var qi=Math.pow;(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[157],{6157:function(vr,vn,mt){"use strict";mt.d(vn,{e:function(){return KO}});var _i={};mt.r(_i),mt.d(_i,{interpolateRgb:function(){return zP}});var mn={};mt.r(mn),mt.d(mn,{interpolateRgb:function(){return qI}});class Gt{static GenAutoIncrementId(){return Gt.auto_increment_id++}}Gt.auto_increment_id=0;class ht{constructor(t){this.id=Gt.GenAutoIncrementId(),this.registry=t}}const re="named",qt="name",bt="unmanaged",Dt="optional",yt="inject",Zt="multi_inject",Jt="inversify:tagged",wt="inversify:tagged_props",Ae="inversify:paramtypes",xt="design:paramtypes",le="pre_destroy";function ve(){return["inject","multi_inject","name","unmanaged","named","optional"]}const st=ve();var hi=mt(34155),Fi=function(n){var t,e;return function(i){const r=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",s=o&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",a=o&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",l=typeof Object.create=="function",h={__proto__:[]}instanceof Array,u=!l&&!h,d={create:l?function(){return V(Object.create(null))}:h?function(){return V({__proto__:null})}:function(){return V({})},has:u?function(L,G){return r.call(L,G)}:function(L,G){return G in L},get:u?function(L,G){return r.call(L,G)?L[G]:void 0}:function(L,G){return L[G]}},c=Object.getPrototypeOf(Function),g=typeof hi=="object"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=g||typeof Map!="function"||typeof Map.prototype.entries!="function"?j():Map,p=((g||typeof Set!="function"||typeof Set.prototype.entries!="function")&&U(),new(g||typeof WeakMap!="function"?W():WeakMap));function v(L,G,K,Y){if(!R(K))throw new TypeError;return A(L,G,K,Y)}function m(L,G,K){if(!R(G))throw new TypeError;return B(K)||(K=k(K)),y(L,G,K)}function C(L,G,K){if(!R(G))throw new TypeError;return B(K)||(K=k(K)),w(L,G,K)}function b(L,G,K){if(!R(G))throw new TypeError;return B(K)||(K=k(K)),S(L,G,K)}function _(L,G,K){let Y=p.get(L);if(B(Y)){if(!K)return;Y=new f,p.set(L,Y)}let nt=Y.get(G);if(B(nt)){if(!K)return;nt=new f,Y.set(G,nt)}return nt}function y(L,G,K){if(w(L,G,K))return!0;const Y=z(G);return!F(Y)&&y(L,Y,K)}function w(L,G,K){const Y=_(G,K,!1);return!B(Y)&&P(Y.has(L))}function S(L,G,K){if(w(L,G,K))return D(L,G,K);const Y=z(G);return F(Y)?void 0:S(L,Y,K)}function D(L,G,K){const Y=_(G,K,!1);if(!B(Y))return Y.get(L)}function A(L,G,K,Y){_(K,Y,!0).set(L,G)}function x(L){if(L===null)return 1;switch(typeof L){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return L===null?1:6;default:return 6}}function B(L){return L===void 0}function F(L){return L===null}function T(L){return typeof L=="symbol"}function R(L){return typeof L=="object"?L!==null:typeof L=="function"}function M(L,G){switch(x(L)){case 0:case 1:case 2:case 3:case 4:case 5:return L}const K=G===3?"string":G===5?"number":"default",Y=O(L,s);if(Y!==void 0){const nt=Y.call(L,K);if(R(nt))throw new TypeError;return nt}return E(L,K==="default"?"number":K)}function E(L,G){if(G==="string"){const K=L.toString;if(H(K)){const nt=K.call(L);if(!R(nt))return nt}const Y=L.valueOf;if(H(Y)){const nt=Y.call(L);if(!R(nt))return nt}}else{const K=L.valueOf;if(H(K)){const nt=K.call(L);if(!R(nt))return nt}const Y=L.toString;if(H(Y)){const nt=Y.call(L);if(!R(nt))return nt}}throw new TypeError}function P(L){return!!L}function I(L){return""+L}function k(L){const G=M(L,3);return T(G)?G:I(G)}function H(L){return typeof L=="function"}function O(L,G){const K=L[G];if(K!=null){if(!H(K))throw new TypeError;return K}}function z(L){const G=Object.getPrototypeOf(L);if(typeof L!="function"||L===c||G!==c)return G;const K=L.prototype,Y=K&&Object.getPrototypeOf(K);if(Y==null||Y===Object.prototype)return G;const nt=Y.constructor;return typeof nt!="function"||nt===L?G:nt}function j(){const L={},G=[],K=function(){function ot(at,et,ft){this._index=0,this._keys=at,this._values=et,this._selector=ft}return ot.prototype["@@iterator"]=function(){return this},ot.prototype[a]=function(){return this},ot.prototype.next=function(){const at=this._index;if(at>=0&&at<this._keys.length){const et=this._selector(this._keys[at],this._values[at]);return at+1>=this._keys.length?(this._index=-1,this._keys=G,this._values=G):this._index++,{value:et,done:!1}}return{value:void 0,done:!0}},ot.prototype.throw=function(at){throw this._index>=0&&(this._index=-1,this._keys=G,this._values=G),at},ot.prototype.return=function(at){return this._index>=0&&(this._index=-1,this._keys=G,this._values=G),{value:at,done:!0}},ot}();return function(){function ot(){this._keys=[],this._values=[],this._cacheKey=L,this._cacheIndex=-2}return Object.defineProperty(ot.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ot.prototype.has=function(at){return this._find(at,!1)>=0},ot.prototype.get=function(at){const et=this._find(at,!1);return et>=0?this._values[et]:void 0},ot.prototype.set=function(at,et){const ft=this._find(at,!0);return this._values[ft]=et,this},ot.prototype.delete=function(at){const et=this._find(at,!1);if(et>=0){const ft=this._keys.length;for(let tt=et+1;tt<ft;tt++)this._keys[tt-1]=this._keys[tt],this._values[tt-1]=this._values[tt];return this._keys.length--,this._values.length--,at===this._cacheKey&&(this._cacheKey=L,this._cacheIndex=-2),!0}return!1},ot.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=L,this._cacheIndex=-2},ot.prototype.keys=function(){return new K(this._keys,this._values,Y)},ot.prototype.values=function(){return new K(this._keys,this._values,nt)},ot.prototype.entries=function(){return new K(this._keys,this._values,q)},ot.prototype["@@iterator"]=function(){return this.entries()},ot.prototype[a]=function(){return this.entries()},ot.prototype._find=function(at,et){return this._cacheKey!==at&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=at)),this._cacheIndex<0&&et&&(this._cacheIndex=this._keys.length,this._keys.push(at),this._values.push(void 0)),this._cacheIndex},ot}();function Y(ot,at){return ot}function nt(ot,at){return at}function q(ot,at){return[ot,at]}}function U(){return function(){function L(){this._map=new f}return Object.defineProperty(L.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),L.prototype.has=function(G){return this._map.has(G)},L.prototype.add=function(G){return this._map.set(G,G),this},L.prototype.delete=function(G){return this._map.delete(G)},L.prototype.clear=function(){this._map.clear()},L.prototype.keys=function(){return this._map.keys()},L.prototype.values=function(){return this._map.values()},L.prototype.entries=function(){return this._map.entries()},L.prototype["@@iterator"]=function(){return this.keys()},L.prototype[a]=function(){return this.keys()},L}()}function W(){const G=d.create(),K=Y();return function(){function et(){this._key=Y()}return et.prototype.has=function(ft){const tt=nt(ft,!1);return tt!==void 0&&d.has(tt,this._key)},et.prototype.get=function(ft){const tt=nt(ft,!1);return tt!==void 0?d.get(tt,this._key):void 0},et.prototype.set=function(ft,tt){return nt(ft,!0)[this._key]=tt,this},et.prototype.delete=function(ft){const tt=nt(ft,!1);return tt!==void 0&&delete tt[this._key]},et.prototype.clear=function(){this._key=Y()},et}();function Y(){let et;do et="@@WeakMap@@"+at();while(d.has(G,et));return G[et]=!0,et}function nt(et,ft){if(!r.call(et,K)){if(!ft)return;Object.defineProperty(et,K,{value:d.create()})}return et[K]}function q(et,ft){for(let tt=0;tt<ft;++tt)et[tt]=255*Math.random()|0;return et}function ot(et){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(et)):q(new Uint8Array(et),et):q(new Array(et),et)}function at(){const et=ot(16);et[6]=79&et[6]|64,et[8]=191&et[8]|128;let ft="";for(let tt=0;tt<16;++tt){const dt=et[tt];tt!==4&&tt!==6&&tt!==8||(ft+="-"),dt<16&&(ft+="0"),ft+=dt.toString(16).toLowerCase()}return ft}}function V(L){return L.__=void 0,delete L.__,L}i("defineMetadata",v),i("hasMetadata",m),i("hasOwnMetadata",C),i("getMetadata",b)}((t=n,function(i,r){typeof t[i]!="function"&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:r}),e&&e(i,r)})),n}({});function Z(){return function(n){return Fi.defineMetadata(Ae,null,n),n}}class Lr{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===re?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}function bw(n,t,e,i){const r=[i];let o={};Fi.hasOwnMetadata(n,t)&&(o=Fi.getMetadata(n,t));let s=o[e];s===void 0&&(s=[]),s.push(...r),o[e]=s,Fi.defineMetadata(n,o,t)}function _w(n,t,e,i){bw(Jt,n,e.toString(),i)}function I0(n){return(t,e,i)=>{_w(t,e,i,n)}}function O0(n){return t=>(e,i,r)=>I0(new Lr(n,t))(e,i,r)}const At=O0(yt);function Ne(n){return I0(new Lr(re,n))}const Le=Symbol("ContributionProvider");class z0{constructor(t,e){this.serviceIdentifier=t,this.container=e}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function Qe(n,t){n(Le).toDynamicValue(({container:e})=>new z0(t,e)).inSingletonScope().whenTargetNamed(t)}function yw(n,t){n(Le).toDynamicValue(({container:e})=>new z0(t,e)).whenTargetNamed(t)}class ww{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i=typeof t=="string"?t.trim():t.name;i&&(this.taps=this.taps.filter(r=>r.name!==i&&(!e||r.fn===e)))}_parseOptions(t,e,i){let r;if(typeof e=="string")r={name:e.trim()};else if(typeof e!="object"||e===null)throw new Error("Invalid tap options");if(typeof r.name!="string"||r.name==="")throw new Error("Missing name for tap");return r=Object.assign({type:t,fn:i},r),r}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;typeof t.before=="string"?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;typeof t.stage=="number"&&(i=t.stage);let r=this.taps.length;for(;r>0;){r--;const o=this.taps[r];this.taps[r+1]=o;const s=o.stage||0;if(e){if(e.has(o.name)){e.delete(o.name);continue}if(e.size>0)continue}if(!(s>i)){r++;break}}this.taps[r]=t}}class Hi extends ww{call(...t){this.taps.map(e=>e.fn).forEach(e=>e(...t))}}const Ja=Symbol.for("EnvContribution"),Ad=Symbol.for("VGlobal");var Dw=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Sw=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},W0=function(n,t){return function(e,i){t(e,i,n)}};const $O="browser";let xd=class{get env(){return this._env}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(n){this._env||this.setEnv("browser"),this.envContribution.supportEvent=n}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=n}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=n}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=n}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(n){this._env||this.setEnv("browser"),this.envContribution.applyStyles=n}constructor(n){this.contributions=n,this.id=Gt.GenAutoIncrementId(),this.hooks={onSetEnv:new Hi(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(n){const t=[];if(this.contributions.getContributions().forEach(e=>{const i=e.configure(this,n);i&&i.then&&t.push(i)}),t.length)return Promise.all(t)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(n,t){if(t&&t.force===!0||this._env!==n)return this.deactiveCurrentEnv(),this.activeEnv(n,t)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(n,t){const e=this._env;this._env=n;const i=this.bindContribution(t);if(i&&i.then)return i.then(()=>{this.envParams=t,this.hooks.onSetEnv.call(e,n,this)});this.envParams=t,this.hooks.onSetEnv.call(e,n,this)}setActiveEnvContribution(n){this.envContribution=n}createCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(n)}createOffscreenCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(n)}releaseCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(n)}addEventListener(n,t,e){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(n,t,e)}removeEventListener(n,t,e){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(n,t,e)}dispatchEvent(n){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(n)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(n){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(n):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(n,t){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(n,t):null}loadImage(n){return this._env||this.setEnv("browser"),this.envContribution.loadImage(n)}loadSvg(n){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(n)}loadJson(n){return this._env||this.setEnv("browser"),this.envContribution.loadJson(n)}loadArrayBuffer(n){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(n)}loadBlob(n){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(n)}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(n){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(n)}removeDom(n){return this._env||this.setEnv("browser"),this.envContribution.removeDom(n)}createDom(n){return this._env||this.setEnv("browser"),this.envContribution.createDom(n)}getElementTop(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(n,t)}getElementLeft(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(n,t)}getElementTopLeft(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(n,t)}};xd=Dw([Z(),W0(0,At(Le)),W0(0,Ne(Ja)),Sw("design:paramtypes",[Object])],xd);const Lt=1e-12,Kt=Math.PI,Zi=Kt/2,ti=2*Kt,XO=4,qO=.001,ZO=1e-7,JO=10,Rt=2*Math.PI,kt=Math.abs,zt=Math.atan2,Ut=Math.cos,Cn=Math.max,Ue=Math.min,It=Math.sin,yi=Math.sqrt,so=Math.pow;function N0(n){return n>1?0:n<-1?Kt:Math.acos(n)}function j0(n){return n>=1?Zi:n<=-1?-Zi:Math.asin(n)}function V0(n,t,e,i,r){let o,s;return typeof n=="number"&&typeof e=="number"&&(o=(1-r)*n+r*e),typeof t=="number"&&typeof i=="number"&&(s=(1-r)*t+r*i),{x:o,y:s}}function QO(n,t,e){const i=e.x-t.x,r=e.y-t.y,o=n.x-t.x,s=n.y-t.y;return Math.abs(i*s-o*r)/Math.sqrt(i*i+r*r)}function tz(n,t){return n[0]*t[1]-n[1]*t[0]}function ez(n,t){return n.x*t.y-n.y*t.x}function iz(n,t){return kt(n-t)<1e-12}function nz(n,t){return kt(n[0]-t[0])+kt(n[1]-t[1])<1e-12}function G0(n,t=10){return Math.round(n*t)/t}function Qa(n){const t=n.toString().split(/[eE]/),e=(t[0].split(".")[1]||"").length-(+t[1]||0);return e>0?e:0}function rz(n,t){return G0(n+t,qi(10,Math.max(Qa(n),Qa(t))))}function oz(n,t){return G0(n-t,qi(10,Math.max(Qa(n),Qa(t))))}function ao(n){return n*(Math.PI/180)}function Aw(n){return 180*n/Math.PI}const xw=(n=0)=>{if(n<0)for(;n<-ti;)n+=ti;else if(n>0)for(;n>ti;)n-=ti;return n},az=(n=0)=>n>360||n<-360?n%360:n,lz=null;function hz(n,t,e){return{x:n.x+t*Math.cos(e),y:n.y+t*Math.sin(e)}}function uz(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}class je{constructor(t=1,e=0,i=0,r=1,o=0,s=0){this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=s}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,r,o,s){return!(this.e!==o||this.f!==s||this.a!==t||this.d!==r||this.b!==e||this.c!==i)}setValue(t,e,i,r,o,s){return this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=s,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,r=this.d,o=this.e,s=this.f,a=new je,l=t*r-e*i;return a.a=r/l,a.b=-e/l,a.c=-i/l,a.d=t/l,a.e=(i*s-r*o)/l,a.f=-(t*s-e*o)/l,a}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a*e+this.c*i,o=this.b*e+this.d*i,s=this.a*-i+this.c*e,a=this.b*-i+this.d*e;return this.a=r,this.b=o,this.c=s,this.d=a,this}rotateByCenter(t,e,i){const r=Math.cos(t),o=Math.sin(t),s=(1-r)*e+o*i,a=(1-r)*i-o*e,l=r*this.a-o*this.b,h=o*this.a+r*this.b,u=r*this.c-o*this.d,d=o*this.c+r*this.d,c=r*this.e-o*this.f+s,g=o*this.e+r*this.f+a;return this.a=l,this.b=h,this.c=u,this.d=d,this.e=c,this.f=g,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,r,o,s){return this.multiply(t,e,i,r,o,s),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:r,e:o,f:s}=this;return this.a=e,this.b=t,this.c=r,this.d=i,this.e=s,this.f=o,this}multiply(t,e,i,r,o,s){const a=this.a,l=this.b,h=this.c,u=this.d,d=a*t+h*e,c=l*t+u*e,g=a*i+h*r,f=l*i+u*r,p=a*o+h*s+this.e,v=l*o+u*s+this.f;return this.a=d,this.b=c,this.c=g,this.d=f,this.e=p,this.f=v,this}interpolate(t,e){const i=new je;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:r,c:o,d:s,e:a,f:l}=this,h=i*s-r*o,u=s/h,d=-r/h,c=-o/h,g=i/h,f=(o*l-s*a)/h,p=-(i*l-r*a)/h,{x:v,y:m}=t;e.x=v*u+m*c+f,e.y=v*d+m*g+p}onlyTranslate(t=1){return this.a===t&&this.b===0&&this.c===0&&this.d===t}clone(){return new je(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,r=this.d,o=t*r-e*i,s={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!==0||e!==0){const a=Math.sqrt(t*t+e*e);s.rotateDeg=e>0?Math.acos(t/a):-Math.acos(t/a),s.scaleX=a,s.scaleY=o/a,s.skewX=(t*i+e*r)/o,s.skewY=0}else if(i!==0||r!==0){const a=Math.sqrt(i*i+r*r);s.rotateDeg=Math.PI/2-(r>0?Math.acos(-i/a):-Math.acos(i/a)),s.scaleX=o/a,s.scaleY=a,s.skewX=0,s.skewY=(t*i+e*r)/o}return s.rotateDeg=Aw(s.rotateDeg),s}}function Bw(n,t,e,i,r,o,s,a){const l=t.a,h=t.b,u=t.c,d=t.d,c=t.e,g=t.f,f=Ut(s),p=It(s);let v,m;a?(v=a[0],m=a[1]):(v=e,m=i);const C=v-e,b=m-i,_=l*f+u*p,y=h*f+d*p,w=u*f-l*p,S=d*f-h*p;n.a=r*_,n.b=r*y,n.c=o*w,n.d=o*S,n.e=c+l*v+u*m-_*C-w*b,n.f=g+h*v+d*m-y*C-S*b}var lo=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,lt=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||lo(n,"Number")};const Fw=typeof console!="undefined";function tl(n,t,e){const i=[t].concat([].slice.call(e));Fw&&console[n].apply(console,i)}var bn;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})(bn||(bn={}));class te{static getInstance(t,e){return te._instance&&lt(t)?te._instance.level(t):te._instance||(te._instance=new te(t,e)),te._instance}static setInstance(t){return te._instance=t}static setInstanceLevel(t){te._instance?te._instance.level(t):te._instance=new te(t)}static clearInstance(){te._instance=null}constructor(t=bn.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find(e=>e===t)||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex(i=>i===t);e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach(e=>e(...t))}canLogInfo(){return this._level>=bn.Info}canLogDebug(){return this._level>=bn.Debug}canLogError(){return this._level>=bn.Error}canLogWarn(){return this._level>=bn.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=bn.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):tl((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=bn.Warn&&tl(this._method||"warn","WARN",t),this}info(...t){return this._level>=bn.Info&&tl(this._method||"log","INFO",t),this}debug(...t){return this._level>=bn.Debug&&tl(this._method||"log","DEBUG",t),this}}te._instance=null;const Tw=ti-1e-8;class U0{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,r,o,s){if(Math.abs(o-r)>Tw)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let a,l,h,u,d=1/0,c=-1/0,g=1/0,f=-1/0;function p(v){h=i*Math.cos(v),u=i*Math.sin(v),h<d&&(d=h),h>c&&(c=h),u<g&&(g=u),u>f&&(f=u)}if(p(r),p(o),o!==r)if((r%=ti)<0&&(r+=ti),(o%=ti)<0&&(o+=ti),o<r&&(s=!s,a=r,r=o,o=a),s)for(o-=ti,a=r-r%Zi,l=0;l<4&&a>o;++l,a-=Zi)p(a);else for(a=r-r%Zi+Zi,l=0;l<4&&a<o;++l,a+=Zi)p(a);this.bounds.add(t+d,e+g),this.bounds.add(t+c,e+f)}arcTo(t,e,i,r,o){throw new Error("\u4E0D\u652F\u6301arcTo")}bezierCurveTo(t,e,i,r,o,s){this.bounds.add(t,e),this.bounds.add(i,r),this.bounds.add(o,s)}closePath(){}ellipse(){throw new Error("\u4E0D\u652F\u6301ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,r){this.bounds.add(t,e),this.bounds.add(i,r)}rect(t,e,i,r){this.bounds.add(t,e),this.bounds.add(t+i,e+r)}clear(){this.bounds.clear()}release(...t){}}var rt=n=>Array.isArray?Array.isArray(n):lo(n,"Array");function Bd(n,t,e){const{x1:i,y1:r,x2:o,y2:s}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*o+e.c*r+e.e,e.b*o+e.d*r+e.f),n.add(e.a*o+e.c*s+e.e,e.b*o+e.d*s+e.f),n.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),t)}function fz(n,t,e,i,r,o,s){if(!(abs(i)<=epsilon||abs(r)<=epsilon)){if(i!==1&&n.scaleX(i),r!==1&&n.scaleY(r),isFinite(o)&&Math.abs(o)>epsilon){let a=0,l=0;s!==void 0&&(a=s[0],l=s[1]),n.rotate(o,a,l)}n.translate(t,e)}}class Ji{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new Ji(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return rt(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return Bd(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:s,y2:a}=this,l=Math.cos(t),h=Math.sin(t),u=e-e*l+i*h,d=i-e*h-i*l;return[l*r-h*o+u,h*r+l*o+d,l*r-h*a+u,h*r+l*a+d,l*s-h*o+u,h*s+l*o+d,l*s-h*a+u,h*s+l*a+d]}scalePoints(t,e,i,r){const{x1:o,y1:s,x2:a,y2:l}=this;return[t*o+(1-t)*i,e*s+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}}class me extends Ji{}class pz extends null{}class Mw{constructor(){this.curves=[],this.bounds=new me}getCurveLengths(){return this.curves.map(t=>t.getLength())}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const Rw=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,Ew={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},Wt={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let Fd,K0,el,Y0,Td,il;function Pw(n){if(!n)return[];const t=n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(t===null)return[];let e,i;const r=[];for(let o=0,s=t.length;o<s;o++)if(Fd=t[o],K0=Fd.slice(1),el=Fd[0],e=[el],i=K0.match(Rw),i!==null){for(let a=0,l=i.length;a<l;a++)Y0=i[a],Td=parseFloat(Y0),Number.isNaN(Td)||e.push(Td);if(il=Ew[el],e.length-1>il){let a;for(let l=1,h=e.length;l<h;l+=il){a=[el];for(let u=l,d=l+il;u<d;u++)a.push(e[u]);r.push(a)}}else r.push(e)}else r.push(e);return r}var Yt;(function(n){n[n.NONE=0]="NONE",n[n.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",n[n.UPDATE_SHAPE=2]="UPDATE_SHAPE",n[n.CLEAR_SHAPE=253]="CLEAR_SHAPE",n[n.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",n[n.INIT=179]="INIT",n[n.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",n[n.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",n[n.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",n[n.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",n[n.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",n[n.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",n[n.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",n[n.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(Yt||(Yt={}));var ps;(function(n){n[n.GLOBAL=1]="GLOBAL",n[n.LOCAL=16]="LOCAL",n[n.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",n[n.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(ps||(ps={}));var Ti;(function(n){n[n.INIT=0]="INIT",n[n.DEFAULT=1]="DEFAULT",n[n.STATE=2]="STATE",n[n.ANIMATE_BIND=10]="ANIMATE_BIND",n[n.ANIMATE_PLAY=11]="ANIMATE_PLAY",n[n.ANIMATE_START=12]="ANIMATE_START",n[n.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",n[n.ANIMATE_END=14]="ANIMATE_END",n[n.TRANSLATE=20]="TRANSLATE",n[n.TRANSLATE_TO=21]="TRANSLATE_TO",n[n.SCALE=22]="SCALE",n[n.SCALE_TO=23]="SCALE_TO",n[n.ROTATE=24]="ROTATE",n[n.ROTATE_TO=25]="ROTATE_TO"})(Ti||(Ti={}));var ui;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSED=2]="PAUSED",n[n.END=3]="END"})(ui||(ui={}));var nl;(function(n){n[n.NORMAL=0]="NORMAL",n[n.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"})(nl||(nl={}));var ho;(function(n){n.wait="wait",n.from="from",n.to="to",n.customAnimate="customAnimate"})(ho||(ho={}));var he;(function(n){n[n.ROW=1]="ROW",n[n.COLUMN=2]="COLUMN"})(he||(he={}));var rl;(function(n){n[n.CubicBezierCurve=0]="CubicBezierCurve",n[n.QuadraticBezierCurve=1]="QuadraticBezierCurve",n[n.ArcCurve=2]="ArcCurve",n[n.LineCurve=3]="LineCurve",n[n.EllipseCurve=4]="EllipseCurve",n[n.MoveCurve=5]="MoveCurve"})(rl||(rl={}));var Nt;(function(n){n[n.beforeFillStroke=0]="beforeFillStroke",n[n.afterFillStroke=1]="afterFillStroke"})(Nt||(Nt={}));function Hw(n,t,e,i,r,o,s,a,l){const h=ao(s),u=Math.sin(h),d=Math.cos(h),c=d*(a-n)*.5+u*(l-t)*.5,g=d*(l-t)*.5-u*(a-n)*.5;let f=c*c/((e=Math.abs(e))*e)+g*g/((i=Math.abs(i))*i);f>1&&(f=Math.sqrt(f),e*=f,i*=f);const p=d/e,v=u/e,m=-u/i,C=d/i,b=p*a+v*l,_=m*a+C*l,y=p*n+v*t,w=m*n+C*t;let S=1/((y-b)*(y-b)+(w-_)*(w-_))-.25;S<0&&(S=0);let D=Math.sqrt(S);o===r&&(D=-D);const A=.5*(b+y)-D*(w-_),x=.5*(_+w)+D*(y-b),B=Math.atan2(_-x,b-A);let F=Math.atan2(w-x,y-A)-B;F<0&&o===1?F+=ti:F>0&&o===0&&(F-=ti);const T=Math.ceil(Math.abs(F/(Zi+.001))),R=[];for(let M=0;M<T;++M){const E=B+M*F/T,P=B+(M+1)*F/T;R[M]=[A,x,E,P,e,i,u,d]}return R}function Lw(n){const t=n[0],e=n[1],i=n[2],r=n[3],o=n[4],s=n[5],a=n[6],l=n[7],h=l*o,u=-a*s,d=a*o,c=l*s,g=Math.cos(i),f=Math.sin(i),p=Math.cos(r),v=Math.sin(r),m=.5*(r-i),C=Math.sin(.5*m),b=8/3*C*C/Math.sin(m),_=t+g-b*f,y=e+f+b*g,w=t+p,S=e+v,D=w+b*v,A=S-b*p;return[h*_+u*y,d*_+c*y,h*D+u*A,d*D+c*A,h*w+u*S,d*w+c*S]}function $0(n,t,e,i){const r=Hw(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,e);for(let o=0;o<r.length;++o){const s=Lw(r[o]);n.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}const kw=(n,t,e,i,r,o,s)=>{const a=Math.abs(e-t),l=4*Math.tan(a/4)/3,h=e<t?-1:1,u=Math.cos(t),d=Math.sin(t),c=Math.cos(e),g=Math.sin(e),f=u*o+i,p=d*s+r,v=c*o+i,m=g*s+r,C=o*l*h,b=s*l*h;n.push(f-C*d,p+b*u,v+C*g,m-b*c,v,m)},Iw=[(n,t,e,i,r,o,s)=>t.arc(n[1]*r+e,n[2]*o+i,n[3]*(r+o)/2,n[4],n[5],n[6],s),(n,t,e,i,r,o,s)=>t.arcTo(n[1]*r+e,n[2]*o+i,n[3]*r+e,n[4]*o+i,n[5]*(r+o)/2,s),(n,t,e,i,r,o,s)=>t.bezierCurveTo(n[1]*r+e,n[2]*o+i,n[3]*r+e,n[4]*o+i,n[5]*r+e,n[6]*o+i,s),(n,t,e,i)=>t.closePath(),(n,t,e,i,r,o)=>t.ellipse(n[1]*r+e,n[2]*o+i,n[3]*r,n[4]*o,n[5],n[6],n[7],n[8]),(n,t,e,i,r,o,s)=>t.lineTo(n[1]*r+e,n[2]*o+i,s),(n,t,e,i,r,o,s)=>t.moveTo(n[1]*r+e,n[2]*o+i,s),(n,t,e,i,r,o,s)=>t.quadraticCurveTo(n[1]*r+e,n[2]*o+i,n[3]*r+e,n[4]*o+i,s),(n,t,e,i,r,o,s)=>t.rect(n[1]*r+e,n[2]*o+i,n[3]*r,n[4]*o,s)];function Yn(n,t,e=0,i=0,r=1,o=1,s){for(let a=0;a<n.length;a++){const l=n[a];Iw[l[0]](l,t,e,i,r,o,s)}}class xe{constructor(t=0,e=0,i,r){this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=r}clone(){return new xe(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return lt(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return lt(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("\u6682\u4E0D\u652F\u6301")}div(t){throw new Error("\u6682\u4E0D\u652F\u6301")}}class _n{static distancePP(t,e){return yi(so(t.x-e.x,2)+so(t.y-e.y,2))}static distanceNN(t,e,i,r){return yi(so(t-i,2)+so(e-r,2))}static distancePN(t,e,i){return yi(so(e-t.x,2)+so(i-t.y,2))}static pointAtPP(t,e,i){return new xe((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}class X0{constructor(t=0,e=0,i,r){this.r=0,this.theta=0,this.r=t,this.theta=e,this.r1=i,this.theta1=r}clone(){return new X0(this.r,this.theta)}copyFrom(t){return this.r=t.r,this.theta=t.theta,this.r1=t.r1,this.theta1=t.theta1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.r=t,this.theta=e,this}}class q0{getLength(t){return t!=null?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function Ow(n,t){let e=0;const i=n.length;for(let r=0;r<i;r++){const o=n[r],s=t[r],a=n[(r+1)%i],l=t[(r+1)%i];e+=_n.distanceNN(o,s,a,l)}return e/2}function zw(n,t,e,i,r){return Ow([n.x,t.x,e.x,i.x],[n.y,t.y,e.y,i.y])}function Z0(n,t,e,i,r){const o=1-r;return o*o*o*n+3*t*r*o*o+3*e*r*r*o+i*r*r*r}function J0(n,t,e,i,r){const o=Z0(n.x,t.x,e.x,i.x,r),s=Z0(n.y,t.y,e.y,i.y,r);return new xe(o,s)}function Md(n,t){const{p0:e,p1:i,p2:r,p3:o}=n,s=J0(e,i,r,o,t),a=_n.pointAtPP(e,i,t),l=_n.pointAtPP(i,r,t),h=_n.pointAtPP(r,o,t),u=_n.pointAtPP(a,l,t),d=_n.pointAtPP(l,h,t);return[new Rd(e,a,u,s),new Rd(s,d,h,o)]}class Rd extends q0{constructor(t,e,i,r){super(),this.type=rl.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(this.defined!==!1)return J0(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined\u4E3Afalse\u7684\u70B9\u4E0D\u80FDgetPointAt")}calcLength(){return this._validPoint()?zw(this.p0,this.p1,this.p2,this.p3,0):60}calcProjLength(t){return t===he.ROW?kt(this.p0.x-this.p3.x):t===he.COLUMN?kt(this.p0.y-this.p3.y):0}getAngleAt(t){const e=Cn(t-.01,0),i=Ue(t+.01,1),r=this.getPointAt(e),o=this.getPointAt(i);return zt(o.y-r.y,o.x-r.x)}}function Q0(n,t){const{p0:e,p1:i}=n,r=_n.pointAtPP(e,i,t);return[new Ed(e,r),new Ed(r,i)]}class Ed extends q0{constructor(t,e){super(),this.type=rl.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(this.defined!==!1)return _n.pointAtPP(this.p0,this.p1,t);throw new Error("defined\u4E3Afalse\u7684\u70B9\u4E0D\u80FDgetPointAt")}getAngleAt(t){return this.angle==null&&(this.angle=zt(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?_n.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===he.ROW?kt(this.p0.x-this.p1.x):t===he.COLUMN?kt(this.p0.y-this.p1.y):0}}class Pd{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,r,o,s,a,l){const h=new Rd(new xe(this._lastX,this._lastY),new xe(t,e),new xe(i,r),new xe(o,s));h.originP1=this._lastOriginP,h.originP2=l,h.defined=a,this.curves.push(h),this._lastX=o,this._lastY=s,this._lastOriginP=l}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext\u4E0D\u652F\u6301\u8C03\u7528ellipse")}lineTo(t,e,i,r){const o=this.addLinearCurve(t,e,i,this._lastOriginP,r);this.curves.push(o),this._lastX=t,this._lastY=e,this._lastOriginP=r}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,r){throw new Error("SegContext\u4E0D\u652F\u6301\u8C03\u7528quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,r,o){const s=new Ed(new xe(this._lastX,this._lastY),new xe(t,e));return s.originP1=r,s.originP2=o,s.defined=i,s}getPointAt(t){throw new Error("\u6682\u672A\u5B9E\u73B0")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===he.COLUMN){if(!this.curves.length)return 0;const r=this.curves[0],o=this.curves[this.curves.length-1],s=(e=o.p3)!==null&&e!==void 0?e:o.p1;return kt(r.p0.y-s.y)}if(t===he.ROW){if(!this.curves.length)return 0;const r=this.curves[0],o=this.curves[this.curves.length-1],s=(i=o.p3)!==null&&i!==void 0?i:o.p1;return kt(r.p0.x-s.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((r,o)=>r+o.getLength(),0)),this.length}}class Ww extends Pd{bezierCurveTo(t,e,i,r,o,s,a,l){return super.bezierCurveTo(e,t,r,i,s,o,a,l)}lineTo(t,e,i,r){return super.lineTo(e,t,i,r)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function uo(n,t,e=1){let i=!1;for(let r=0,o=t.length;r<=o;r++)r>=o===i&&((i=!i)?n.lineStart():n.lineEnd()),i&&n.point(t[r])}function vs(n,t,e){const i=t!=null?t:kt(e[e.length-1].x-e[0].x)>kt(e[e.length-1].y-e[0].y)?he.ROW:he.COLUMN;return n==="monotoneY"?new Ww(n,i):new Pd(n,i)}class tp{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function ms(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=vs("linear",e,n);return Nw(new tp(r,i),n),r}function Nw(n,t){return uo(n,t,1)}function ep(n,t,e,i,r){n.context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+t)/6,(n._y0+4*n._y1+e)/6,i,n.lastPoint1)}class jw{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&ep(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:ep(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function Vw(n,t){return uo(n,t,2)}function ip(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return ms(n,t);const r=vs("basis",e,n);return Vw(new jw(r,i),n),r}function np(n){return n<0?-1:1}function rp(n,t,e){const i=n._x1-n._x0,r=t-n._x1,o=(n._y1-n._y0)/(i||Number(r<0&&-0)),s=(e-n._y1)/(r||Number(i<0&&-0)),a=(o*r+s*i)/(i+r);return(np(o)+np(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function op(n,t){const e=n._x1-n._x0;return e?(3*(n._y1-n._y0)/e-t)/2:t}function Hd(n,t,e,i,r){const o=n._x0,s=n._y0,a=n._x1,l=n._y1,h=(a-o)/3;n.context.bezierCurveTo(o+h,s+h*t,a-h,l-h*e,a,l,i,n.lastPoint1)}class sp{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:Hd(this,this._t0,op(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,r=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(i,r,t);break;case 1:this._point=2;break;case 2:this._point=3,Hd(this,op(this,e=rp(this,i,r)),e,this._lastDefined1!==!1&&this._lastDefined2!==!1,t);break;default:Hd(this,this._t0,e=rp(this,i,r),this._lastDefined1!==!1&&this._lastDefined2!==!1,t)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class Gw extends sp{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function Uw(n,t){return uo(n,t,2)}function ap(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return ms(n,t);const r=vs("monotoneX",e,n);return Uw(new sp(r,i),n),r}function Kw(n,t){return uo(n,t,2)}function lp(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return ms(n,t);const r=vs("monotoneY",e,n);return Kw(new Gw(r,i),n),r}class Yw{constructor(t,e=.5,i){this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t);else{const r=this._x*(1-this._t)+e*this._t;this.context.lineTo(r,this._y,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(r,i,this._lastDefined!==!1&&t.defined!==!1,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function co(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const o=new Pd("step",i!=null?i:kt(n[n.length-1].x-n[0].x)>kt(n[n.length-1].y-n[0].y)?he.ROW:he.COLUMN);return $w(new Yw(o,t,r),n),o}function $w(n,t){return uo(n,t,1)}class Xw extends tp{lineEnd(){this.context.closePath()}}function hp(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=vs("linear",e,n);return qw(new Xw(r,i),n),r}function qw(n,t){return uo(n,t,1)}function Ld(n,t,e){switch(t){case"linear":default:return ms(n,e);case"basis":return ip(n,e);case"monotoneX":return ap(n,e);case"monotoneY":return lp(n,e);case"step":return co(n,.5,e);case"stepBefore":return co(n,0,e);case"stepAfter":return co(n,1,e);case"linearClosed":return hp(n,e)}}class Ke extends Mw{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new U0(this.bounds)}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([Wt.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([Wt.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.commandList.push([Wt.Q,t,e,i,r]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,o,s){return this.commandList.push([Wt.C,t,e,i,r,o,s]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,r,o,s),this}arcTo(t,e,i,r,o){return this.commandList.push([Wt.AT,t,e,i,r,o]),this._ctx&&this._ctx.arcTo(t,e,i,r,o),this}ellipse(t,e,i,r,o,s,a,l){return this.commandList.push([Wt.E,t,e,i,r,o,s,a,l]),this._ctx&&this._ctx.ellipse(t,e,i,r,o,s,a,l),this}rect(t,e,i,r){return this.commandList.push([Wt.R,t,e,i,r]),this._ctx&&this._ctx.rect(t,e,i,r),this}arc(t,e,i,r,o,s){return this.commandList.push([Wt.A,t,e,i,r,o,s]),this._ctx&&this._ctx.arc(t,e,i,r,o,s),this}closePath(){return this.commandList.push([Wt.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this.curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this.curves.length=0}beginPath(){this.clear()}toString(){if(!this.toStringCbList){const i=[];i[Wt.M]=r=>`M${r[1]} ${r[2]}`,i[Wt.L]=r=>`L${r[1]} ${r[2]}`,i[Wt.Q]=r=>`Q${r[1]} ${r[2]} ${r[3]} ${r[4]}`,i[Wt.C]=r=>`C${r[1]} ${r[2]} ${r[3]} ${r[4]} ${r[5]} ${r[6]}`,i[Wt.A]=r=>{const o=[];kw(o,r[4],r[5],r[1],r[2],r[3],r[3]);let s="";for(let a=0;a<o.length;a+=6)s+=`C${o[a]} ${o[a+1]} ${o[a+2]} ${o[a+3]} ${o[a+4]} ${o[a+5]}`;return s},i[Wt.R]=r=>`M${r[1]} ${r[2]} h${r[3]} v${r[4]} H${r[1]}Z`,i[Wt.Z]=r=>"Z",this.toStringCbList=i}const t=this.toStringCbList;let e="";return this.commandList.forEach(i=>{e+=t[i[0]](i)}),e}fromString(t,e,i,r,o){this.clear();const s=Pw(t);return this._runCommandStrList(s,e,i,r,o),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:r}=t.attribute;if(!e)return;const o=Ld(e,i);r==="x"?this.direction=he.ROW:r==="y"?this.direction=he.COLUMN:r==="auto"&&(this.direction=o.direction),this.curves=o.curves}fromCustomPath2D(t,e,i,r,o){return this.clear(),this._runCommandList(t.commandList,e,i,r,o),this._updateBounds(),this}transform(t,e,i,r){const o=this.commandList;if(!this.transformCbList){const s=[];s[Wt.M]=this.moveToTransform,s[Wt.L]=this.lineToTransform,s[Wt.Q]=this.quadraticCurveToTransform,s[Wt.C]=this.bezierCurveToTransform,s[Wt.AT]=this.arcToTransform,s[Wt.E]=this.ellipseTransform,s[Wt.R]=this.rectTransform,s[Wt.A]=this.arcTransform,s[Wt.Z]=this.closePathTransform,this.transformCbList=s}o.forEach(s=>{this.transformCbList[s[0]](s,t,e,i,r)}),this._updateBounds()}moveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}lineToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}quadraticCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i}bezierCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*r+e,t[6]=t[6]*o+i}arcToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*(r+o)/2}ellipseTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}rectTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}arcTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*(r+o)/2}closePathTransform(){}_runCommandStrList(t,e=0,i=0,r=1,o=1){let s,a,l,h,u,d=null,c=0,g=0,f=0,p=0;for(let v=0,m=t.length;v<m;++v){switch(s=t[v],r===1&&o===1||(s=Zw(s,r,o)),s[0]){case"l":c+=s[1],g+=s[2],this.lineTo(c+e,g+i);break;case"L":c=s[1],g=s[2],this.lineTo(c+e,g+i);break;case"h":c+=s[1],this.lineTo(c+e,g+i);break;case"H":c=s[1],this.lineTo(c+e,g+i);break;case"v":g+=s[1],this.lineTo(c+e,g+i);break;case"V":g=s[1],this.lineTo(c+e,g+i);break;case"m":c+=s[1],g+=s[2],this.moveTo(c+e,g+i);break;case"M":c=s[1],g=s[2],this.moveTo(c+e,g+i);break;case"c":a=c+s[5],l=g+s[6],f=c+s[3],p=g+s[4],this.bezierCurveTo(c+s[1]+e,g+s[2]+i,f+e,p+i,a+e,l+i),c=a,g=l;break;case"C":c=s[5],g=s[6],f=s[3],p=s[4],this.bezierCurveTo(s[1]+e,s[2]+i,f+e,p+i,c+e,g+i);break;case"s":a=c+s[3],l=g+s[4],f=2*c-f,p=2*g-p,this.bezierCurveTo(f+e,p+i,c+s[1]+e,g+s[2]+i,a+e,l+i),f=c+s[1],p=g+s[2],c=a,g=l;break;case"S":a=s[3],l=s[4],f=2*c-f,p=2*g-p,this.bezierCurveTo(f+e,p+i,s[1]+e,s[2]+i,a+e,l+i),c=a,g=l,f=s[1],p=s[2];break;case"q":a=c+s[3],l=g+s[4],f=c+s[1],p=g+s[2],this.quadraticCurveTo(f+e,p+i,a+e,l+i),c=a,g=l;break;case"Q":a=s[3],l=s[4],this.quadraticCurveTo(s[1]+e,s[2]+i,a+e,l+i),c=a,g=l,f=s[1],p=s[2];break;case"t":a=c+s[1],l=g+s[2],d[0].match(/[QqTt]/)===null?(f=c,p=g):d[0]==="t"?(f=2*c-h,p=2*g-u):d[0]==="q"&&(f=2*c-f,p=2*g-p),h=f,u=p,this.quadraticCurveTo(f+e,p+i,a+e,l+i),c=a,g=l,f=c+s[1],p=g+s[2];break;case"T":a=s[1],l=s[2],f=2*c-f,p=2*g-p,this.quadraticCurveTo(f+e,p+i,a+e,l+i),c=a,g=l;break;case"a":$0(this,c+e,g+i,[s[1],s[2],s[3],s[4],s[5],s[6]+c+e,s[7]+g+i]),c+=s[6],g+=s[7];break;case"A":$0(this,c+e,g+i,[s[1],s[2],s[3],s[4],s[5],s[6]+e,s[7]+i]),c=s[6],g=s[7];break;case"z":case"Z":this.closePath()}d=s}}_runCommandList(t,e=0,i=0,r=1,o=1){if(e!==0||i!==0||r!==1||o!==1)for(let s=0,a=t.length;s<a;++s){const l=t[s].slice();switch(l[0]){case Wt.L:this.lineToTransform(l,e,i,r,o);break;case Wt.M:this.moveToTransform(l,e,i,r,o);break;case Wt.C:this.bezierCurveToTransform(l,e,i,r,o);break;case Wt.Q:this.quadraticCurveToTransform(l,e,i,r,o);break;case Wt.A:this.arcToTransform(l,e,i,r,o);break;case Wt.E:this.ellipseTransform(l,e,i,r,o);break;case Wt.R:this.rectTransform(l,e,i,r,o);break;case Wt.AT:this.arcToTransform(l,e,i,r,o);break;case Wt.Z:this.closePath()}}else this.commandList=t.map(s=>s.slice())}_updateBounds(){this.bounds.clear(),Yn(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===he.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1];return kt(t.p0.y-e.p1.y)}if(this.direction===he.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1];return kt(t.p0.x-e.p1.x)}return this.curves.reduce((t,e)=>t+e.getLength(),0)}getAttrAt(t){if(!this.curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let o=0;o<this.curves.length;o++){e=this.curves[o];const s=e.getLength(this.direction);if(i+s>=t)break;i+=s}const r=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(r),angle:e.getAngleAt(r)}}}const Qi=["l",0,0,0,0,0,0,0];function Zw(n,t,e){const i=Qi[0]=n[0];if(i==="a"||i==="A")Qi[1]=t*n[1],Qi[2]=e*n[2],Qi[3]=n[3],Qi[4]=n[4],Qi[5]=n[5],Qi[6]=t*n[6],Qi[7]=e*n[7];else if(i==="h"||i==="H")Qi[1]=t*n[1];else if(i==="v"||i==="V")Qi[1]=e*n[1];else for(let r=1,o=n.length;r<o;++r)Qi[r]=(r%2==1?t:e)*n[r];return Qi}const Jw={alignSelf:"auto"},Ve={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new je},up={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},kd={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},dp=Object.assign({outerBorder:Object.assign(Object.assign({},kd),{distance:0}),innerBorder:Object.assign(Object.assign({},kd),{distance:0})},kd),tn={text:"",maxLineWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"\u2026",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0},Qw={pickStrokeBuffer:0},tD=Object.assign(Object.assign(Object.assign(Object.assign({opacity:1,background:null,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,blur:0,cursor:null,html:null},up),dp),Jw),Qw),cp={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},fe=Object.assign(Object.assign(Object.assign({strokeSeg:null,pickable:!0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden"},{_debug_bounds:!1}),tD),Ve);function mz(n,t,e){e.forEach(i=>{t.prototype[i]=n[i]})}function Cz(n,t){Object.setPrototypeOf(n,t)}const eD=Object.assign(Object.assign({},fe),{startAngle:0,endAngle:Rt,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),iD=Object.assign(Object.assign(Object.assign({},fe),cp),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1}),nD=Object.assign(Object.assign({},fe),{radius:1,startAngle:0,endAngle:Rt}),rD=Object.assign(Object.assign({},fe),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start"}),oD=Object.assign(Object.assign({},fe),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),sD=Object.assign(Object.assign(Object.assign({},fe),cp),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1}),aD=Object.assign(Object.assign({},fe),{path:new Ke,customPath:()=>{te.getInstance().warn("\u7A7A\u51FD\u6570")}}),lD=Object.assign(Object.assign({},fe),{points:[],cornerRadius:0,closePath:!0}),hD=Object.assign(Object.assign({},fe),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0}),uD=Object.assign(Object.assign({},fe),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0}),dD=Object.assign(Object.assign({},fe),{symbolType:"circle",size:10,keepDirIn3d:!0}),gp=Object.assign(Object.assign(Object.assign({},fe),tn),{strokeBoundsBuffer:0,keepDirIn3d:!0}),En=Object.assign(Object.assign(Object.assign({},fe),tn),{width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Cs=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0},fe),{fill:!0,cornerRadius:0}),cD=Object.assign(Object.assign({},Cs),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});class gD{}const $=new gD,Id={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},ol={fontSize:16,fontFamily:"sans-serif",fill:!0,stroke:!1,fontWeight:"normal",lineHeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",script:"normal"},fp=String.fromCharCode(160),pp=/\w|\(|\)|-/,fD=/[.?!,;:/，。？！、；：]/,pD=/\S/;function vD(n,t){const e=t&&t.fill||ol.fill;if(!e)return void(n.globalAlpha=0);n.globalAlpha=1,n.fillStyle=e;let i=t.fontSize||16;switch(t.script){case"super":case"sub":i*=.8}n.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:i,fontFamily:t.fontFamily||"sans-serif"})}function mD(n,t){const e=t&&t.stroke||ol.stroke;if(!e)return void(n.globalAlpha=0);n.globalAlpha=1,n.lineWidth=t&&typeof t.lineHeight=="number"?t.lineHeight:1,n.strokeStyle=e;let i=t.fontSize||16;switch(t.script){case"super":case"sub":i*=.8}n.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:i,fontFamily:t.fontFamily||"sans-serif"})}function bz(n){n.setTextStyle({textAlign:"left",textBaseline:"bottom"})}function _z(n,t,e,i,r){n=n.replace(/\s/g,fp);const o=document.createElement("span");o.setAttribute("style",e),o.style.visibility="hidden",o.style.whiteSpace="nowrap",document.body.appendChild(o);let s=i,a=n.slice(0,s);o.innerText=a;let l=o.offsetWidth,h=n.slice(0,s+1);o.innerText=h;let u=o.offsetWidth;for(;l>t||u<=t;)l>t?s--:s++,a=n.slice(0,s),o.innerText=a,l=o.offsetWidth,h=n.slice(0,s+1),o.innerText=h,u=o.offsetWidth;return r&&(s=bs(n,s)),document.body.removeChild(o),s}function Od(n,t,e,i,r){if(!t||t<=0)return 0;const o=$.graphicUtil.textMeasure;let s=i,a=n.slice(0,s),l=Math.floor(o.measureText(a,e).width),h=n.slice(0,s+1),u=Math.floor(o.measureText(h,e).width);for(;l>t||u<=t;){if(l>t?s--:s++,s>n.length){s=n.length;break}if(s<0){s=0;break}a=n.slice(0,s),l=Math.floor(o.measureText(a,e).width),h=n.slice(0,s+1),u=Math.floor(o.measureText(h,e).width)}return r&&(s=bs(n,s)),s}function bs(n,t){let e=t;for(;pp.test(n[e-1])&&pp.test(n[e])||fD.test(n[e]);)if(e--,e<=0)return t;return e}function yz(n,t){var e;let i;const r=document.createElement("span"),o=document.createElement("div");i=document.createElement("div"),o.style.display="inline-block",o.style.width="1px",o.style.height="0",i.style.visibility="hidden",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="500px",i.style.height="200px",i.style.whiteSpace="nowrap",i.appendChild(r),i.appendChild(o),document.body.appendChild(i);const s={};try{r.setAttribute("style",t),r.style.whiteSpace="nowrap",r.style.display="inline-block",r.innerHTML="",r.appendChild(document.createTextNode(n.replace(/\s/g,fp))),o.style.verticalAlign="baseline",s.ascent=o.offsetTop-r.offsetTop,o.style.verticalAlign="bottom",s.height=o.offsetTop-r.offsetTop,s.descent=s.height-s.ascent,s.width=r.offsetWidth}finally{(e=i.parentNode)===null||e===void 0||e.removeChild(i),i=null}return s}function go(n,t){const e=$.graphicUtil.textMeasure.measureText(n,t),i={ascent:0,height:0,descent:0,width:0};return typeof e.actualBoundingBoxAscent!="number"||typeof e.actualBoundingBoxDescent!="number"?(i.width=Math.floor(e.width),i.height=t.fontSize||0,i.ascent=i.height,i.descent=0):(i.width=Math.floor(e.width),i.height=Math.floor(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent),i.ascent=Math.floor(e.actualBoundingBoxAscent),i.descent=i.height-i.ascent),i}function wz(n,t){let e=n&&n.fontSize||ol.fontSize;if(n)switch(n.script){case"super":case"sub":e*=.8}return(n&&n.fontStyle||"")+" "+(n&&n.fontWeight||"")+" "+(e||12)+"px "+(n&&n.fontFamily||ol.fontFamily)}var CD=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let zd=class{configure(n,t){this.canvas=n.canvas,this.context=n.context,n.bindTextMeasure(this)}measureTextWidth(n,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(n).width):this.estimate(n,t).width}estimate(n,{fontSize:t=gp.fontSize}){let e=0,i=0;for(let r=0;r<n.length;r++)n.charCodeAt(r)<128?e++:i++;return{width:~~(.8*e*t+i*t),height:t}}measureTextPixelHeight(n,t){var e;if(!this.context)return(e=t.fontSize)!==null&&e!==void 0?e:tn.fontSize;this.context.setTextStyleWithoutAlignBaseline(t);const i=this.context.measureText(n);return Math.abs(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)}measureTextBoundHieght(n,t){var e;if(!this.context)return(e=t.fontSize)!==null&&e!==void 0?e:tn.fontSize;this.context.setTextStyleWithoutAlignBaseline(t);const i=this.context.measureText(n);return Math.abs(i.fontBoundingBoxAscent-i.fontBoundingBoxDescent)}measureText(n,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(n)):this.estimate(n,t)}clipTextVertical(n,t,e,i){if(n.length===0)return{verticalList:n,width:0};const{fontSize:r=12}=t;n.forEach(l=>{l.width=l.direction===0?r:this.measureTextWidth(l.text,t)});const o=[];let s=0,a=0;for(;a<n.length&&s+n[a].width<e;a++)s+=n[a].width,o.push(n[a]);if(n[a]&&n[a].text.length>1){const l=this._clipText(n[a].text,t,e-s,0,n[a].text.length-1,"end",!1);if(i&&l.str!==n[a].text){let h="",u=0;for(let g=0;g<a;g++){const f=n[g];h+=f.text,u+=f.text.length}h+=n[a].text;const d=u+l.str.length;let c=bs(h,d);c-=u,c!==l.str.length-1&&(l.str=l.str.substring(0,c),l.width=this.measureTextWidth(l.str,t))}o.push(Object.assign(Object.assign({},n[a]),{text:l.str,width:l.width})),s+=l.width}return{verticalList:o,width:s}}clipText(n,t,e,i){if(n.length===0)return{str:"",width:0};let r=this.measureTextWidth(n,t);if(r<=e)return{str:n,width:r};if(r=this.measureTextWidth(n[0],t),r>e)return{str:"",width:0};const o=this._clipText(n,t,e,0,n.length-1,"end",!1);if(i&&o.str!==n){const s=bs(n,o.str.length);s!==o.str.length&&(o.str=n.substring(0,s),o.width=this.measureTextWidth(o.str,t))}return o}_clipText(n,t,e,i,r,o,s){let a;if(o==="start")a=this._clipTextStart(n,t,e,i,r),s&&(a.result=s+a.str);else if(o==="middle"){const l=this._clipTextMiddle(n,t,e,"","",0,0,1);a={str:"none",width:l.width,result:l.left+s+l.right}}else a=this._clipTextEnd(n,t,e,i,r),s&&(a.result=a.str+s);return a}_clipTextEnd(n,t,e,i,r){const o=Math.floor((i+r)/2),s=n.substring(0,o+1),a=this.measureTextWidth(s,t);let l;if(a>e){if(s.length<=1)return{str:"",width:0};const h=n.substring(0,o);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextEnd(n,t,e,i,o)}if(a<e){if(o>=n.length-1)return{str:n,width:this.measureTextWidth(n,t)};const h=n.substring(0,o+2);return l=this.measureTextWidth(h,t),l>=e?{str:s,width:a}:this._clipTextEnd(n,t,e,o,r)}return{str:s,width:a}}_clipTextStart(n,t,e,i,r){const o=Math.ceil((i+r)/2),s=n.substring(o-1,n.length-1),a=this.measureTextWidth(s,t);let l;if(a>e){if(s.length<=1)return{str:"",width:0};const h=n.substring(o,n.length-1);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextStart(n,t,e,o,n.length-1)}if(a<e){if(o<=0)return{str:n,width:this.measureTextWidth(n,t)};const h=n.substring(o-2,n.length-1);return l=this.measureTextWidth(h,t),l>=e?{str:s,width:a}:this._clipTextStart(n,t,e,i,o)}return{str:s,width:a}}_clipTextMiddle(n,t,e,i,r,o,s,a){const l=n.substring(0,a),h=this.measureTextWidth(l,t);if(h+s>e)return{left:i,right:r,width:o+s};const u=n.substring(n.length-a,n.length),d=this.measureTextWidth(u,t);return h+d>e?{left:l,right:r,width:h+s}:this._clipTextMiddle(n,t,e,l,u,h,d,a+1)}clipTextWithSuffixVertical(n,t,e,i,r,o){if(i==="")return this.clipTextVertical(n,t,e,r);if(n.length===0)return{verticalList:n,width:0};const s=this.clipTextVertical(n,t,e,r);if(s.verticalList.length===n.length&&s.verticalList[s.verticalList.length-1].width===n[n.length-1].width)return s;const a=this.measureTextWidth(i,t);if(a>e)return s;let l;if(e-=a,o==="start"){const h=this.revertVerticalList(n);l=this.clipTextVertical(h,t,e,r);const u=this.revertVerticalList(l.verticalList);u.unshift({text:i,direction:1,width:a}),l.verticalList=u}else if(o==="middle"){const h=this.clipTextVertical(n,t,e/2,r),u=this.revertVerticalList(n),d=this.clipTextVertical(u,t,e/2,r);h.verticalList.push({text:i,direction:1,width:a}),this.revertVerticalList(d.verticalList).forEach(c=>h.verticalList.push(c)),l={verticalList:h.verticalList,width:h.width+d.width}}else l=this.clipTextVertical(n,t,e,r),l.verticalList.push({text:i,direction:1,width:a});return l.width+=a,l}revertVerticalList(n){return n.reverse().map(t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})})}clipTextWithSuffix(n,t,e,i,r,o){if(i==="")return this.clipText(n,t,e,r);if(n.length===0)return{str:"",width:0};const s=this.measureTextWidth(n,t);if(s<=e)return{str:n,width:s};const a=this.measureTextWidth(i,t);if(a>e)return{str:"",width:0};e-=a;const l=this._clipText(n,t,e,0,n.length-1,o,i);if(r&&l.str!==n){const h=bs(n,l.str.length);h!==l.str.length&&(l.str=n.substring(0,h),l.width=this.measureTextWidth(l.str,t))}return l.str=l.result,l.width+=a,l}};zd=CD([Z()],zd);var bD=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};const $n=Symbol.for("TextMeasureContribution");let fo=class extends zd{};fo=bD([Z()],fo);var N=n=>n!=null,ut=n=>n==null,ue=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||lo(n,"String")};function xz(n,t=!0){if(typeof n!="string"||n.length===0||(n=_D(n)).length===0)return 0;n=n.replace(wD(),"  ");const e=t?1:2;let i=0;for(const r of n){const o=r.codePointAt(0);if(!(o<=31||o>=127&&o<=159)&&!(o>=768&&o<=879))switch(Wd(r)){case"F":case"W":i+=2;break;case"A":i+=e;break;default:i+=1}}return i}const _D=n=>{if(typeof n!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof n}\``);return n.replace(yD(),"")},yD=({onlyFirst:n=!1}={})=>{const t=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"].join("|");return new RegExp(t,n?void 0:"g")},Wd=n=>{let t=n.charCodeAt(0),e=n.length===2?n.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"},wD=()=>/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC08\uDC26](?:\u200D\u2B1B)?|[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC2\uDECE-\uDEDB\uDEE0-\uDEE8]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g;function DD(n,t={}){const{fontStyle:e=t.fontStyle,fontVariant:i=t.fontVariant,fontWeight:r=t.fontWeight,fontSize:o=t.fontSize,fontFamily:s=t.fontFamily}=n;return(e?e+" ":"")+(i?i+" ":"")+(r?r+" ":"")+o+"px "+(s||"sans-serif")}class di{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e!=null?e:{},this.textSpec=this._initSpec(),N(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=N(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(ut(this._canvas)&&(N(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),ut(this._canvas)&&typeof window!="undefined"&&window.document!==void 0&&globalThis&&N(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),ut(this._context)&&N(this._canvas)){const t=this._canvas.getContext("2d");N(t)&&(t.save(),t.font=DD(this.textSpec),this._contextSaved=!0,this._context=t)}return!ut(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:s=r.fontVariant,fontWeight:a=(t=r.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=r.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=r.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:u,textAlign:d=u!=null?u:"center",baseline:c,textBaseline:g=c!=null?c:"middle",ellipsis:f,limit:p}=this._userSpec;let{lineHeight:v=l}=this._userSpec;if(ue(v)&&v[v.length-1]==="%"){const m=Number.parseFloat(v.substring(0,v.length-1))/100;v=l*m}return{fontStyle:o,fontVariant:s,fontFamily:h,fontSize:l,fontWeight:a,textAlign:d,textBaseline:g,ellipsis:f,limit:p,lineHeight:v}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(ut(t))return{width:0,height:0};if(ut(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:a,limit:l,lineHeight:h}=this.textSpec;let u;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});u={width:d.width(),height:d.height()}}catch(d){this._notSupportVRender=!0,u=this.measureWithNaiveCanvas(t)}return u}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:(e=o)!==null&&e!==void 0?e:r}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);ut(o)&&di.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),ut(o)&&["F","W"].includes(Wd(r))&&(o=this._measureFullSizeChar()),ut(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let s=0;s<t.length;s++){const a=t[s],l=["F","W"].includes(Wd(a))?1:.53;i.width+=l*r}return i.height=(e=o)!==null&&e!==void 0?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,s={width:0,height:0};if(ut(t))return s;if(rt(t)){const a=t.filter(N).map(l=>l.toString());return a.length===0?s:a.length===1?e(a[0]):{width:a.reduce((l,h)=>Math.max(l,e(h).width),0),height:a.length*(((i=o)!==null&&i!==void 0?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(ut(this._numberCharSize)){const t=this._standardMethod(di.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/di.NUMBERS_CHAR_SET.length,height:t.height}}return this._numberCharSize}_measureFullSizeChar(){return ut(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(di.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(ut(this._letterCharSize)){const t=this._standardMethod(di.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/di.ALPHABET_CHAR_SET.length,height:t.height}}return this._letterCharSize}_measureSpecialChar(t){return N(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){N(this._canvas)&&(this._canvas=null),N(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}di.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",di.NUMBERS_CHAR_SET="0123456789",di.FULL_SIZE_CHAR="\u5B57";const kr={Singleton:"Singleton",Transient:"Transient"},mr={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},Bz={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};class Nd{constructor(t,e){this.id=Gt.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=mr.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new Nd(this.serviceIdentifier,this.scope);return t.activated=t.scope===kr.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class SD{getConstructorMetadata(t){return{compilerGeneratedMetadata:Fi.getMetadata(Ae,t),userGeneratedMetadata:Fi.getMetadata(Jt,t)||{}}}getPropertiesMetadata(t){throw new Error("\u6682\u672A\u5B9E\u73B0")}}const AD=(n=>t=>{const e=i=>{if(i==null)return!1;if(i.key===n&&i.value===t)return!0;if(i.constructorArgsMetadata==null)return!1;const r=i.constructorArgsMetadata;for(let o=0;o<r.length;o++)if(r[o].key===n&&r[o].value===t)return!0;return!1};return e.metaData=new Lr(n,t),e})(re);class sl{constructor(t){this._binding=t}inRequestScope(){throw new Error("\u6682\u672A\u5B9E\u73B0")}inSingletonScope(){return this._binding.scope=kr.Singleton,this}inTransientScope(){return this._binding.scope=kr.Transient,this}whenTargetNamed(t){return this._binding.constraint=AD(t),this}}class xD{constructor(t){this._binding=t}to(t){return this._binding.type=mr.Instance,this._binding.implementationType=t,new sl(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=mr.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new sl(this._binding)}toConstantValue(t){return this._binding.type=mr.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=kr.Singleton,new sl(this._binding)}toFactory(t){return this._binding.type=mr.Factory,this._binding.factory=t,this._binding.scope=kr.Singleton,new sl(this._binding)}toService(t){this.toDynamicValue(e=>e.container.get(t))}}class BD{constructor(t){const e=t||{};e.defaultScope=e.defaultScope||kr.Transient,this.options=e,this.id=Gt.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new SD}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const r=this._getNotAllArgs(t,!1,e,i);return this._get(r)}getNamed(t,e){return this.getTagged(t,re,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new Nd(t,e),r=this._bindingDictionary.get(t)||[];return r.push(i),this._bindingDictionary.set(t,r),new xD(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(s,a)=>{s._binding.moduleId=a},e=s=>a=>{const l=this.bind(a);return t(l,s),l},i=()=>s=>this.unbind(s),r=()=>s=>this.isBound(s),o=s=>a=>{const l=this.rebind(a);return t(l,s),l};return s=>({bindFunction:e(s),isboundFunction:r(),rebindFunction:o(s),unbindFunction:i(),unbindAsyncFunction:a=>null})}_getNotAllArgs(t,e,i,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:r}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter(i=>i.constraint(t)).forEach(i=>{e.push(this._resolveFromBinding(i))}),t.isMultiInject||e.length!==1?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),r=Object.keys(i),o=[];for(let s=0;s<r.length;s++){const a=i[s],l={};a.forEach(g=>{l[g.key]=g.value});const h={inject:l[yt],multiInject:l[Zt]},u=h.inject||h.multiInject,d={serviceIdentifier:u,constructorArgsMetadata:a},c={injectIdentifier:u,metadata:a,bindings:this._bindingDictionary.get(u).filter(g=>g.constraint(d))};o.push(c)}return o}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case mr.ConstantValue:case mr.Function:e=t.cache;break;case mr.Instance:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map(e=>e.bindings.length>1?e.bindings.map(i=>this._resolveFromBinding(i)):this._resolveFromBinding(e.bindings[0]))}_saveToScope(t,e){t.scope===kr.Singleton&&(t.cache=e,t.activated=!0)}}const pt=new BD,vp=Symbol.for("CanvasFactory"),FD=Symbol.for("Context2dFactory");function al(n){return pt.getNamed(vp,$.global.env)(n)}function Tz(n,t){return container.getNamed(Context2dFactory,application.global.env)(n,t)}const mp=1e-4,Cp=Math.sqrt(3),ll=null;function Cr(n){return n>-_s&&n<_s}function bp(n){return n>_s||n<-_s}function Mz(n,t){return Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1])<1e-10}function Rz(n){return typeof n=="number"&&Number.isFinite(n)}const Pn=null,en=null,po=null;function vo(n,t){return(n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])}function yn(n,t,e,i){const r=1-i;return r*(r*n+2*i*t)+i*i*e}function wn(n,t,e,i,r){const o=1-r;return o*o*(o*n+3*r*t)+r*r*(r*i+3*o*e)}function TD(n,t,e,i,r){const o=n-2*t+e,s=2*(t-n),a=n-i;let l=0;if(Cr(o)){if(bp(s)){const h=-a/s;h>=0&&h<=1&&(r[l++]=h)}}else{const h=s*s-4*o*a;if(Cr(h)){const u=-s/(2*o);u>=0&&u<=1&&(r[l++]=u)}else if(h>0){const u=Math.sqrt(h),d=(-s+u)/(2*o),c=(-s-u)/(2*o);d>=0&&d<=1&&(r[l++]=d),c>=0&&c<=1&&(r[l++]=c)}}return l}function MD(n,t,e){const i=n+e-2*t;return i===0?.5:(n-t)/i}function RD(n,t,e,i,r,o,s,a,l){let h=0,u=.005,d=1/0;Pn[0]=s,Pn[1]=a;for(let c=0;c<1;c+=.05){en[0]=yn(n,e,r,c),en[1]=yn(t,i,o,c);const g=vo(Pn,en);g<d&&(h=c,d=g)}d=1/0;for(let c=0;c<32&&!(u<mp);c++){const g=h-u,f=h+u;en[0]=yn(n,e,r,g),en[1]=yn(t,i,o,g);const p=vo(en,Pn);if(g>=0&&p<d)h=g,d=p;else{po[0]=yn(n,e,r,f),po[1]=yn(t,i,o,f);const v=vo(po,Pn);f<=1&&v<d?(h=f,d=v):u*=.5}}return l&&(l[0]=yn(n,e,r,h),l[1]=yn(t,i,o,h)),Math.sqrt(d)}function ED(n,t,e,i,r,o,s,a,l,h,u){let d,c,g,f,p=0,v=.005,m=1/0;Pn[0]=l,Pn[1]=h;for(let C=0;C<1;C+=.05)en[0]=wn(n,e,r,s,C),en[1]=wn(t,i,o,a,C),g=vo(Pn,en),g<m&&(p=C,m=g);m=1/0;for(let C=0;C<32&&!(v<mp);C++)d=p-v,c=p+v,en[0]=wn(n,e,r,s,d),en[1]=wn(t,i,o,a,d),g=vo(en,Pn),d>=0&&g<m?(p=d,m=g):(po[0]=wn(n,e,r,s,c),po[1]=wn(t,i,o,a,c),f=vo(po,Pn),c<=1&&f<m?(p=c,m=f):v*=.5);return u&&(u[0]=wn(n,e,r,s,p),u[1]=wn(t,i,o,a,p)),Math.sqrt(m)}function hl(n){return(n%=pi2)<0&&(n+=pi2),n}function Ir(n,t,e,i,r,o){if(o>t&&o>i||o<t&&o<i||i===t)return 0;const s=(o-t)/(i-t);let a=i<t?1:-1;s!==1&&s!==0||(a=i<t?.5:-.5);const l=s*(e-n)+n;return l===r?1/0:l>r?a:0}function PD(n,t,e,i,r,o,s,a,l){if(s===0)return!1;const h=s;return l>t+h&&l>i+h&&l>o+h||l<t-h&&l<i-h&&l<o-h||a>n+h&&a>e+h&&a>r+h||a<n-h&&a<e-h&&a<r-h?!1:RD(n,t,e,i,r,o,a,l,null)<=h/2}function HD(n,t,e,i,r,o,s,a,l,h,u){if(l===0)return!1;const d=l;return u>t+d&&u>i+d&&u>o+d&&u>a+d||u<t-d&&u<i-d&&u<o-d&&u<a-d||h>n+d&&h>e+d&&h>r+d&&h>s+d||h<n-d&&h<e-d&&h<r-d&&h<s-d?!1:ED(n,t,e,i,r,o,s,a,h,u,null)<=d/2}function LD(n,t,e,i,r,o,s,a,l){if(s===0)return!1;const h=s;a-=n,l-=t;const u=Math.sqrt(a*a+l*l);if(u-h>e||u+h<e)return!1;if(Math.abs(i-r)%pi2<1e-4)return!0;if(o){const c=i;i=hl(r),r=hl(c)}else i=hl(i),r=hl(r);i>r&&(r+=pi2);let d=Math.atan2(l,a);return d<0&&(d+=pi2),d>=i&&d<=r||d+pi2>=i&&d+pi2<=r}function mo(n,t,e,i,r,o,s){if(r===0)return!1;const a=r,l=r/2;let h=0,u=n;if(s>t+l&&s>i+l||s<t-l&&s<i-l||o>n+l&&o>e+l||o<n-l&&o<e-l)return!1;if(n===e)return Math.abs(o-n)<=a/2;h=(t-i)/(n-e),u=(n*i-e*t)/(n-e);const d=h*o-s+u;return d*d/(h*h+1)<=a/2*a/2}const kD={x:0,y:0};function Ez(n,t,e){const i=t.currentMatrix.getInverse();return(e=e||kD).x=n.x*i.a+n.y*i.c+i.e,e.y=n.x*i.b+n.y*i.d+i.f,e}const _s=1e-4;function ID(n,t,e,i,r,o){const s=i+3*(t-e)-n,a=3*(e-2*t+n),l=3*(t-n),h=n-r,u=a*a-3*s*l,d=a*l-9*s*h,c=l*l-3*a*h;let g=0;if(Cr(u)&&Cr(d))if(Cr(a))o[0]=0;else{const f=-l/a;f>=0&&f<=1&&(o[g++]=f)}else{const f=d*d-4*u*c;if(Cr(f)){const p=d/u,v=-a/s+p,m=-p/2;v>=0&&v<=1&&(o[g++]=v),m>=0&&m<=1&&(o[g++]=m)}else if(f>0){const p=Math.sqrt(f);let v=u*a+1.5*s*(-d+p),m=u*a+1.5*s*(-d-p);v=v<0?-Math.pow(-v,ll):Math.pow(v,ll),m=m<0?-Math.pow(-m,ll):Math.pow(m,ll);const C=(-a-(v+m))/(3*s);C>=0&&C<=1&&(o[g++]=C)}else{const p=(2*u*a-3*s*d)/(2*Math.sqrt(u*u*u)),v=Math.acos(p)/3,m=Math.sqrt(u),C=Math.cos(v),b=(-a-2*m*C)/(3*s),_=(-a+m*(C+Cp*Math.sin(v)))/(3*s),y=(-a+m*(C-Cp*Math.sin(v)))/(3*s);b>=0&&b<=1&&(o[g++]=b),_>=0&&_<=1&&(o[g++]=_),y>=0&&y<=1&&(o[g++]=y)}}return g}function OD(n,t,e,i,r){const o=6*e-12*t+6*n,s=9*t+3*i-3*n-9*e,a=3*t-3*n;let l=0;if(Cr(s)){if(bp(o)){const h=-a/o;h>=0&&h<=1&&(r[l++]=h)}}else{const h=o*o-4*s*a;if(Cr(h))r[0]=-o/(2*s);else if(h>0){const u=Math.sqrt(h),d=(-o+u)/(2*s),c=(-o-u)/(2*s);d>=0&&d<=1&&(r[l++]=d),c>=0&&c<=1&&(r[l++]=c)}}return l}function zD(n,t){return Math.abs(n-t)<_s}const wi=null,nn=null;function WD(){const n=nn[0];nn[0]=nn[1],nn[1]=n}function ND(n,t,e,i,r,o,s,a,l,h){if(h>t&&h>i&&h>o&&h>a||h<t&&h<i&&h<o&&h<a)return 0;const u=ID(t,i,o,a,h,wi);if(u===0)return 0;let d=0,c=-1,g=0,f=0;for(let p=0;p<u;p++){const v=wi[p],m=v===0||v===1?.5:1;wn(n,e,r,s,v)<l||(c<0&&(c=OD(t,i,o,a,nn),nn[1]<nn[0]&&c>1&&WD(),g=wn(t,i,o,a,nn[0]),c>1&&(f=wn(t,i,o,a,nn[1]))),c===2?v<nn[0]?d+=g<t?m:-m:v<nn[1]?d+=f<g?m:-m:d+=a<f?m:-m:v<nn[0]?d+=g<t?m:-m:d+=a<g?m:-m)}return d}function jD(n,t,e,i,r,o,s,a){if(a>t&&a>i&&a>o||a<t&&a<i&&a<o)return 0;const l=TD(t,i,o,a,wi);if(l===0)return 0;const h=MD(t,i,o);if(h>=0&&h<=1){let d=0;const c=yn(t,i,o,h);for(let g=0;g<l;g++){const f=wi[g]===0||wi[g]===1?.5:1;yn(n,e,r,wi[g])<s||(wi[g]<h?d+=c<t?f:-f:d+=o<c?f:-f)}return d}const u=wi[0]===0||wi[0]===1?.5:1;return yn(n,e,r,wi[0])<s?0:o<t?u:-u}function VD(n,t,e,i,r,o,s,a){if((a-=t)>e||a<-e)return 0;const l=Math.sqrt(e*e-a*a);wi[0]=-l,wi[1]=l;const h=Math.abs(i-r);if(h<1e-4)return 0;if(h>=pi2-1e-4){i=0,r=pi2;const d=o?1:-1;return s>=wi[0]+n&&s<=wi[1]+n?d:0}if(i>r){const d=i;i=r,r=d}i<0&&(i+=pi2,r+=pi2);let u=0;for(let d=0;d<2;d++){const c=wi[d];if(c+n>s){let g=Math.atan2(a,c),f=o?1:-1;g<0&&(g=pi2+g),(g>=i&&g<=r||g+pi2>=i&&g+pi2<=r)&&(g>pi/2&&g<1.5*pi&&(f=-f),u+=f)}}return u}function jd(n){return Math.round(n/pi*1e8)/1e8%2*pi}function GD(n,t){let e=jd(n[0]);e<0&&(e+=pi2);const i=e-n[0];let r=n[1];r+=i,!t&&r-e>=pi2?r=e+pi2:t&&e-r>=pi2?r=e-pi2:!t&&e>r?r=e+(pi2-jd(e-r)):t&&e<r&&(r=e-(pi2-jd(r-e))),n[0]=e,n[1]=r}const ys=null;function _p(n,t,e,i,r){const o=n,s=n.length;let a,l,h=0,u=0,d=0,c=0,g=0;for(let f=0;f<s;f++){const p=o[f],v=f===0;p[0]===CMD.M&&f>1&&(e||(h+=Ir(u,d,c,g,i,r))),v&&(u=p[1],d=p[2],c=u,g=d);const m=p[0],C=p[1],b=p[2],_=p[3],y=p[4],w=p[5],S=p[6];let D=y,A=w;ys[0]=D,ys[1]=A,GD(ys,!!p[6]),D=ys[0],A=ys[1];const x=D,B=A-D,F=!!(1-(p[6]?0:1)),T=(i-C)*_/_+C;switch(m){case CMD.M:c=C,g=b,u=c,d=g;break;case CMD.L:if(e){if(mo(u,d,C,b,t,i,r))return!0}else h+=Ir(u,d,C,b,i,r)||0;u=C,d=b;break;case CMD.C:if(e){if(HD(u,d,C,b,_,y,w,S,t,i,r))return!0}else h+=ND(u,d,C,b,_,y,w,S,i,r)||0;u=w,d=S;break;case CMD.Q:if(e){if(PD(u,d,C,b,_,y,t,i,r))return!0}else h+=jD(u,d,C,b,_,y,i,r)||0;u=_,d=y;break;case CMD.A:if(a=Math.cos(x)*_+C,l=Math.sin(x)*_+b,v?(c=a,g=l):h+=Ir(u,d,a,l,i,r),e){if(LD(C,b,_,x,x+B,F,t,T,r))return!0}else h+=VD(C,b,_,x,x+B,F,T,r);u=Math.cos(x+B)*_+C,d=Math.sin(x+B)*_+b;break;case CMD.R:if(c=u=C,g=d=b,a=c+_,l=g+y,e){if(mo(c,g,a,g,t,i,r)||mo(a,g,a,l,t,i,r)||mo(a,l,c,l,t,i,r)||mo(c,l,c,g,t,i,r))return!0}else h+=Ir(a,g,a,l,i,r),h+=Ir(c,l,c,g,i,r);break;case CMD.Z:if(e){if(mo(u,d,c,g,t,i,r))return!0}else h+=Ir(u,d,c,g,i,r);u=c,d=g}}return e||zD(d,g)||(h+=Ir(u,d,c,g,i,r)||0),h!==0}function Pz(n,t,e){return _p(n,0,!1,t,e)}function Hz(n,t,e,i){return _p(n,t,!0,e,i)}class UD{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const i=al(Object.assign({nativeCanvas:$.global.createCanvas(t)},t));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const i={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},r=al(Object.assign({nativeCanvas:$.global.createCanvas(i)},i));return this.allocatedCanvas.push(r),r}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const Co=new UD;var KD=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},YD=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const ul=Symbol.for("VWindow"),Vd=Symbol.for("WindowHandlerContribution");let Gd=class{get width(){if(this._handler){const n=this._handler.getWH();return this._width=n.width}return this._width}get height(){if(this._handler){const n=this._handler.getWH();return this._height=n.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new Hi(["x","y","width","height"])},this._uid=Gt.GenAutoIncrementId(),this.global=$.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",()=>{this.active()}),this.active()}active(){const n=this.global;!n.env||this.actived||(pt.getNamed(Vd,n.env).configure(this,n),this.actived=!0)}get style(){return this._handler.getStyle()}set style(n){this._handler.setStyle(n)}create(n){this._handler.createWindow(n);const t=this._handler.getWH();this._width=t.width,this._height=t.height,this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(n){this._handler=n}setDpr(n){return this._handler.setDpr(n)}resize(n,t){return this._handler.resizeWindow(n,t)}configure(){throw new Error("\u6682\u4E0D\u652F\u6301")}release(){return this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(n){return this._handler.getImageBuffer?this._handler.getImageBuffer(n):null}addEventListener(n,t,e){return this._handler.addEventListener(n,t,e)}removeEventListener(n,t,e){return this._handler.removeEventListener(n,t,e)}dispatchEvent(n){return this._handler.dispatchEvent(n)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(n,t){this._handler.clearViewBox(n,t)}isVisible(n){return this._handler.isVisible(n)}onVisibleChange(n){return this._handler.onVisibleChange(n)}getTopLeft(n){return this._handler.getTopLeft(n)}};Gd=KD([Z(),YD("design:paramtypes",[])],Gd);var yp=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},wp=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Dp=function(n,t){return function(e,i){t(e,i,n)}};let Ud=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(n){this.contributions=n,this.configured=!1,this.global=$.global,this.global.hooks.onSetEnv.tap("graphic-util",(t,e,i)=>{this.configured=!1,this.configure(i,e)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(n,t){this.configured||(this.contributions.getContributions().forEach(e=>{e.configure(this,t)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const n=Co.shareCanvas();this._canvas=n,this._context=n.getContext("2d")}}bindTextMeasure(n){this._textMeasure=n}measureText(n,t,e="native"){var i;this.configure(this.global,this.global.env);const r=this.global.measureTextMethod;this.global.measureTextMethod=e;const o={width:this._textMeasure.measureTextWidth(n,t),height:(i=t.fontSize)!==null&&i!==void 0?i:tn.fontSize};return this.global.measureTextMethod=r,o}createTextMeasureInstance(n,t,e){return this.configure(this.global,this.global.env),new di(Object.assign({defaultFontParams:{fontFamily:tn.fontFamily,fontSize:tn.fontSize},getCanvasForMeasure:e||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+di.ALPHABET_CHAR_SET+di.ALPHABET_CHAR_SET.toUpperCase()},t!=null?t:{}),n)}drawGraphicToCanvas(n,t,e){if(!t.defaultLayer)return null;const i=pt.get(ul),r=n.AABBBounds,o=r.width(),s=r.height();i.create({width:o,height:s,canvas:e,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""});const a=-r.x1,l=-r.y1,h=t.params.optimize.disableCheckGraphicWidthOutRange;t.params.optimize.disableCheckGraphicWidthOutRange=!0,t.defaultLayer.getNativeHandler().drawTo(i,[n],{x:a,y:l,width:o,height:s,stage:t,layer:t.defaultLayer,renderService:t.renderService,background:"transparent",clear:!0,updateBounds:!1}),t.params.optimize.disableCheckGraphicWidthOutRange=h;const u=i.getNativeHandler();return u.nativeCanvas?u.nativeCanvas:null}};Ud=yp([Z(),Dp(0,At(Le)),Dp(0,Ne($n)),wp("design:paramtypes",[Object])],Ud);var br;(function(n){n[n.transform=0]="transform",n[n.matrix=1]="matrix"})(br||(br={}));const ke=new je;let Kd=class{constructor(){this.matrix=new je}init(n){return this.mode=br.transform,this.originTransform=n,this.matrix.reset(),this}fromMatrix(n,t){return this.mode=br.matrix,this.outSourceMatrix=n,this.outTargetMatrix=t,this}scaleMatrix(n,t,e){const i=this.outSourceMatrix;if(ke.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:r,y:o}=e;this.outTargetMatrix.translate(r,o),this.outTargetMatrix.scale(n,t),this.outTargetMatrix.translate(-r,-o)}else this.outTargetMatrix.scale(n,t);return this.outTargetMatrix.multiply(ke.a,ke.b,ke.c,ke.d,ke.e,ke.f),this}rotateMatrix(n,t){const e=this.outSourceMatrix;if(ke.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),t){const{x:i,y:r}=t;this.outTargetMatrix.translate(i,r),this.outTargetMatrix.rotate(n),this.outTargetMatrix.translate(-i,-r)}else this.outTargetMatrix.rotate(n);return this.outTargetMatrix.multiply(ke.a,ke.b,ke.c,ke.d,ke.e,ke.f),this}scale(n,t,e){return this.mode===br.matrix?this.scaleMatrix(n,t,e):this}rotate(n,t){return this.mode===br.matrix?this.rotateMatrix(n,t):this}translateMatrix(n,t){const e=this.outSourceMatrix;return ke.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(n,t),this.outTargetMatrix.multiply(ke.a,ke.b,ke.c,ke.d,ke.e,ke.f),this}translate(n,t){return this.mode===br.matrix?this.translateMatrix(n,t):this}simplify(n){return this.mode===br.matrix?this.simplifyMatrix(n):this}simplifyMatrix(n){return this}};Kd=yp([Z(),wp("design:paramtypes",[])],Kd);const ci={arc:eD,area:iD,circle:nD,line:sD,path:aD,symbol:dD,text:gp,rect:hD,rect3d:uD,polygon:lD,richtext:En,richtextIcon:cD,image:Cs,group:rD,glyph:oD},Yd=Object.keys(ci);function $D(){return{arc:Object.assign({},ci.arc),area:Object.assign({},ci.area),circle:Object.assign({},ci.circle),line:Object.assign({},ci.line),path:Object.assign({},ci.path),symbol:Object.assign({},ci.symbol),text:Object.assign({},ci.text),rect:Object.assign({},ci.rect),rect3d:Object.assign({},ci.rect3d),polygon:Object.assign({},ci.polygon),richtext:Object.assign({},ci.richtext),richtextIcon:Object.assign({},ci.richtextIcon),image:Object.assign({},ci.image),group:Object.assign({},ci.group),glyph:Object.assign({},ci.glyph)}}function dl(n,t){Object.keys(t).forEach(e=>{n[e]=t[e]})}const Sp=$D();class ws{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Yd.forEach(t=>{this._defaultTheme[t]=Object.create(Sp[t])}),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e,i=!1){if(this.dirty){const r=this.getParentWithTheme(t);if(r){const o=r.theme;(o.dirty||i)&&o.applyTheme(r,e,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,te.getInstance().warn("\u672A\u77E5\u9519\u8BEF\uFF0C\u8D70\u5230\u4E0D\u5E94\u8BE5\u8D70\u7684\u533A\u57DF\u91CC")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;Yd.forEach(r=>{const o=Object.create(Sp[r]);t&&t[r]&&dl(o,t[r]),i[r]&&dl(o,i[r]),e[r]&&dl(o,e[r]),this.combinedTheme[r]=o}),e.common&&Yd.forEach(r=>{dl(this.combinedTheme[r],e.common)}),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach(r=>{i[r]?Object.assign(i[r],t[r]):i[r]=Object.assign({},t[r])}):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren(e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))})}}const Ap=new ws;function X(n,t){return n.glyphHost?X(n.glyphHost):t?(n.isContainer,t):XD(n)||n.attachedThemeGraphic&&X(n.attachedThemeGraphic)||Ap.getTheme()}function XD(n){let t;if(t=n.isContainer?n:n.parent,t){for(;t&&!t.theme;)t=t.parent;return t?(t.theme||t.createTheme(),t.theme.getTheme(t)):Ap.getTheme()}return null}const qD=Object.prototype.hasOwnProperty;var xp=(n,t)=>n!=null&&qD.call(n,t),ZD=n=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(n),JD=n=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(n),ye=n=>{const t=typeof n;return n!==null&&t==="object"||t==="function"},QD=mt(26729),Ds=mt.n(QD),Li=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||lo(n,"Boolean"),ge=n=>typeof n=="function",tS=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};class eS extends Ds(){get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=Gt.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t,e=!1){if(e){let i=this._lastChild,r=0;for(;i;){if(t(i,r++))return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(t(i,r++))return;i=i._next}}}forEachChildrenAsync(t,e=!1){return tS(this,void 0,void 0,function*(){if(e){let i=this._lastChild,r=0;for(;i;){let o=t(i,r++);if(o.then&&(o=yield o),o)return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){let o=t(i,r++);if(o.then&&(o=yield o),o)return;i=i._next}}})}forEach(t){return this.forEachChildren(t)}appendChild(t,e=!0){if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("\u3010Node::appendChild\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20append\u4E3A\u5B50\u5143\u7D20");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t,e=!1){return console.error("\u6682\u4E0D\u652F\u6301\u8BE5\u51FD\u6570"),t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this._uid===t._uid)return null;if(t.isAncestorsOf(this))throw new Error("\u3010Node::insertBefore\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20insert\u4E3A\u5B50\u5143\u7D20");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this._uid===t._uid)return null;if(t.isAncestorsOf(this))throw new Error("\u3010Node::insertAfter\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20insert\u4E3A\u5B50\u5143\u7D20");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&te.getInstance().warn("insertIntoKeepIdx\u548CinsertInto\u6DF7\u7528\u53EF\u80FD\u4F1A\u5B58\u5728\u9519\u8BEF"),e>=this.childrenCount)return this.appendChild(t);if(this._uid===t._uid)return null;if(t.isAncestorsOf(this))throw new Error("\u3010Node::insertBefore\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20insert\u4E3A\u5B50\u5143\u7D20");if(t.parent&&t.parent.removeChild(t),t.parent=this,e===0)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let r=0;r<e;r++){if(!i)return null;r>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const o=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,o)}let i;this._nodeList[e]=t;for(let o=e-1;o>=0&&(i=this._nodeList[o],!i);o--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const r=this.insertInto(t,0);return this._ignoreWarn=!1,r}removeChild(t){if(!this._idMap||!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex(i=>i===t);e>0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;let e=this._firstChild;for(;e;){const i=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}find(t,e=!1){let i=null;return this.forEachChildren((r,o)=>!(r===this||!t(r,o))&&(i=r,!0)),e&&this.forEachChildren(r=>{if(r.isContainer){const o=r.find(t,!0);if(o)return i=o,!0}return!1}),i}findAll(t,e=!1){let i=[];return this.forEachChildren((r,o)=>{r!==this&&t(r,o)&&i.push(r)}),e&&this.forEachChildren(r=>{if(r.isContainer){const o=r.findAll(t,!0);o.length&&(i=i.concat(o))}}),i}getElementById(t){return this.find(e=>e.id===t,!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll(e=>e.name===t,!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll(e=>e.type===t,!0)}getChildByName(t,e=!1){return this.find(i=>i.name===t,e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;t!=null&&t.parent;)t=t.parent;return t||this}hasChildNodes(){return this._firstChild!==null}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(e!==null);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("\u6682\u4E0D\u652F\u6301")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do e._count+=t,e=e.parent;while(e!==null)}clone(){throw new Error("\u6682\u4E0D\u652F\u6301")}cloneTo(t){throw new Error("\u6682\u4E0D\u652F\u6301")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const r=Li(i,!0)&&i||ye(i)&&i.capture,o=ye(i)&&i.once,s=ge(e)?void 0:e;return t=r?`${t}capture`:t,e=ge(e)?e:e.handleEvent,o?super.once(t,e,s):super.on(t,e,s),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const r=Li(i,!0)&&i||ye(i)&&i.capture,o=ge(e)?void 0:e;t=r?`${t}capture`:t,e=ge(e)?e:e.handleEvent;const s=ye(i)&&i.once;return super.off(t,e,o,s),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return ye(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t,...e){return super.emit(t.type,t,...e),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class Ss{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Ss.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation(),this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class $d extends Ss{constructor(t,e){super(),this.type=t,this.detail=e}}const iS={pickable:!0,visible:!0,dispatchEvent(n){var t;if(!(n instanceof Ss))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=[],n.target=this,(t=n==null?void 0:n.manager)===null||t===void 0||t.dispatchEvent(n),!n.defaultPrevented},emit(n,t){return this.dispatchEvent(new $d(n,t))}};class Mt{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return t===0?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return t===0?0:Math.pow(2,10*t-10)}static expoOut(t){return t===1?1:1-Math.pow(2,-10*t)}static expoInOut(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-Mt.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*Mt.bounceIn(2*t):.5*Mt.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(i===0||i===1)return i;const r=e/Rt*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Rt/e)}}static getElasticOut(t,e){return function(i){if(i===0||i===1)return i;const r=e/Rt*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-r)*Rt/e)+1}}static getElasticInOut(t,e){return function(i){const r=e/Rt*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Rt/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*Rt/e)*.5+1}}}Mt.quadIn=Mt.getPowIn(2),Mt.quadOut=Mt.getPowOut(2),Mt.quadInOut=Mt.getPowInOut(2),Mt.cubicIn=Mt.getPowIn(3),Mt.cubicOut=Mt.getPowOut(3),Mt.cubicInOut=Mt.getPowInOut(3),Mt.quartIn=Mt.getPowIn(4),Mt.quartOut=Mt.getPowOut(4),Mt.quartInOut=Mt.getPowInOut(4),Mt.quintIn=Mt.getPowIn(5),Mt.quintOut=Mt.getPowOut(5),Mt.quintInOut=Mt.getPowInOut(5),Mt.backIn=Mt.getBackIn(1.7),Mt.backOut=Mt.getBackOut(1.7),Mt.backInOut=Mt.getBackInOut(1.7),Mt.elasticIn=Mt.getElasticIn(1,.3),Mt.elasticOut=Mt.getElasticOut(1,.3),Mt.elasticInOut=Mt.getElasticInOut(1,.3*1.5);class Bp{constructor(){this.id=Gt.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===ui.END?this.removeAnimate(e):e.status===ui.RUNNING||e.status===ui.INITIAL?(this.animateCount++,e.advance(t)):e.status===ui.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t,e=!0){t._onRemove&&t._onRemove.forEach(i=>i()),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}}const Fp=new Bp;class nS{constructor(t,e,i,r,o){this.from=t,this.to=e,this.duration=i,this.easing=r,this.params=o,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},(t=this.step.prev.getLastProps())!==null&&t!==void 0?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(this.updateCount===0){this.onFirstRun();const r=this.step.getLastProps();Object.keys(r).forEach(o=>{this.subAnimate.animate.validAttr(o)&&(i[o]=r[o])})}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}}class rS extends nS{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}}class _r{constructor(t=Gt.GenAutoIncrementId(),e=Fp){this.id=t,this.timeline=e,this.status=ui.INITIAL,this.tailAnimate=new Tp(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this)}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((t,e)=>t+e.totalDuration,0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach(i=>{e=Cn(i.getDuration(),e)}),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){_r.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.duration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t,e=_r.mode){t&&e&nl.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:Ti.ANIMATE_PLAY})}runCb(t){const e=new rS(()=>{t(this,e.step.prev)});return this.tailAnimate.play(e),this}customInterpolate(t,e,i,r,o,s){const a=_r.interpolateMap.get(t)||_r.interpolateMap.get("");return!!a&&a(t,e,i,r,o,s)}pause(){this.status===ui.RUNNING&&(this.status=ui.PAUSED)}resume(){this.status===ui.PAUSED&&(this.status=ui.RUNNING)}to(t,e,i,r){if(this.tailAnimate.to(t,e,i,r),this.target){const o=this.target.stage;o&&o.renderNextFrame()}return this}from(t,e,i,r){if(this.tailAnimate.from(t,e,i,r),this.target){const o=this.target.stage;o&&o.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}subAnimate(){const t=new Tp(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach(e=>this.preventAttr(e))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&this.target.onAnimateBind(this),this.subAnimates.forEach(e=>{e.bind(t)}),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===ui.INITIAL&&(this.status=ui.RUNNING,this._onStart&&this._onStart.forEach(e=>e())),this.setPosition(this.rawPosition+t*this.timeScale)&&this.status===ui.RUNNING&&(this.status=ui.END,this._onEnd&&this._onEnd.forEach(e=>e()))}setPosition(t){let e,i=0;const r=this.rawPosition,o=this.subAnimates.reduce((a,l)=>a+l.totalDuration,0);t<0&&(t=0);const s=t>=o;if(s&&(t=o),t===r)return s;for(let a=0;a<this.subAnimates.length&&(e=this.subAnimates[a],!(i+e.totalDuration>=t));a++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),s}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=ui.END}stop(t){t||this.target.onStop(),t==="start"?this.target.onStop(this.getStartProps()):t==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}}_r.mode=nl.NORMAL,_r.interpolateMap=new Map;class Tp{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new Mp(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(e==null||e<0)&&(e=0);const i=t.easing,r=typeof i=="string"?Mt[i]:i,o=this._addStep(e,null,r);return o.type=ho.customAnimate,this._appendProps(t.getEndProps(),o,!1),this._appendCustomAnimate(t,o),this}to(t,e,i,r){(e==null||e<0)&&(e=0);const o=typeof i=="string"?Mt[i]:i,s=this._addStep(e,null,o);return s.type=ho.to,this._appendProps(t,s,!!r&&r.tempProps),s.propKeys||(s.propKeys=Object.keys(s.props)),r&&r.noPreventAttrs||this.target.animates.forEach(a=>{a.id!==this.animate.id&&a.preventAttrs(s.propKeys)}),this}from(t,e,i,r){this.to(t,0,i,r);const o={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(s=>{o[s]=this.getLastPropByName(s,this.stepTail)}),this.to(o,e,i,r),this.stepTail.type=ho.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return(t=this.stepHead)===null||t===void 0?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=ho.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const r=new Mp(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(r),this.stepTail=r,r}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let r=e.prev;const o=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach(a=>{e.props[a]===void 0&&(e.props[a]=this.target.getDefaultAttribute(a))});r.prev;)r.props&&(r.propKeys||(r.propKeys=Object.keys(r.props)),r.propKeys.forEach(a=>{o[a]===void 0&&(o[a]=r.props[a])})),e.propKeys=Object.keys(e.props),r=r.prev;const s=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(o)),e.propKeys.forEach(a=>{if(s[a]===void 0){const l=this.animate.getStartProps();s[a]=l[a]=this.target.getComputedAttribute(a)}}),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,r=this.loop,o=this.rawPosition;let s,a,l=!1;const h=(e=this._startAt)!==null&&e!==void 0?e:0;if(t<0&&(t=0),t<h)return this.rawPosition=t,!1;if(t-=h,i<=0)return l=!0,l;if(s=Math.floor(t/i),a=t-s*i,l=t>=r*i+i,l&&(a=i,s=r,t=a*s+i),t===o)return l;const u=!this.reversed!=!(this.bounce&&s%2);return u&&(a=i-a),this._deltaPosition=a-this.position,this.position=a,this.rawPosition=t+h,this.updatePosition(l,u),l}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const r=this.position,o=this.duration;if(this.target&&i){let s=i.next;for(;s&&s.position<=r;)i=s,s=i.next;let a=t?o===0?1:r/o:(r-i.position)/i.duration;i.easing&&(a=i.easing(a)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,a,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach(l=>l(i,a))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let r=e.prev;for(;r&&r!==t;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let r=e.next;for(;r&&r!==t;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=r.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&i.props[t]!==void 0)return i.props[t];if(i.customAnimate){const r=i.customAnimate.getEndProps()[t];if(r!==void 0)return r}i=i.prev}return te.getInstance().warn("\u672A\u77E5\u9519\u8BEF\uFF0Cstep\u4E2D\u627E\u4E0D\u5230\u5C5E\u6027"),e.props[t]}updateTarget(t,e,i){t.props==null&&t.customAnimate==null||this.target.onStep(this,this.animate,t,e,i)}}class Mp{constructor(t,e,i,r){this.duration=e,this.position=t,this.props=i,this.easing=r}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}}const Rp={duration:200,easing:"cubicOut"},Nz={duration:1e3,easing:"quadInOut"};var Xn=function(n,t,e){return n<t?t:n>e?e:n};function Ep(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),o=e-i/2;let s=0,a=0,l=0;return 0<=n&&n<60?(s=i,a=r,l=0):60<=n&&n<120?(s=r,a=i,l=0):120<=n&&n<180?(s=0,a=i,l=r):180<=n&&n<240?(s=0,a=r,l=i):240<=n&&n<300?(s=r,a=0,l=i):300<=n&&n<360&&(s=i,a=0,l=r),s=Math.round(255*(s+o)),a=Math.round(255*(a+o)),l=Math.round(255*(l+o)),{r:s,g:a,b:l}}function Pp(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),o=r-i;let s=0,a=0,l=0;return s=o===0?0:r===n?(t-e)/o%6:r===t?(e-n)/o+2:(n-t)/o+4,s=Math.round(60*s),s<0&&(s+=360),l=(r+i)/2,a=o===0?0:o/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l}}const Hp=/^#([0-9a-f]{3,8})$/,Lp={transparent:4294967040},Xd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function cl(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function qd(n){return lt(n)?new gi(n>>16,n>>8&255,255&n,1):rt(n)?new gi(n[0],n[1],n[2]):new gi(255,255,255)}function oS(n){return lt(n)?new gi(n>>>24,n>>>16&255,n>>>8&255,255&n):rt(n)?new gi(n[0],n[1],n[2],n[3]):new gi(255,255,255,1)}function Zd(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function Jd(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}class rn{static Brighter(t,e=1){return e===1?t:new rn(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new rn(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof rn?t:new rn(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(N(Lp[t]))return oS(Lp[t]);if(N(Xd[t]))return qd(Xd[t]);const e=`${t}`.trim().toLowerCase(),i=Hp.exec(e);if(i){const r=parseInt(i[1],16),o=i[1].length;return o===3?new gi((r>>8&15)+((r>>8&15)<<4),(r>>4&15)+((r>>4&15)<<4),(15&r)+((15&r)<<4),1):o===6?qd(r):o===8?new gi(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):void 0}if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new gi(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),o=Ep(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new gi(o.r,o.g,o.b,parseFloat(r[3]))}}constructor(t){const e=rn.parseColorString(t);e?this.color=e:(console.warn(`Warn: \u4F20\u5165${t}\u65E0\u6CD5\u89E3\u6790\u4E3AColor`),this.color=new gi(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=Pp(this.color.r,this.color.g,this.color.b),s=Ep(ut(t)?o.h:Xn(t,0,360),ut(e)?o.s:e>=0&&e<=1?100*e:e,ut(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new gi(s.r,s.g,s.b,r),this}setRGB(t,e,i){return!ut(t)&&(this.color.r=t),!ut(e)&&(this.color.g=e),!ut(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=Hp.exec(e),r=parseInt(i[1],16),o=i[1].length;return o===3?new gi((r>>8&15)+((r>>8&15)<<4),(r>>4&15)+((r>>4&15)<<4),(15&r)+((15&r)<<4),1):o===6?qd(r):o===8?new gi(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):this}setColorName(t){const e=Xd[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new rn(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=Zd(t.color.r),this.color.g=Zd(t.color.g),this.color.b=Zd(t.color.b),this}copyLinearToSRGB(t){return this.color.r=Jd(t.color.r),this.color.g=Jd(t.color.g),this.color.b=Jd(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class gi{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),N(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${cl(this.r)+cl(this.g)+cl(this.b)+(this.opacity===1?"":cl(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=Pp(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}}function Vz(n,t){const e=Color.parseColorString(n),i=Color.parseColorString(t);return!(!e||!i)&&e.r===i.r&&e.g===i.g&&e.b===i.b&&e.opacity===i.opacity}var Mi;(function(n){n[n.Color255=0]="Color255",n[n.Color1=1]="Color1"})(Mi||(Mi={}));class Ce{static Get(t,e=Mi.Color1,i=[0,0,0,1]){if(e===Mi.Color1){const s=Ce.store1[t];if(s)return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i;const a=rn.parseColorString(t);if(a){const l=[a.r/255,a.g/255,a.b/255,a.opacity];Ce.store1[t]=l,Ce.store255[t]=[a.r,a.g,a.b,a.opacity],i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3]}return i}const r=Ce.store255[t];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const o=rn.parseColorString(t);return o&&(Ce.store1[t]=[o.r/255,o.g/255,o.b/255,o.opacity],Ce.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=o.r,i[1]=o.g,i[2]=o.b,i[3]=o.opacity),i}static Set(t,e,i){if(e===Mi.Color1){if(Ce.store1[t])return;Ce.store1[t]=i,Ce.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(Ce.store255[t])return;Ce.store255[t]=i,Ce.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}Ce.store255={},Ce.store1={};function gl(n,t=!1){return Array.isArray(n)?t?`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])},${n[3].toFixed(2)})`:`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])})`:n}function bo(n,t,e,i,r){if(!n||!t)return n&&gl(n)||t&&gl(t)||!1;let o,s,a=!1,l=!1;if(Array.isArray(n)?o=n:typeof n=="string"?o=Ce.Get(n,Mi.Color255):a=!0,Array.isArray(t)?s=t:typeof t=="string"?s=Ce.Get(t,Mi.Color255):l=!0,a!==l){const h=a?n:t,u=a?t:n,d=Object.assign(Object.assign({},h),{stops:h.stops.map(c=>Object.assign(Object.assign({},c),{color:gl(u)}))});return a?bo(h,d,e,i,r):bo(d,h,e,i,r)}if(a){if(n.gradient===t.gradient){const h=n,u=t,d=h.stops,c=u.stops;if(d.length!==c.length)return!1;if(h.gradient==="linear")return sS(h,u,e);if(h.gradient==="radial")return aS(h,u,e);if(h.gradient==="conical")return lS(h,u,e)}return!1}return r&&r(o,s),gl(hS(o,s,e),i)}function sS(n,t,e){const i=n.stops,r=t.stops;return{gradient:"linear",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,stops:new Array(i.length).fill(0).map((o,s)=>({color:Qd(i[s].color,r[s].color,e),offset:i[s].offset+(r[s].offset-i[s].offset)*e}))}}function aS(n,t,e){const i=n.stops,r=t.stops;return{gradient:"radial",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,r0:n.r0+(t.r0-n.r0)*e,r1:n.r1+(t.r1-n.r1)*e,stops:new Array(i.length).fill(0).map((o,s)=>({color:Qd(i[s].color,r[s].color,e),offset:i[s].offset+(r[s].offset-i[s].offset)*e}))}}function lS(n,t,e){const i=n.stops,r=t.stops;return{gradient:"conical",startAngle:n.startAngle+(t.startAngle-n.startAngle)*e,endAngle:n.endAngle+(t.endAngle-n.endAngle)*e,x:n.x+(t.x-n.x)*e,y:n.y+(t.y-n.y)*e,stops:new Array(i.length).fill(0).map((o,s)=>({color:Qd(i[s].color,r[s].color,e),offset:i[s].offset+(r[s].offset-i[s].offset)*e}))}}function hS(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e,n[2]+(t[2]-n[2])*e,n[3]+(t[3]-n[3])*e]}const qn=[0,0,0,0],As=[0,0,0,0];function Qd(n,t,e){return Ce.Get(n,Mi.Color255,qn),Ce.Get(t,Mi.Color255,As),`rgba(${Math.round(qn[0]+(As[0]-qn[0])*e)},${Math.round(qn[1]+(As[1]-qn[1])*e)},${Math.round(qn[2]+(As[2]-qn[2])*e)},${qn[3]+(As[3]-qn[3])*e})`}const Gz=10;class ee{static GetImage(t,e){var i;const r=ee.cache.get(t);r?r.loadState==="fail"?$.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):ee.loadImage(t,e)}static GetSvg(t,e){var i;let r=ee.cache.get(t);r?r.loadState==="fail"?$.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):(r={type:"image",loadState:"init"},ee.cache.set(t,r),r.dataPromise=$.global.loadSvg(t),r.dataPromise?(r.waitingMark=[e],r.dataPromise.then(o=>{var s;r.loadState=o!=null&&o.data?"success":"fail",r.data=o==null?void 0:o.data,(s=r.waitingMark)===null||s===void 0||s.map((a,l)=>{o!=null&&o.data?(r.loadState="success",r.data=o.data,a.imageLoadSuccess(t,o.data)):(r.loadState="fail",a.imageLoadFail(t))})})):(r.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=ee.cache.get(t);return i?i.loadState==="init"||i.loadState==="fail"?Promise.reject():i.loadState==="loading"?i.dataPromise.then(r=>r.data):Promise.resolve(i.data):(i={type:e,loadState:"init"},ee.cache.set(t,i),e==="arrayBuffer"?i.dataPromise=$.global.loadArrayBuffer(t):e==="blob"?i.dataPromise=$.global.loadBlob(t):e==="json"&&(i.dataPromise=$.global.loadJson(t)),i.dataPromise.then(r=>r.data))}static loading(){setTimeout(()=>{if(!ee.isLoading&&ee.toLoadAueue.length){ee.isLoading=!0;const t=ee.toLoadAueue.splice(0,10),e=[];t.forEach(i=>{const{url:r,marks:o}=i,s={type:"image",loadState:"init"};if(ee.cache.set(r,s),s.dataPromise=$.global.loadImage(r),s.dataPromise){s.waitingMark=o;const a=s.dataPromise.then(l=>{var h;s.loadState=l!=null&&l.data?"success":"fail",s.data=l==null?void 0:l.data,(h=s.waitingMark)===null||h===void 0||h.map((u,d)=>{l!=null&&l.data?(s.loadState="success",s.data=l.data,u.imageLoadSuccess(r,l.data)):(s.loadState="fail",u.imageLoadFail(r))})});e.push(a)}else s.loadState="fail",o.forEach(a=>a.imageLoadFail(r))}),Promise.all(e).then(()=>{ee.isLoading=!1,ee.loading()}).catch(i=>{console.error(i),ee.isLoading=!1,ee.loading()})}},0)}static loadImage(t,e){const i=kp(t,ee.toLoadAueue);if(i!==-1)return ee.toLoadAueue[i].marks.push(e),void ee.loading();ee.toLoadAueue.push({url:t,marks:[e]}),ee.loading()}static improveImageLoading(t){const e=kp(t,ee.toLoadAueue);if(e!==-1){const i=ee.toLoadAueue.splice(e,1);ee.toLoadAueue.unshift(i[0])}}}function kp(n,t){for(let e=0;e<t.length;e++)if(t[e].url===n)return e;return-1}ee.cache=new Map,ee.isLoading=!1,ee.toLoadAueue=[];const uS=new je,Ip=new me,Uz=null,ki=["lineWidth","scaleX","scaleY","angle","anchor","visible"],Op=["x","y"],zp=["scaleX","scaleY"],Wp=["angle"],xs=new xe,fi={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class vi extends eS{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(vi.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get AABBBounds(){return this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise")}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(t={}){var e;super(),this._AABBBounds=new me,this._updateTag=Yt.INIT,this.attribute=t,this.valid=this.isValid(),t.background&&this.loadImage((e=t.background.background)!==null&&e!==void 0?e:t.background,!0)}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t,e=!1){var i,r;const{dx:o=t.dx,dy:s=t.dy}=this.attribute;if(e&&this.parent){const a=this.parent.attribute;xs.x=o+((i=a.scrollX)!==null&&i!==void 0?i:0),xs.y=s+((r=a.scrollY)!==null&&r!==void 0?r:0)}else xs.x=o,xs.y=s;return xs}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(t){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;$.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return $.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),e}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(t=!0){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(t=!0){return this._transMatrix||(this._transMatrix=new je),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&Yt.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&Yt.UPDATE_BOUNDS)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&Yt.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&Yt.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&Yt.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite(((t=i.x)!==null&&t!==void 0?t:0)+((e=i.y)!==null&&e!==void 0?e:0))}_validNumber(t){return t==null||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&Yt.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=Yt.CLEAR_SHAPE}containsPoint(t,e,i,r){if(!r)return!1;if(i===ps.GLOBAL){const o=new xe(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(o,o),t=o.x,e=o.y}return r.containsPoint(this,{x:t,y:e})}setAttributes(t,e=!1,i){(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background&&this.loadImage(t.background,!0),this._setAttributes(t,e,i)}_setAttributes(t,e=!1,i){const r=Object.keys(t);for(let o=0;o<r.length;o++){const s=r[o];this.attribute[s]=t[s]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,r){var o;const s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);s?this._setAttributes(s,i,r):ut((o=this.normalAttrs)===null||o===void 0?void 0:o[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[t]=e,t==="background"&&this.loadImage(e,!0)}needUpdateTags(t,e=ki){for(let i=0;i<e.length;i++){const r=e[i];if(t.indexOf(r)!==-1)return!0}return!1}needUpdateTag(t,e=ki){for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:Ti.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background&&this.loadImage(t.background,!0),this._updateTag=Yt.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,r;if(t===0&&e===0)return this;const o={type:Ti.TRANSLATE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,Op,o);s&&(t=s.x,e=s.y,delete s.x,delete s.y,this._setAttributes(s));const a=this.attribute,l=a.postMatrix;return l?$.transformUtil.fromMatrix(l,l).translate(t,e):(a.x=((i=a.x)!==null&&i!==void 0?i:Ve.x)+t,a.y=((r=a.y)!==null&&r!==void 0?r:Ve.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const r={type:Ti.TRANSLATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,Op,r);return o?(this._setAttributes(o,!1,r),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(t,e,i){var r,o;if(t===1&&e===1)return this;const s={type:Ti.SCALE},a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,zp,s);a&&(t=a.scaleX,e=a.scaleY,delete a.scaleX,delete a.scaleY,this._setAttributes(a));const l=this.attribute;if(i){let{postMatrix:h}=this.attribute;h||(h=new je,l.postMatrix=h),$.transformUtil.fromMatrix(h,h).scale(t,e,i)}else l.scaleX=((r=l.scaleX)!==null&&r!==void 0?r:Ve.scaleX)*t,l.scaleY=((o=l.scaleY)!==null&&o!==void 0?o:Ve.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const r={type:Ti.SCALE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,zp,r);return o?(this._setAttributes(o,!1,r),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(t,e){var i;if(t===0)return this;const r={type:Ti.ROTATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,Wp,r);o&&(delete o.angle,this._setAttributes(o,!1,r));const s=this.attribute;if(e){let{postMatrix:a}=this.attribute;a||(a=new je,s.postMatrix=a),$.transformUtil.fromMatrix(a,a).rotate(t,e)}else s.angle=((i=s.angle)!==null&&i!==void 0?i:Ve.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:Ti.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,Wp,i);return r?(this._setAttributes(r,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){this.animates||(this.animates=new Map);const e=new _r(t==null?void 0:t.id,this.stage&&this.stage.getTimeline()).bind(this);if(t){const{onStart:i,onFrame:r,onEnd:o,onRemove:s}=t;i!=null&&e.onStart(i),r!=null&&e.onFrame(r),o!=null&&e.onEnd(o),s!=null&&e.onRemove(s),e.interpolateFunc=t.interpolate}return this.animates.set(e.id,e),e.onRemove(()=>{this.animates.delete(e.id)}),e}onAttributeUpdate(t){t&&t.skipUpdateCallback||($.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise"),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise"),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!ut(t)||this.currentStates.includes(t))}getState(t){var e;return(e=this.states)===null||e===void 0?void 0:e[t]}applyStateAttrs(t,e,i,r){var o,s,a,l;if(i){const h=Object.keys(t),u=this.getNoWorkAnimateAttr(),d={};let c;r?h.forEach(f=>{u[f]?(c||(c={}),c[f]=t[f]):d[f]=t[f]===void 0?this.getDefaultAttribute(f):t[f]}):h.forEach(f=>{u[f]?(c||(c={}),c[f]=t[f]):d[f]=t[f]});const g=this.animate();g.stateNames=e,g.to(d,(s=(o=this.stateAnimateConfig)===null||o===void 0?void 0:o.duration)!==null&&s!==void 0?s:Rp.duration,(l=(a=this.stateAnimateConfig)===null||a===void 0?void 0:a.easing)!==null&&l!==void 0?l:Rp.easing),c&&this.setAttributes(c,!1,{type:Ti.STATE})}else this.setAttributes(t,!1,{type:Ti.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach(i=>{i in this.normalAttrs?(e[i]=this.normalAttrs[i],delete this.normalAttrs[i]):e[i]=this.getNormalAttribute(i)}),Object.keys(this.normalAttrs).forEach(i=>{t[i]=this.normalAttrs[i]})):Object.keys(t).forEach(i=>{e[i]=this.getNormalAttribute(i)}),this.normalAttrs=e}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach(i=>{if(i.stateNames){const r=i.getEndProps();xp(r,t)&&(e=r[t])}}),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if((this.currentStates?this.currentStates.indexOf(t):-1)>=0){const i=this.currentStates.filter(r=>r!==t);this.useStates(i,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var r;if(this.currentStates&&this.currentStates.includes(t)&&(e||this.currentStates.length===1))return;const o=e&&(!((r=this.currentStates)===null||r===void 0)&&r.length)?this.currentStates.concat([t]):[t];this.useStates(o,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((o,s)=>this.currentStates[s]!==o)))return;const r={};t.forEach(o=>{var s;const a=this.stateProxy?this.stateProxy(o,t):(s=this.states)===null||s===void 0?void 0:s[o];a&&Object.assign(r,a)}),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}addUpdateBoundTag(){this._updateTag|=Yt.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=Yt.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=Yt.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&Yt.UPDATE_SHAPE_AND_BOUNDS)===Yt.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=Yt.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Yt.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Yt.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=Yt.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=Yt.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=Yt.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=Yt.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&Yt.UPDATE_LAYOUT)}getAnchor(t,e){const i=[0,0],r=()=>{if(e.b)return e.b;const{scaleX:o,scaleY:s,angle:a}=this.attribute;return Ip.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),e.b=this.AABBBounds.clone(),this._AABBBounds.copy(Ip),this.setAttributes({scaleX:o,scaleY:s,angle:a}),e.b};if(typeof t[0]=="string"){const o=parseFloat(t[0])/100,s=r();i[0]=s.x1+(s.x2-s.x1)*o}else i[0]=t[0];if(typeof t[1]=="string"){const o=parseFloat(t[1])/100,s=r();i[1]=s.y1+(s.y2-s.y1)*o}else i[1]=t[1];return i}doUpdateLocalMatrix(){const{x:t=Ve.x,y:e=Ve.y,scaleX:i=Ve.scaleX,scaleY:r=Ve.scaleY,angle:o=Ve.angle,scaleCenter:s,anchor:a,postMatrix:l}=this.attribute;let h=[0,0];const u={};if(a&&(h=this.getAnchor(a,u)),!s||i===1&&r===1)Bw(this._transMatrix,this._transMatrix.reset(),t,e,i,r,o,a&&h);else{const c=this._transMatrix;c.reset(),c.translate(h[0],h[1]),c.rotate(o),c.translate(-h[0],-h[1]),c.translate(t,e),h=this.getAnchor(s,u),$.transformUtil.fromMatrix(c,c).scale(i,r,{x:h[0],y:h[1]})}const d=this.getOffsetXY(Ve);if(this._transMatrix.e+=d.x,this._transMatrix.f+=d.y,l){const c=uS.setValue(l.a,l.b,l.c,l.d,l.e,l.f),g=this._transMatrix;c.multiply(g.a,g.b,g.c,g.d,g.e,g.f),g.setValue(c.a,c.b,c.c,c.d,c.e,c.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const i=t.getTimeline();this.animates.forEach(r=>{r.setTimeline(i)})}this._onSetStage&&this._onSetStage(this,t,e),$.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:Ti.ANIMATE_END})}onStep(t,e,i,r,o){const s={};if(i.customAnimate)i.customAnimate.update(o,r,s);else{const a=i.props,l=i.parsedProps,h=i.propKeys;this.stepInterpolate(t,e,s,i,r,o,a,void 0,l,h)}this.setAttributes(s,!1,{type:Ti.ANIMATE_UPDATE,animationState:{ratio:r,end:o,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,r,o,s,a,l,h,u){u||(u=Object.keys(a),r.propKeys=u),s?r.propKeys.forEach(d=>{e.validAttr(d)&&(i[d]=a[d])}):u.forEach(d=>{var c;if(!e.validAttr(d))return;const g=a[d],f=(c=l&&l[d])!==null&&c!==void 0?c:t.getLastPropByName(d,r);if(g==null||f==null)return void(i[d]=g);let p;p=e.interpolateFunc&&e.interpolateFunc(d,o,f,g,i),p||(p=e.customInterpolate(d,o,f,g,this,i),p||this.defaultInterpolate(g,f,d,i,h,o)||this._interpolate(d,o,f,g,i))}),r.parsedProps=h}defaultInterpolate(t,e,i,r,o,s){if(Number.isFinite(t))return r[i]=e+(t-e)*s,!0;if(i==="fill"){o||(o={});const a=o.fillColorArray,l=bo(e,a!=null?a:t,s,!1,(h,u)=>{o.fillColorArray=u});return l&&(r[i]=l),!0}if(i==="stroke"){o||(o={});const a=o.strokeColorArray,l=bo(e,a!=null?a:t,s,!1,(h,u)=>{o.strokeColorArray=u});return l&&(r[i]=l),!0}if(i==="shadowColor"){o||(o={});const a=o.shadowColorArray,l=bo(e,a!=null?a:t,s,!0,(h,u)=>{o.shadowColorArray=u});return l&&(r[i]=l),!0}return!1}_interpolate(t,e,i,r,o){}getDefaultAttribute(t){return X(this)[this.type][t]}getComputedAttribute(t){var e;return(e=this.attribute[t])!==null&&e!==void 0?e:this.getDefaultAttribute(t)}onSetStage(t,e=!1){this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=t!=null?t:$.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(t=>t.toJson())}}createPathProxy(t){return ue(t,!0)?this.pathProxy=new Ke().fromString(t):this.pathProxy=new Ke,this.pathProxy}loadImage(t,e=!1){if(!t||e&&dS(t))return;const i=t;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),typeof t=="string"?(r.state="loading",t.startsWith("<svg")?(ee.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(ZD(t)||t.includes("/")||JD(t))&&(ee.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):ye(t)?(r.state="success",r.data=t,this.backgroundImg=this.backgroundImg||e):r.state="fail"}imageLoadSuccess(t,e,i){if(!this.resources)return;const r=this.resources.get(t);r&&(r.state="success",r.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach(e=>{e.stop()})}stopAnimates(t=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren(e=>{e.stopAnimates(t)})}release(){this.releaseStatus="released",$.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,r;if(this._events&&t in this._events){const o=new $d(t,e);o.bubbles=!1,o.manager=(r=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||r===void 0?void 0:r.manager,this.dispatchEvent(o)}}}function dS(n){return!(!n.fill&&!n.stroke)}vi.mixin(iS);var Np;(function(n){n[n.Top=1]="Top",n[n.Right=2]="Right",n[n.Bottom=4]="Bottom",n[n.Left=8]="Left",n[n.ALL=15]="ALL"})(Np||(Np={}));const Zn=[!1,!1,!1,!1],cS=n=>{var t;let e=!0;if(Li(n,!0)){for(let i=0;i<4;i++)Zn[i]=n,e&&(e=!((t=Zn[i])!==null&&t!==void 0&&!t));e=n}else if(Array.isArray(n))for(let i=0;i<4;i++)Zn[i]=!!n[i],e&&(e=!!Zn[i]);else Zn[0]=!1,Zn[1]=!1,Zn[2]=!1,Zn[3]=!1;return{isFullStroke:e,stroke:Zn}},Bs=[0,0,0,0],Ye=n=>n?rt(n)?n.length===0?0:n.length===1?n[0]:n.length===2?(Bs[0]=n[0],Bs[2]=n[0],Bs[1]=n[1],Bs[3]=n[1],Bs):n:n:0,_o=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],fl=[1,2,3,0,1,2,3,0];function tc(n,t,e,i){for(;n>=Rt;)n-=Rt;for(;n<0;)n+=Rt;for(;n>t;)t+=Rt;_o[0].x=e,_o[1].y=e,_o[2].x=-e,_o[3].y=-e;const r=Math.ceil(n/Zi)%4,o=Math.ceil(t/Zi)%4;if(i.add(Ut(n)*e,It(n)*e),i.add(Ut(t)*e,It(t)*e),r!==o||t-n>Kt){let s=!1;for(let a=0;a<fl.length;a++)if(s||r!==fl[a]){if(s&&o===fl[a])break;if(s){const l=_o[fl[a]];i.add(l.x,l.y)}}else{s=!0;const l=_o[r];i.add(l.x,l.y)}}}function Kz(n,t){return!(!n||!t)&&(Array.isArray(n)&&Array.isArray(t)?n.length===t.length&&n.every((e,i)=>jp(e,t[i])):!Number.isNaN(n.x+n.y)&&jp(n,t))}function jp(n,t){return n.x===t.x&&n.y===t.y&&n.x1===t.x1&&n.y1===t.y1&&n.defined===t.defined}function Vp(n,t,e){const{x:i,y:r}=V0(n.x,n.y,t.x,t.y,e),{x:o,y:s}=V0(n.x1,n.y1,t.x1,t.y1,e),a=new xe(i,r,o,s);return a.defined=t.defined,a}function Yz(n,t,e,i){const{x:r,y:o}=pointAt(n.x,n.y,t.x,t.y,e),{x:s,y:a}=pointAt(n.x1,n.y1,t.x1,t.y1,e);return i.x=r,i.y=o,i.x1=s,i.y1=a,i.defined=t.defined,i}function ec(n,t,e){if(!n||!t)return[];Array.isArray(n)||(n=[n]),Array.isArray(t)||(t=[t]);let i=[];if(n.length>t.length){i=t.map(r=>{const o=new xe(r.x,r.y,r.x1,r.y1);return o.defined=r.defined,o});for(let r=0;r<t.length;r++)i[r]=Vp(n[r],t[r],e)}else{i=t.map(r=>{const o=new xe(r.x,r.y,r.x1,r.y1);return o.defined=r.defined,o});for(let r=0;r<n.length;r++)i[r]=Vp(n[r],t[r],e)}return i}const gS=null,$z=n=>gS.includes(n);function pl(n,t){if(rt(n)){let e;for(let i=0;i<n.length&&e===void 0;i++)e=n[i][t];return e}return n[t]}class vl{constructor(){this.durations=[],this.timeout=vl.TimeOut,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),t(0)},this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((e,i)=>e+i,0)/this.durations.length,1e3/60),1e3/30)}}vl.TimeOut=1e3/60;const Gp=new vl,Jn=(n,t)=>ue(n)&&n[n.length-1]==="%"?t*(Number.parseFloat(n.substring(0,n.length-1))/100):n;var fS=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};function Xz(n,t){n.incrementalAppendChild(t)}function qz(n){return fS(this,void 0,void 0,function*(){const t=[],e=n.getChildren();yield new Promise(i=>{application.global.getRequestAnimationFrame()(()=>{i(null)})}),e.forEach(i=>{i.subLayers.size&&i.subLayers.forEach(r=>{r.drawContribution&&r.drawContribution.hooks&&r.drawContribution.rendering&&t.push(new Promise(o=>{r.drawContribution.hooks.completeDraw.tap("outWait",()=>{r.drawContribution.hooks.completeDraw.taps=r.drawContribution.hooks.completeDraw.taps.filter(s=>s.name!=="outWait"),o(null)})}))})}),yield Promise.all(t)})}function ml(n,t,e,i=0){return n.expand(t+(i/2+(e?pS(e,t):0))),n}function pS(n,t){return n?t:0}let vS=0;function ei(){return vS++}var Or;(function(n){n[n.HORIZONTAL=0]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"})(Or||(Or={}));function Up(n){const t=[];let e=0,i="";for(let r=0;r<n.length;r++)bS(n[r])?e?i+=n[r]:(e=1,i=n[r]):(e&&(t.push({text:i,direction:Or.VERTICAL}),i="",e=0),t.push({text:n[r],direction:Or.HORIZONTAL}));return i&&t.push({text:i,direction:Or.VERTICAL}),t}const mS=["\u2026","\uFF08","\uFF09","\u2014","\u3010","\u3011","\u300C","\u300D","\u300A","\u300B"],Kp=new Map;mS.forEach(n=>Kp.set(n,!0));const CS=[""],Yp=new Map;function bS(n){if(Kp.has(n))return!0;if(Yp.has(n))return!1;let t=!1;return n.codePointAt(0)<256&&(t=!0),t}CS.forEach(n=>Yp.set(n,!0));function Zz(n){const t=isArray(n)?n[0]:n,e=[];if(!t)return e;if(isXML(t)===!0){const i=new XMLParser().parse(t);i.tc&&Object.keys(i.tc).forEach(r=>{r==="text"?e.push(_S(i.tc[r])):e.push(yS(i.tc[r]))})}return e}function _S(n){const t={text:""};$p(n,t);const e=n["#text"];return e&&(t.text=e),t}function $p(n,t){const e=n.attribute;e&&e.split(";").forEach(i=>{if(!i)return;const r=i.split(":");if(r.length===2){const o=parseFloat(r[1]);t[r[0].trim()]=isFinite(o)?o:r[1].trim()}else{let o="";for(let s=1;s<r.length;s++)s>1&&(o+=":"),o+=r[s].trim();t[r[0].trim()]=o}})}function yS(n){const t={image:"",width:0,height:0};$p(n,t);const e=t.image;return e&&(t.image=e.replaceAll("&quot",'"').replaceAll("&lt","<").replaceAll("&gt",">")),t}const Cl=ei(),Fs=ei(),Ts=ei(),bl=ei(),_l=ei(),ic=ei(),yl=ei(),Ms=ei(),wl=ei(),Dl=ei(),nc=ei(),Sl=ei(),rc=ei(),oc=ei(),Al=ei(),xl=ei(),Xp=Symbol.for("GraphicService"),qp=Symbol.for("GraphicCreator"),Qz=Object.keys({"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity"}),Zp={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},wS=Object.keys(Zp);var Jp;(function(n){n[n.LESS_GROUP=0]="LESS_GROUP",n[n.MORE_GROUP=1]="MORE_GROUP"})(Jp||(Jp={}));class Di extends vi{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=ic,this._childUpdateTag=Yt.UPDATE_BOUNDS}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new ws),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new ws)}hideAll(){this.setAttribute("visible",!1),this.forEachChildren(t=>{t.isContainer&&t.hideAll?t.hideAll():t.setAttribute("visible",!1)})}showAll(){this.setAttribute("visible",!0),this.forEachChildren(t=>{t.isContainer&&t.showAll?t.showAll():t.setAttribute("visible",!0)})}containsPoint(t,e,i){if(i===ps.GLOBAL){const r=new xe(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(r,r),this.AABBBounds.contains(r.x,r.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&Yt.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;$.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),$.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),e}doUpdateLocalMatrix(){const{x:t=Ve.x,y:e=Ve.y,dx:i=Ve.dx,dy:r=Ve.dy,scaleX:o=Ve.scaleX,scaleY:s=Ve.scaleY,angle:a=Ve.angle,postMatrix:l}=this.attribute;if(t!==0||e!==0||i!==0||r!==0||o!==1||s!==1||a!==0||l)return super.doUpdateLocalMatrix();this._transMatrix.reset()}doUpdateAABBBounds(){const t=this.attribute,e=X(this).group;this._AABBBounds.clear();const i=$.graphicService.updateGroupAABBBounds(t,e,this._AABBBounds,this),{boundsPadding:r=e.boundsPadding}=t,o=Ye(r);return o&&i.expand(o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),i}clearUpdateBoundTag(){this._updateTag&=Yt.CLEAR_BOUNDS,this._childUpdateTag&=Yt.CLEAR_BOUNDS}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}addUpdateBoundTag(){this._updateTag|=Yt.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&Yt.UPDATE_BOUNDS||(this._childUpdateTag|=Yt.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),$.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),$.graphicService.onClearIncremental(this,this.stage)}appendChild(t,e=!0){const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){const i=super.insertBefore(t,e);return this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertAfter(t,e){const i=super.insertAfter(t,e);return this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertInto(t,e){const i=super.insertInto(t,e);return this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}removeChild(t){const e=super.removeChild(t);return t.stage=null,$.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(t=!1){this.forEachChildren(e=>{$.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),$.graphicService.onSetStage(this,t),this.forEachChildren(i=>{i.setStage(t,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&Yt.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find(i=>i.name===t,e)}createOrUpdateChild(t,e,i){let r=this._getChildByName(t);return r?r.setAttributes(e):(r=$.graphicService.creator[i](e),r.name=t,this.add(r)),r}clone(){return new Di(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Di.NOWORK_ANIMATE_ATTR}}Di.NOWORK_ANIMATE_ATTR=fi;function sc(n){return new Di(n)}class DS extends Di{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("\u6682\u4E0D\u652F\u6301")}get dpr(){return this._dpr}constructor(t,e,i,r){var o;super({}),this.stage=t,this.global=e,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(o=r.zIndex)!==null&&o!==void 0?o:0}),this.layer=this,this.subLayers=new Map,this.theme=new ws,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(t=!0){const e=Array.from(this.subLayers.values()).sort((i,r)=>i.zIndex-r.zIndex);this.layerHandler.merge(e.map(i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(t),i.layer.getNativeHandler()))),t&&e.forEach(i=>{i.group&&(i.group.incremental=0)}),e.forEach(i=>{$.layerService.releaseLayer(this.stage,i.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)})}render(t,e){var i;const r=this.stage;this.layerHandler.render([this],{renderService:t.renderService,x:r.x,y:r.y,width:this.viewWidth,height:this.viewHeight,stage:this.stage,layer:this,background:(i=t.background)!==null&&i!==void 0?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach(o=>o(this)),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("\u6682\u4E0D\u652F\u6301")}setToFrame(t){throw new Error("\u6682\u4E0D\u652F\u6301")}prepare(t,e){}combineTo(t,e){var i,r,o;this.offscreen&&(this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,x:(r=e.x)!==null&&r!==void 0?r:this.stage.x,y:(o=e.y)!==null&&o!==void 0?o:this.stage.y,width:this.viewWidth,height:this.viewHeight,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach(s=>s(this)))}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(t=>{$.layerService.releaseLayer(this.stage,t.layer)})}drawTo(t,e){var i,r,o;this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,x:(r=e.x)!==null&&r!==void 0?r:this.stage.x,y:(o=e.y)!==null&&o!==void 0?o:this.stage.y,width:this.viewWidth,height:this.viewHeight,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach(s=>s(this))}}const Qp=Symbol.for("TransformUtil"),tv=Symbol.for("GraphicUtil"),ac=Symbol.for("LayerService"),ev=Symbol.for("StaticLayerHandlerContribution"),iv=Symbol.for("DynamicLayerHandlerContribution"),nv=Symbol.for("VirtualLayerHandlerContribution");var Rs,SS=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Es=Rs=class{static GenerateLayerId(){return`${Rs.idprefix}_${Rs.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=$.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(n){return this.layerMap.get(n)}getRecommendedLayerType(n){return n||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(n){let t;return t=n==="static"?pt.get(ev):n==="dynamic"?pt.get(iv):pt.get(nv),t}createLayer(n,t={main:!1}){var e;this.tryInit();let i=this.getRecommendedLayerType(t.layerMode);i=t.main||t.canvasId?"static":i;const r=this.getLayerHandler(i),o=new DS(n,this.global,n.window,Object.assign(Object.assign({main:!1},t),{layerMode:i,canvasId:(e=t.canvasId)!==null&&e!==void 0?e:Rs.GenerateLayerId(),layerHandler:r})),s=this.layerMap.get(n)||[];return s.push(o),this.layerMap.set(n,s),this.staticLayerCountInEnv--,o}prepareStageLayer(n){let t;n.forEachChildren(e=>{const i=e.getNativeHandler();i.type==="virtual"?(i.mainHandler=t,t.secondaryHandlers.push(i)):(t=i,t.secondaryHandlers=[])})}releaseLayer(n,t){t.release();const e=this.layerMap.get(n)||[];this.layerMap.set(n,e.filter(i=>i!==t))}layerCount(n){return(this.layerMap.get(n)||[]).length}restLayerCount(n){return this.global.env==="browser"?10:0}};Es.idprefix="visactor_layer",Es.prefix_count=0,Es=Rs=SS([Z(),AS("design:paramtypes",[])],Es);var xS=new ht(n=>{n(Ad).to(xd).inSingletonScope(),n(ul).to(Gd),n(tv).to(Ud).inSingletonScope(),n(Qp).to(Kd).inSingletonScope(),n(ac).to(Es).inSingletonScope()});const rv=Symbol.for("IncrementalDrawContribution"),Bl=Symbol.for("ArcRender"),lc=Symbol.for("Arc3dRender"),Fl=Symbol.for("AreaRender"),Tl=Symbol.for("CircleRender"),We=Symbol.for("GraphicRender"),ov=Symbol.for("GroupRender"),Ml=Symbol.for("LineRender"),Rl=Symbol.for("PathRender"),El=Symbol.for("PolygonRender"),Pl=Symbol.for("RectRender"),hc=Symbol.for("Rect3DRender"),Hl=Symbol.for("SymbolRender"),uc=Symbol.for("TextRender"),dc=Symbol.for("RichTextRender"),cc=Symbol.for("Pyramid3dRender"),Ll=Symbol.for("GlyphRender"),sv=Symbol.for("ImageRender"),tW=Symbol.for("RenderSelector"),gc=Symbol.for("DrawContribution");var BS=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},TS=function(n,t){return function(e,i){t(e,i,n)}};const av=Symbol.for("RenderService"),eW=Symbol.for("BeforeRenderConstribution");let fc=class{constructor(n){this.drawContribution=n}prepare(n){n&&this.renderTreeRoots.forEach(t=>{this._prepare(t,n)})}_prepare(n,t){n.forEachChildren(e=>{this._prepare(e,t)}),n.update({bounds:t,trans:!0})}prepareRenderList(){}beforeDraw(n){}draw(n){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(n){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(n,t){this.renderTreeRoots=n,this.drawParams=t;const e=t.updateBounds;this.prepare(e),this.prepareRenderList(),this.beforeDraw(t),this.draw(t),this.afterDraw(t)}};fc=BS([Z(),TS(0,At(gc)),FS("design:paramtypes",[Object])],fc);var MS=new ht(n=>{n(av).to(fc).inSingletonScope()});const iW=Symbol.for("GraphicPicker"),yo=Symbol.for("PickerService"),nW=Symbol.for("BoundsPicker"),lv=Symbol.for("GlobalPickerService"),rW=Symbol.for("MatrixAllocate"),oW=Symbol.for("Mat4Allocate");function hv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}class RS{constructor(){this.pools=[]}allocate(t,e,i,r,o,s){if(!this.pools.length)return new je(t,e,i,r,o,s);const a=this.pools.pop();return a.a=t,a.b=e,a.c=i,a.d=r,a.e=o,a.f=s,a}allocateByObj(t){if(!this.pools.length)return new je(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}class kl{constructor(){this.pools=[]}static identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}allocate(){if(!this.pools.length)return hv();const t=this.pools.pop();return kl.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():hv();for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const on=new RS,ie=new kl;var pc=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};const wo=Symbol.for("PickItemInterceptor");let Il=class{constructor(){this.order=1}afterPickItem(n,t,e,i,r){return n.attribute.shadowRootIdx>0||!n.attribute.shadowRootIdx?this._pickItem(n,t,e,i,r):null}beforePickItem(n,t,e,i,r){return n.attribute.shadowRootIdx<0?this._pickItem(n,t,e,i,r):null}_pickItem(n,t,e,i,r){if(!n.shadowRoot)return null;const{parentMatrix:o}=r||{};if(!o)return null;const s=t.pickContext;s.highPerformanceSave();const a=n.shadowRoot,l=on.allocateByObj(o),h=new xe(l.a*e.x+l.c*e.y+l.e,l.b*e.x+l.d*e.y+l.f),u=t.pickGroup(a,h,l,i);return s.highPerformanceRestore(),u}};Il=pc([Z()],Il);let Ol=class{constructor(){this.order=1}beforePickItem(n,t,e,i,r){const o=n.baseGraphic;if(o&&o.parent){const s=new xe(e.x,e.y),a=t.pickContext;a.highPerformanceSave();const l=o.parent.globalTransMatrix;l.transformPoint(s,s);const h=o.isContainer?t.pickGroup(o,s.clone(),l,i):t.pickItem(o,s.clone(),l,i);return a.highPerformanceRestore(),h}return null}};Ol=pc([Z()],Ol);let zl=class{constructor(){this.order=1}beforePickItem(n,t,e,i,r){if(!n.in3dMode||i.in3dInterceptor)return null;const o=t.pickContext,s=n.stage;if(!o||!s)return null;if(i.in3dInterceptor=!0,o.save(),this.initCanvasCtx(o),o.camera=s.camera,n.isContainer){let a,l=!1,h=!1;if(n.forEachChildren(u=>(l=u.numberType===Fs,!l)),n.forEachChildren(u=>(h=!!u.findFace,!h)),l){const u=n.getChildren(),d=[...u];d.sort((c,g)=>{var f,p,v,m;let C=((p=(f=c.attribute.startAngle)!==null&&f!==void 0?f:0+c.attribute.endAngle)!==null&&p!==void 0?p:0)/2,b=((m=(v=g.attribute.startAngle)!==null&&v!==void 0?v:0+g.attribute.endAngle)!==null&&m!==void 0?m:0)/2;for(;C<0;)C+=Rt;for(;b<0;)b+=Rt;return b-C}),d.forEach(c=>{c._next=null,c._prev=null}),n.removeAllChild(),n.update(),d.forEach(c=>{n.appendChild(c)}),i.hack_pieFace="outside",a=t.pickGroup(n,e,r.parentMatrix,i),a.graphic||(i.hack_pieFace="inside",a=t.pickGroup(n,e,r.parentMatrix,i)),a.graphic||(i.hack_pieFace="top",a=t.pickGroup(n,e,r.parentMatrix,i)),n.removeAllChild(),u.forEach(c=>{c._next=null,c._prev=null}),u.forEach(c=>{n.appendChild(c)})}else if(h){const u=n.getChildren(),d=u.map(c=>({ave_z:c.findFace().vertices.map(g=>{var f;return o.view(g[0],g[1],(f=g[2]+c.attribute.z)!==null&&f!==void 0?f:0)[2]}).reduce((g,f)=>g+f,0),g:c}));d.sort((c,g)=>g.ave_z-c.ave_z),n.removeAllChild(),d.forEach(c=>{c.g._next=null,c.g._prev=null}),n.update(),d.forEach(c=>{n.add(c.g)}),a=t.pickGroup(n,e,r.parentMatrix,i),n.removeAllChild(),u.forEach(c=>{c._next=null,c._prev=null}),n.update(),u.forEach(c=>{n.add(c)})}else a=t.pickGroup(n,e,r.parentMatrix,i);return o.camera=null,i.in3dInterceptor=!1,o.restore(),a}return o.restore(),null}initCanvasCtx(n){n.setTransformForCurrent()}};zl=pc([Z()],zl);var ES=new ht((n,t,e)=>{e(yo)||(n(lv).toSelf(),n(yo).toService(lv)),n(zl).toSelf().inSingletonScope(),n(wo).toService(zl),n(Il).toSelf().inSingletonScope(),n(wo).toService(Il),n(Ol).toSelf().inSingletonScope(),n(wo).toService(Ol),Qe(n,wo)});class Ps{updateBounds(t,e,i,r){const{outerBorder:o,shadowBlur:s=e.shadowBlur}=t;if(o){const a=e.outerBorder,{distance:l=a.distance,lineWidth:h=a.lineWidth}=o;i.expand(l+(s+h)/2)}return i}}class PS extends Ps{updateBounds(t,e,i,r){const{outerBorder:o,shadowBlur:s=e.shadowBlur,strokeBoundsBuffer:a=e.strokeBoundsBuffer}=t;if(o){const l=e.outerBorder,{distance:h=l.distance,lineWidth:u=l.lineWidth}=o;ml(i,h+(s+u)/2,!0,a)}return i}}var HS=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},LS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},kS=function(n,t){return function(e,i){t(e,i,n)}};function IS(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function uv(n,t,e){const i=Math.sin(e),r=Math.cos(e),o=t[4],s=t[5],a=t[6],l=t[7],h=t[8],u=t[9],d=t[10],c=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=o*r+h*i,n[5]=s*r+u*i,n[6]=a*r+d*i,n[7]=l*r+c*i,n[8]=h*r-o*i,n[9]=u*r-s*i,n[10]=d*r-a*i,n[11]=c*r-l*i,n}function dv(n,t,e){const i=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],a=t[2],l=t[3],h=t[8],u=t[9],d=t[10],c=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=o*r-h*i,n[1]=s*r-u*i,n[2]=a*r-d*i,n[3]=l*r-c*i,n[8]=o*i+h*r,n[9]=s*i+u*r,n[10]=a*i+d*r,n[11]=l*i+c*r,n}function OS(n,t,e){const i=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],a=t[2],l=t[3],h=t[4],u=t[5],d=t[6],c=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=o*r+h*i,n[1]=s*r+u*i,n[2]=a*r+d*i,n[3]=l*r+c*i,n[4]=h*r-o*i,n[5]=u*r-s*i,n[6]=d*r-a*i,n[7]=c*r-l*i,n}function zr(n,t,e){const i=e[0],r=e[1],o=e[2];let s,a,l,h,u,d,c,g,f,p,v,m;return t===n?(n[12]=t[0]*i+t[4]*r+t[8]*o+t[12],n[13]=t[1]*i+t[5]*r+t[9]*o+t[13],n[14]=t[2]*i+t[6]*r+t[10]*o+t[14],n[15]=t[3]*i+t[7]*r+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],h=t[3],u=t[4],d=t[5],c=t[6],g=t[7],f=t[8],p=t[9],v=t[10],m=t[11],n[0]=s,n[1]=a,n[2]=l,n[3]=h,n[4]=u,n[5]=d,n[6]=c,n[7]=g,n[8]=f,n[9]=p,n[10]=v,n[11]=m,n[12]=s*i+u*r+f*o+t[12],n[13]=a*i+d*r+p*o+t[13],n[14]=l*i+c*r+v*o+t[14],n[15]=h*i+g*r+m*o+t[15]),n}function vc(n,t){n[0]=t.a,n[1]=t.b,n[2]=0,n[3]=0,n[4]=t.c,n[5]=t.d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t.e,n[13]=t.f,n[14]=0,n[15]=1}function sW(n,t,e){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],d=t[8],c=t[9],g=t[10],f=t[11],p=t[12],v=t[13],m=t[14],C=t[15];let b=e.a,_=e.b,y=0,w=0;return n[0]=b*i+_*a+y*d+w*p,n[1]=b*r+_*l+y*c+w*v,n[2]=b*o+_*h+y*g+w*m,n[3]=b*s+_*u+y*f+w*C,b=e.c,_=e.d,y=0,w=0,n[4]=b*i+_*a+y*d+w*p,n[5]=b*r+_*l+y*c+w*v,n[6]=b*o+_*h+y*g+w*m,n[7]=b*s+_*u+y*f+w*C,b=0,_=0,y=1,w=0,n[8]=b*i+_*a+y*d+w*p,n[9]=b*r+_*l+y*c+w*v,n[10]=b*o+_*h+y*g+w*m,n[11]=b*s+_*u+y*f+w*C,b=e.e,_=e.f,y=0,w=1,n[12]=b*i+_*a+y*d+w*p,n[13]=b*r+_*l+y*c+w*v,n[14]=b*o+_*h+y*g+w*m,n[15]=b*s+_*u+y*f+w*C,n}function zS(n,t,e){const i=e[0],r=e[1],o=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*o,n[9]=t[9]*o,n[10]=t[10]*o,n[11]=t[11]*o,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Hs(n,t,e){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],d=t[8],c=t[9],g=t[10],f=t[11],p=t[12],v=t[13],m=t[14],C=t[15];let b=e[0],_=e[1],y=e[2],w=e[3];return n[0]=b*i+_*a+y*d+w*p,n[1]=b*r+_*l+y*c+w*v,n[2]=b*o+_*h+y*g+w*m,n[3]=b*s+_*u+y*f+w*C,b=e[4],_=e[5],y=e[6],w=e[7],n[4]=b*i+_*a+y*d+w*p,n[5]=b*r+_*l+y*c+w*v,n[6]=b*o+_*h+y*g+w*m,n[7]=b*s+_*u+y*f+w*C,b=e[8],_=e[9],y=e[10],w=e[11],n[8]=b*i+_*a+y*d+w*p,n[9]=b*r+_*l+y*c+w*v,n[10]=b*o+_*h+y*g+w*m,n[11]=b*s+_*u+y*f+w*C,b=e[12],_=e[13],y=e[14],w=e[15],n[12]=b*i+_*a+y*d+w*p,n[13]=b*r+_*l+y*c+w*v,n[14]=b*o+_*h+y*g+w*m,n[15]=b*s+_*u+y*f+w*C,n}function aW(n,t,e){const{alpha:i,beta:r}=e.attribute;if(!i&&!r)return null;const{anchor3d:o=e.attribute.anchor}=e.attribute,s=[0,0];if(o){if(typeof o[0]=="string"){const l=parseFloat(o[0])/100,h=e.AABBBounds;s[0]=h.x1+(h.x2-h.x1)*l}else s[0]=o[0];if(typeof o[1]=="string"){const l=parseFloat(o[1])/100,h=e.AABBBounds;s[1]=h.x1+(h.x2-h.x1)*l}else s[1]=o[1]}if(e.type==="text"){const{textAlign:l}=e.attribute;s[0]+=textDrawOffsetX(l,e.clipedWidth)}s[0]+=n,s[1]+=t;const a=mat4Allocate.allocate();return zr(a,a,[s[0],s[1],0]),r&&uv(a,a,r),i&&dv(a,a,i),zr(a,a,[-s[0],-s[1],0]),a}function cv(n,t,e){var i;const{x:r=e.x,y:o=e.y,z:s=e.z,dx:a=e.dx,dy:l=e.dy,dz:h=e.dz,scaleX:u=e.scaleX,scaleY:d=e.scaleY,scaleZ:c=e.scaleZ,alpha:g=e.alpha,beta:f=e.beta,angle:p=e.angle,anchor3d:v=t.attribute.anchor,anchor:m}=t.attribute,C=[0,0,0];if(v){if(typeof v[0]=="string"){const b=parseFloat(v[0])/100,_=t.AABBBounds;C[0]=_.x1+(_.x2-_.x1)*b}else C[0]=v[0];if(typeof v[1]=="string"){const b=parseFloat(v[1])/100,_=t.AABBBounds;C[1]=_.x1+(_.x2-_.x1)*b}else C[1]=v[1];C[2]=(i=v[2])!==null&&i!==void 0?i:0}if(IS(n),zr(n,n,[r+a,o+l,s+h]),zr(n,n,[C[0],C[1],C[2]]),uv(n,n,f),dv(n,n,g),zr(n,n,[-C[0],-C[1],C[2]]),zS(n,n,[u,d,c]),p){const b=ie.allocate(),_=[0,0];if(m){if(typeof v[0]=="string"){const y=parseFloat(v[0])/100,w=t.AABBBounds;_[0]=w.x1+(w.x2-w.x1)*y}else _[0]=v[0];if(typeof v[1]=="string"){const y=parseFloat(v[1])/100,w=t.AABBBounds;_[1]=w.x1+(w.x2-w.x1)*y}else _[1]=v[1]}zr(b,b,[_[0],_[1],0]),OS(b,b,p),zr(b,b,[-_[0],-_[1],0]),Hs(n,n,b)}}function WS(n){const{alpha:t,beta:e}=n.attribute;return t||e}let mc=class{constructor(n){this.creator=n,this.hooks={onAttributeUpdate:new Hi(["graphic"]),onSetStage:new Hi(["graphic","stage"]),onRemove:new Hi(["graphic"]),onRelease:new Hi(["graphic"]),onAddIncremental:new Hi(["graphic","group","stage"]),onClearIncremental:new Hi(["graphic","group","stage"]),beforeUpdateAABBBounds:new Hi(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new Hi(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"])},this.tempAABBBounds1=new me,this.tempAABBBounds2=new me,this._rectBoundsContribitions=[new Ps],this._symbolBoundsContribitions=[new PS],this._circleBoundsContribitions=[new Ps],this._arcBoundsContribitions=[new Ps],this._pathBoundsContribitions=[new Ps]}onAttributeUpdate(n){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(n)}onSetStage(n,t){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(n,t)}onRemove(n){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(n)}onRelease(n){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(n)}onAddIncremental(n,t,e){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(n,t,e)}onClearIncremental(n,t){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(n,t)}beforeUpdateAABBBounds(n,t,e,i){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(n,t,e,i)}afterUpdateAABBBounds(n,t,e,i,r){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(n,t,e,i,r)}updatePathProxyAABBBounds(n,t){const e=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;if(!e)return!1;const i=new U0(n);return Yn(e.commandList,i,0,0),!0}updateRectAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i))return e;if(!this.updatePathProxyAABBBounds(e,i)){let{width:s,height:a}=n;const{x1:l,y1:h,x:u,y:d}=n;s=s!=null?s:l-u,a=a!=null?a:h-d,e.set(0,0,s||0,a||0)}const r=this.tempAABBBounds1,o=this.tempAABBBounds2;return r.setValue(e.x1,e.y1,e.x2,e.y2),o.setValue(e.x1,e.y1,e.x2,e.y2),this._rectBoundsContribitions.length&&this._rectBoundsContribitions.forEach(s=>{s.updateBounds(n,t,r,i),e.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2)}),this.transformAABBBounds(n,e,t,!1,i),e}updateGroupAABBBounds(n,t,e,i){const{width:r,height:o,path:s,clip:a=t.clip}=n;s&&s.length?s.forEach(u=>{e.union(u.AABBBounds)}):r!=null&&o!=null&&e.set(0,0,r,o),a||i.forEachChildren(u=>{e.union(u.AABBBounds)});const l=this.tempAABBBounds1,h=this.tempAABBBounds2;return l.setValue(e.x1,e.y1,e.x2,e.y2),h.setValue(e.x1,e.y1,e.x2,e.y2),this.transformAABBBounds(n,e,t,!1,i),e}updateGlyphAABBBounds(n,t,e,i){return this._validCheck(n,t,e,i)&&i.getSubGraphic().forEach(r=>{e.union(r.AABBBounds)}),e}updateRichTextAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i)||!i)return e;const{width:r=t.width,height:o=t.height,maxWidth:s=t.maxWidth,maxHeight:a=t.maxHeight,textAlign:l=t.textAlign,textBaseline:h=t.textBaseline}=n;if(r>0&&o>0)e.set(0,0,r,o);else{const f=i.getFrameCache(),{width:p,height:v}=f.getActualSize();let m=r||p||0,C=o||v||0;C=typeof a=="number"&&C>a?a:C||0,m=typeof s=="number"&&m>s?s:m||0,e.set(0,0,m,C)}let u=0;switch(h){case"top":u=0;break;case"middle":u=-e.height()/2;break;case"bottom":u=-e.height()}let d=0;switch(l){case"left":d=0;break;case"center":d=-e.width()/2;break;case"right":d=-e.width()}e.translate(d,u);const c=this.tempAABBBounds1,g=this.tempAABBBounds2;return c.setValue(e.x1,e.y1,e.x2,e.y2),g.setValue(e.x1,e.y1,e.x2,e.y2),this.transformAABBBounds(n,e,t,!1,i),e}updateTextAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i)||!i)return e;const{text:r=t.text}=i.attribute;Array.isArray(r)?i.updateMultilineAABBBounds(r):i.updateSingallineAABBBounds(r);const o=this.tempAABBBounds1,s=this.tempAABBBounds2;o.setValue(e.x1,e.y1,e.x2,e.y2),s.setValue(e.x1,e.y1,e.x2,e.y2);const{scaleX:a=t.scaleX,scaleY:l=t.scaleY,shadowBlur:h=t.shadowBlur,strokeBoundsBuffer:u=t.strokeBoundsBuffer}=n;if(h){const d=h/Math.abs(a+l);ml(o,d,!0,u),e.union(o)}return this.combindShadowAABBBounds(e,i),Bd(e,e,i.transMatrix),e}updatePathAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i))return e;this.updatePathProxyAABBBounds(e,i)||this.updatePathAABBBoundsImprecise(n,t,e,i);const r=this.tempAABBBounds1,o=this.tempAABBBounds2;r.setValue(e.x1,e.y1,e.x2,e.y2),o.setValue(e.x1,e.y1,e.x2,e.y2),this._pathBoundsContribitions.length&&this._pathBoundsContribitions.forEach(a=>{a.updateBounds(n,t,r,i),e.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2)});const{lineJoin:s=t.lineJoin}=n;return this.transformAABBBounds(n,e,t,s==="miter",i),e}updatePathAABBBoundsImprecise(n,t,e,i){if(!i)return e;const r=i.getParsedPathShape();return e.union(r.getBounds()),e}updatePyramid3dAABBBounds(n,t,e,i){if(!i)return e;const r=i.stage;if(!r||!r.camera)return e;i.findFace().vertices.forEach(a=>{const l=a[0],h=a[1];e.add(l,h)});const o=this.tempAABBBounds1,s=this.tempAABBBounds2;return o.setValue(e.x1,e.y1,e.x2,e.y2),s.setValue(e.x1,e.y1,e.x2,e.y2),this.transformAABBBounds(n,e,t,!1,i),e}updateArc3dAABBBounds(n,t,e,i){if(!i)return e;const r=i.stage;if(!r||!r.camera)return e;const{outerRadius:o=t.outerRadius,height:s=0}=n,a=o+s;e.setValue(-a,-a,a,a);const l=this.tempAABBBounds1,h=this.tempAABBBounds2;return l.setValue(e.x1,e.y1,e.x2,e.y2),h.setValue(e.x1,e.y1,e.x2,e.y2),this.transformAABBBounds(n,e,t,!1,i),e}updatePolygonAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i))return e;this.updatePathProxyAABBBounds(e,i)||this.updatePolygonAABBBoundsImprecise(n,t,e,i);const r=this.tempAABBBounds1,o=this.tempAABBBounds2;r.setValue(e.x1,e.y1,e.x2,e.y2),o.setValue(e.x1,e.y1,e.x2,e.y2);const{lineJoin:s=t.lineJoin}=n;return this.transformAABBBounds(n,e,t,s==="miter",i),e}updatePolygonAABBBoundsImprecise(n,t,e,i){const{points:r=t.points}=n;return r.forEach(o=>{e.add(o.x,o.y)}),e}updateLineAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i))return e;this.updatePathProxyAABBBounds(e,i)||(n.segments?this.updateLineAABBBoundsBySegments(n,t,e,i):this.updateLineAABBBoundsByPoints(n,t,e,i));const r=this.tempAABBBounds1,o=this.tempAABBBounds2;r.setValue(e.x1,e.y1,e.x2,e.y2),o.setValue(e.x1,e.y1,e.x2,e.y2);const{lineJoin:s=t.lineJoin}=n;return this.transformAABBBounds(n,e,t,s==="miter",i),e}updateLineAABBBoundsByPoints(n,t,e,i){const{points:r=t.points}=n,o=e;return r.forEach(s=>{o.add(s.x,s.y)}),o}updateLineAABBBoundsBySegments(n,t,e,i){const{segments:r=t.segments}=n,o=e;return r.forEach(s=>{s.points.forEach(a=>{o.add(a.x,a.y)})}),o}updateAreaAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i))return e;this.updatePathProxyAABBBounds(e,i)||(n.segments?this.updateAreaAABBBoundsBySegments(n,t,e,i):this.updateAreaAABBBoundsByPoints(n,t,e,i));const r=this.tempAABBBounds1,o=this.tempAABBBounds2;r.setValue(e.x1,e.y1,e.x2,e.y2),o.setValue(e.x1,e.y1,e.x2,e.y2);const{lineJoin:s=t.lineJoin}=n;return this.transformAABBBounds(n,e,t,s==="miter",i),e}updateAreaAABBBoundsByPoints(n,t,e,i){const{points:r=t.points}=n,o=e;return r.forEach(s=>{var a,l;o.add(s.x,s.y),o.add((a=s.x1)!==null&&a!==void 0?a:s.x,(l=s.y1)!==null&&l!==void 0?l:s.y)}),o}updateAreaAABBBoundsBySegments(n,t,e,i){const{segments:r=t.segments}=n,o=e;return r.forEach(s=>{s.points.forEach(a=>{var l,h;o.add(a.x,a.y),o.add((l=a.x1)!==null&&l!==void 0?l:a.x,(h=a.y1)!==null&&h!==void 0?h:a.y)})}),o}updateCircleAABBBounds(n,t,e,i,r){if(!this._validCheck(n,t,e,r))return e;this.updatePathProxyAABBBounds(e,r)||(i?this.updateCircleAABBBoundsImprecise(n,t,e,r):this.updateCircleAABBBoundsAccurate(n,t,e,r));const o=this.tempAABBBounds1,s=this.tempAABBBounds2;return o.setValue(e.x1,e.y1,e.x2,e.y2),s.setValue(e.x1,e.y1,e.x2,e.y2),this._circleBoundsContribitions.length&&this._circleBoundsContribitions.forEach(a=>{a.updateBounds(n,t,o,r),e.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2)}),this.transformAABBBounds(n,e,t,!1,r),e}updateCircleAABBBoundsImprecise(n,t,e,i){const{radius:r=t.radius}=n;return e.set(-r,-r,r,r),e}updateCircleAABBBoundsAccurate(n,t,e,i){const{startAngle:r=t.startAngle,endAngle:o=t.endAngle,radius:s=t.radius}=n;return o-r>Rt-Lt?e.set(-s,-s,s,s):tc(r,o,s,e),e}updateArcAABBBounds(n,t,e,i,r){if(!this._validCheck(n,t,e,r))return e;this.updatePathProxyAABBBounds(e,r)||(i?this.updateArcAABBBoundsImprecise(n,t,e,r):this.updateArcAABBBoundsAccurate(n,t,e,r));const o=this.tempAABBBounds1,s=this.tempAABBBounds2;o.setValue(e.x1,e.y1,e.x2,e.y2),s.setValue(e.x1,e.y1,e.x2,e.y2),this._arcBoundsContribitions.length&&this._arcBoundsContribitions.forEach(l=>{l.updateBounds(n,t,o,r),e.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2)});const{lineJoin:a=t.lineJoin}=n;return this.transformAABBBounds(n,e,t,a==="miter",r),e}updateArcAABBBoundsImprecise(n,t,e,i){let{outerRadius:r=t.outerRadius,innerRadius:o=t.innerRadius}=n;const{outerPadding:s=t.outerPadding,innerPadding:a=t.innerPadding}=n;return r+=s,o-=a,r<o&&(r=o),e.set(-r,-r,r,r),e}updateArcAABBBoundsAccurate(n,t,e,i){let{outerRadius:r=t.outerRadius,innerRadius:o=t.innerRadius}=n;const{outerPadding:s=t.outerPadding,innerPadding:a=t.innerPadding}=n;if(r+=s,o-=a,r<o){const u=r;r=o,o=u}let{endAngle:l=t.endAngle,startAngle:h=t.startAngle}=n;if(h>l){const u=h;h=l,l=u}return r<=Lt?e.set(0,0,0,0):Math.abs(l-h)>Rt-Lt?e.set(-r,-r,r,r):(tc(h,l,r,e),tc(h,l,o,e)),e}updateSymbolAABBBounds(n,t,e,i,r){if(!this._validCheck(n,t,e,r))return e;this.updatePathProxyAABBBounds(e,r)||(i?this.updateSymbolAABBBoundsImprecise(n,t,e,r):this.updateSymbolAABBBoundsAccurate(n,t,e,r));const o=this.tempAABBBounds1,s=this.tempAABBBounds2;o.setValue(e.x1,e.y1,e.x2,e.y2),s.setValue(e.x1,e.y1,e.x2,e.y2),this._symbolBoundsContribitions.length&&this._symbolBoundsContribitions.forEach(l=>{l.updateBounds(n,t,o,r),e.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2)});const{lineJoin:a=t.lineJoin}=n;return this.transformAABBBounds(n,e,t,a==="miter",r),e}updateSymbolAABBBoundsImprecise(n,t,e,i){const{size:r=t.size}=n;if(rt(r))e.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{const o=r/2;e.set(-o,-o,o,o)}return e}updateSymbolAABBBoundsAccurate(n,t,e,i){if(!i)return e;const{size:r=t.size}=n;return i.getParsedPath().bounds(r,e),e}updateImageAABBBounds(n,t,e,i){if(!this._validCheck(n,t,e,i))return e;if(!this.updatePathProxyAABBBounds(e,i)){const{width:s=t.width,height:a=t.height}=n;e.set(0,0,s,a)}const r=this.tempAABBBounds1,o=this.tempAABBBounds2;return r.setValue(e.x1,e.y1,e.x2,e.y2),o.setValue(e.x1,e.y1,e.x2,e.y2),this.transformAABBBounds(n,e,t,!1,i),e}combindShadowAABBBounds(n,t){if(t&&t.shadowRoot){const e=t.shadowRoot.AABBBounds;n.union(e)}}transformAABBBounds(n,t,e,i,r){if(!t.empty()){const{scaleX:a=e.scaleX,scaleY:l=e.scaleY,stroke:h=e.stroke,shadowBlur:u=e.shadowBlur,lineWidth:d=e.lineWidth,pickStrokeBuffer:c=e.pickStrokeBuffer,strokeBoundsBuffer:g=e.strokeBoundsBuffer}=n,f=this.tempAABBBounds1,p=this.tempAABBBounds2;if(h&&d){const v=(d+c)/Math.abs(a+l);ml(f,v,i,g),t.union(f),f.setValue(p.x1,p.y1,p.x2,p.y2)}if(u){const{shadowOffsetX:v=e.shadowOffsetX,shadowOffsetY:m=e.shadowOffsetY}=n,C=u/Math.abs(a+l)*2;ml(f,C,!1,g+1),f.translate(v,m),t.union(f)}}if(this.combindShadowAABBBounds(t,r),t.empty())return;let o=!0;const s=r.transMatrix;r&&r.isContainer&&(o=!(s.a===1&&s.b===0&&s.c===0&&s.d===1&&s.e===0&&s.f===0)),o&&Bd(t,t,s)}_validCheck(n,t,e,i){if(!i)return!0;if(!i.valid)return e.clear(),!1;const{visible:r=t.visible}=n;return!!r||(e.clear(),!1)}};mc=HS([Z(),kS(0,At(qp)),LS("design:paramtypes",[Object])],mc);class NS{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}}const ct=new NS;var jS=new ht(n=>{n(Xp).to(mc).inSingletonScope(),n(qp).toConstantValue(ct)});const Ls=Symbol.for("AutoEnablePlugins"),gv=Symbol.for("PluginService");var VS=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},fv=function(n,t){return function(e,i){t(e,i,n)}};let Cc=class{constructor(n){this.autoEnablePlugins=n,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(n,t){this.stage=n,this.actived=!0;const{pluginList:e}=t;e&&pt.isBound(Ls)&&this.autoEnablePlugins.getContributions().forEach(i=>{e.includes(i.name)&&this.register(i)})}findPluginsByName(n){const t=[];return this.onStartupFinishedPlugin.forEach(e=>{e.name===n&&t.push(e)}),this.onRegisterPlugin.forEach(e=>{e.name===n&&t.push(e)}),t}register(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(n):n.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(n),n.activate(this))}unRegister(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1):n.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1),n.deactivate(this)}release(...n){this.onStartupFinishedPlugin.forEach(t=>{t.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(t=>{t.deactivate(this)}),this.onRegisterPlugin=[]}};Cc=VS([Z(),fv(0,At(Le)),fv(0,Ne(Ls)),GS("design:paramtypes",[Object])],Cc);var US=new ht(n=>{n(gv).to(Cc),yw(n,Ls)}),KS=new ht(n=>{Qe(n,Ja)}),YS=new ht(n=>{n($n).to(fo).inSingletonScope(),Qe(n,$n)}),$S=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},XS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Wl=class{constructor(){this.type="static",this.offscreen=!1,this.global=$.global}setDpr(n){this.canvas.dpr=n}init(n,t,e){if(this.layer=n,this.window=t,e.main)this.main=!0,this.context=t.getContext(),this.canvas=this.context.getCanvas();else{let i;this.main=!1,e.canvasId&&(i=this.global.getElementById(e.canvasId)),i||(i=this.global.createCanvas({width:t.width,height:t.height})),i.style&&(i.style["pointer-events"]="none");const r=t.getContext().getCanvas().nativeCanvas,o=al({nativeCanvas:i,width:t.width,height:t.height,dpr:t.dpr,id:e.canvasId,canvasControled:!0,container:t.getContainer(),x:r.offsetLeft,y:r.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(n,t){this.canvas.resize(n,t)}resizeView(n,t){}render(n,t,e){var i;if(!this.main){const r=this.window.getContext().getCanvas().nativeCanvas;!r||this.canvas.x===r.offsetLeft&&this.canvas.y===r.offsetTop||(this.canvas.x=r.offsetLeft,this.canvas.y=r.offsetTop,this.canvas.applyPosition())}t.renderService.render(n,Object.assign(Object.assign({context:this.context,clear:(i=t.background)!==null&&i!==void 0?i:"#ffffff"},t),e))}merge(n){n.forEach(t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)})}prepare(n,t){}drawTo(n,t,e){var i;const r=n.getContext();e.renderService.render(t,Object.assign(Object.assign({context:r},e),{clear:e.clear?(i=e.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};Wl=$S([Z(),XS("design:paramtypes",[])],Wl);var qS=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ZS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Nl=class{constructor(){this.offscreen=!1,this.type="virtual",this.global=$.global}setDpr(n){}init(n,t,e){if(this.layer=n,this.window=t,e.main)throw new Error("virtual layer\u4E0D\u80FD\u4F5C\u4E3Amain layer");this.main=!1,this.canvas=null,this.context=null}resize(n,t){}resizeView(n,t){}render(n,t,e){this.mainHandler.render(n,t,Object.assign(Object.assign({},e),{clear:!1}))}merge(n){}prepare(n,t){}drawTo(n,t,e){var i;const r=n.getContext();e.renderService.render(t,Object.assign(Object.assign({context:r},e),{clear:e.clear?(i=e.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return null}release(){}};Nl=qS([Z(),ZS("design:paramtypes",[])],Nl);var JS=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},QS=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let jl=class{constructor(){this.offscreen=!0,this.type="dynamic",this.global=$.global}setDpr(n){this.canvas.dpr=n}init(n,t,e){this.layer=n;const i=this.global.createOffscreenCanvas({width:e.width,height:e.height,dpr:t.dpr}),r=al({nativeCanvas:i,width:e.width,height:e.height,dpr:t.dpr,canvasControled:!0});this.canvas=r,this.context=r.getContext()}resize(n,t){this.canvas.resize(n,t)}resizeView(n,t){this.canvas.resize(n,t)}render(n,t){var e;t.renderService.render(n,Object.assign(Object.assign({context:this.context},t),{x:0,y:0,clear:(e=t.background)!==null&&e!==void 0?e:"#ffffff"}))}prepare(n,t){}release(){this.canvas.release()}getContext(){return this.context}drawTo(n,t,e){const i=n.getContext(),r=n.dpr,{x:o=0,y:s=0,width:a=this.layer.viewWidth,height:l=this.layer.viewHeight}=e;i.nativeContext.save(),i.nativeContext.setTransform(r,0,0,r,0,0),e.clear&&i.clearRect(o,s,a,l),i.drawImage(this.canvas.nativeCanvas,0,0,this.canvas.width,this.canvas.height,o,s,a,l),i.nativeContext.restore()}merge(n){}};jl=JS([Z(),QS("design:paramtypes",[])],jl);var tA=new ht(n=>{n(Wl).toSelf(),n(jl).toSelf(),n(Nl).toSelf(),n(ev).toService(Wl),n(iv).toService(jl),n(nv).toService(Nl)});function eA(n){n.load(KS),n.load(YS),n.load(tA)}const pv=O0(Zt);var iA=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};function vv(n,t,e,i=!1,r=!1){const o={},s=[];let a=!1;if(r)a=!0;else{let l;n.forEachChildren((h,u)=>{const{zIndex:d=t}=h.attribute;if(u===0)l=d;else if(l!==d)return a=!0,!0;return!1},i)}if(a){n.forEachChildren(h=>{const{zIndex:u=t}=h.attribute;o[u]?o[u].push(h):(o[u]=[h],s.push(u))},i),s.sort((h,u)=>i?u-h:h-u);let l=!1;for(let h=0;h<s.length&&!l;h++){const u=s[h],d=o[u];r&&d.sort((c,g)=>{var f,p;return(i?-1:1)*(((f=g.attribute.z)!==null&&f!==void 0?f:0)-((p=c.attribute.z)!==null&&p!==void 0?p:0))});for(let c=0;c<d.length;c++)if(e(d[c],c)){l=!0;break}}}else n.forEachChildren(e,i)}function mv(n,t,e,i=!1){return iA(this,void 0,void 0,function*(){yield n.forEachChildrenAsync(e,i)})}function nA(n,t,e,i=!1){const r={},o=[];let s=!1;n.forEachChildren((h,u)=>{const{zIndex:d=e}=h.attribute;if(u!==0){if(d!==void 0)return s=!0,!0}return!1},i);let a=null,l=!1;if(s){n.forEachChildren(u=>{const{zIndex:d=e}=u.attribute;r[d]?r[d].push(u):(r[d]=[u],o.push(d))},i),o.sort((u,d)=>i?d-u:u-d);let h=!1;for(let u=0;u<o.length&&!h;u++){const d=o[u],c=r[d];for(let g=0;g<c.length;g++){if(l){h=!0,a=c[g];break}c[g]._uid!==t||(l=!0)}}}else n.forEachChildren(h=>l?(a=h,!0):(h._uid===t&&(l=!0),!1),i);return a}function bc(n,t,e){n[0]=t[0]-e[0],n[1]=t[1]-e[1]}let Be,Fe,Te,Me,ii,ni,ri,oi;function rA(n,t,e,i){let r,o=n[0],s=t[0],a=e[0],l=i[0];return s<o&&(r=s,s=o,o=r),l<a&&(r=l,l=a,a=r),!(s<a||l<o)&&(o=n[1],s=t[1],a=e[1],l=i[1],s<o&&(r=s,s=o,o=r),l<a&&(r=l,l=a,a=r),!(s<a||l<o))}function lW(n,t,e,i){if(!rA(n,t,e,i))return!1;const r=[0,0],o=[0,0],s=[0,0];if(bc(r,t,n),bc(o,i,e),fuzzyEqualVec(r,o))return!0;bc(s,e,n);const a=crossProduct(s,o)/crossProduct(r,o);return a>=0&&a<=1&&[n[0]+r[0]*a,n[1]+r[1]*a]}function Cv(n,t,e){return n===null?t:t===null?n:(Be=n.x1,Fe=n.x2,Te=n.y1,Me=n.y2,ii=t.x1,ni=t.x2,ri=t.y1,oi=t.y2,e&&(Be>Fe&&([Be,Fe]=[Fe,Be]),Te>Me&&([Te,Me]=[Me,Te]),ii>ni&&([ii,ni]=[ni,ii]),ri>oi&&([ri,oi]=[oi,ri])),Be>=ni||Fe<=ii||Te>=oi||Me<=ri?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(Be,ii),y1:Math.max(Te,ri),x2:Math.min(Fe,ni),y2:Math.min(Me,oi)})}var Do;(function(n){n[n.NONE=0]="NONE",n[n.BBOX1=1]="BBOX1",n[n.BBOX2=2]="BBOX2"})(Do||(Do={}));function oA(n,t,e){return n&&t?(Be=n.x1,Fe=n.x2,Te=n.y1,Me=n.y2,ii=t.x1,ni=t.x2,ri=t.y1,oi=t.y2,e&&(Be>Fe&&([Be,Fe]=[Fe,Be]),Te>Me&&([Te,Me]=[Me,Te]),ii>ni&&([ii,ni]=[ni,ii]),ri>oi&&([ri,oi]=[oi,ri])),Be>ii&&Fe<ni&&Te>ri&&Me<oi?Do.BBOX1:ii>Be&&ni<Fe&&ri>Te&&oi<Me?Do.BBOX2:Do.NONE):Do.NONE}function _c(n,t,e){return!n||!t||(e?(Be=n.x1,Fe=n.x2,Te=n.y1,Me=n.y2,ii=t.x1,ni=t.x2,ri=t.y1,oi=t.y2,Be>Fe&&([Be,Fe]=[Fe,Be]),Te>Me&&([Te,Me]=[Me,Te]),ii>ni&&([ii,ni]=[ni,ii]),ri>oi&&([ri,oi]=[oi,ri]),!(Be>ni||Fe<ii||Te>oi||Me<ri)):!(n.x1>t.x2||n.x2<t.x1||n.y1>t.y2||n.y2<t.y1))}function hW(n,t,e){return!t||(e?(Be=t.x1,Fe=t.x2,Te=t.y1,Me=t.y2,Be>Fe&&([Be,Fe]=[Fe,Be]),Te>Me&&([Te,Me]=[Me,Te]),n.x>=Be&&n.x<=Fe&&n.y>=Te&&n.y<=Me):n.x>=t.x1&&n.x<=t.x2&&n.y>=t.y1&&n.y<=t.y2)}function yc(n,t){return Math.abs(t[0]*n[0]+t[1]*n[1])}function Vl({x:n,y:t},e,i={x:0,y:0}){return{x:(n-i.x)*Math.cos(e)+(t-i.y)*Math.sin(e)+i.x,y:(n-i.x)*Math.sin(e)+(i.y-t)*Math.cos(e)+i.y}}function ks(n){return n/180*Math.PI}function wc(n){return{x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2}}function bv(n,t){const e=t?n.angle:ks(n.angle),i=wc(n);return[Vl({x:n.x1,y:n.y1},e,i),Vl({x:n.x2,y:n.y1},e,i),Vl({x:n.x2,y:n.y2},e,i),Vl({x:n.x1,y:n.y2},e,i)]}function sA(n,t,e=!1,i){const r=bv(n,e),o=bv(t,e),s=(b,_)=>[_.x-b.x,_.y-b.y];i&&(i.save(),i.fillStyle="red",i.globalAlpha=.6,r.forEach((b,_)=>{_===0?i.moveTo(b.x,b.y):i.lineTo(b.x,b.y)}),i.fill(),i.restore(),i.save(),i.fillStyle="green",i.globalAlpha=.6,o.forEach((b,_)=>{_===0?i.moveTo(b.x,b.y):i.lineTo(b.x,b.y)}),i.fill(),i.restore());const a=wc(n),l=wc(t);i&&i.fillRect(a.x,a.y,2,2),i&&i.fillRect(l.x,l.y,2,2);const h=s(a,l),u=s(r[0],r[1]),d=s(r[1],r[2]),c=s(o[0],o[1]),g=s(o[1],o[2]),f=e?n.angle:ks(n.angle);let p=e?n.angle+Zi:ks(90-n.angle);const v=e?t.angle:ks(t.angle);let m=e?t.angle+Zi:ks(90-t.angle);p>Rt&&(p-=Rt),m>Rt&&(m-=Rt);const C=(b,_,y,w)=>{const S=[Math.cos(_),Math.sin(_)];return b+(yc(S,y)+yc(S,w))/2>yc(S,h)};return C((n.x2-n.x1)/2,f,c,g)&&C((n.y2-n.y1)/2,p,c,g)&&C((t.x2-t.x1)/2,v,u,d)&&C((t.y2-t.y1)/2,m,u,d)}var aA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},lA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const Is=Symbol.for("DrawItemInterceptor"),_v=new me;class hA{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx)&&this.drawItem(t,e,i,r,o),!1}beforeDrawItem(t,e,i,r,o){return t.attribute.shadowRootIdx<0&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.shadowRoot)return!1;const{context:s}=i;if(s.highPerformanceSave(),s.transformFromMatrix(t.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){_v.copy(r.dirtyBounds);const a=t.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(a)}return r.renderGroup(t.shadowRoot,i,t.parent.globalTransMatrix),s.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&r.dirtyBounds.copy(_v),!0}}class uA{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.attribute._debug_bounds&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.attribute._debug_bounds)return!1;const{context:s}=i;s.highPerformanceSave(),t.parent&&s.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&s.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const a=t.AABBBounds;return t.attribute._debug_bounds!==!0&&t.attribute._debug_bounds(s,t),s.strokeRect(a.x1,a.y1,a.width(),a.height()),s.highPerformanceRestore(),!0}}let Gl=class{constructor(){this.order=1,this.interceptors=[new hA,new cA,new dA,new uA]}afterDrawItem(n,t,e,i,r){for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(n,t,e,i,r))return!0;return!1}beforeDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(n,t,e,i,r))return!0;return!1}};Gl=aA([Z(),lA("design:paramtypes",[])],Gl);class dA{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,r,o):this.beforeSetInteractive(t,e,i,r,o))}beforeSetInteractive(t,e,i,r,o){let s=t.interactiveGraphic;if(t.attribute.globalZIndex){s||(s=t.clone(),t.interactiveGraphic=s,s.baseGraphic=t),s.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");return a&&this.getShadowRoot(a).add(s),!0}if(s){i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");a&&this.getShadowRoot(a).removeChild(s),t.interactiveGraphic=null,s.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,r,o){const s=t.baseGraphic;if(s){this.processing=!0;const{context:a}=i;return a.highPerformanceSave(),a.setTransformFromMatrix(s.parent.globalTransMatrix,!0),s.isContainer?r.renderGroup(s,i,s.parent.globalTransMatrix):r.renderItem(s,i),a.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=ct.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),(e=i.shadowRoot)!==null&&e!==void 0?e:i.attachShadow()}}class cA{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:s,stage:a}=e.drawParams;s.canvas,s.save(),this.initCanvasCtx(s),s.camera=a.camera;const l=s.currentMatrix;l.a/=s.dpr,l.b/=s.dpr,l.c/=s.dpr,l.d/=s.dpr,l.e/=s.dpr,l.f/=s.dpr;const h=ie.allocate();vc(h,l);const u=s.modelMatrix;if(u){if(h){const d=ie.allocate();s.modelMatrix=Hs(d,u,h)}}else s.modelMatrix=h;if(s.setTransform(1,0,0,1,0,0,!0),t.isContainer){let d=!1,c=!1;if(t.forEachChildren(g=>(d=g.numberType===Fs,!d)),t.forEachChildren(g=>(c=!!g.findFace,!c)),d){const g=t.getChildren(),f=[...g];f.sort((v,m)=>{var C,b,_,y;let w=(((C=v.attribute.startAngle)!==null&&C!==void 0?C:0)+((b=v.attribute.endAngle)!==null&&b!==void 0?b:0))/2,S=(((_=m.attribute.startAngle)!==null&&_!==void 0?_:0)+((y=m.attribute.endAngle)!==null&&y!==void 0?y:0))/2;for(;w<0;)w+=Rt;for(;S<0;)S+=Rt;return S-w}),f.forEach(v=>{v._next=null,v._prev=null}),t.removeAllChild(),t.update(),f.forEach(v=>{t.appendChild(v)});const p=t.parent.globalTransMatrix;i.hack_pieFace="outside",r.renderGroup(t,i,p),i.hack_pieFace="inside",r.renderGroup(t,i,p),i.hack_pieFace="top",r.renderGroup(t,i,p),t.removeAllChild(),g.forEach(v=>{v._next=null,v._prev=null}),g.forEach(v=>{t.appendChild(v)})}else if(c){const g=t.getChildren(),f=g.map(p=>({ave_z:p.findFace().vertices.map(v=>{var m;return s.view(v[0],v[1],(m=v[2]+p.attribute.z)!==null&&m!==void 0?m:0)[2]}).reduce((v,m)=>v+m,0),g:p}));f.sort((p,v)=>v.ave_z-p.ave_z),t.removeAllChild(),f.forEach(p=>{p.g._next=null,p.g._prev=null}),t.update(),f.forEach(p=>{t.add(p.g)}),r.renderGroup(t,i,t.parent.globalTransMatrix,!0),t.removeAllChild(),g.forEach(p=>{p._next=null,p._prev=null}),t.update(),g.forEach(p=>{t.add(p)})}else r.renderGroup(t,i,t.parent.globalTransMatrix)}else r.renderItem(t,i);return s.camera=null,s.restore(),s.modelMatrix!==u&&ie.free(s.modelMatrix),s.modelMatrix=u,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}const gA=function(){const n={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let t="";function e(_){const y=new Error(t+": "+_);throw y.source=t,y}function i(){const _=g(r);return t.length>0&&e("Invalid input not EOF"),_}function r(){return o("linear",n.linearGradient,s)||o("radial",n.radialGradient,l)||o("conic",n.conicGradient,a)}function o(_,y,w){return function(S,D){const A=C(S);if(A){C(n.startCall)||e("Missing (");const x=D(A);return C(n.endCall)||e("Missing )"),x}}(y,function(S){const D=w();return D&&(C(n.comma)||e("Missing comma before color stops")),{type:_,orientation:D,colorStops:g(f)}})}function s(){return m("directional",n.sideOrCorner,1)||m("angular",n.angleValue,1)}function a(){return m("angular",n.fromAngleValue,1)}function l(){let _,y,w=h();return w&&(_=[],_.push(w),y=t,C(n.comma)&&(w=h(),w?_.push(w):t=y)),_}function h(){let _=function(){const y=m("shape",/^(circle)/i,0);return y&&(y.style=v()||u()),y}()||function(){const y=m("shape",/^(ellipse)/i,0);return y&&(y.style=p()||u()),y}();if(_)_.at=d();else{const y=u();if(y){_=y;const w=d();w&&(_.at=w)}else{const w=c();w&&(_={type:"default-radial",at:w})}}return _}function u(){return m("extent-keyword",n.extentKeywords,1)}function d(){if(m("position",/^at/,0)){const _=c();return _||e("Missing positioning value"),_}}function c(){const _={x:p(),y:p()};if(_.x||_.y)return{type:"position",value:_}}function g(_){let y=_();const w=[];if(y)for(w.push(y);C(n.comma);)y=_(),y?w.push(y):e("One extra comma");return w}function f(){const _=m("hex",n.hexColor,1)||m("rgba",n.rgbaColor,1)||m("rgb",n.rgbColor,1)||m("literal",n.literalColor,0);return _||e("Expected color definition"),_.length=p(),_}function p(){return m("%",n.percentageValue,1)||m("position-keyword",n.positionKeywords,1)||v()}function v(){return m("px",n.pixelValue,1)||m("em",n.emValue,1)}function m(_,y,w){const S=C(y);if(S)return{type:_,value:S[w]}}function C(_){const y=/^[\n\r\t\s]+/.exec(t);y&&b(y[0].length);const w=_.exec(t);return w&&b(w[0].length),w}function b(_){t=t.substr(_)}return function(_){return t=_.toString(),i()}}();class So{static IsGradient(t){return!(typeof t=="string"&&!t.includes("gradient"))}static IsGradientStr(t){return typeof t=="string"&&t.includes("gradient")}static Parse(t){if(So.IsGradientStr(t))try{const e=gA(t)[0];if(e){if(e.type==="linear")return So.ParseLinear(e);if(e.type==="radial")return So.ParseRadial(e);if(e.type==="conic")return So.ParseConic(e)}}catch(e){return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,r=Kt/2,o=parseFloat(e.value)/180*Kt-r;return{gradient:"conical",x:.5,y:.5,startAngle:o,endAngle:o+Rt,stops:i.map(s=>({color:s.value,offset:parseFloat(s.length.value)/100}))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map(i=>({color:i.value,offset:parseFloat(i.length.value)/100}))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,r=Kt/2;let o=e.type==="angular"?parseFloat(e.value)/180*Kt:0;for(;o<0;)o+=Rt;for(;o>Rt;)o-=Rt;let s=0,a=0,l=0,h=0;return o<r?(s=0,a=1,l=Math.sin(o),h=Math.cos(o)):o<Kt?(s=0,a=0,l=Math.cos(o-r),h=Math.sin(o-r)):o<Kt+r?(s=1,a=0,l=s-Math.sin(o-Kt),h=Math.cos(o-Kt)):(s=1,l=s-Math.cos(o-r-Kt),h-=Math.sin(o-r-Kt)),{gradient:"linear",x0:s,y0:a,x1:l,y1:h,stops:i.map(u=>({color:u.value,offset:parseFloat(u.length.value)/100}))}}}function si(n,t,e){let i=t;const{a:r,b:o,c:s,d:a}=n.currentMatrix,l=Math.sign(r)*Math.sqrt(r*r+o*o),h=Math.sign(a)*Math.sqrt(s*s+a*a);return l+h===0?0:(i=i/Math.abs(l+h)*2*e,i)}function Dc(n,t,e,i,r){if(!t||t===!0)return"black";let o,s;if(rt(t))for(let a=0;a<t.length&&(s=t[a],!s);a++);else s=t;return s=So.Parse(s),typeof s=="string"?s:(s.gradient==="linear"?o=fA(n,s,e,i,r):s.gradient==="conical"?o=vA(n,s,e,i,r):s.gradient==="radial"&&(o=pA(n,s,e,i,r)),o||"orange")}function fA(n,t,e,i=0,r=0){var o,s,a,l;const h=e.AABBBounds;if(!h)return;let u=h.x2-h.x1,d=h.y2-h.y1,c=h.x1-i,g=h.y1-r;if(e.attribute){const{scaleX:p=1,scaleY:v=1}=e.attribute;if(p*v==0)return;u/=p,d/=v,c/=p,g/=v}const f=n.createLinearGradient(c+((o=t.x0)!==null&&o!==void 0?o:0)*u,g+((s=t.y0)!==null&&s!==void 0?s:0)*d,c+((a=t.x1)!==null&&a!==void 0?a:1)*u,g+((l=t.y1)!==null&&l!==void 0?l:0)*d);return t.stops.forEach(p=>{f.addColorStop(p.offset,p.color)}),f}function pA(n,t,e,i=0,r=0){var o,s,a,l,h,u;const d=e.AABBBounds;if(!d)return;let c=d.x2-d.x1,g=d.y2-d.y1,f=d.x1-i,p=d.y1-r;if(e.attribute){const{scaleX:m=1,scaleY:C=1}=e.attribute;if(m*C==0)return;f/=m,p/=C,c/=m,g/=C}const v=n.createRadialGradient(f+((o=t.x0)!==null&&o!==void 0?o:.5)*c,p+((s=t.y0)!==null&&s!==void 0?s:.5)*g,Math.max(c,g)*((a=t.r0)!==null&&a!==void 0?a:0),f+((l=t.x1)!==null&&l!==void 0?l:.5)*c,p+((h=t.y1)!==null&&h!==void 0?h:.5)*g,Math.max(c,g)*((u=t.r1)!==null&&u!==void 0?u:.5));return t.stops.forEach(m=>{v.addColorStop(m.offset,m.color)}),v}function vA(n,t,e,i=0,r=0){var o,s;const a=e.AABBBounds;if(!a)return;let l=a.x2-a.x1,h=a.y2-a.y1,u=a.x1-i,d=a.y1-r;if(e.attribute){const{scaleX:g=1,scaleY:f=1}=e.attribute;if(g*f==0)return;l/=g,h/=f,u/=g,d/=f}const c=n.createConicGradient(u+((o=t.x)!==null&&o!==void 0?o:0)*l,d+((s=t.y)!==null&&s!==void 0?s:0)*h,t.startAngle,t.endAngle);return t.stops.forEach(g=>{c.addColorStop(g.offset,g.color)}),c.GetPattern(l+u,h+d,void 0)}const uW=Symbol.for("BoundsAllocate");class mA{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new me)}allocate(t,e,i,r){if(!this.pools.length)return new me().setValue(t,e,i,r);const o=this.pools.pop();return o.x1=t,o.y1=e,o.x2=i,o.y2=r,o}allocateByObj(t){if(!this.pools.length)return new me(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const Ul=new mA;var CA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},bA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Sc=function(n,t){return function(e,i){t(e,i,n)}};let Kl=class{constructor(n,t){this.contributions=n,this.drawItemInterceptorContributions=t,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Ji,this.backupDirtyBounds=new Ji,this.global=$.global,this.layerService=$.layerService,this.init()}init(){this.contributions.forEach(n=>{if(n.style){const t=this.styleRenderMap.get(n.style)||new Map;t.set(n.numberType,n),this.styleRenderMap.set(n.style,t)}else this.defaultRenderMap.set(n.numberType,n)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((n,t)=>n.order-t.order)}prepareForDraw(n,t){t.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!t.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(n,t){this.prepareForDraw(n,t),t.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(t.renderStyle)||this.defaultRenderMap,this.currentRenderService=n;const{context:e,stage:i,x:r=0,y:o=0,width:s,height:a}=t;if(!e)return;if(t.keepMatrix){if(e.nativeContext&&e.nativeContext.getTransform){const d=e.nativeContext.getTransform();e.setTransformFromMatrix(d,!0,1)}}else e.inuse=!0,e.clearMatrix(),e.setTransformForCurrent(!0);const l=this.dirtyBounds.setValue(0,0,s,a);if(i.dirtyBounds&&!i.dirtyBounds.empty()){const d=Cv(l,i.dirtyBounds,!1);l.x1=Math.floor(d.x1),l.y1=Math.floor(d.y1),l.x2=Math.ceil(d.x2),l.y2=Math.ceil(d.y2)}const h=e.dpr%1;(h||h!==.5)&&(l.x1=Math.floor(l.x1*e.dpr)/e.dpr,l.y1=Math.floor(l.y1*e.dpr)/e.dpr,l.x2=Math.ceil(l.x2*e.dpr)/e.dpr,l.y2=Math.ceil(l.y2*e.dpr)/e.dpr),this.backupDirtyBounds.copy(l);const u=l.width()*e.dpr<e.canvas.width||l.height()*e.dpr<e.canvas.height;e.save(),e.translate(r,o,!0),u&&(e.beginPath(),e.rect(l.x1,l.y1,l.width(),l.height()),e.clip()),i.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(n,e,t),e.save(),n.renderTreeRoots.sort((d,c)=>{var g,f;return((g=d.attribute.zIndex)!==null&&g!==void 0?g:fe.zIndex)-((f=c.attribute.zIndex)!==null&&f!==void 0?f:fe.zIndex)}).forEach(d=>{d.isContainer?this.renderGroup(d,t,on.allocate(1,0,0,1,0,0)):this.renderItem(d,t)}),e.restore(),e.restore(),e.draw(),t.keepMatrix||(e.inuse=!1)}doRegister(){throw new Error("\u6682\u4E0D\u652F\u6301")}_findNextGraphic(n){let t=n.parent,e=n._uid;for(;t;){const i=nA(t,e,fe.zIndex);if(i)return i;e=t._uid,t=t.parent}return null}renderGroup(n,t,e,i){if(t.break||n.attribute.visibleAll===!1)return;if(n.incremental&&(t.startAtId==null||t.startAtId===n._uid))return t.break=!0,void this._increaseRender(n,t);if(this.useDirtyBounds&&!_c(n.AABBBounds,this.dirtyBounds,!1))return;let r,o=e;if(this.useDirtyBounds){r=Ul.allocateByObj(this.dirtyBounds);const s=n.transMatrix;o=on.allocateByObj(e).multiply(s.a,s.b,s.c,s.d,s.e,s.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(o.getInverse())}this.renderItem(n,t,{drawingCb:()=>{var s;i?n.forEachChildren(a=>{t.break||(a.isContainer?this.renderGroup(a,t,o):this.renderItem(a,t))}):vv(n,fe.zIndex,a=>{t.break||(a.isContainer?this.renderGroup(a,t,o):this.renderItem(a,t))},!1,!!(!((s=t.context)===null||s===void 0)&&s.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(r),Ul.free(r),on.free(o))}_increaseRender(n,t){const{layer:e,stage:i}=t,{subLayers:r}=e;let o=r.get(n._uid);o||(o={layer:this.layerService.createLayer(i),zIndex:r.size,group:n},r.set(n._uid,o));const s=o.layer.getNativeHandler().getContext(),a=o.drawContribution||pt.get(rv);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:o.layer,context:s,startAtId:n._uid,break:!1})),o.drawContribution=a;const l=this._findNextGraphic(n);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,t);else{let h=r.get(l._uid);h||(h={layer:this.layerService.createLayer(i),zIndex:r.size},r.set(l._uid,h));const u=h.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:h.layer,context:u,startAtId:l._uid,break:!1}))}}getRenderContribution(n){let t;return t||(t=this.selectRenderByNumberType(n.numberType,n)),t||(t=this.selectRenderByType(n.type)),t}renderItem(n,t,e){if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.beforeDrawItem&&l.beforeDrawItem(n,this.currentRenderService,t,this,e))return}const i=this.getRenderContribution(n);if(!i)return;let r,o=!1;if(n.parent){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;if(o=!(!a&&!l),o){r=this.dirtyBounds.clone();const h=n.globalTransMatrix.getInverse();this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(h),this.dirtyBounds.translate(-a,-l)}}if(this.useDirtyBounds&&!n.isContainer&&!_c(n.AABBBounds,this.dirtyBounds,!1))return void(o&&this.dirtyBounds.copy(r));const s=t.startAtId!=null&&n._uid!==t.startAtId;if(n._uid===t.startAtId&&(t.startAtId=null),e&&(e.skipDraw=s),s?n.isContainer&&i.draw(n,this.currentRenderService,t,e):i.draw(n,this.currentRenderService,t,e),o&&this.dirtyBounds.copy(r),this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.afterDrawItem&&l.afterDrawItem(n,this.currentRenderService,t,this))return}}selectRenderByType(n){return te.getInstance().warn("\u672A\u77E5\u9519\u8BEF\uFF0C\u4E0D\u5E94\u8BE5\u8D70\u5230\u8FD9\u91CC"),null}selectRenderByNumberType(n,t){let e;if(t.attribute.renderStyle){const i=this.styleRenderMap.get(t.attribute.renderStyle);e=i&&i.get(n)}return e||this.currentRenderMap.get(n)||this.defaultRenderMap.get(n)}clearScreen(n,t,e){var i,r;const{clear:o}=e;if(o){const s=t.getCanvas(),{width:a=s.width,height:l=s.height}=e,h=0,u=0;t.clearRect(h,u,a,l);const d=(i=n.drawParams)===null||i===void 0?void 0:i.stage;if(d&&(t.globalAlpha=(r=d.attribute.opacity)!==null&&r!==void 0?r:1),d&&d.backgroundImg&&d.resources){const c=d.resources.get(o);c&&c.state==="success"&&c.data&&t.drawImage(c.data,h,u,a,l)}else t.fillStyle=Dc(t,o,{AABBBounds:{x1:h,y1:u,x2:h+a,y2:u+l}},0,0),t.fillRect(h,u,a,l)}}afterDraw(n,t){}};Kl=CA([Z(),Sc(0,pv(We)),Sc(1,At(Le)),Sc(1,Ne(Is)),bA("design:paramtypes",[Array,Object])],Kl);var Ac=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)};function xc(n){return N(n)?rt(n)?n:[n]:[]}function Yl(n){if(Ac(n))return n[n.length-1]}const cW=n=>n.length<=1?0:Yl(n)-n[0],_A=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=t==null?void 0:t(o,i))!==null&&e!==void 0?e:o-i>0)&&(i=o)}return i},yv=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=t==null?void 0:t(o,i))!==null&&e!==void 0?e:o-i<0)&&(i=o)}return i};function Os(n,t){if(!rt(n)||!rt(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function gW(n){return n&&isArray(n)?Array.from(new Set(xc(n))):n}function fW(n,t=Math.random){let e,i,r=n.length;for(;r;)e=Math.floor(t()*r),i=n[--r],n[r]=n[e],n[e]=i;return n}function Bc(n){if(!rt(n))return[n];const t=[];for(const e of n)t.push(...Bc(e));return t}const $l=Kt/2;function Qn(n,t,e,i,r,o){let s;if(i<0&&(t+=i,i=-i),r<0&&(e+=r,r=-r),lt(o,!0))s=[o=kt(o),o,o,o];else if(Array.isArray(o)){const y=o;let w,S;switch(y.length){case 0:s=[0,0,0,0];break;case 1:w=kt(y[0]),s=[w,w,w,w];break;case 2:case 3:w=kt(y[0]),S=kt(y[1]),s=[w,S,w,S];break;default:s=y,s[0]=kt(s[0]),s[1]=kt(s[1]),s[2]=kt(s[2]),s[3]=kt(s[3])}}else s=[0,0,0,0];if(i<0||s[0]+s[1]+s[2]+s[3]<1e-12)return n.rect(t,e,i,r);const[a,l,h,u]=[[t,e],[t+i,e],[t+i,e+r],[t,e+r]],d=Math.min(i/2,r/2),c=[Math.min(d,s[0]),Math.min(d,s[1]),Math.min(d,s[2]),Math.min(d,s[3])],g=[a[0]+c[0],a[1]],f=[a[0],a[1]+c[0]],p=[l[0]-c[1],l[1]],v=[l[0],l[1]+c[1]],m=[h[0]-c[2],h[1]],C=[h[0],h[1]-c[2]],b=[u[0]+c[3],u[1]],_=[u[0],u[1]-c[3]];if(n.moveTo(g[0],g[1]),n.lineTo(p[0],p[1]),!Os(p,v)){const y=p[0],w=p[1]+c[1];n.arc(y,w,c[1],-$l,0,!1)}if(n.lineTo(C[0],C[1]),!Os(m,C)){const y=C[0]-c[2],w=C[1];n.arc(y,w,c[2],0,$l,!1)}if(n.lineTo(b[0],b[1]),!Os(b,_)){const y=b[0],w=b[1]-c[3];n.arc(y,w,c[3],$l,Kt,!1)}if(n.lineTo(f[0],f[1]),!Os(g,f)){const y=g[0],w=g[1]+c[0];n.arc(y,w,c[0],Kt,Kt+$l,!1)}return n.closePath(),n}function Wr(n,t){return!(!n&&!t)}function Ao(n,t){let e;return e=rt(n)?n.some(i=>i||i===void 0):!!n,e&&t>0}function Nr(n,t,e){return e&&n*t>0}function Fc(n,t,e,i,r){return r&&n*t>0&&e!==0&&i!==0}function Tc(n,t){return n*t>0}function Mc(n,t,e,i){return n*t>0&&e!==0&&i!==0}function yA(n,t,e,i,r,o,s,a){if(!n.pathProxy)return!1;const l=X(n,o==null?void 0:o.theme)[n.type],{fill:h=l.fill,stroke:u=l.stroke,opacity:d=l.opacity,fillOpacity:c=l.fillOpacity,lineWidth:g=l.lineWidth,strokeOpacity:f=l.strokeOpacity,visible:p=l.visible}=n.attribute,v=Nr(d,c,h),m=Tc(d,f),C=Wr(h),b=Ao(u,g);if(!p||!C&&!b||!(v||m||s||a))return!0;t.beginPath();const _=typeof n.pathProxy=="function"?n.pathProxy(n.attribute):n.pathProxy;return Yn(_.commandList,t,e,i),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),b&&(a?a(t,n.attribute,l):m&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke())),C&&(s?s(t,n.attribute,l):v&&(t.setCommonStyle(n,n.attribute,e,i,l),t.fill())),!0}function wv(n,t,e,i,r,o,s,a){const l=e-n,h=i-t,u=s-r,d=a-o;let c=d*l-u*h;return c*c<Lt?[]:(c=(u*(t-o)-d*(n-r))/c,[n+c*l,t+c*h])}function yr(n,t,e,i,r,o,s){const a=n-e,l=t-i,h=(s?o:-o)/Math.sqrt(a*a+l*l),u=h*l,d=-h*a,c=n+u,g=t+d,f=e+u,p=i+d,v=(c+f)/2,m=(g+p)/2,C=f-c,b=p-g,_=C*C+b*b,y=r-o,w=c*p-f*g,S=(b<0?-1:1)*Math.sqrt(Math.max(0,y*y*_-w*w));let D=(w*b-C*S)/_,A=(-w*C-b*S)/_;const x=(w*b+C*S)/_,B=(-w*C+b*S)/_,F=D-v,T=A-m,R=x-v,M=B-m;return F*F+T*T>R*R+M*M&&(D=x,A=B),{cx:D,cy:A,x01:-u,y01:-d,x11:D*(r/y-1),y11:A*(r/y-1)}}function Xl(n,t,e,i,r,o,s){const{startAngle:a,endAngle:l}=n.getParsedAngle(),h=kt(l-a),u=l>a;let d=!1;if(r<o){const c=r;r=o,o=c}if(r<=Lt)t.moveTo(e,i);else if(h>=Rt-Lt)t.moveTo(e+r*Ut(a),i+r*It(a)),t.arc(e,i,r,a,l,!u),o>Lt&&(t.moveTo(e+o*Ut(l),i+o*It(l)),t.arc(e,i,o,l,a,u));else{const c=n.getParsedCornerRadius(),{outerDeltaAngle:g,innerDeltaAngle:f,outerStartAngle:p,outerEndAngle:v,innerEndAngle:m,innerStartAngle:C}=n.getParsePadAngle(a,l),b=c,_=c,y=c,w=c,S=Math.max(_,b),D=Math.max(y,w);let A=S,x=D;const B=r*Ut(p),F=r*It(p),T=o*Ut(m),R=o*It(m);let M,E,P,I;if((D>Lt||S>Lt)&&(M=r*Ut(v),E=r*It(v),P=o*Ut(C),I=o*It(C),h<Kt)){const k=wv(B,F,P,I,M,E,T,R);if(k){const H=B-k[0],O=F-k[1],z=M-k[0],j=E-k[1],U=1/It(N0((H*z+O*j)/(yi(H*H+O*O)*yi(z*z+j*j)))/2),W=yi(k[0]*k[0]+k[1]*k[1]);x=Ue(D,(o-W)/(U-1)),A=Ue(S,(r-W)/(U+1))}}if(g<.001)s&&(s[3]||s[1])&&t.moveTo(e+B,i+F),d=!0;else if(A>Lt){const k=Ue(b,A),H=Ue(_,A),O=yr(P,I,B,F,r,k,Number(u)),z=yr(M,E,T,R,r,H,Number(u));A<S&&k===H?!s||s[0]?(t.moveTo(e+O.cx+O.x01,i+O.cy+O.y01),t.arc(e+O.cx,i+O.cy,A,zt(O.y01,O.x01),zt(z.y01,z.x01),!u)):t.moveTo(e+O.cx+A*Ut(zt(z.y01,z.x01)),i+O.cy+A*It(zt(z.y01,z.x01))):!s||s[0]?(t.moveTo(e+O.cx+O.x01,i+O.cy+O.y01),k>0&&t.arc(e+O.cx,i+O.cy,k,zt(O.y01,O.x01),zt(O.y11,O.x11),!u),t.arc(e,i,r,zt(O.cy+O.y11,O.cx+O.x11),zt(z.cy+z.y11,z.cx+z.x11),!u),H>0&&t.arc(e+z.cx,i+z.cy,H,zt(z.y11,z.x11),zt(z.y01,z.x01),!u)):H>0?t.moveTo(e+z.cx+H*Ut(zt(z.y01,z.x01)),i+z.cy+H*It(zt(z.y01,z.x01))):t.moveTo(e+M,i+r*It(v))}else!s||s[0]?(t.moveTo(e+B,i+F),t.arc(e,i,r,p,v,!u)):t.moveTo(e+r*Ut(v),i+r*It(v));if(!(o>Lt)||f<.001)!s||s[1]?t.lineTo(e+T,i+R):t.moveTo(e+T,i+R),d=!0;else if(x>Lt){const k=Ue(w,x),H=Ue(y,x),O=yr(T,R,M,E,o,-H,Number(u)),z=yr(B,F,P,I,o,-k,Number(u));if(!s||s[1]?t.lineTo(e+O.cx+O.x01,i+O.cy+O.y01):t.moveTo(e+O.cx+O.x01,i+O.cy+O.y01),x<D&&k===H){const j=zt(z.y01,z.x01);!s||s[2]?t.arc(e+O.cx,i+O.cy,x,zt(O.y01,O.x01),j,!u):t.moveTo(e+O.cx+Ut(j),i+O.cy+It(j))}else!s||s[2]?(H>0&&t.arc(e+O.cx,i+O.cy,H,zt(O.y01,O.x01),zt(O.y11,O.x11),!u),t.arc(e,i,o,zt(O.cy+O.y11,O.cx+O.x11),zt(z.cy+z.y11,z.cx+z.x11),u),k>0&&t.arc(e+z.cx,i+z.cy,k,zt(z.y11,z.x11),zt(z.y01,z.x01),!u)):k>0?t.moveTo(e+z.cx+k*Ut(zt(z.y01,z.x01)),i+z.cy+k*It(zt(z.y01,z.x01))):t.moveTo(e+P,i+I)}else!s||s[1]?t.lineTo(e+T,i+R):t.moveTo(e+T,i+R),!s||s[2]?t.arc(e,i,o,m,C,u):t.moveTo(e+o*Ut(C),i+o*It(C))}return s?s[3]&&t.lineTo(e+r*Ut(a),i+r*It(a)):t.closePath(),d}const Rc=Symbol.for("ArcRenderContribution"),Ec=Symbol.for("AreaRenderContribution"),Pc=Symbol.for("CircleRenderContribution"),sn=Symbol.for("GroupRenderContribution"),zs=Symbol.for("ImageRenderContribution"),Hc=Symbol.for("PathRenderContribution"),Lc=Symbol.for("PolygonRenderContribution"),jr=Symbol.for("RectRenderContribution"),kc=Symbol.for("SymbolRenderContribution"),ql=Symbol.for("TextRenderContribution"),pW=Symbol.for("CommonRenderContribution"),Ic=Symbol.for("InteractiveSubRenderContribution");var wA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Dv=function(n,t){return function(e,i){t(e,i,n)}};class Ws{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){const{background:f,backgroundMode:p=h.backgroundMode,backgroundFit:v=h.backgroundFit}=t.attribute;if(f)if(t.backgroundImg&&t.resources){const m=t.resources.get(f);if(m.state!=="success"||!m.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const b=X(t.parent).group,{scrollX:_=b.scrollX,scrollY:y=b.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(_,y)}e.clip();const C=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,r,h),this.doDrawImage(e,m.data,C,p,v),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=f,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,r,o){if(r==="no-repeat")t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const s=i.width(),a=i.height();let l=s,h=a;if(o&&r!=="repeat"&&(e.width||e.height)){const c=e.width,g=e.height;r==="repeat-x"?(l=c*(a/g),h=a):r==="repeat-y"&&(h=g*(s/c),l=s);const f=t.dpr,p=Co.allocate({width:l,height:h,dpr:f}),v=p.getContext("2d");v&&(v.inuse=!0,v.clearMatrix(),v.setTransformForCurrent(!0),v.clearRect(0,0,l,h),v.drawImage(e,0,0,l,h),e=p.nativeCanvas),Co.free(p)}const u=t.dpr,d=t.createPattern(e,r);d.setTransform&&d.setTransform(new DOMMatrix([1/u,0,0,1/u,0,0])),t.fillStyle=d,t.translate(i.x1,i.y1),t.fillRect(0,0,s,a),t.translate(-i.x1,-i.y1)}}}const Vr=new Ws;let an=class{constructor(n){this.subRenderContribitions=n,this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(g=>{g.render(n,t,e,i,r,o,s,a,l,h,u,d,c)})}};an=wA([Z(),Dv(0,At(Le)),Dv(0,Ne(Ic)),DA("design:paramtypes",[Object])],an);class SA extends Ws{constructor(){super(...arguments),this.time=Nt.beforeFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{background:g,backgroundMode:f=h.backgroundMode,backgroundFit:p=h.backgroundFit}=t.attribute;if(g)if(t.backgroundImg&&t.resources){const v=t.resources.get(g);if(v.state!=="success"||!v.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const m=t.AABBBounds;this.doDrawImage(e,v.data,m,f,p),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=g,e.fill(),e.highPerformanceRestore()}}const AA=new SA;var xA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},BA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Sv=function(n,t){return function(e,i){t(e,i,n)}};let Oc=class{constructor(n){this.groupRenderContribitions=n,this.numberType=ic}drawShape(n,t,e,i,r,o,s,a){const l=X(n,o==null?void 0:o.theme).group,{fill:h=l.fill,background:u,stroke:d=l.stroke,opacity:c=l.opacity,width:g=l.width,height:f=l.height,clip:p=l.clip,fillOpacity:v=l.fillOpacity,strokeOpacity:m=l.strokeOpacity,cornerRadius:C=l.cornerRadius,path:b=l.path,lineWidth:_=l.lineWidth,visible:y=l.visible}=n.attribute,w=Fc(c,v,g,f,h),S=Mc(c,m,g,f),D=Wr(h,u),A=Ao(d,_);if(!n.valid||!y||!p&&(!D&&!A||!(w||S||s||a||u)))return;if(b&&b.length&&r.drawContribution){const B=t.disableFill,F=t.disableStroke,T=t.disableBeginPath;t.disableFill=!0,t.disableStroke=!0,t.disableBeginPath=!0,b.forEach(R=>{r.drawContribution.getRenderContribution(R).draw(R,r.renderService,r,o)}),t.disableFill=B,t.disableStroke=F,t.disableBeginPath=T}else C===0||rt(C)&&C.every(B=>B===0)?(t.beginPath(),t.rect(e,i,g,f)):(t.beginPath(),Qn(t,e,i,g,f,C));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(AA));const x={doFill:D,doStroke:A};this._groupRenderContribitions.forEach(B=>{B.time===Nt.beforeFillStroke&&B.drawShape(n,t,e,i,D,A,w,S,l,r,s,a,x)}),p&&t.clip(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),x.doFill&&(s?s(t,n.attribute,l):w&&(t.setCommonStyle(n,n.attribute,e,i,l),t.fill())),x.doStroke&&(a?a(t,n.attribute,l):S&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke())),this._groupRenderContribitions.forEach(B=>{B.time===Nt.afterFillStroke&&B.drawShape(n,t,e,i,D,A,w,S,l,r,s,a)})}draw(n,t,e,i){const{context:r}=e;if(!r)return;const{clip:o}=n.attribute;o?r.save():r.highPerformanceSave();const s=X(n,i==null?void 0:i.theme).group,a=r.modelMatrix;if(r.camera){const d=ie.allocate(),c=ie.allocate();cv(c,n,s),Hs(d,a||d,c),r.modelMatrix=d,ie.free(c),r.setTransform(1,0,0,1,0,0,!0)}else r.transformFromMatrix(n.transMatrix,!0);r.beginPath(),i.skipDraw?this.drawShape(n,r,0,0,e,i,()=>!1,()=>!1):this.drawShape(n,r,0,0,e);const{scrollX:l=s.scrollX,scrollY:h=s.scrollY}=n.attribute;let u;(l||h)&&r.translate(l,h),i&&i.drawingCb&&(u=i.drawingCb()),r.modelMatrix!==a&&ie.free(r.modelMatrix),r.modelMatrix=a,u&&u.then?u.then(()=>{o?r.restore():r.highPerformanceRestore()}):o?r.restore():r.highPerformanceRestore()}};Oc=xA([Z(),Sv(0,At(Le)),Sv(0,Ne(sn)),BA("design:paramtypes",[Object])],Oc);const Re={x:0,y:0,z:0,lastModelMatrix:null};class Si{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions&&this.builtinContributions.forEach(e=>this._renderContribitions.push(e)),this._renderContribitions.length&&(this._renderContribitions.sort((e,i)=>i.order-e.order),this._beforeRenderContribitions=this._renderContribitions.filter(e=>e.time===Nt.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(e=>e.time===Nt.afterFillStroke))}beforeRenderStep(t,e,i,r,o,s,a,l,h,u,d,c,g){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(f=>{f.drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g)})}afterRenderStep(t,e,i,r,o,s,a,l,h,u,d,c,g){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(f=>{f.drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g)})}valid(t,e,i,r){const{fill:o=e.fill,background:s,stroke:a=e.stroke,opacity:l=e.opacity,fillOpacity:h=e.fillOpacity,lineWidth:u=e.lineWidth,strokeOpacity:d=e.strokeOpacity,visible:c=e.visible}=t.attribute,g=Nr(l,h,o),f=Tc(l,d),p=Wr(o,s),v=Ao(a,u);return!(!t.valid||!c)&&!(!p&&!v)&&!!(g||f||i||r||s)&&{fVisible:g,sVisible:f,doFill:p,doStroke:v}}transform(t,e,i,r=!1){const{x:o=e.x,y:s=e.y,z:a=e.z,scaleX:l=e.scaleX,scaleY:h=e.scaleY,angle:u=e.angle,postMatrix:d}=t.attribute,c=i.modelMatrix,g=i.camera;Re.x=o,Re.y=s,Re.z=a,Re.lastModelMatrix=c;const f=g&&(r||WS(t)),p=f?t.transMatrix.onlyTranslate()&&!d:l===1&&h===1&&u===0&&!d;if(f){const v=ie.allocate(),m=ie.allocate();cv(m,t,e),Hs(v,c||v,m),Re.x=0,Re.y=0,Re.z=0,i.modelMatrix=v,i.setTransform(1,0,0,1,0,0,!0),ie.free(m)}if(p&&!c){const v=t.getOffsetXY(e);Re.x+=v.x,Re.y+=v.y,Re.z=a,i.setTransformForCurrent()}else if(f)Re.x=0,Re.y=0,Re.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(g&&i.project){const v=t.getOffsetXY(e);Re.x+=v.x,Re.y+=v.y,this.transformWithoutTranslate(i,Re.x,Re.y,Re.z,l,h,u)}else i.transformFromMatrix(t.transMatrix,!0),Re.x=0,Re.y=0,Re.z=0;return Re}transformUseContext2d(t,e,i,r){const o=r.camera;if(this.camera=o,o){const s=t.AABBBounds,a=s.x2-s.x1,l=s.y2-s.y1,h=r.project(0,0,i),u=r.project(a,0,i),d=r.project(a,l,i),c={x:0,y:0},g={x:a,y:0},f={x:a,y:l};r.camera=null;const p=1/(c.x*(f.y-g.y)-g.x*f.y+f.x*g.y+(g.x-f.x)*c.y),v=-(c.y*(d.x-u.x)-g.y*d.x+f.y*u.x+(g.y-f.y)*h.x)*p,m=(g.y*d.y+c.y*(u.y-d.y)-f.y*u.y+(f.y-g.y)*h.y)*p,C=(c.x*(d.x-u.x)-g.x*d.x+f.x*u.x+(g.x-f.x)*h.x)*p,b=-(g.x*d.y+c.x*(u.y-d.y)-f.x*u.y+(f.x-g.x)*h.y)*p,_=(c.x*(f.y*u.x-g.y*d.x)+c.y*(g.x*d.x-f.x*u.x)+(f.x*g.y-g.x*f.y)*h.x)*p,y=(c.x*(f.y*u.y-g.y*d.y)+c.y*(g.x*d.y-f.x*u.y)+(f.x*g.y-g.x*f.y)*h.y)*p;r.setTransform(v,m,C,b,_,y,!0)}}restoreTransformUseContext2d(t,e,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(t,e,i,r,o,s,a){const l=t.project(e,i,r);t.translate(l.x,l.y,!1),t.scale(o,s,!1),t.rotate(a,!1),t.translate(-l.x,-l.y,!1),t.setTransformForCurrent()}_draw(t,e,i,r,o){const{context:s}=r;if(!s)return;s.highPerformanceSave();const a=this.transform(t,e,s,i),{x:l,y:h,z:u,lastModelMatrix:d}=a;this.z=u,yA(t,s,l,h,r,o)||(this.drawShape(t,s,l,h,r,o),this.z=0,s.modelMatrix!==d&&ie.free(s.modelMatrix),s.modelMatrix=d),s.highPerformanceRestore()}}function Zl(n,t,e,i){if(!t.p1)return;const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};if(e===1)t.p2&&t.p3?n.bezierCurveTo(r+t.p1.x,o+t.p1.y,r+t.p2.x,o+t.p2.y,r+t.p3.x,o+t.p3.y,s):n.lineTo(r+t.p1.x,o+t.p1.y,s);else if(t.p2&&t.p3){const[a]=Md(t,e);n.bezierCurveTo(r+a.p1.x,o+a.p1.y,r+a.p2.x,o+a.p2.y,r+a.p3.x,o+a.p3.y,s)}else{const a=t.getPointAt(e);n.lineTo(r+a.x,o+a.y,s)}}function zc(n,t,e,i,r){var o;const{offsetX:s=0,offsetY:a=0,offsetZ:l=0,mode:h="none",drawConnect:u=!1,zeroX:d=0,zeroY:c=0}=r||{};if(u&&h==="none"||!t)return;let g=!0;const{curves:f}=t;if(e>=1){if(u){let _,y=!0;f.forEach((w,S)=>{var D;let A=w.p0;if(w.originP1!==w.originP2){if(_&&_.originP1===_.originP2&&(A=_.p0),w.defined)y||(n.lineTo(A.x+s,A.y+a,l),y=!y);else{const{originP1:x,originP2:B}=w;let F;if(x&&x.defined!==!1?F=A:x&&B.defined!==!1&&(F=(D=w.p3)!==null&&D!==void 0?D:w.p1),y){y=!y;const T=F?F.x:w.p0.x,R=F?F.y:w.p0.y;n.moveTo(T+s,R+a,l)}else F&&(y=!y,n.lineTo(F.x+s,F.y+a,l))}_=w}else _=w})}else f.forEach(_=>{_.defined?(g&&n.moveTo(_.p0.x+s,_.p0.y+a,l),Zl(n,_,1,r),g=!1):g=!0});return}if(e<=0)return;let p;i==="x"?p=he.ROW:i==="y"?p=he.COLUMN:i==="auto"&&(p=t.direction);const v=e*t.tryUpdateLength(p);let m=0,C=!0,b=null;for(let _=0,y=f.length;_<y;_++){const w=f[_],S=w.getLength(p),D=(v-m)/S;if(m+=S,D<0)break;if(u){let A=w.p0;if(w.originP1===w.originP2){b=w;continue}if(b&&b.originP1===b.originP2&&(A=b.p0),w.defined)C||(n.lineTo(A.x+s,A.y+a,l),C=!C);else{const{originP1:x,originP2:B}=w;let F;if(x&&x.defined!==!1?F=A:x&&B.defined!==!1&&(F=(o=w.p3)!==null&&o!==void 0?o:w.p1),C){C=!C;const T=F?F.x:w.p0.x,R=F?F.y:w.p0.y;n.moveTo(T+s,R+a,l)}else F&&(C=!C,n.lineTo(F.x+s,F.y+a,l))}b=w}else{if(!w.defined){g=!0;continue}g&&n.moveTo(w.p0.x+s,w.p0.y+a,l),Zl(n,w,Ue(D,1),r),g=!1}}}function FA(n,t,e,i){const{offsetX:r=0,offsetY:o=0}=i||{},s=t?t.points[t.points.length-1]:e.points[0];n.moveTo(s.x+r,s.y+o),e.points.forEach(a=>{a.defined!==!1?n.lineTo(a.x+r,a.y+o):n.moveTo(a.x+r,a.y+o)})}function TA(n,t,e,i){const{offsetX:r=0,offsetY:o=0}=i||{},{points:s}=e,a=[];let l=0;for(let h=0;h<s.length;h++)s[h].defined===!1&&(l+1!==h&&a.slice(l,h),l=h);a.length,a.push(s),a.forEach((h,u)=>{var d,c,g,f;const p=t&&u===0?t.points[t.points.length-1]:h[0];n.moveTo(p.x+r,p.y+o),h.forEach(v=>{v.defined!==!1?n.lineTo(v.x+r,v.y+o):n.moveTo(v.x+r,v.y+o)});for(let v=h.length-1;v>=0;v--){const m=h[v];n.lineTo((d=m.x1)!==null&&d!==void 0?d:m.x,(c=m.y1)!==null&&c!==void 0?c:m.y)}n.lineTo((g=p.x1)!==null&&g!==void 0?g:p.x,(f=p.y1)!==null&&f!==void 0?f:p.y),n.closePath()})}var MA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Ns=class extends Si{constructor(){super(...arguments),this.numberType=Ms}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).line;this._draw(n,r,!1,e,i)}drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p,v,m,C,b;if(!t)return;n.beginPath();const _=(p=this.z)!==null&&p!==void 0?p:0;zc(n.camera?n:n.nativeContext,t,l,h,{offsetX:u,offsetY:d,offsetZ:_}),c.cache&&!rt(c.cache)&&c.cache.curves.every(B=>B.defined)&&c.attribute.curveType&&c.attribute.curveType.includes("Closed")&&n.closePath(),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,s,a);const{x:y=0,x:w=0}=s;e!==!1&&(g?g(n,s,a):r&&(n.setCommonStyle(c,s,y-u,w-d,a),n.fill())),i!==!1&&(f?f(n,s,a):o&&(n.setStrokeStyle(c,s,y-u,w-d,a),n.stroke()));let{connectedType:S,connectedX:D,connectedY:A,connectedStyle:x}=s;if(rt(a)?(S=(v=S!=null?S:a[0].connectedType)!==null&&v!==void 0?v:a[1].connectedType,D=(m=D!=null?D:a[0].connectedX)!==null&&m!==void 0?m:a[1].connectedX,A=(C=A!=null?A:a[0].connectedY)!==null&&C!==void 0?C:a[1].connectedY,x=(b=x!=null?x:a[0].connectedStyle)!==null&&b!==void 0?b:a[1].connectedStyle):(S=S!=null?S:a.connectedType,D=D!=null?D:a.connectedX,A=A!=null?A:a.connectedY,x=x!=null?x:a.connectedStyle),S!=="connect"&&S!=="zero"&&(S="none"),S!=="none"){n.beginPath(),zc(n.camera?n:n.nativeContext,t,l,h,{offsetX:u,offsetY:d,offsetZ:_,drawConnect:!0,mode:S,zeroX:D,zeroY:A});const B=[];rt(a)?a.forEach(F=>B.push(F)):B.push(a),B.push(s),e!==!1&&(g?g(n,s,a):r&&(n.setCommonStyle(c,x,y-u,w-d,B),n.fill())),i!==!1&&(f?f(n,s,a):o&&(n.setStrokeStyle(c,x,y-u,w-d,B),n.stroke()))}return!1}drawLinearLineHighPerformance(n,t,e,i,r,o,s,a,l,h,u,d,c){var g;t.beginPath();const f=(g=this.z)!==null&&g!==void 0?g:0,{points:p}=n.attribute,v=p[0];t.moveTo(v.x+s,v.y+a,f);for(let b=1;b<p.length;b++){const _=p[b];t.lineTo(_.x+s,_.y+a,f)}t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l);const{x:m=0,x:C=0}=n.attribute;e!==!1&&(d?d(t,n.attribute,l):r&&(t.setCommonStyle(n,n.attribute,m-s,C-a,l),t.fill())),i!==!1&&(c?c(t,n.attribute,l):o&&(t.setStrokeStyle(n,n.attribute,m-s,C-a,l),t.stroke()))}drawShape(n,t,e,i,r,o,s,a){const l=X(n,o==null?void 0:o.theme).line,{fill:h=l.fill,stroke:u=l.stroke,fillOpacity:d=l.fillOpacity,strokeOpacity:c=l.strokeOpacity,segments:g,points:f,closePath:p}=n.attribute;if(!this.valid(n,l,s,a))return;let{curveType:v=l.curveType}=n.attribute;p&&v==="linear"&&(v="linearClosed");const{clipRange:m=l.clipRange,clipRangeByDimension:C=l.clipRangeByDimension}=n.attribute;if(m===1&&!g&&!f.some(b=>b.defined===!1)&&v==="linear")return this.drawLinearLineHighPerformance(n,t,!!h,!!u,d,c,e,i,l,r,o,s,a);if(n.shouldUpdateShape()){const{points:b,segments:_}=n.attribute,y=b;if(_&&_.length){let w,S;if(n.cache=_.map((D,A)=>{if(D.points.length<=1&&A===0)return D.points[0]&&(S={endX:D.points[0].x,endY:D.points[0].y,curves:[{defined:D.points[0].defined!==!1}]}),null;A===1?w={x:S.endX,y:S.endY,defined:S.curves[S.curves.length-1].defined}:A>1&&(w.x=S.endX,w.y=S.endY,w.defined=S.curves[S.curves.length-1].defined);const x=Ld(D.points,v,{startPoint:w});return S=x,x}).filter(D=>!!D),v==="linearClosed"){let D;for(let A=0;A<n.cache.length;A++){const x=n.cache[A];for(let B=0;B<x.curves.length;B++)if(x.curves[B].defined){D=x.curves[B].p0;break}if(D)break}n.cache[n.cache.length-1]&&n.cache[n.cache.length-1].lineTo(D.x,D.y,!0)}}else{if(!b||!b.length)return n.cache=null,void n.clearUpdateShapeTag();n.cache=Ld(y,v)}n.clearUpdateShapeTag()}if(Array.isArray(n.cache)){const b=n.attribute.segments.filter(_=>_.points.length);if(b[0].points.length===1&&b.shift(),m===1){let _=!1;n.cache.forEach((y,w)=>{_||(_=this.drawSegmentItem(t,y,!!h,!!u,d,c,b[w],[l,n.attribute],m,C,e,i,n,s,a))})}else{const _=n.cache.reduce((D,A)=>D+A.getLength(),0),y=m*_;let w=0,S=!1;n.cache.forEach((D,A)=>{if(S)return;const x=D.getLength(),B=(y-w)/x;w+=x,B>0&&(S=this.drawSegmentItem(t,D,!!h,!!u,d,c,b[A],[l,n.attribute],Ue(B,1),C,e,i,n,s,a))})}}else this.drawSegmentItem(t,n.cache,!!h,!!u,d,c,n.attribute,l,m,C,e,i,n,s,a)}};Ns=MA([Z()],Ns);var RA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Jl=class extends Ns{constructor(){super(...arguments),this.numberType=Ms}drawShape(n,t,e,i,r,o,s,a){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:l,length:h}=r.multiGraphicOptions,{segments:u=[]}=n.attribute;if(l>u.length)return;const d=X(n).line,{fill:c=d.fill,stroke:g=d.stroke,opacity:f=d.opacity,fillOpacity:p=d.fillOpacity,strokeOpacity:v=d.strokeOpacity,lineWidth:m=d.lineWidth,visible:C=d.visible}=n.attribute,b=Nr(f,p,c),_=Tc(f,v),y=Wr(c),w=Ao(g,m);if(!n.valid||!C||!y&&!w||!(b||_||s||a))return;const{context:S}=r;for(let D=l;D<l+h;D++)this.drawIncreaseSegment(n,S,u[D-1],u[D],n.attribute.segments[D],[d,n.attribute],e,i)}else super.drawShape(n,t,e,i,r,o,s,a)}drawIncreaseSegment(n,t,e,i,r,o,s,a){i&&(t.beginPath(),FA(t.nativeContext,e,i,{offsetX:s,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,r,o),t.setStrokeStyle(n,r,s,a,o),t.stroke())}};Jl=RA([Z()],Jl);function EA(n,t,e,i){var r;const{drawConnect:o=!1,mode:s="none"}=i||{};if(o&&s==="none")return;const{top:a,bottom:l}=t;if(a.curves.length!==l.curves.length)return;if(e>=1){const w=[],S=[];let D=!0;if(o){let A,x,B=!0;const F=a.curves.length;a.curves.forEach((T,R)=>{const M=l.curves[F-R-1];let E=T,P=M;if(T.originP1===T.originP2)return A=T,void(x=M);if(A&&A.originP1===A.originP2&&(E=A,P=x),T.defined)B||(w.push(E),S.push(P),xo(n,w,S,i),w.length=0,S.length=0,B=!B);else{const{originP1:I,originP2:k}=T;let H,O;I&&I.defined!==!1?(H=E,O=P):I&&k.defined!==!1&&(H=T,O=M),B?(B=!B,w.push(H||T),S.push(O||M)):H&&(B=!B,w.push(H||T),S.push(O||M),xo(n,w,S,i),w.length=0,S.length=0)}A=T}),xo(n,w,S,i)}else{for(let A=0,x=a.curves.length;A<x;A++){const B=a.curves[A];D!==B.defined?(D?(Ql(n,w,S,i),w.length=0,S.length=0):(w.push(B),S.push(l.curves[x-A-1])),D=!D):D&&(w.push(B),S.push(l.curves[x-A-1]))}Ql(n,w,S,i)}return}if(e<=0)return;let{direction:h}=i||{};const{curves:u}=a,d=(r=u[u.length-1].p3)!==null&&r!==void 0?r:u[u.length-1].p1,c=kt(d.x-u[0].p0.x),g=kt(d.y-u[0].p0.y);h=h!=null?h:c>g?he.ROW:he.COLUMN,Number.isFinite(c)||(h=he.COLUMN),Number.isFinite(g)||(h=he.ROW);const f=e*(h===he.ROW?c:g);let p=0,v=!0;const m=[],C=[];let b,_,y=!0;for(let w=0,S=a.curves.length;w<S;w++){const D=a.curves[w],A=D.getLength(h),x=(f-p)/A;if(x<0)break;if(p+=A,o){const B=l.curves[S-w-1];let F=D,T=B;if(D.originP1===D.originP2){b=D,_=B;continue}if(b&&b.originP1===b.originP2&&(F=b,T=_),D.defined)y||(m.push(F),C.push(T),xo(n,m,C,i),m.length=0,C.length=0,y=!y);else{const{originP1:R,originP2:M}=D;let E,P;R&&R.defined!==!1?(E=F,P=T):R&&M.defined!==!1&&(E=D,P=B),y?(y=!y,m.push(E||D),C.push(P||B)):E&&(y=!y,m.push(E||D),C.push(P||B),xo(n,m,C,i),m.length=0,C.length=0)}b=D}else{let B=null,F=null;v!==D.defined?(v?(Ql(n,m,C,i),m.length=0,C.length=0):(B=D,F=l.curves[S-w-1]),v=!v):v&&(B=D,F=l.curves[S-w-1]),B&&F&&(x<1&&(B=B.p2&&B.p3?Md(B,x)[0]:Q0(B,x)[0],F=F.p2&&F.p3?Md(F,1-x)[1]:Q0(F,1-x)[1]),B.defined=v,F.defined=v,m.push(B),C.push(F)),B=null,F=null}}o?xo(n,m,C,i):Ql(n,m,C,i)}function xo(n,t,e,i){if(t.length<2)return;const{offsetX:r=0,offsetY:o=0,offsetZ:s=0,mode:a}=i||{};let l=t[0];n.moveTo(l.p0.x+r,l.p0.y+o,s),l=t[t.length-1];let h=l.p3||l.p1;n.lineTo(h.x+r,h.y+o,s),l=e[e.length-1],n.lineTo(l.p0.x+r,l.p0.y+o,s),l=e[0],h=l.p3||l.p1,n.lineTo(h.x+r,h.y+o,s),n.closePath()}function Ql(n,t,e,i){const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};let a=!0;t.forEach(l=>{l.defined?(a&&n.moveTo(l.p0.x+r,l.p0.y+o,s),Zl(n,l,1,i),a=!1):a=!0}),a=!0;for(let l=e.length-1;l>=0;l--){const h=e[l];h.defined?(a&&n.lineTo(h.p0.x+r,h.p0.y+o,s),Zl(n,h,1,i),a=!1):a=!0}n.closePath()}class Wc{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=10}createCommonPattern(t,e,i,r,o){const s=(t-2*e)/2,a=r.dpr,l=Co.allocate({width:t,height:t,dpr:a}),h=l.getContext("2d");if(!h)return null;h.inuse=!0,h.clearMatrix(),h.setTransformForCurrent(!0),h.clearRect(0,0,t,t),o(s,h);const u=r.createPattern(l.nativeCanvas,"repeat");return u.setTransform&&u.setTransform(new DOMMatrix([1/a,0,0,1/a,0,0])),Co.free(l),u}createCirclePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{s.fillStyle=i,s.arc(o,o,o,0,Rt),s.fill()})}createDiamondPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{const a=t/2,l=a;s.fillStyle=i,s.moveTo(a,l-o),s.lineTo(o+a,l),s.lineTo(a,l+o),s.lineTo(a-o,l),s.closePath(),s.fill()})}createRectPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{const a=e,l=a;s.fillStyle=i,s.fillRect(a,l,2*o,2*o)})}createVerticalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{const a=e;s.fillStyle=i,s.fillRect(a,0,2*o,t)})}createHorizontalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{const a=e;s.fillStyle=i,s.fillRect(0,a,t,2*o)})}createBiasLRLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{s.strokeStyle=i,s.lineWidth=o,s.moveTo(0,0),s.lineTo(t,t);const a=t/2,l=-a;s.moveTo(a,l),s.lineTo(a+t,l+t),s.moveTo(-a,-l),s.lineTo(-a+t,-l+t),s.stroke()})}createBiasRLLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{s.strokeStyle=i,s.lineWidth=o,s.moveTo(t,0),s.lineTo(0,t);const a=t/2,l=a;s.moveTo(t+a,l),s.lineTo(a,l+t),s.moveTo(t-a,-l),s.lineTo(-a,-l+t),s.stroke()})}createGridPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(o,s)=>{const a=e,l=a;s.fillStyle=i,s.fillRect(a,l,o,o),s.fillRect(a+o,l+o,o,o)})}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){this.textureMap||this.initTextureMap(e,t.stage);const{texture:f=h.texture,textureColor:p=h.textureColor,textureSize:v=h.textureSize,texturePadding:m=h.texturePadding}=t.attribute;f&&this.drawTexture(f,t,e,i,r,h,p,v,m)}drawTexture(t,e,i,r,o,s,a,l,h){let u=this.textureMap.get(t);if(!u)switch(t){case"circle":u=this.createCirclePattern(l,h,a,i);break;case"diamond":u=this.createDiamondPattern(l,h,a,i);break;case"rect":u=this.createRectPattern(l,h,a,i);break;case"vertical-line":u=this.createVerticalLinePattern(l,h,a,i);break;case"horizontal-line":u=this.createHorizontalLinePattern(l,h,a,i);break;case"bias-lr":u=this.createBiasLRLinePattern(l,h,a,i);break;case"bias-rl":u=this.createBiasRLLinePattern(l,h,a,i);break;case"grid":u=this.createGridPattern(l,h,a,i)}u&&(i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,r,o,s),i.fillStyle=u,i.fill(),i.highPerformanceRestore())}}const Bo=new Wc;class PA extends Wc{constructor(){super(...arguments),this.time=Nt.afterFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){var f,p,v,m;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:C=t.attribute}=g||{},{texture:b=(f=t.attribute.texture)!==null&&f!==void 0?f:pl(h,"texture"),textureColor:_=(p=t.attribute.textureColor)!==null&&p!==void 0?p:pl(h,"textureColor"),textureSize:y=(v=t.attribute.textureSize)!==null&&v!==void 0?v:pl(h,"textureSize"),texturePadding:w=(m=t.attribute.texturePadding)!==null&&m!==void 0?m:pl(h,"texturePadding")}=C;b&&this.drawTexture(b,t,e,i,r,h,_,y,w)}}const HA=new PA,LA=Vr;var kA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},IA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Av=function(n,t){return function(e,i){t(e,i,n)}};function th(n,t,e){switch(t){case"linear":default:return ms(n,e);case"basis":return ip(n,e);case"monotoneX":return ap(n,e);case"monotoneY":return lp(n,e);case"step":return co(n,.5,e);case"stepBefore":return co(n,0,e);case"stepAfter":return co(n,1,e);case"linearClosed":return hp(n,e)}}let js=class extends Si{constructor(n){super(),this.areaRenderContribitions=n,this.numberType=Ts,this.builtinContributions=[HA,LA],this.init(n)}drawLinearAreaHighPerformance(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p,v,m;const{points:C}=n.attribute;if(C.length<2)return;t.beginPath();const b=(g=this.z)!==null&&g!==void 0?g:0,_=C[0];t.moveTo(_.x+s,_.y+a,b);for(let S=1;S<C.length;S++){const D=C[S];t.lineTo(D.x+s,D.y+a,b)}for(let S=C.length-1;S>=0;S--){const D=C[S];t.lineTo(((f=D.x1)!==null&&f!==void 0?f:D.x)+s,((p=D.y1)!==null&&p!==void 0?p:D.y)+a,b)}t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,s,a,!!r,!1,e,!1,l,h,d,null,{attribute:n.attribute});const{x:y=0,x:w=0}=n.attribute;if(e!==!1&&(d?d(t,n.attribute,l):r&&(t.setCommonStyle(n,n.attribute,y-s,w-a,l),t.fill())),this.afterRenderStep(n,t,s,a,!!r,!1,e,!1,l,h,d,null,{attribute:n.attribute}),i){const{stroke:S=l&&l.stroke}=n.attribute;if(rt(S)&&(S[0]||S[2])&&S[1]===!1){if(t.beginPath(),S[0]){t.moveTo(_.x+s,_.y+a,b);for(let D=1;D<C.length;D++){const A=C[D];t.lineTo(A.x+s,A.y+a,b)}}else if(S[2]){const D=C[C.length-1];t.moveTo(D.x+s,D.y+a,b);for(let A=C.length-2;A>=0;A--){const x=C[A];t.lineTo(((v=x.x1)!==null&&v!==void 0?v:x.x)+s,((m=x.y1)!==null&&m!==void 0?m:x.y)+a,b)}}}c?c(t,n.attribute,l):(t.setStrokeStyle(n,n.attribute,y-s,w-a,l),t.stroke())}}drawShape(n,t,e,i,r,o,s,a){var l,h,u,d,c,g;const f=X(n,o==null?void 0:o.theme).area,{fill:p=f.fill,stroke:v=f.stroke,fillOpacity:m=f.fillOpacity,z:C=f.z,strokeOpacity:b=f.strokeOpacity}=n.attribute,_=this.valid(n,f,s,a);if(!_)return;const{doFill:y,doStroke:w}=_,{clipRange:S=f.clipRange,closePath:D,points:A,segments:x}=n.attribute;let{curveType:B=f.curveType}=n.attribute;if(D&&B==="linear"&&(B="linearClosed"),S===1&&!x&&!A.some(F=>F.defined===!1)&&B==="linear")return this.drawLinearAreaHighPerformance(n,t,!!p,w,m,b,e,i,f,r,o,s,a);if(n.shouldUpdateShape()){if(x&&x.length){let F,T;const R=x.map((P,I)=>{if(P.points.length<=1&&I===0)return P.points[0]&&(T={endX:P.points[0].x,endY:P.points[0].y}),null;I===1?F={x:T.endX,y:T.endY}:I>1&&(F.x=T.endX,F.y=T.endY);const k=th(P.points,B,{startPoint:F});return T=k,k}).filter(P=>!!P);let M;const E=[];for(let P=x.length-1;P>=0;P--){const I=x[P].points,k=[];for(let H=I.length-1;H>=0;H--)k.push({x:(l=I[H].x1)!==null&&l!==void 0?l:I[H].x,y:(h=I[H].y1)!==null&&h!==void 0?h:I[H].y});if(P!==0){const H=x[P-1].points,O=H[H.length-1];O&&k.push({x:(u=O.x1)!==null&&u!==void 0?u:O.x,y:(d=O.y1)!==null&&d!==void 0?d:O.y})}k.length>1&&(M=th(k,B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B),E.unshift(M))}n.cacheArea=E.map((P,I)=>({top:R[I],bottom:P}))}else{if(!A||!A.length)return n.cacheArea=null,void n.clearUpdateShapeTag();{const F=A,T=[];for(let E=A.length-1;E>=0;E--)T.push({x:(c=A[E].x1)!==null&&c!==void 0?c:A[E].x,y:(g=A[E].y1)!==null&&g!==void 0?g:A[E].y});const R=th(F,B),M=th(T,B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B);n.cacheArea={top:R,bottom:M}}}n.clearUpdateShapeTag()}if(Array.isArray(n.cacheArea)){const F=n.attribute.segments.filter(T=>T.points.length);if(F[0].points.length===1&&F.shift(),S===1){let T=!1;n.cacheArea.forEach((R,M)=>{T||(T=this.drawSegmentItem(t,R,y,m,w,b,F[M],[f,n.attribute],S,e,i,C,n,r,s,a))})}else{const T=n.cacheArea.reduce((P,I)=>P+I.top.getLength(),0),R=S*T;let M=0,E=!1;n.cacheArea.forEach((P,I)=>{if(E)return;const k=P.top.getLength(),H=(R-M)/k;M+=k,H>0&&(E=this.drawSegmentItem(t,P,y,m,w,b,F[I],[f,n.attribute],Ue(H,1),e,i,C,n,r,s,a))})}}else this.drawSegmentItem(t,n.cacheArea,y,m,w,b,n.attribute,f,S,e,i,C,n,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).area;this._draw(n,r,!1,e,i)}drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){let v=!1;return v=v||this._drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,!1,f,p),v=v||this._drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,!0,f,p),v}_drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v){var m,C,b,_;if(!(t&&t.top&&t.bottom&&t.top.curves&&t.top.curves.length&&t.bottom.curves&&t.bottom.curves.length))return;let{connectedType:y,connectedX:w,connectedY:S,connectedStyle:D}=s;const A=[];if(f&&(rt(a)?(y=(m=y!=null?y:a[0].connectedType)!==null&&m!==void 0?m:a[1].connectedType,w=(C=w!=null?w:a[0].connectedX)!==null&&C!==void 0?C:a[1].connectedX,S=(b=S!=null?S:a[0].connectedY)!==null&&b!==void 0?b:a[1].connectedY,D=(_=D!=null?D:a[0].connectedStyle)!==null&&_!==void 0?_:a[1].connectedStyle):(y=y!=null?y:a.connectedType,w=w!=null?w:a.connectedX,S=S!=null?S:a.connectedY,D=D!=null?D:a.connectedStyle),y!=="connect"&&y!=="zero"&&(y="none"),rt(a)?a.forEach(P=>A.push(P)):A.push(a),A.push(s)),f&&y==="none")return!1;n.beginPath();const{points:x,segments:B}=c.attribute;let F,T,R=he.ROW;if(B){const P=B[B.length-1];T=B[0].points[0],F=P.points[P.points.length-1]}else T=x[0],F=x[x.length-1];R=kt(F.x-T.x)>kt(F.y-T.y)?he.ROW:he.COLUMN,EA(n.camera?n:n.nativeContext,t,l,{offsetX:h,offsetY:u,offsetZ:d,direction:R,drawConnect:f,mode:y,zeroX:w,zeroY:S}),this.beforeRenderStep(c,n,h,u,!!i,!1,e,!1,a,g,p,null,{attribute:s}),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,s,a);const{x:M=0,x:E=0}=s;if(e!==!1&&(p?p(n,s,a):i&&(n.setCommonStyle(c,f?D:s,M-h,E-u,f?A:a),n.fill())),this.afterRenderStep(c,n,h,u,!!i,!1,e,!1,a,g,p,null,{attribute:s}),r!==!1)if(v)v(n,s,a);else{const{stroke:P=a&&a[1]&&a[1].stroke}=s;rt(P)&&(P[0]||P[2])&&P[1]===!1&&(n.beginPath(),zc(n.camera?n:n.nativeContext,P[0]?t.top:t.bottom,l,R===he.ROW?"x":"y",{offsetX:h,offsetY:u,offsetZ:d,drawConnect:f,mode:y,zeroX:w,zeroY:S})),n.setStrokeStyle(c,f?D:s,M-h,E-u,f?A:a),n.stroke()}return!1}};js=kA([Z(),Av(0,At(Le)),Av(0,Ne(Ec)),IA("design:paramtypes",[Object])],js);var OA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let eh=class extends js{constructor(){super(...arguments),this.numberType=Ts}drawShape(n,t,e,i,r,o,s){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:a,length:l}=r.multiGraphicOptions,{segments:h=[]}=n.attribute;if(a>h.length)return;const u=X(n).area,{fill:d=u.fill,fillOpacity:c=u.fillOpacity,opacity:g=u.opacity,visible:f=u.visible}=n.attribute,p=Nr(g,c,d),v=Wr(d);if(!n.valid||!f||!v||!p&&!s)return;for(let m=a;m<a+l;m++)this.drawIncreaseSegment(n,t,h[m-1],h[m],n.attribute.segments[m],[u,n.attribute],e,i)}else super.drawShape(n,t,e,i,r,o,s)}drawIncreaseSegment(n,t,e,i,r,o,s,a){i&&(t.beginPath(),TA(t.camera?t:t.nativeContext,e,i,{offsetX:s,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,r,o),t.setCommonStyle(n,r,s,a,o),t.fill())}};eh=OA([Z()],eh);var Fo,zA=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},WA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Vs=function(n,t){return function(e,i){t(e,i,n)}},Hn=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};(function(n){n[n.NORMAL=0]="NORMAL",n[n.STOP=1]="STOP"})(Fo||(Fo={}));let Nc=class extends Kl{constructor(n,t,e,i){super(n,i),this.contributions=n,this.lineRender=t,this.areaRender=e,this.drawItemInterceptorContributions=i,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=Fo.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new Hi([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(n,t){return Hn(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=n,this.lastDrawContext=t,this.checkingForDrawPromise=this.checkForDraw(t);const e=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,e)return;this.currentRenderService=n;const{context:i,x:r=0,y:o=0}=t;if(i){if(t.keepMatrix){if(i.nativeContext&&i.nativeContext.getTransform){const s=i.nativeContext.getTransform();i.setTransformFromMatrix(s,!0,1)}}else i.inuse=!0,i.clearMatrix();i.setTransformForCurrent(!0),i.save(),t.restartIncremental&&this.clearScreen(this.currentRenderService,i,t),i.translate(r,o,!0),i.save(),n.renderTreeRoots.sort((s,a)=>{var l,h;return((l=s.attribute.zIndex)!==null&&l!==void 0?l:fe.zIndex)-((h=a.attribute.zIndex)!==null&&h!==void 0?h:fe.zIndex)}).forEach(s=>{this.renderGroup(s,t)}),this.hooks.completeDraw.tap("top-draw",()=>{i.restore(),i.restore(),i.draw(),t.keepMatrix||(i.inuse=!1),this.rendering=!1})}})}_increaseRender(n,t){return Hn(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(n,t)})}_renderIncrementalGroup(n,t){return Hn(this,void 0,void 0,function*(){this.count=n.count,yield new Promise(e=>{this.renderItem(n,t,{drawingCb:()=>Hn(this,void 0,void 0,function*(){if(n.count!==2)yield mv(n,fe.zIndex,(i,r)=>{if(this.status===Fo.STOP)return!0;if(i.isContainer||r<this.currentIdx)return!1;const o=this.currFrameStartAt+n.incremental;return r<o&&(this.currentIdx=r+1,this.renderItem(i,t)),r===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),e(!1);else{const i=n.getChildAt(0);if(i.incremental&&i.attribute.segments)for(i.incrementalAt||(i.incrementalAt=0);i.incrementalAt<i.attribute.segments.length;)t.multiGraphicOptions={startAtIdx:i.incrementalAt,length:i.incremental},this.renderItem(i,t),i.incrementalAt+=i.incremental,yield this.waitToNextFrame();else this.renderItem(i,t);e(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return Hn(this,void 0,void 0,function*(){return new Promise(n=>{this.global.getRequestAnimationFrame()(()=>{n(!1)})})})}checkForDraw(n){return Hn(this,void 0,void 0,function*(){let t=this.rendering;return n.restartIncremental&&(t=!1,yield this.forceStop(),this.resetToInit()),t})}forceStop(){return Hn(this,void 0,void 0,function*(){this.rendering&&(this.status=Fo.STOP,yield new Promise(n=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=Fo.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(t=>t.name!=="stopCb"),n(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(n,t){return Hn(this,void 0,void 0,function*(){if(!t.break&&n.attribute.visibleAll!==!1)return n.incremental&&t.startAtId===n._uid?(yield this._increaseRender(n,t),void(t.break=!0)):void(yield new Promise(e=>{this.renderItem(n,t,{drawingCb:()=>Hn(this,void 0,void 0,function*(){yield mv(n,fe.zIndex,i=>Hn(this,void 0,void 0,function*(){t.break||i.isContainer&&(yield this.renderGroup(i,t))})),e(!1)})})}))})}};Nc=zA([Z(),Vs(0,pv(We)),Vs(1,At(Jl)),Vs(2,At(eh)),Vs(3,At(Le)),Vs(3,Ne(Is)),WA("design:paramtypes",[Array,Object,Object,Object])],Nc);var NA=new ht(n=>{n(Ws).toSelf().inSingletonScope(),n(Wc).toSelf().inSingletonScope(),n(gc).to(Kl),n(rv).to(Nc),n(ov).to(Oc).inSingletonScope(),n(We).toService(ov),Qe(n,sn),n(an).toSelf().inSingletonScope(),Qe(n,Ic),Qe(n,We),n(Gl).toSelf().inSingletonScope(),n(Is).toService(Gl),Qe(n,Is)});function jA(n){n.load(NA)}function Gs(){Gs.__loaded||(Gs.__loaded=!0,pt.load(xS),pt.load(jS),pt.load(MS),pt.load(ES),pt.load(US),eA(pt),jA(pt))}Gs.__loaded=!1,Gs();const Ie=pt.get(Ad);$.global=Ie;const VA=pt.get(tv);$.graphicUtil=VA;const GA=pt.get(Qp);$.transformUtil=GA;const UA=pt.get(Xp);$.graphicService=UA;const KA=pt.get(ac);$.layerService=KA;let Gr;function xv(){if(Gr==null)try{Gr=globalThis===window,Gr&&(Gr=!!document.createElement)}catch(n){Gr=!1}}function ih(){xv();const n=$.global&&$.global.env;return n?n==="browser":Gr}function YA(){xv();const n=$.global&&$.global.env;return n?n==="node":!Gr}function vW(){return ih()?"browser":"node"}var $A=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},XA=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const jc={WIDTH:500,HEIGHT:500,DPR:1};let Us=class{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(n){this._x=n}get y(){return this._y}set y(n){this._y=n}get nativeCanvas(){return this._nativeCanvas}get width(){return this._pixelWidth}set width(n){this._pixelWidth=n,this._displayWidth=n/(this._dpr||1)}get height(){return this._pixelHeight}set height(n){this._pixelHeight=n,this._displayHeight=n/(this._dpr||1)}getContext(n){return this._context}get visiable(){return this._visiable}set visiable(n){this._visiable=n,n?this.show():this.hide()}get dpr(){return this._dpr}set dpr(n){this._dpr=n,this.resize(this._displayWidth,this._displayHeight)}constructor(n){var t;const{nativeCanvas:e,width:i=jc.WIDTH,height:r=jc.HEIGHT,dpr:o=jc.DPR,x:s,y:a,id:l,canvasControled:h=!0}=n;this._x=s!=null?s:0,this._y=a!=null?a:0,this._pixelWidth=i*o,this._pixelHeight=r*o,this._visiable=n.visiable!==!1,this.controled=h,this._displayWidth=i,this._displayHeight=r,this._dpr=o,this._nativeCanvas=e,this._id=(t=e.id)!==null&&t!==void 0?t:l,l&&(e.id=l),this.init(n)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(n){}resize(n,t){}toDataURL(n,t){return""}readPixels(n,t,e,i){return this._context.getImageData(n,t,e,i)}convertToBlob(n){throw new Error("\u6682\u672A\u5B9E\u73B0")}transferToImageBitmap(){throw new Error("\u6682\u672A\u5B9E\u73B0")}release(...n){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}};Us.env="browser",Us=$A([Z(),XA("design:paramtypes",[Object])],Us);function qA(n,t,e,i){let r,o,s,a,l,h,u,d,c,g;const f=t[0],p=t[1],v=t[2],m=i[0],C=i[1],b=i[2],_=e[0],y=e[1],w=e[2];return Math.abs(f-_)<Lt&&Math.abs(p-y)<Lt&&Math.abs(v-w)<Lt?kl.identity(n):(u=f-_,d=p-y,c=v-w,g=1/Math.hypot(u,d,c),u*=g,d*=g,c*=g,r=C*c-b*d,o=b*u-m*c,s=m*d-C*u,g=Math.hypot(r,o,s),g?(g=1/g,r*=g,o*=g,s*=g):(r=0,o=0,s=0),a=d*s-c*o,l=c*r-u*s,h=u*o-d*r,g=Math.hypot(a,l,h),g?(g=1/g,a*=g,l*=g,h*=g):(a=0,l=0,h=0),n[0]=r,n[1]=a,n[2]=u,n[3]=0,n[4]=o,n[5]=l,n[6]=d,n[7]=0,n[8]=s,n[9]=h,n[10]=c,n[11]=0,n[12]=-(r*f+o*p+s*v),n[13]=-(a*f+l*p+h*v),n[14]=-(u*f+d*p+c*v),n[15]=1,n)}function ZA(n,t,e,i,r,o,s){const a=1/(t-e),l=1/(i-r),h=1/(o-s);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(t+e)*a,n[13]=(r+i)*l,n[14]=(s+o)*h,n[15]=1,n}function Bv(n,t,e){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],d=t[8],c=t[9],g=t[10],f=t[11],p=t[12],v=t[13],m=t[14],C=t[15];let b=e[0],_=e[1],y=e[2],w=e[3];return n[0]=b*i+_*a+y*d+w*p,n[1]=b*r+_*l+y*c+w*v,n[2]=b*o+_*h+y*g+w*m,n[3]=b*s+_*u+y*f+w*C,b=e[4],_=e[5],y=e[6],w=e[7],n[4]=b*i+_*a+y*d+w*p,n[5]=b*r+_*l+y*c+w*v,n[6]=b*o+_*h+y*g+w*m,n[7]=b*s+_*u+y*f+w*C,b=e[8],_=e[9],y=e[10],w=e[11],n[8]=b*i+_*a+y*d+w*p,n[9]=b*r+_*l+y*c+w*v,n[10]=b*o+_*h+y*g+w*m,n[11]=b*s+_*u+y*f+w*C,b=e[12],_=e[13],y=e[14],w=e[15],n[12]=b*i+_*a+y*d+w*p,n[13]=b*r+_*l+y*c+w*v,n[14]=b*o+_*h+y*g+w*m,n[15]=b*s+_*u+y*f+w*C,n}function Ii(n,t,e){const i=t[0],r=t[1],o=t[2];let s=e[3]*i+e[7]*r+e[11]*o+e[15];return s=s||1,n[0]=(e[0]*i+e[4]*r+e[8]*o+e[12])/s,n[1]=(e[1]*i+e[5]*r+e[9]*o+e[13])/s,n[2]=(e[2]*i+e[6]*r+e[10]*o+e[14])/s,n}class JA{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:r=this.L_TIME,R_COUNT:o=this.R_COUNT}=e;if(t.size<i)return 0;let s=0;const a=h=>{s++,t.delete(h)},l=Date.now();return t.forEach((h,u)=>{if(h.timestamp.length<o)return a(u);let d=0;for(;l-h.timestamp[h.timestamp.length-1-d]<r&&(d++,!(d>=o)););if(d<o)return a(u);for(;l-h.timestamp[0]>r;)h.timestamp.shift()}),s}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:r=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>r&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();t.forEach(o=>{for(;r-o.timestamp[0]>i;)o.timestamp.shift()})}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();for(;r-t.timestamp[0]>i;)t.timestamp.shift()}}class ln{static GetCanvas(){try{return ln.canvas||(ln.canvas=$.global.createCanvas({})),ln.canvas}catch(t){return null}}static GetCtx(){if(!ln.ctx){const t=ln.GetCanvas();ln.ctx=t.getContext("2d")}return ln.ctx}}class Ur extends JA{static getInstance(){return Ur._instance||(Ur._instance=new Ur),Ur._instance}constructor(t=[],e=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=ln.GetCanvas(),r=ln.GetCtx();if(i.width=e,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("\u83B7\u53D6ctx\u53D1\u751F\u9519\u8BEF");const o=r.createLinearGradient(0,0,e,0);t.forEach(s=>{o.addColorStop(s[0],s[1])}),r.fillStyle=o,r.fillRect(0,0,e,1),this.rgbaSet=r.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,r,o=[],s=100){let a=`${t}${e}${i}${r}`;o.forEach(h=>a+=h.join()),a+=s;let l=this.dataMap.get(a);return l||(l={data:new Ur(o,s),timestamp:[]},this.addLimitedTimestamp(l,Date.now(),{}),this.dataMap.set(a,l)),this.clearCache(this.dataMap,this.cacheParams),l.data}}class mi{static GetSize(t){for(let e=0;e<mi.ImageSize.length;e++)if(mi.ImageSize[e]>=t)return mi.ImageSize[e];return t}static Get(t,e,i,r,o,s,a){const l=mi.GenKey(t,e,i,r,o),h=mi.cache[l];if(!h||h.length===0)return null;for(let u=0;u<h.length;u++)if(h[u].width>=s&&h[u].height>=a)return h[u].pattern;return null}static Set(t,e,i,r,o,s,a,l){const h=mi.GenKey(t,e,i,r,o);mi.cache[h]?mi.cache[h].push({width:a,height:l,pattern:s}):mi.cache[h]=[{width:a,height:l,pattern:s}]}static GenKey(t,e,i,r,o){return`${e},${i},${r},${o},${t.join()}`}}mi.cache={},mi.ImageSize=[20,40,80,160,320,640,1280,2560];function QA(n,t,e,i){const{stops:r,startAngle:o,endAngle:s}=i;for(;e<0;)e+=Rt;for(;e>Rt;)e-=Rt;if(e<o||e>s)return r[0].color;let a,l,h=(e-o)/(s-o);for(let u=0;u<r.length;u++)if(r[u].offset>=h){a=r[u-1],l=r[u];break}return h=(h-a.offset)/(l.offset-a.offset),bo(a.color,l.color,h,!1)}function tx(n,t,e,i,r,o,s,a,l){const h=Math.floor(180*r/Math.PI),u=ln.GetCanvas(),d=ln.GetCtx();if(!d)return null;const c=mi.GetSize(a),g=mi.GetSize(l);let f=mi.Get(t,e,i,o,s,c,g);if(f)return f;const p=Math.sqrt(Math.max(Math.max(Math.pow(e,2)+Math.pow(i,2),Math.pow(c-e,2)+Math.pow(i,2)),Math.max(Math.pow(c-e,2)+Math.pow(g-i,2),Math.pow(e,2)+Math.pow(g-i,2)))),v=h+1,m=r/Math.max(1,v-1),C=Ur.getInstance().GetOrCreate(e,i,c,g,t,v),b=2*Math.PI*p/360;u.width=c,u.height=g,d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,c,g),d.translate(e,i),d.rotate(o);for(let y=0,w=v-1;y<w&&!(o+y*m>s);y++){const S=C.getColor(y);d.beginPath(),d.rotate(m),d.moveTo(0,0),d.lineTo(p,-2*b),d.lineTo(p,0),d.fillStyle=S,d.closePath(),d.fill()}const _=d.getImageData(0,0,c,g);return u.width=_.width,u.height=_.height,d.putImageData(_,0,0),f=n.createPattern(u,"no-repeat"),f&&mi.Set(t,e,i,o,s,f,c,g),f}function Vc(n,t={},e){e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:r=t.fontVariant,fontWeight:o=t.fontWeight,fontSize:s=t.fontSize,fontFamily:a=t.fontFamily}=n;return(i?i+" ":"")+(r?r+" ":"")+(o?o+" ":"")+s*e+"px "+(a||"sans-serif")}function ex(n,t){return n==="top"?Math.ceil(.79*t):n==="middle"?Math.round(.3*t):n==="bottom"?Math.round(-.21*t):0}function Ln(n,t){return n==="end"||n==="right"?-t:n==="center"?-t/2:0}function kn(n,t,e,i=0){return n==="middle"?-t/2:n==="top"?0:n==="bottom"?i-t:n&&n!=="alphabetic"?0:(e||(e=t),-(t-e)/2-.79*e)}var ix=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},nx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const Tt=[0,0,0],rx=new je(1,0,0,1,0,0),ox=(n,t,e,i,r,o,s,a)=>{if(a)for(;e>t;)e-=Rt;else for(;e<t;)e+=Rt;const l=Kt/3*(e>t?1:-1);let h=t,u=h;for(;u!==e;){u=l>0?Math.min(u+l,e):Math.max(u+l,e);const d=Math.abs(u-h),c=4*Math.tan(d/4)/3,g=u<h?-1:1,f=Math.cos(h),p=Math.sin(h),v=Math.cos(u),m=Math.sin(u),C=f*o+i,b=p*s+r,_=v*o+i,y=m*s+r,w=o*c*g,S=s*c*g;n.push([C-w*p,b+S*f,_+w*m,y-S*v,_,y]),h=u}};let To=class{set fillStyle(n){this.nativeContext.fillStyle=n}get fillStyle(){return this.nativeContext.fillStyle}set font(n){this.nativeContext.font=n}get font(){return this.nativeContext.font}set globalAlpha(n){this.nativeContext.globalAlpha=n}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(n){this.nativeContext.lineCap=n}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(n){this.nativeContext.lineDashOffset=n}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(n){this.nativeContext.lineJoin=n}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(n){this.nativeContext.lineWidth=n}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(n){this.nativeContext.miterLimit=n}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(n){this.nativeContext.shadowBlur=n}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(n){this.nativeContext.shadowColor=n}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(n){this.nativeContext.shadowOffsetX=n}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(n){this.nativeContext.shadowOffsetY=n}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(n){this.nativeContext.strokeStyle=n}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(n){this.nativeContext.textAlign=n}get textAlign(){return this.nativeContext.textAlign}set textBaseline(n){this.nativeContext.textBaseline=n}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(n){n!==!!this._inuse&&(this._inuse=n,n?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(n,t){this.fillAttributes=Object.assign(Object.assign({},up),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},dp),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},tn),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const e=n.nativeCanvas.getContext("2d");if(!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0C\u83B7\u53D62d\u4E0A\u4E0B\u6587\u5931\u8D25");this.nativeContext=e,this.canvas=n,this.matrix=new je(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new je(1,0,0,1,0,0)}reset(){this.stack.length&&te.getInstance().warn("\u53EF\u80FD\u5B58\u5728bug\uFF0Cmatrix\u6CA1\u6709\u6E05\u7A7A"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new je(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(n=!1){!n&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(n){return on.allocateByObj(n)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(on.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(on.free(this.matrix),this.matrix=this.stack.pop())}rotate(n,t=!0){this.matrix.rotate(n),t&&this.setTransformForCurrent()}save(){const n=this.cloneMatrix(this.matrix);this.stack.push(n),this.nativeContext.save()}highPerformanceSave(){const n=this.cloneMatrix(this.matrix);this.stack.push(n)}scale(n,t,e=!0){this.matrix.scale(n,t),e&&this.setTransformForCurrent()}setScale(n,t,e=!0){this.matrix.setScale(n,t),e&&this.setTransformForCurrent()}scalePoint(n,t,e,i,r=!0){this.translate(e,i,!1),this.scale(n,t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}setTransform(n,t,e,i,r,o,s=!0,a=this.dpr){this.matrix.setValue(a*n,a*t,a*e,a*i,a*r,a*o),s&&this.setTransformForCurrent()}setTransformFromMatrix(n,t=!0,e=this.dpr){this.matrix.setValue(n.a*e,n.b*e,n.c*e,n.d*e,n.e*e,n.f*e),t&&this.setTransformForCurrent()}resetTransform(n=!0,t=this.dpr){this.setTransform(t,0,0,t,0,0),n&&this.setTransformForCurrent()}transform(n,t,e,i,r,o,s=!0){this.matrix.multiply(n,t,e,i,r,o),s&&this.setTransformForCurrent()}transformFromMatrix(n,t){this.matrix.multiply(n.a,n.b,n.c,n.d,n.e,n.f),t&&this.setTransformForCurrent()}translate(n,t,e=!0){this.matrix.translate(n,t),e&&this.setTransformForCurrent()}rotateDegrees(n,t=!0){const e=n*Math.PI/180;this.rotate(e,t)}rotateAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotate(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotateDegrees(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(n,t){n?typeof n=="string"?this.nativeContext.clip(n):this.nativeContext.clip(n,t):this.nativeContext.clip()}arc(n,t,e,i,r,o,s){if(s=s||0,this.camera){const a=[];ox(a,i,r,n,t,e,e,o);for(let l=0;l<a.length;++l){const h=a[l];this.bezierCurveTo(h[0],h[1],h[2],h[3],h[4],h[5],s)}}else this.nativeContext.arc(n,t,e,i,r,o)}arcTo(n,t,e,i,r){this.nativeContext.arcTo(n,t,e,i,r)}bezierCurveTo(n,t,e,i,r,o,s){if(s=s||0,this.camera){let a=s,l=s;this.modelMatrix&&(Ii(Tt,[n,t,s],this.modelMatrix),n=Tt[0],t=Tt[1],a=Tt[2],Ii(Tt,[e,i,s],this.modelMatrix),e=Tt[0],i=Tt[1],l=Tt[2],Ii(Tt,[r,o,s],this.modelMatrix),r=Tt[0],o=Tt[1],s=Tt[2]);let h=this.camera.vp(r,o,s);r=h.x,o=h.y,h=this.camera.vp(n,t,a),n=h.x,t=h.y,h=this.camera.vp(e,i,l),e=h.x,i=h.y}this.nativeContext.bezierCurveTo(n,t,e,i,r,o)}closePath(){this.nativeContext.closePath()}ellipse(n,t,e,i,r,o,s,a){a==null?this.nativeContext.ellipse(n,t,e,i,r,o,s):this.nativeContext.ellipse(n,t,e,i,r,o,s,a)}lineTo(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Ii(Tt,[n,t,e],this.modelMatrix),n=Tt[0],t=Tt[1],e=Tt[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}this.nativeContext.lineTo(n,t)}moveTo(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Ii(Tt,[n,t,e],this.modelMatrix),n=Tt[0],t=Tt[1],e=Tt[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}this.nativeContext.moveTo(n,t)}quadraticCurveTo(n,t,e,i,r){if(r=r||0,this.camera){let o=r;this.modelMatrix&&(Ii(Tt,[n,t,r],this.modelMatrix),n=Tt[0],t=Tt[1],o=Tt[2],Ii(Tt,[e,i,r],this.modelMatrix),e=Tt[0],i=Tt[1],r=Tt[2]);let s=this.camera.vp(e,i,r);e=s.x,i=s.y,s=this.camera.vp(n,t,o),n=s.x,t=s.y}this.nativeContext.quadraticCurveTo(n,t,e,i)}rect(n,t,e,i,r){r=r||0,this.camera?(this.moveTo(n,t,r),this.lineTo(n+e,t,r),this.lineTo(n+e,t+i,r),this.lineTo(n,t+i,r),this.closePath()):this.nativeContext.rect(n,t,e,i)}createImageData(){const n=arguments;return n.length===2?this.nativeContext.createImageData(n[0],n[1]):n.length===1?this.nativeContext.createImageData(n[0]):null}createLinearGradient(n,t,e,i){return this.nativeContext.createLinearGradient(n,t,e,i)}createPattern(n,t){return n.width===0||n.height===0?null:this.nativeContext.createPattern(n,t)}createRadialGradient(n,t,e,i,r,o){return this.nativeContext.createRadialGradient(n,t,e,i,r,o)}createConicGradient(n,t,e,i){let r,o=!1;const s=this;return{stops:[],addColorStop(a,l){this.stops.push([a,l]),o=!0},GetPattern(a,l,h){return o&&(h||(h=i-e),r=tx(s,this.stops,n,t,h,e,i,a,l),o=!1),r}}}fill(n,t){this.disableFill||(n?this.nativeContext.fill(n):this.nativeContext.fill())}fillRect(n,t,e,i){this.nativeContext.fillRect(n,t,e,i)}clearRect(n,t,e,i){this.nativeContext.clearRect(n,t,e,i)}project(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Ii(Tt,[n,t,e],this.modelMatrix),n=Tt[0],t=Tt[1],e=Tt[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}return{x:n,y:t}}view(n,t,e){return e=e||0,this.camera?(this.modelMatrix&&(Ii(Tt,[n,t,e],this.modelMatrix),n=Tt[0],t=Tt[1],e=Tt[2]),this.camera.view(n,t,e)):[n,t,e]}fillText(n,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Ii(Tt,[t,e,i],this.modelMatrix),t=Tt[0],e=Tt[1],i=Tt[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.fillText(n,t,e)}getImageData(n,t,e,i){return this.nativeContext.getImageData(n,t,e,i)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(n,t){return this.nativeContext.isPointInPath(n,t)}isPointInStroke(n,t){return this.nativeContext.isPointInStroke(n,t)}measureText(n,t=$.global.measureTextMethod){var e,i;if(!t||t==="native")return this.nativeContext.measureText(n);this.mathTextMeasure||(this.mathTextMeasure=$.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));const r=(e=this.fontFamily)!==null&&e!==void 0?e:tn.fontFamily,o=(i=this.fontSize)!==null&&i!==void 0?i:tn.fontSize;return this.mathTextMeasure.textSpec.fontFamily===r&&this.mathTextMeasure.textSpec.fontSize===o||(this.mathTextMeasure.textSpec.fontFamily=r,this.mathTextMeasure.textSpec.fontSize=o,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(n,t)}putImageData(n,t,e){this.nativeContext.putImageData(n,t,e)}setLineDash(n){const t=arguments,e=this.nativeContext;this.nativeContext.setLineDash?e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])}stroke(n){this.disableStroke||(n?this.nativeContext.stroke(n):this.nativeContext.stroke())}strokeRect(n,t,e,i){this.nativeContext.strokeRect(n,t,e,i)}strokeText(n,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Ii(Tt,[t,e,i],this.modelMatrix),t=Tt[0],e=Tt[1],i=Tt[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.strokeText(n,t,e)}drawImage(){const n=this.nativeContext,t=arguments;t.length===3?n.drawImage(t[0],t[1],t[2]):t.length===5?n.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&n.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setCommonStyle(n,t,e,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setCommonStyle(n,t,e,i,r[0]);const o=Object.create(r[0]);return r.forEach((s,a)=>{a!==0&&Object.assign(o,s)}),this._setCommonStyle(n,t,e,i,o)}return this._setCommonStyle(n,t,e,i,r)}_setCommonStyle(n,t,e,i,r){const o=this.nativeContext;r||(r=this.fillAttributes);const{fillOpacity:s=r.fillOpacity,opacity:a=r.opacity,fill:l=r.fill}=t;s>1e-12&&a>1e-12?(o.globalAlpha=s*a,o.fillStyle=Dc(this,l,n,e,i)):o.globalAlpha=s*a}setShadowBlendStyle(n,t,e){if(Array.isArray(e)){if(e.length<=1)return this._setShadowBlendStyle(n,e[0]);const i=Object.create(e[0]);return e.forEach((r,o)=>{o!==0&&Object.assign(i,r)}),this._setShadowBlendStyle(n,t,i)}return this._setShadowBlendStyle(n,t,e)}_setShadowBlendStyle(n,t,e){const i=this.nativeContext;e||(e=this.fillAttributes);const{opacity:r=e.opacity,shadowBlur:o=e.shadowBlur,shadowColor:s=e.shadowColor,shadowOffsetX:a=e.shadowOffsetX,shadowOffsetY:l=e.shadowOffsetY,blur:h=e.blur,globalCompositeOperation:u=e.globalCompositeOperation}=t;r<=1e-12||(o||a||l?(i.shadowBlur=o*this.dpr,i.shadowColor=s,i.shadowOffsetX=a*this.dpr,i.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0),h?(i.filter=`blur(${h}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(i.filter="blur(0px)",this._clearFilterStyle=!1),u?(i.globalCompositeOperation=u,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(i.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(n,t,e,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setStrokeStyle(n,t,e,i,r[0]);const o=Object.create(r[0]);return r.forEach((s,a)=>{a!==0&&Object.assign(o,s)}),this._setStrokeStyle(n,t,e,i,o)}return this._setStrokeStyle(n,t,e,i,r)}_setStrokeStyle(n,t,e,i,r){const o=this.nativeContext;r||(r=this.strokeAttributes);const{strokeOpacity:s=r.strokeOpacity,opacity:a=r.opacity}=t;if(s>1e-12&&a>1e-12){const{lineWidth:l=r.lineWidth,stroke:h=r.stroke,lineJoin:u=r.lineJoin,lineDash:d=r.lineDash,lineCap:c=r.lineCap,miterLimit:g=r.miterLimit}=t;o.globalAlpha=s*a,o.lineWidth=si(this,l,this.dpr),o.strokeStyle=Dc(this,h,n,e,i),o.lineJoin=u,o.setLineDash(d),o.lineCap=c,o.miterLimit=g}}setTextStyleWithoutAlignBaseline(n,t,e){const i=this.nativeContext;t||(t=this.textAttributes);const{scaleIn3d:r=t.scaleIn3d}=n;n.font?i.font=n.font:i.font=Vc(n,t,r&&this.camera&&this.camera.getProjectionScale(e));const{fontFamily:o=t.fontFamily,fontSize:s=t.fontSize}=n;this.fontFamily=o,this.fontSize=s,i.textAlign="left",i.textBaseline="alphabetic"}setTextStyle(n,t,e){var i,r;const o=this.nativeContext;t||(t=this.textAttributes),n.font?o.font=n.font:o.font=Vc(n,t,this.camera&&this.camera.getProjectionScale(e));const{fontFamily:s=t.fontFamily,fontSize:a=t.fontSize}=n;this.fontFamily=s,this.fontSize=a,o.textAlign=(i=n.textAlign)!==null&&i!==void 0?i:t.textAlign,o.textBaseline=(r=n.textBaseline)!==null&&r!==void 0?r:t.textBaseline}draw(){}clearMatrix(n=!0,t=this.dpr){this.setTransformFromMatrix(rx,n,t)}onlyTranslate(n=this.dpr){return this.matrix.a===n&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===n}release(...n){this.stack.forEach(t=>on.free(t)),this.stack.length=0}};To.env="browser",To=ix([Z(),nx("design:paramtypes",[Object,Number])],To);var sx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ax=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Mo=class extends Us{constructor(n){super(n)}init(n){const{container:t}=n;if(typeof t=="string"){const e=$.global.getElementById(t);e&&(this._container=e)}else this._container=t;this._context=new To(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:n}=this;n.width=this._pixelWidth,n.height=this._pixelHeight,!n.style||this.setCanvasStyle(n,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(n),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const n=this._nativeCanvas;n.style.position="absolute",n.style.top=`${this._y}px`,n.style.left=`${this._x}px`}resetStyle(n){if(!this.controled)return;const{width:t=this._displayWidth,height:e=this._displayHeight,dpr:i=this._dpr,x:r=this._x,y:o=this._y}=n,{nativeCanvas:s}=this;s.width=t*i,s.height=e*i,!s.style||this.setCanvasStyle(s,r,o,t,e),n.id&&(s.id=n.id),this.visiable||this.hide()}setCanvasStyle(n,t,e,i,r){this.controled&&(n.style.width=`${i}px`,n.style.height=`${r}px`)}toDataURL(n,t){return n==="image/jpeg"?this._nativeCanvas.toDataURL(n,t):n==="image/png"?this._nativeCanvas.toDataURL(n):this._nativeCanvas.toDataURL(n,t)}resize(n,t){this.controled&&(this._pixelWidth=n*this._dpr,this._pixelHeight=t*this._dpr,this._displayWidth=n,this._displayHeight=t,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${n}px`,this._nativeCanvas.style.height=`${t}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};Mo.env="browser",Mo=sx([Z(),ax("design:paramtypes",[Object])],Mo);function Fv(n,t){return new ht(e=>{e(vp).toDynamicValue(()=>i=>new n(i)).whenTargetNamed(n.env),e(FD).toDynamicValue(()=>(i,r)=>new t(i,r)).whenTargetNamed(t.env)})}const lx=Fv(Mo,To);var hx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ux=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Tv=function(n,t){return function(e,i){t(e,i,n)}};let Gc=class{constructor(n){this.pickItemInterceptorContributions=n,this.type="default",this.global=$.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((n,t)=>n.order-t.order)}pick(n,t,e){let i={graphic:null,group:null};e.pickerService=this;let r=0,o=0;if(e&&e.bounds){if(!e.bounds.contains(t.x,t.y))return i;r=e.bounds.x1,o=e.bounds.y1}if(this.pickContext)if(e.keepMatrix){if(this.pickContext.nativeContext&&this.pickContext.nativeContext.getTransform){const l=this.pickContext.nativeContext.getTransform();this.pickContext.setTransformFromMatrix(l,!0,1)}}else this.pickContext.inuse=!0,this.pickContext.clearMatrix(!0,1);e.pickContext=this.pickContext;const s=new je(1,0,0,1,r,o);let a;for(let l=n.length-1;l>=0&&(i=n[l].isContainer?this.pickGroup(n[l],t,s,e):this.pickItem(n[l],t,s,e),!i.graphic);l--)a||(a=i.group);if(i.graphic||(i.group=a),this.pickContext&&!e.keepMatrix&&(this.pickContext.inuse=!1),i.graphic){let l=i.graphic;for(;l.parent;)l=l.parent;l.shadowHost&&(i.params={shadowTarget:i.graphic},i.graphic=l.shadowHost)}return i}containsPoint(n,t,e){var i;return!!(!((i=this.pickItem(n,t,null,e!=null?e:{pickContext:this.pickContext,pickerService:this}))===null||i===void 0)&&i.graphic)}pickGroup(n,t,e,i){let r={group:null,graphic:null};if(n.attribute.visibleAll===!1)return r;const o=i.pickContext,s=o.modelMatrix;if(o.camera){const g=n.transMatrix,f=ie.allocate();if(vc(f,g),s){if(f){const p=ie.allocate();o.modelMatrix=Hs(p,s,f),ie.free(f)}}else vc(f,n.globalTransMatrix),o.modelMatrix=f}if(this.InterceptorContributions.length)for(let g=0;g<this.InterceptorContributions.length;g++){const f=this.InterceptorContributions[g];if(f.beforePickItem){const p=f.beforePickItem(n,this,t,i,{parentMatrix:e});if(p)return o.modelMatrix!==s&&ie.free(o.modelMatrix),o.modelMatrix=s,p}}const a=n.transMatrix,l=on.allocateByObj(e),h=new xe(t.x,t.y);l.transformPoint(h,h);const u=n.AABBBounds.containsPoint(h);if(!u&&!n.stage.camera)return r;const d=this.pickItem(n,h.clone(),e,i);d&&d.graphic&&(r.graphic=d.graphic,r.params=d.params);const c=n.attribute.pickable!==!1&&u;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),n.attribute.childrenPickable===!1||d&&d.graphic||vv(n,fe.zIndex,g=>{if(g.isContainer){const f=new xe(t.x,t.y),p=X(n).group,{scrollX:v=p.scrollX,scrollY:m=p.scrollY}=n.attribute;f.x-=v,f.y-=m,r=this.pickGroup(g,f,l,i)}else{const f=new xe(t.x,t.y);l.transformPoint(f,f);const p=X(n).group,{scrollX:v=p.scrollX,scrollY:m=p.scrollY}=n.attribute;f.x-=v,f.y-=m;const C=this.pickItem(g,f,e,i);C&&C.graphic&&(r.graphic=C.graphic,r.params=C.params)}return!!r.graphic||!!r.group},!0,!!o.camera),o.modelMatrix!==s&&ie.free(o.modelMatrix),o.modelMatrix=s,r.graphic||r.group||!c||n.stage.camera||(r.group=n),on.free(l),r}selectPicker(n){return this.pickerMap.get(n.numberType)||null}};Gc=hx([Z(),Tv(0,At(Le)),Tv(0,Ne(wo)),ux("design:paramtypes",[Object])],Gc);const tr=Symbol.for("MathPickerContribution"),Mv=Symbol.for("MathArcPicker"),Rv=Symbol.for("MathAreaPicker"),Ev=Symbol.for("MathCirclePicker"),nh=Symbol.for("MathImagePicker"),Pv=Symbol.for("MathLinePicker"),Hv=Symbol.for("MathPathPicker"),Lv=Symbol.for("MathRectPicker"),kv=Symbol.for("MathSymbolPicker"),Iv=Symbol.for("MathTextPicker"),Ov=Symbol.for("MathPolygonPicker"),zv=Symbol.for("MathGlyphPicker"),Wv=Symbol.for("CanvasArcPicker"),Nv=Symbol.for("CanvasArc3dPicker"),jv=Symbol.for("CanvasAreaPicker"),Vv=Symbol.for("CanvasCirclePicker"),Gv=Symbol.for("CanvasImagePicker"),Uv=Symbol.for("CanvasLinePicker"),Kv=Symbol.for("CanvasPathPicker"),Yv=Symbol.for("CanvasRectPicker"),$v=Symbol.for("CanvasRect3dPicker"),Xv=Symbol.for("CanvasSymbolPicker"),qv=Symbol.for("CanvasTextPicker"),Zv=Symbol.for("CanvasPolygonPicker"),Jv=Symbol.for("CanvasPyramid3dPicker"),Qv=Symbol.for("CanvasRichTextPicker"),tm=Symbol.for("CanvasGlyphPicker"),em=Symbol.for("CanvasGroupPicker"),$e=Symbol.for("CanvasPickerContribution");var dx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},cx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Ks=function(n,t){return function(e,i){t(e,i,n)}};let Ro=class extends Gc{constructor(n,t,e){super(e),this.contributions=n,this.drawContribution=t,this.pickItemInterceptorContributions=e,this.global.hooks.onSetEnv.tap("canvas-picker-service",(i,r,o)=>{this.configure(o,r)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(n=>{this.pickerMap.set(n.numberType,n)}),super._init()}configure(n,t){this.pickCanvas=Co.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(n,t,e,i){if(n.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.beforePickItem){const h=l.beforePickItem(n,this,t,i,{parentMatrix:e});if(h)return h}}const r=this.pickerMap.get(n.numberType);if(!r)return null;const o=r.contains(n,t,i)?n:null,s={graphic:o};if(o)return s;if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.afterPickItem){const h=l.afterPickItem(n,this,t,i,{parentMatrix:e});if(h)return h}}return s}};Ro=dx([Z(),Ks(0,At(Le)),Ks(0,Ne($e)),Ks(1,At(gc)),Ks(2,At(Le)),Ks(2,Ne(wo)),cx("design:paramtypes",[Object,Object,Object])],Ro);var gx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Uc=class{constructor(){this.type="group",this.numberType=ic}contains(n,t,e){return!1}};Uc=gx([Z()],Uc);const rh=new ht((n,t,e,i)=>{rh.__vloaded||(rh.__vloaded=!0,n(em).to(Uc).inSingletonScope(),n($e).toService(em),Qe(n,$e))});rh.__vloaded=!1;var fx=rh;const px=new ht((n,t,e,i)=>{e(Ro)||n(Ro).toSelf().inSingletonScope(),e(yo)?i(yo).toService(Ro):n(yo).toService(Ro)});function vx(n){n.load(fx),n.load(px)}var mx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Cx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let oh=class{constructor(){this._uid=Gt.GenAutoIncrementId()}onChange(n){this._onChangeCb=n}configure(n,t){t.env===this.type&&n.setWindowHandler(this)}release(...n){this.releaseWindow()}isVisible(n){return!0}onVisibleChange(n){}getTopLeft(n){return{top:0,left:0}}};oh=mx([Z(),Cx("design:paramtypes",[])],oh);var Ys,bx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},_x=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let wr=Ys=class extends oh{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${Ys.idprefix}_${Ys.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=$.global}getTitle(){return this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch(n){console.error("\u53D1\u751F\u9519\u8BEF\uFF0C\u8BE5\u73AF\u5883\u4E0D\u5B58\u5728IntersectionObserver")}}isElementVisible(n){const t=n.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>e||t.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const n=new IntersectionObserver((t,e)=>{t.forEach(i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting})});n&&n.observe(this.canvas.nativeCanvas)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height});let e;if(e=typeof n.container=="string"?this.global.getElementById(n.container):n.container?n.container:this.global.getRootElement(),!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0CcontainerId\u53EF\u80FD\u4F20\u5165\u6709\u8BEF");n.offscreen?e=null:e.appendChild(t);const i={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,container:e,id:Ys.GenerateCanvasId(),canvasControled:!0};this.canvas=new Mo(i)}createWindowByCanvas(n){var t;let e;if(typeof n.canvas=="string"){if(e=this.global.getElementById(n.canvas),!e)throw new Error("canvasId \u53C2\u6570\u4E0D\u6B63\u786E\uFF0C\u8BF7\u786E\u8BA4canvas\u5B58\u5728\u5E76\u63D2\u5165dom")}else e=n.canvas;if(!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0C\u4F20\u5165\u7684canvas\u4E0D\u6B63\u786E");let i=n.width,r=n.height;if(i==null||r==null||!n.canvasControled){const s=e.getBoundingClientRect();i=s.width,r=s.height}let o=n.dpr;o==null&&(o=(t=e.getContext("2d").pixelRatio)!==null&&t!==void 0?t:e.width/i),this.canvas=new Mo({width:i,height:r,dpr:o,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(n,t,e){return this.canvas.nativeCanvas.addEventListener(n,t,e)}removeEventListener(n,t,e){return this.canvas.nativeCanvas.removeEventListener(n,t,e)}dispatchEvent(n){return this.canvas.nativeCanvas.dispatchEvent(n)}getStyle(){return this.canvas.nativeCanvas.style}setStyle(n){this.canvas.nativeCanvas.style=n}getBoundingClientRect(){const n=this.canvas.nativeCanvas,t=this.getWH();return n.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(n,t){const e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(n.x1,n.y1,n.x2-n.x1,n.y2-n.y1),t&&(e.fillStyle=t,e.fillRect(n.x1,n.y1,n.x2-n.x1,n.y2-n.y1)),e.nativeContext.restore()}isVisible(n){return this._canvasIsIntersecting}onVisibleChange(n){this._onVisibleChangeCb=n}getTopLeft(n){return this.global.getElementTopLeft(this.canvas.nativeCanvas,n)}};wr.env="browser",wr.idprefix="visactor_window",wr.prefix_count=0,wr=Ys=bx([Z(),_x("design:paramtypes",[])],wr);const yx=new ht(n=>{n(wr).toSelf(),n(Vd).toDynamicValue(t=>t.container.get(wr)).whenTargetNamed(wr.env)});var wx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let sh=class{configure(n,...t){n.env===this.type&&n.setActiveEnvContribution(this)}getNativeAABBBounds(n){return new me}removeDom(n){return!1}createDom(n){return null}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}loadJson(n){const t=fetch(n).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(n){return fetch(n).then(t=>t.blob()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(n,t){return 0}getElementLeft(n,t){return 0}getElementTopLeft(n,t){return{top:0,left:0}}};sh=wx([Z()],sh);var we=n=>lt(n)&&Number.isFinite(n),Dx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Sx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};class Ax{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function im(n,t=!1){const e=document.createElement("img");if(e.crossOrigin="anonymous",t){const i=new Blob([n],{type:"image/svg+xml"});n=window.URL.createObjectURL(i)}return e.src=n,e.complete?Promise.resolve(e):new Promise((i,r)=>{e.onload=()=>{i(e)},e.onerror=()=>{r(new Error("\u52A0\u8F7D\u5931\u8D25"))}})}let ah=class extends sh{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch(n){this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(n,t){var e;if(t){const{clientX:i,clientY:r}=n,o=t.getBoundingClientRect(),s=(e=t.getNativeHandler)===null||e===void 0?void 0:e.call(t).nativeCanvas;let a,l;return s&&(a=o.width/s.offsetWidth,l=o.height/s.offsetHeight),{x:(i-o.left)/(we(a)?a:1),y:(r-o.top)/(we(l)?l:1)}}return{x:n.offsetX,y:n.offsetY}}getNativeAABBBounds(n){let t=n;if(typeof n=="string"&&(t=new DOMParser().parseFromString(n,"text/html").firstChild,t.lastChild&&(t=t.lastChild.firstChild)),t.getBoundingClientRect){const e=t.getBoundingClientRect();return new Ax(e)}return new me}removeDom(n){return n.parentElement.removeChild(n),!0}createDom(n){const{tagName:t="div",width:e,height:i,style:r,parent:o}=n,s=document.createElement(t);if(r&&(ue(r)?s.setAttribute("style",r):Object.keys(r).forEach(a=>{s.setAttribute(a,r[a])})),e!=null&&(s.style.width=`${e}px`),i!=null&&(s.style.height=`${i}px`),o){const a=ue(o)?this.getElementById(o):o;a&&a.appendChild&&a.appendChild(s)}return s}loadImage(n){return im(n,!1).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(n){return im(n,!0).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(n){var t,e;const i=document.createElement("canvas");n.id&&(i.id=(t=n.id)!==null&&t!==void 0?t:Gt.GenAutoIncrementId().toString());const r=(e=n.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return n.width&&n.height&&(i.style.width=`${n.width}px`,i.style.height=`${n.height}px`,i.width=n.width*r,i.height=n.height*r),i}createOffscreenCanvas(n){var t;const e=(t=n.dpr)!==null&&t!==void 0?t:window.devicePixelRatio;return new OffscreenCanvas(n.width*e,n.height*e)}releaseCanvas(n){let t;t=typeof n=="string"?document.getElementById(n):n,t&&t.parentElement&&t.parentElement.removeChild(t)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(n,t,e){return document.addEventListener(n,t,e)}removeEventListener(n,t,e){return document.removeEventListener(n,t,e)}dispatchEvent(n){return document.dispatchEvent(n)}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}getDocument(){return document}release(...n){}getElementTop(n,t){let e=n.offsetTop,i=n.offsetParent;for(;i!==null;)e+=i.offsetTop,i=i.offsetParent;return e}getElementLeft(n,t){let e=n.offsetLeft,i=n.offsetParent;for(;i!==null;)e+=i.offsetLeft,i=i.offsetParent;return e}getElementTopLeft(n,t){let e=n.offsetTop,i=n.offsetLeft,r=n.offsetParent;for(;r!==null;)e+=r.offsetTop,i+=r.offsetLeft,r=r.offsetParent;return{top:e,left:i}}};ah=Dx([Z(),Sx("design:paramtypes",[])],ah);const lh=new ht(n=>{lh.isBrowserBound||(lh.isBrowserBound=!0,n(ah).toSelf().inSingletonScope(),n(Ja).toService(ah))});lh.isBrowserBound=!1;function $s(n,t=!0){$s.__loaded||($s.__loaded=!0,n.load(lh),n.load(lx),n.load(yx),t&&vx(n))}$s.__loaded=!1;function CW(){$s(container)}var xx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Bx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Xs=class extends To{constructor(n,t){super(n,t);const e=n.nativeCanvas.getContext("2d");if(!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0C\u83B7\u53D62d\u4E0A\u4E0B\u6587\u5931\u8D25");this.nativeContext=e,this.canvas=n,this.matrix=new je(1,0,0,1,0,0),this.stack=[],this.dpr=t!=null?t:1}release(...n){}};Xs.env="node",Xs=xx([Z(),Bx("design:paramtypes",[Object,Number])],Xs);var Fx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Tx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Eo=class extends Us{constructor(n){super(n)}init(){this._context=new Xs(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...n){this._nativeCanvas.release&&ge(this._nativeCanvas.release)&&this._nativeCanvas.release()}};Eo.env="node",Eo=Fx([Z(),Tx("design:paramtypes",[Object])],Eo);const Mx=Fv(Eo,Xs);var Rx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Ex=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Px=function(n,t){return function(e,i){t(e,i,n)}};let Po=class extends oh{get container(){return null}constructor(n){super(),this.global=n,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height}),e={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,id:Gt.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new Eo(e)}createWindowByCanvas(n){const t=n.canvas;let e=n.width,i=n.height;e!=null&&i!=null&&n.canvasControled||(e=t.width,i=t.height),this.canvas=new Eo({width:e,height:i,dpr:1,nativeCanvas:t,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(n="image/png"){return this.canvas.nativeCanvas.toBuffer(n)}addEventListener(n,t,e){}dispatchEvent(n){return!0}removeEventListener(n,t,e){}getStyle(){}setStyle(n){}getBoundingClientRect(){return null}clearViewBox(n,t){}};Po.env="node",Po=Rx([Z(),Px(0,At(Ad)),Ex("design:paramtypes",[Object])],Po);const Hx=new ht(n=>{n(Po).toSelf(),n(Vd).toDynamicValue(t=>t.container.get(Po)).whenTargetNamed(Po.env)});var Lx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let hh=class extends sh{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(n,t){n.env===this.type&&(n.setActiveEnvContribution(this),this.pkg=t)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(n){const t=fetch(n).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(n){const{loadImage:t}=this.pkg;return t?t(n).then(e=>({loadState:e?"success":"fail",data:e})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(n){const t=this.pkg.Resvg;if(!t)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const e=new t(n).render().asPng();return this.loadImage(e)}createCanvas(n){return this.pkg.createCanvas(n.width,n.height)}releaseCanvas(n){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(n){return Gp.call(n)}}getCancelAnimationFrame(){return n=>{Gp.clear(n)}}addEventListener(n,t,e){}removeEventListener(n,t,e){}getElementById(n){return null}getRootElement(){return null}dispatchEvent(n){}release(...n){}createOffscreenCanvas(n){}};hh=Lx([Z()],hh);const uh=new ht(n=>{uh.isNodeBound||(uh.isNodeBound=!0,n(hh).toSelf().inSingletonScope(),n(Ja).toService(hh))});uh.isNodeBound=!1;function qs(n,t=!0){qs.__loaded||(qs.__loaded=!0,n.load(uh),n.load(Mx),n.load(Hx))}qs.__loaded=!1;function bW(){qs(container)}const nm=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...ki];class Ho extends vi{constructor(t){super(t),this.type="arc",this.numberType=Cl}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const t=X(this).arc,{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:r=t.outerPadding}=this.attribute;let{outerRadius:o=t.outerRadius,innerRadius:s=t.innerRadius}=this.attribute;if(o+=r,s-=i,e===0||e==="0%")return 0;const a=Math.abs(o-s);return Math.min(lt(e,!0)?e:a*parseFloat(e)/100,a/2)}getParsedAngle(){const t=X(this).arc;let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:r=t.cap}=this.attribute,o=i-e>=0?1:-1,s=i-e;if(e=xw(e),i=e+s,r&&kt(s)<Rt-Lt){let a=1,l=1;r.length&&(a=Number(r[0]),l=Number(r[1]));let{outerRadius:h=t.outerRadius,innerRadius:u=t.innerRadius}=this.attribute;const{outerPadding:d=t.outerPadding,innerPadding:c=t.innerPadding}=this.attribute;h+=d,u-=c;const g=Math.abs(h-u)/2,f=g/h;if(g>Lt&&h>Lt)return{startAngle:e-o*f*a,endAngle:i+o*f*l,sc:o*f*a,ec:o*f*l}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=X(this).arc,{innerPadding:r=i.innerPadding,outerPadding:o=i.outerPadding,padAngle:s=i.padAngle}=this.attribute;let{outerRadius:a=i.outerRadius,innerRadius:l=i.innerRadius}=this.attribute;a+=o,l-=r;const{padRadius:h=yi(a*a+l*l)}=this.attribute,u=kt(e-t);let d=t,c=e,g=t,f=e;const p=s/2;let v=u,m=u;if(p>Lt&&h>Lt){const C=e>t?1:-1;let b=j0(Number(h)/l*It(p)),_=j0(Number(h)/a*It(p));return(v-=2*b)>Lt?(b*=C,g+=b,f-=b):(v=0,g=f=(t+e)/2),(m-=2*_)>Lt?(_*=C,d+=_,c-=_):(m=0,d=c=(t+e)/2),{outerStartAngle:d,outerEndAngle:c,innerStartAngle:g,innerEndAngle:f,innerDeltaAngle:v,outerDeltaAngle:m}}return{outerStartAngle:d,outerEndAngle:c,innerStartAngle:g,innerEndAngle:f,innerDeltaAngle:v,outerDeltaAngle:m}}doUpdateAABBBounds(t){const e=X(this).arc;this._AABBBounds.clear();const i=this.attribute,r=$.graphicService.updateArcAABBBounds(i,X(this).arc,this._AABBBounds,t,this),{boundsPadding:o=e.boundsPadding}=i,s=Ye(o);return s&&r.expand(s),this.clearUpdateBoundTag(),r}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}needUpdateTags(t){return super.needUpdateTags(t,nm)}needUpdateTag(t){return super.needUpdateTag(t,nm)}getDefaultAttribute(t){return X(this).arc[t]}toCustomPath(){const t=this.attribute,{startAngle:e,endAngle:i}=this.getParsedAngle();let r=t.innerRadius-(t.innerPadding||0),o=t.outerRadius-(t.outerPadding||0);const s=kt(i-e),a=i>e;if(o<r){const h=o;o=r,r=h}const l=new Ke;if(o<=Lt)l.moveTo(0,0);else if(s>=Rt-Lt)l.moveTo(0+o*Ut(e),0+o*It(e)),l.arc(0,0,o,e,i,!a),r>Lt&&(l.moveTo(0+r*Ut(i),0+r*It(i)),l.arc(0,0,r,i,e,a));else{const h=o*Ut(e),u=o*It(e),d=r*Ut(i),c=r*It(i);l.moveTo(0+h,0+u),l.arc(0,0,o,e,i,!a),l.lineTo(0+d,0+c),l.arc(0,0,r,i,e,a),l.closePath()}return l}clone(){return new Ho(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ho.NOWORK_ANIMATE_ATTR}}Ho.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},fi);function Kc(n){return new Ho(n)}function kx(){ct.RegisterGraphicCreator("arc",Kc)}class Ix{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{outerBorder:g,innerBorder:f}=t.attribute,p=g&&g.visible!==!1,v=f&&f.visible!==!1;if(!p&&!v)return;const{innerPadding:m=h.innerPadding,outerPadding:C=h.outerPadding,startAngle:b=h.startAngle,endAngle:_=h.endAngle,opacity:y=h.opacity,x:w=h.x,y:S=h.y,scaleX:D=h.scaleX,scaleY:A=h.scaleY}=t.attribute;let{innerRadius:x=h.innerRadius,outerRadius:B=h.outerRadius}=t.attribute;B+=C,x-=m;const F=!(!g||!g.stroke),T=!(!f||!f.stroke);if(p){const{distance:R=h.outerBorder.distance}=g,M=si(e,R,e.dpr),E=R/B;if(t.setAttributes({outerRadius:B+M,innerRadius:x-M,startAngle:b-E,endAngle:_+E}),e.beginPath(),Xl(t,e,i,r,B+M,x-M),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,g,h.outerBorder);else if(F){const P=h.outerBorder.opacity;h.outerBorder.opacity=y,e.setStrokeStyle(t,g,(w-i)/D,(S-r)/A,h.outerBorder),h.outerBorder.opacity=P,e.stroke()}}if(v){const{distance:R=h.innerBorder.distance}=f,M=si(e,R,e.dpr),E=R/B;if(t.setAttributes({outerRadius:B-M,innerRadius:x+M,startAngle:b+E,endAngle:_-E}),e.beginPath(),Xl(t,e,i,r,B-M,x+M),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,f,h.innerBorder);else if(T){const P=h.innerBorder.opacity;h.innerBorder.opacity=y,e.setStrokeStyle(t,f,(w-i)/D,(S-r)/A,h.innerBorder),h.innerBorder.opacity=P,e.stroke()}}t.setAttributes({outerRadius:B,innerRadius:x,startAngle:b,endAngle:_})}}const Ox=new Ix,zx=Bo,Wx=Vr;var Nx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},jx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},rm=function(n,t){return function(e,i){t(e,i,n)}};let dh=class extends Si{constructor(n){super(),this.arcRenderContribitions=n,this.numberType=Cl,this.builtinContributions=[Ox,Wx,zx],this.init(n)}drawArcTailCapPath(n,t,e,i,r,o,s,a){const l=a-s,h=n.getParsedAngle(),u=h.startAngle;let d=h.endAngle;d=a;const c=kt(d-u),g=d>u;let f=!1;if(r<o){const z=r;r=o,o=z}const p=n.getParsedCornerRadius(),{outerDeltaAngle:v,innerDeltaAngle:m,outerStartAngle:C,outerEndAngle:b,innerEndAngle:_,innerStartAngle:y}=n.getParsePadAngle(u,d),w=p,S=p,D=p,A=p,x=Math.max(S,w),B=Math.max(D,A);let F=x,T=B;const R=r*Ut(C),M=r*It(C),E=o*Ut(_),P=o*It(_);let I,k,H,O;if((B>Lt||x>Lt)&&(I=r*Ut(b),k=r*It(b),H=o*Ut(y),O=o*It(y),c<Kt)){const z=wv(R,M,H,O,I,k,E,P);if(z){const j=R-z[0],U=M-z[1],W=I-z[0],V=k-z[1],L=1/It(N0((j*W+U*V)/(yi(j*j+U*U)*yi(W*W+V*V)))/2),G=yi(z[0]*z[0]+z[1]*z[1]);T=Ue(B,(o-G)/(L-1)),F=Ue(x,(r-G)/(L+1))}}if(F>Lt){const z=Ue(w,F),j=Ue(S,F),U=yr(H,O,R,M,r,z,Number(g)),W=yr(I,k,E,P,r,j,Number(g));if(F<x&&z===j)t.moveTo(e+U.cx+U.x01,i+U.cy+U.y01),t.arc(e+U.cx,i+U.cy,F,zt(U.y01,U.x01),zt(W.y01,W.x01),!g);else{const V=d-l-.03,L=zt(W.y11,W.x11);t.arc(e,i,r,V,L,!g),j>0&&t.arc(e+W.cx,i+W.cy,j,zt(W.y11,W.x11),zt(W.y01,W.x01),!g)}}else t.moveTo(e+R,i+M);if(!(o>Lt)||m<.001)t.lineTo(e+E,i+P),f=!0;else if(T>Lt){const z=Ue(A,T),j=Ue(D,T),U=yr(E,P,I,k,o,-j,Number(g)),W=yr(R,M,H,O,o,-z,Number(g));if(t.lineTo(e+U.cx+U.x01,i+U.cy+U.y01),T<B&&z===j){const V=zt(W.y01,W.x01);t.arc(e+U.cx,i+U.cy,T,zt(U.y01,U.x01),V,!g)}else{j>0&&t.arc(e+U.cx,i+U.cy,j,zt(U.y01,U.x01),zt(U.y11,U.x11),!g);const V=zt(U.cy+U.y11,U.cx+U.x11),L=d-l-.03;t.arc(e,i,o,V,L,g)}}else t.lineTo(e+o*Ut(y),i+o*It(y));return f}drawShape(n,t,e,i,r,o,s,a){const l=X(n,o==null?void 0:o.theme).arc,{fill:h=l.fill,stroke:u=l.stroke,x:d=l.x,y:c=l.y}=n.attribute,g=this.valid(n,l,s,a);if(!g)return;const{fVisible:f,sVisible:p,doFill:v,doStroke:m}=g,{outerPadding:C=l.outerPadding,innerPadding:b=l.innerPadding,cap:_=l.cap,forceShowCap:y=l.forceShowCap}=n.attribute;let{outerRadius:w=l.outerRadius,innerRadius:S=l.innerRadius}=n.attribute;w+=C,S-=b;let D=0;const A=(Li(_)&&_||_[0])&&h.gradient==="conical";if(A){const{sc:T,startAngle:R,endAngle:M}=n.getParsedAngle();kt(M-R)<Rt-Lt&&(D=T||0,h.startAngle-=D,h.endAngle-=D)}let x=!1;const{isFullStroke:B,stroke:F}=cS(u);if((v||B)&&(t.beginPath(),Xl(n,t,e,i,w,S),x=!0,t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,v,m,f,p,l,r,s,a),v&&(s?s(t,n.attribute,l):f&&(t.setCommonStyle(n,n.attribute,d-e,c-i,l),t.fill())),m&&B&&(a?a(t,n.attribute,l):p&&(t.setStrokeStyle(n,n.attribute,d-e,c-i,l),t.stroke()))),!B&&m&&(t.beginPath(),Xl(n,t,e,i,w,S,F),x||this.beforeRenderStep(n,t,e,i,v,m,f,p,l,r,s,a),a?a(t,n.attribute,l):p&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke())),(Li(_)&&_||_[1])&&y){const{startAngle:T,endAngle:R}=n.getParsedAngle();if(kt(R-T)>=Rt-Lt){t.beginPath();const M=Math.abs(w-S)/2/w,{endAngle:E=l.endAngle,fill:P=l.fill}=n.attribute,I=E;if(this.drawArcTailCapPath(n,t,e,i,w,S,I,I+M),x||this.beforeRenderStep(n,t,e,i,v,m,f,p,l,r,s,a),v){const k=P;if(k.gradient==="conical"){const H=QA(0,0,E,k);s||Nr&&(t.setCommonStyle(n,n.attribute,e,i,l),t.fillStyle=H,t.fill())}}m&&(a||p&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke()))}}this.afterRenderStep(n,t,e,i,v,m,f,p,l,r,s,a),A&&(h.startAngle+=D,h.endAngle+=D)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).arc;this._draw(n,r,!1,e,i)}};dh=Nx([Z(),rm(0,At(Le)),rm(0,Ne(Rc)),jx("design:paramtypes",[Object])],dh);let om=!1;const Vx=new ht(n=>{om||(om=!0,n(dh).toSelf().inSingletonScope(),n(Bl).to(dh).inSingletonScope(),n(We).toService(Bl),n(Rc).toService(an),Qe(n,Rc))}),hn=ih();var Gx=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Ux=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Kx=function(n,t){return function(e,i){t(e,i,n)}};let Yc=class{constructor(n){this.canvasRenderer=n,this.type="arc",this.numberType=Cl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).arc;i.highPerformanceSave();let{x:o=r.x,y:s=r.y}=n.attribute;if(n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=si(i,d+c,i.dpr),a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};Yc=Gx([Z(),Kx(0,At(Bl)),Ux("design:paramtypes",[Object])],Yc);let sm=!1;const Yx=new ht((n,t,e,i)=>{sm||(sm=!0,n(Wv).to(Yc).inSingletonScope(),n($e).toService(Wv))});var $x=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Xx=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},qx=function(n,t){return function(e,i){t(e,i,n)}};let $c=class{constructor(n){this.canvasRenderer=n,this.type="arc",this.numberType=Cl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).arc;i.highPerformanceSave();let{x:o=r.x,y:s=r.y}=n.attribute;if(n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=d+c,a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};$c=$x([Z(),qx(0,At(Bl)),Xx("design:paramtypes",[Object])],$c);let am=!1;const Zx=new ht((n,t,e,i)=>{am||(am=!0,n(Mv).to($c).inSingletonScope(),n(tr).toService(Mv))});function ch(){ch.__loaded||(ch.__loaded=!0,kx(),pt.load(Vx),pt.load(hn?Yx:Zx))}ch.__loaded=!1;const Jx=ch;class gh extends Ho{constructor(t){super(t),this.type="arc3d",this.numberType=Fs}doUpdateAABBBounds(){const t=X(this).arc;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateArc3dAABBBounds(e,X(this).polygon,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),this._AABBBounds}getNoWorkAnimateAttr(){return gh.NOWORK_ANIMATE_ATTR}}gh.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},fi);function Qx(n){return new gh(n)}function tB(){ct.RegisterGraphicCreator("arc3d",Qx)}var eB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};function iB(n,t,e,i,r,o,s){const{startAngle:a,endAngle:l}=n.getParsedAngle(),h=kt(l-a),u=l>a;let d=!1;if(o<s){const c=o;o=s,s=c}if(o<=Lt)t.moveTo(e,i,r);else if(h>=Rt-Lt)t.moveTo(e+o*Ut(a),i+o*It(a),r),t.arc(e,i,o,a,l,!u,r),s>Lt&&(t.moveTo(e+s*Ut(l),i+s*It(l),r),t.arc(e,i,s,l,a,u,r));else{const{outerDeltaAngle:c,innerDeltaAngle:g,outerStartAngle:f,outerEndAngle:p,innerEndAngle:v,innerStartAngle:m}=n.getParsePadAngle(a,l),C=o*Ut(f),b=o*It(f),_=s*Ut(v),y=s*It(v);c<.001?d=!0:(t.moveTo(e+C,i+b,r),t.arc(e,i,o,f,p,!u,r)),!(s>Lt)||g<.001?(t.lineTo(e+_,i+y,r),d=!0):(t.lineTo(e+_,i+y,r),t.arc(e,i,s,v,m,u,r))}return t.closePath(),d}function nB(n,t,e,i,r,o,s,a){const{startAngle:l,endAngle:h}=n.getParsedAngle(),u=kt(h-l),d=h>l;let c=!1;if(s<=Lt)t.moveTo(e,i,r);else if(u>=Rt-Lt)t.moveTo(e+s*Ut(l),i+s*It(l),r),t.arc(e,i,s,l,h,!d,r),t.lineTo(e+s*Ut(h),i+s*It(h),o),t.arc(e,i,s,h,l,d,o);else{const{innerouterDeltaAngle:g,innerouterStartAngle:f,innerouterEndAngle:p}=a(l,h),v=s*Ut(f),m=s*It(f),C=s*Ut(p),b=s*It(p);g<.001?c=!0:(t.moveTo(e+v,i+m,r),t.arc(e,i,s,f,p,!d,r),t.lineTo(e+C,i+b,o),t.arc(e,i,s,p,f,d,o))}return t.closePath(),c}let Xc=class extends Si{constructor(){super(...arguments),this.numberType=Fs}drawShape(n,t,e,i,r,o,s,a){var l;const h=X(n,o==null?void 0:o.theme).arc,{fill:u=h.fill}=n.attribute,d=this.valid(n,h,s,a);if(!d)return;const{fVisible:c,sVisible:g,doFill:f,doStroke:p}=d,v=(l=this.z)!==null&&l!==void 0?l:0,{outerPadding:m=h.outerPadding,innerPadding:C=h.innerPadding,height:b=10}=n.attribute;let{outerRadius:_=h.outerRadius,innerRadius:y=h.innerRadius}=n.attribute;_+=m,y-=C;const w=Ce.Get(u,Mi.Color255),{light:S}=r.stage||{},D=r.hack_pieFace,A={top:v,bottom:v+b},x={top:[0,1,0],bottom:[0,-1,0],outside:[1,0,-1],inside:[1,0,-1]};D==="bottom"||D==="top"?(t.beginPath(),iB(n,t,e,i,A[D],_,y),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),f&&(s?s(t,n.attribute,h):c&&(t.setCommonStyle(n,n.attribute,e,i,h),t.fillStyle=S?S.computeColor(x[D],w):u,t.fill())),p&&(a?a(t,n.attribute,h):g&&(t.setStrokeStyle(n,n.attribute,e,i,h),t.stroke()))):D!=="outside"&&D!=="inside"||(D==="inside"&&(t.save(),t.beginPath(),t.arc(e,i,y,0,Rt,!0,A.top),t.clip()),t.beginPath(),nB(n,t,e,i,A.top,A.bottom,D==="outside"?_:y,(B,F)=>{const{outerDeltaAngle:T,innerDeltaAngle:R,outerStartAngle:M,outerEndAngle:E,innerEndAngle:P,innerStartAngle:I}=n.getParsePadAngle(B,F);return D==="outside"?{innerouterDeltaAngle:T,innerouterEndAngle:E,innerouterStartAngle:M}:{innerouterDeltaAngle:R,innerouterEndAngle:P,innerouterStartAngle:I}}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),f&&(s?s(t,n.attribute,h):c&&(t.setCommonStyle(n,n.attribute,e,i,h),t.fillStyle=S?S.computeColor(x[D],w):u,t.fill())),p&&(a?a(t,n.attribute,h):g&&(t.setStrokeStyle(n,n.attribute,e,i,h),t.stroke())),D==="inside"&&t.restore())}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).arc;this._draw(n,r,!1,e,i)}};Xc=eB([Z()],Xc);let lm=!1;const rB=new ht(n=>{lm||(lm=!0,n(lc).to(Xc).inSingletonScope(),n(We).toService(lc))});var oB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let er=class extends Si{};er=oB([Z()],er);var sB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},aB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},lB=function(n,t){return function(e,i){t(e,i,n)}};let qc=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="arc3d",this.numberType=Fs}contains(n,t,e){const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).arc;i.highPerformanceSave();const o=this.transform(n,r,i),{x:s,y:a,z:l,lastModelMatrix:h}=o;let u=t;if(i.camera){u=t.clone();const c=n.parent.globalTransMatrix;u.x=c.a*t.x+c.c*t.y+c.e,u.y=c.b*t.x+c.d*t.y+c.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(n,i,s,a,e,null,(c,g,f)=>!!d||(d=c.isPointInPath(u.x,u.y),d)),this.canvasRenderer.z=0,i.modelMatrix!==h&&ie.free(i.modelMatrix),i.modelMatrix=h,i.highPerformanceRestore(),d}};qc=sB([Z(),lB(0,At(lc)),aB("design:paramtypes",[Object])],qc);let hm=!1;const hB=new ht((n,t,e,i)=>{hm||(hm=!0,n(Nv).to(qc).inSingletonScope(),n($e).toService(Nv))});function fh(){fh.__loaded||(fh.__loaded=!0,tB(),pt.load(rB),pt.load(hB))}fh.__loaded=!1;const uB=fh,um=["segments","points","curveType",...ki];class Zs extends vi{constructor(t){super(t),this.type="area",this.numberType=Ts}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&t.length!==0}doUpdateAABBBounds(){const t=X(this).area;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateAreaAABBBounds(e,X(this).area,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}_interpolate(t,e,i,r,o){t==="points"&&(o.points=ec(i,r,e))}getDefaultAttribute(t){return X(this).area[t]}needUpdateTags(t){return super.needUpdateTags(t,um)}needUpdateTag(t){return super.needUpdateTag(t,um)}toCustomPath(){const t=new Ke,e=this.attribute,i=e.segments,r=o=>{if(o&&o.length){let s=!0;const a=[];if(o.forEach(l=>{var h,u;l.defined!==!1&&(s?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y),a.push({x:(h=l.x1)!==null&&h!==void 0?h:l.x,y:(u=l.y1)!==null&&u!==void 0?u:l.y}),s=!1)}),a.length){for(let l=a.length-1;l>=0;l--)t.lineTo(a[l].x,a[l].y);t.closePath()}}};return e.points?r(e.points):i&&i.length&&i.forEach(o=>{r(o.points)}),t}clone(){return new Zs(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Zs.NOWORK_ANIMATE_ATTR}}Zs.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},fi);function dB(n){return new Zs(n)}function cB(){ct.RegisterGraphicCreator("area",dB)}let dm=!1;const gB=new ht(n=>{dm||(dm=!0,n(js).toSelf().inSingletonScope(),n(Fl).to(js).inSingletonScope(),n(We).toService(Fl),n(Ec).toService(an),Qe(n,Ec),n(eh).toSelf().inSingletonScope())});var fB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},pB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},vB=function(n,t){return function(e,i){t(e,i,n)}};let Zc=class{constructor(n){this.canvasRenderer=n,this.type="area",this.numberType=Ts}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).area;let{x:o=r.x,y:s=r.y}=n.attribute;const{fillPickable:a=r.fillPickable,strokePickable:l=r.strokePickable}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const u=n.getOffsetXY(r);o+=u.x,s+=u.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let h=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,u=>!!h||!!a&&(h=u.isPointInPath(t.x,t.y),h),(u,d,c)=>{if(h)return!0;if(!l)return!1;const g=d.lineWidth||c.lineWidth,f=d.pickStrokeBuffer||c.pickStrokeBuffer;return i.lineWidth=si(i,g+f,i.dpr),h=u.isPointInStroke(t.x,t.y),h}),i.highPerformanceRestore(),h}};Zc=fB([Z(),vB(0,At(Fl)),pB("design:paramtypes",[Object])],Zc);let cm=!1;const mB=new ht((n,t,e,i)=>{cm||(cm=!0,n(jv).to(Zc).inSingletonScope(),n($e).toService(jv))});var CB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},bB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},_B=function(n,t){return function(e,i){t(e,i,n)}};let Jc=class{constructor(n){this.canvasRenderer=n,this.type="area",this.numberType=Ts}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).area;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,l=>!!a||(a=l.isPointInPath(t.x,t.y),a)),i.highPerformanceRestore(),a}};Jc=CB([Z(),_B(0,At(Fl)),bB("design:paramtypes",[Object])],Jc);let gm=!1;const yB=new ht((n,t,e,i)=>{gm||(gm=!0,n(Rv).to(Jc).inSingletonScope(),n(tr).toService(Rv))});function ph(){ph.__loaded||(ph.__loaded=!0,cB(),pt.load(gB),pt.load(hn?mB:yB))}ph.__loaded=!1;const wB=ph,fm=["radius","startAngle","endAngle",...ki];class Js extends vi{constructor(t={radius:1}){super(t),this.type="circle",this.numberType=bl}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}doUpdateAABBBounds(t){const e=X(this).circle;this._AABBBounds.clear();const i=this.attribute,r=$.graphicService.updateCircleAABBBounds(i,X(this).circle,this._AABBBounds,t,this),{boundsPadding:o=e.boundsPadding}=i,s=Ye(o);return s&&r.expand(s),this.clearUpdateBoundTag(),r}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return X(this).circle[t]}needUpdateTags(t){return super.needUpdateTags(t,fm)}needUpdateTag(t){return super.needUpdateTag(t,fm)}toCustomPath(){var t,e,i;const r=this.attribute,o=(t=r.radius)!==null&&t!==void 0?t:this.getDefaultAttribute("radius"),s=(e=r.startAngle)!==null&&e!==void 0?e:this.getDefaultAttribute("startAngle"),a=(i=r.endAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("endAngle"),l=new Ke;return l.arc(0,0,o,s,a),l}clone(){return new Js(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Js.NOWORK_ANIMATE_ATTR}}Js.NOWORK_ANIMATE_ATTR=fi;function pm(n){return new Js(n)}function DB(){ct.RegisterGraphicCreator("circle",pm)}class SB{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{outerBorder:g,innerBorder:f}=t.attribute,p=g&&g.visible!==!1,v=f&&f.visible!==!1;if(!p&&!v)return;const{radius:m=h.radius,startAngle:C=h.startAngle,endAngle:b=h.endAngle,opacity:_=h.opacity,x:y=h.x,y:w=h.y,scaleX:S=h.scaleX,scaleY:D=h.scaleY}=t.attribute,A=!(!g||!g.stroke),x=!(!f||!f.stroke);if(p){const{distance:B=h.outerBorder.distance}=g,F=si(e,B,e.dpr);if(e.beginPath(),e.arc(i,r,m+F,C,b),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,g,h.outerBorder);else if(A){const T=h.outerBorder.opacity;h.outerBorder.opacity=_,e.setStrokeStyle(t,g,(y-i)/S,(w-r)/D,h.outerBorder),h.outerBorder.opacity=T,e.stroke()}}if(v){const{distance:B=h.innerBorder.distance}=f,F=si(e,B,e.dpr);if(e.beginPath(),e.arc(i,r,m-F,C,b),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,f,h.innerBorder);else if(x){const T=h.innerBorder.opacity;h.innerBorder.opacity=_,e.setStrokeStyle(t,f,(y-i)/S,(w-r)/D,h.innerBorder),h.innerBorder.opacity=T,e.stroke()}}}}const AB=new SB,xB=Bo,BB=Vr;var FB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},TB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},vm=function(n,t){return function(e,i){t(e,i,n)}};let vh=class extends Si{constructor(n){super(),this.circleRenderContribitions=n,this.numberType=bl,this.builtinContributions=[AB,BB,xB],this.init(n)}drawShape(n,t,e,i,r,o,s,a){const l=X(n,o==null?void 0:o.theme).circle,{radius:h=l.radius,startAngle:u=l.startAngle,endAngle:d=l.endAngle,x:c=l.x,y:g=l.y}=n.attribute,f=this.valid(n,l,s,a);if(!f)return;const{fVisible:p,sVisible:v,doFill:m,doStroke:C}=f;t.beginPath(),t.arc(e,i,h,u,d),t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,m,C,p,v,l,r,s,a),m&&(s?s(t,n.attribute,l):p&&(t.setCommonStyle(n,n.attribute,c-e,g-i,l),t.fill())),C&&(a?a(t,n.attribute,l):v&&(t.setStrokeStyle(n,n.attribute,c-e,g-i,l),t.stroke())),this.afterRenderStep(n,t,e,i,m,C,p,v,l,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).circle;this._draw(n,r,!1,e,i)}};vh=FB([Z(),vm(0,At(Le)),vm(0,Ne(Pc)),TB("design:paramtypes",[Object])],vh);let mm=!1;const MB=new ht(n=>{mm||(mm=!0,n(vh).toSelf().inSingletonScope(),n(Tl).to(vh).inSingletonScope(),n(We).toService(Tl),n(Pc).toService(an),Qe(n,Pc))});var RB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},EB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},PB=function(n,t){return function(e,i){t(e,i,n)}};let Qc=class{constructor(n){this.canvasRenderer=n,this.type="circle",this.numberType=bl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).circle;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=si(i,d+c,i.dpr),a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};Qc=RB([Z(),PB(0,At(Tl)),EB("design:paramtypes",[Object])],Qc);let Cm=!1;const HB=new ht((n,t,e,i)=>{Cm||(Cm=!0,n(Vv).to(Qc).inSingletonScope(),n($e).toService(Vv))});var LB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},kB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},IB=function(n,t){return function(e,i){t(e,i,n)}};let tg=class{constructor(n){this.canvasRenderer=n,this.type="circle",this.numberType=bl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).circle;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=d+c,a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};tg=LB([Z(),IB(0,At(Tl)),kB("design:paramtypes",[Object])],tg);let bm=!1;const OB=new ht((n,t,e,i)=>{bm||(bm=!0,n(Ev).to(tg).inSingletonScope(),n(tr).toService(Ev))});function mh(){mh.__loaded||(mh.__loaded=!0,DB(),pt.load(MB),pt.load(hn?HB:OB))}mh.__loaded=!1;const zB=mh;class Qs extends vi{constructor(t){super(t),this.type="glyph",this.numberType=_l,this.subGraphic=[],this._onInit&&this._onInit(this),this.valid=this.isValid()}setSubGraphic(t){this.detachSubGraphic(),this.subGraphic=t,t.forEach(e=>{e.glyphHost=this,Object.setPrototypeOf(e.attribute,this.attribute)}),this.valid=this.isValid(),this.addUpdateBoundTag()}detachSubGraphic(){this.subGraphic.forEach(t=>{t.glyphHost=null,Object.setPrototypeOf(t.attribute,{})})}getSubGraphic(){return this.subGraphic}onInit(t){this._onInit=t}onUpdate(t){this._onUpdate=t}isValid(){return!0}setAttribute(t,e,i,r){super.setAttribute(t,e,i,r),this.subGraphic.forEach(o=>{o.addUpdateShapeAndBoundsTag(),o.addUpdatePositionTag()})}setAttributes(t,e=!1,i){super.setAttributes(t,e,i),this.subGraphic.forEach(r=>{r.addUpdateShapeAndBoundsTag(),r.addUpdatePositionTag()})}translate(t,e){return super.translate(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}translateTo(t,e){return super.translateTo(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}scale(t,e,i){return super.scale(t,e,i),this.subGraphic.forEach(r=>{r.addUpdatePositionTag(),r.addUpdateBoundTag()}),this}scaleTo(t,e){return super.scaleTo(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}rotate(t){return super.rotate(t),this.subGraphic.forEach(e=>{e.addUpdatePositionTag(),e.addUpdateBoundTag()}),this}rotateTo(t){return super.rotate(t),this.subGraphic.forEach(e=>{e.addUpdatePositionTag(),e.addUpdateBoundTag()}),this}doUpdateAABBBounds(){this._AABBBounds.clear();const t=$.graphicService.updateGlyphAABBBounds(this.attribute,X(this).glyph,this._AABBBounds,this);return this.clearUpdateBoundTag(),t}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}needUpdateTags(t){return!1}needUpdateTag(t){return!1}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((s,a)=>this.currentStates[a]!==s)))return;const r={},o=this.subGraphic.map(()=>({}));t.forEach(s=>{var a;const l=this.glyphStateProxy?this.glyphStateProxy(s,t):this.glyphStates[s];l&&(Object.assign(r,l.attributes),!((a=l.subAttributes)===null||a===void 0)&&a.length&&o.forEach((h,u)=>{Object.assign(h,l.subAttributes[u])}))}),this.subGraphic.forEach((s,a)=>{s.updateNormalAttrs(o[a]),s.applyStateAttrs(o[a],t,e)}),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}clearStates(t){this.hasState()&&this.normalAttrs&&(this.subGraphic.forEach(e=>{e.applyStateAttrs(e.normalAttrs,this.currentStates,t,!0),e.normalAttrs=null}),this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0),this.normalAttrs=null,this.currentStates=[])}clone(){const t=new Qs(Object.assign({},this.attribute));return t.setSubGraphic(this.subGraphic.map(e=>e.clone())),t}getNoWorkAnimateAttr(){return Qs.NOWORK_ANIMATE_ATTR}}Qs.NOWORK_ANIMATE_ATTR=fi;function WB(n){return new Qs(n)}function NB(){ct.RegisterGraphicCreator("glyph",WB)}var jB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let eg=class{constructor(){this.numberType=_l}drawShape(n,t,e,i,r,o,s,a){r.drawContribution&&n.getSubGraphic().forEach(l=>{const h=r.drawContribution.getRenderContribution(l);h&&h.drawShape&&h.drawShape(l,t,e,i,r,o,s,a)})}draw(n,t,e,i){const{context:r}=e;if(!r||(r.highPerformanceSave(),!e.drawContribution))return;const o=X(n),s=n.getSubGraphic();s.length&&s.forEach(a=>{e.drawContribution.renderItem(a,e,{theme:o})}),r.highPerformanceRestore()}};eg=jB([Z()],eg);let _m=!1;const VB=new ht(n=>{_m||(_m=!0,n(Ll).to(eg).inSingletonScope(),n(We).toService(Ll))});var GB=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},UB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},KB=function(n,t){return function(e,i){t(e,i,n)}};let ig=class{constructor(n){this.canvasRenderer=n,this.type="glyph",this.numberType=_l}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=e==null?void 0:e.pickerService;if(r){let o=!1;return n.getSubGraphic().forEach(s=>{if(o)return;const a=r.pickItem(s,t,null,e);o=!(!a||!a.graphic)}),o}return!1}};ig=GB([Z(),KB(0,At(Ll)),UB("design:paramtypes",[Object])],ig);let ym=!1;const YB=new ht((n,t,e,i)=>{ym||(ym=!0,n(tm).to(ig).inSingletonScope(),n($e).toService(tm))});var $B=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},XB=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},qB=function(n,t){return function(e,i){t(e,i,n)}};let Ch=class{constructor(n){this.canvasRenderer=n,this.type="glyph",this.numberType=_l}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=e==null?void 0:e.pickerService;if(r){let o=!1;return n.getSubGraphic().forEach(s=>{o||(o=!!r.pickItem(s,t,null,e))}),o}return!1}};Ch=$B([Z(),qB(0,At(Ll)),XB("design:paramtypes",[Object])],Ch);let wm=!1;const ZB=new ht((n,t,e,i)=>{wm||(wm=!0,n(zv).to(Ch).inSingletonScope(),n(Ch).toService(zv))});function bh(){bh.__loaded||(bh.__loaded=!0,NB(),pt.load(VB),pt.load(hn?YB:ZB))}bh.__loaded=!1;const JB=bh;function QB(){ct.RegisterGraphicCreator("group",sc)}function _h(){_h.__loaded||(_h.__loaded=!0,QB())}_h.__loaded=!1;const Dn=_h,Dm=["width","height","image",...ki];class ir extends vi{constructor(t){super(t),this.type="image",this.numberType=yl,this.loadImage(this.attribute.image)}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:0}set width(t){this.attribute.width===t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:0}set height(t){this.attribute.height===t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get repeatX(){var t;return(t=this.attribute.repeatX)!==null&&t!==void 0?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return(t=this.attribute.repeatY)!==null&&t!==void 0?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,()=>{this.successCallback&&this.successCallback()})}imageLoadFail(t,e){super.imageLoadFail(t,()=>{this.failCallback&&this.failCallback()})}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,r){return t==="image"&&this.loadImage(e),super.setAttribute(t,e,i,r)}doUpdateAABBBounds(){const t=X(this).image;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateImageAABBBounds(e,X(this).image,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return Cs[t]}needUpdateTags(t){return super.needUpdateTags(t,Dm)}needUpdateTag(t){return super.needUpdateTag(t,Dm)}clone(){return new ir(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ir.NOWORK_ANIMATE_ATTR}}ir.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},fi);function yh(n){return new ir(n)}function t2(){ct.RegisterGraphicCreator("image",yh)}class e2 extends Ws{constructor(){super(...arguments),this.time=Nt.beforeFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{background:g,backgroundMode:f=h.backgroundMode,backgroundFit:p=h.backgroundFit}=t.attribute;if(g)if(t.backgroundImg){const v=t.resources.get(g);if(v.state!=="success"||!v.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const C=X(t.parent).group,{scrollX:b=C.scrollX,scrollY:_=C.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(b,_)}const m=t.AABBBounds;this.doDrawImage(e,v.data,m,f,p),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else if(ye(g)){const{stroke:v,fill:m,lineWidth:C=1,cornerRadius:b=0,expandX:_=0,expandY:y=0}=g;if(!v&&!m)return;e.beginPath();const{x:w,y:S,width:D,height:A}=i2(t);b?Qn(e,w-_,S-y,D+2*_,A+2*y,b):e.rect(w-_,S-y,D+2*_,A+2*y),e.globalAlpha=1,m&&(e.fillStyle=m,e.fill()),v&&C>0&&(e.lineWidth=C,e.strokeStyle=v,e.stroke())}else{e.beginPath();const v=t.AABBBounds;e.rect(i,r,v.width(),v.height()),e.fillStyle=g,e.globalAlpha=1,e.fill()}}}function i2(n){const t=Ye(n.attribute.boundsPadding),e=n.AABBBounds;let i=e.x1,r=e.y1,o=e.width(),s=e.height();return lt(t)?(i+=t,r+=t,o-=2*t,s-=2*t):(i+=t[3],r+=t[0],o-=t[1]+t[3],s-=t[0]+t[2]),{x:i,y:r,width:o,height:s}}const n2=new e2;var r2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},o2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Sm=function(n,t){return function(e,i){t(e,i,n)}};const s2=["","repeat-x","repeat-y","repeat"];let ng=class extends Si{constructor(n){super(),this.imageRenderContribitions=n,this.numberType=yl,this.builtinContributions=[n2],this.init(n)}drawShape(n,t,e,i,r,o,s){const a=X(n).image,{width:l=a.width,height:h=a.height,repeatX:u=a.repeatX,repeatY:d=a.repeatY,cornerRadius:c=a.cornerRadius,image:g}=n.attribute,f=this.valid(n,a,s);if(!f)return;const{fVisible:p,sVisible:v,doFill:m,doStroke:C}=f;if(t.setShadowBlendStyle&&t.setShadowBlendStyle(n,a),this.beforeRenderStep(n,t,e,i,m,!1,p,!1,a,r,s),m){if(s)s(t,n.attribute,a);else if(p){if(!g||!n.resources)return;const b=n.resources.get(g);if(b.state!=="success")return;let _=!1;c===0||rt(c)&&c.every(w=>w===0)||(t.beginPath(),Qn(t,e,i,l,h,c),t.save(),t.clip(),_=!0),t.setCommonStyle(n,n.attribute,e,i,a);let y=0;if(u==="repeat"&&(y|=1),d==="repeat"&&(y|=2),y){const w=t.createPattern(b.data,s2[y]);t.fillStyle=w,t.translate(e,i,!0),t.fillRect(0,0,l,h),t.translate(-e,-i,!0)}else t.drawImage(b.data,e,i,l,h);_&&t.restore()}}this.afterRenderStep(n,t,e,i,m,!1,p,!1,a,r,s)}draw(n,t,e){const{image:i}=n.attribute;if(!i||!n.resources)return;const r=n.resources.get(i);if(r.state==="loading"&&ue(i))return void ee.improveImageLoading(i);if(r.state!=="success")return;const{context:o}=t.drawParams;if(!o)return;const s=X(n).image;this._draw(n,s,!1,e)}};ng=r2([Z(),Sm(0,At(Le)),Sm(0,Ne(zs)),o2("design:paramtypes",[Object])],ng);let Am=!1;const a2=new ht(n=>{Am||(Am=!0,n(sv).to(ng).inSingletonScope(),n(We).toService(sv),n(zs).toService(an),Qe(n,zs))});var l2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let rg=class{constructor(){this.type="image",this.numberType=yl}contains(n,t,e){const{pickContext:i}=e!=null?e:{};return!!i&&!!n.AABBBounds.containsPoint(t)}};rg=l2([Z()],rg);let xm=!1;const h2=new ht((n,t,e,i)=>{xm||(xm=!0,n(Gv).to(rg).inSingletonScope(),n($e).toService(Gv))});var u2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Lo=class{constructor(){this.type="image",this.numberType=yl}contains(n,t,e){const{pickContext:i}=e!=null?e:{};return!!i&&!!n.AABBBounds.containsPoint(t)}};Lo=u2([Z()],Lo);let Bm=!1;const d2=new ht((n,t,e,i)=>{Bm||(Bm=!0,n(nh).to(Lo).inSingletonScope(),n(Lo).toService(nh))});function wh(){wh.__loaded||(wh.__loaded=!0,t2(),pt.load(a2),pt.load(hn?h2:d2))}wh.__loaded=!1;const Fm=wh,Tm=["segments","points","curveType",...ki];class ta extends vi{constructor(t={}){super(t),this.type="line",this.numberType=Ms}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&!(t.length<=1)}_interpolate(t,e,i,r,o){t==="points"&&(o.points=ec(i,r,e))}doUpdateAABBBounds(){const t=X(this).line;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateLineAABBBounds(e,X(this).line,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return X(this).line[t]}needUpdateTags(t){return super.needUpdateTags(t,Tm)}needUpdateTag(t){return super.needUpdateTag(t,Tm)}toCustomPath(){const t=this.attribute,e=new Ke,i=t.segments,r=o=>{if(o&&o.length){let s=!0;o.forEach(a=>{a.defined!==!1&&(s?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y),s=!1)})}};return i&&i.length?i.forEach(o=>{r(o.points)}):t.points&&r(t.points),e}clone(){return new ta(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ta.NOWORK_ANIMATE_ATTR}}ta.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},fi);function Sn(n){return new ta(n)}function c2(){ct.RegisterGraphicCreator("line",Sn)}let Mm=!1;const g2=new ht(n=>{Mm||(Mm=!0,n(Ns).toSelf().inSingletonScope(),n(Jl).toSelf().inSingletonScope(),n(Ml).to(Ns).inSingletonScope(),n(We).toService(Ml))});var f2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},p2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},v2=function(n,t){return function(e,i){t(e,i,n)}};let og=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=Ms}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;i.highPerformanceSave();const r=X(n).line,o=this.transform(n,r,i),{x:s,y:a,z:l,lastModelMatrix:h}=o;let u=t;if(i.camera){u=t.clone();const c=n.parent.globalTransMatrix;u.x=c.a*t.x+c.c*t.y+c.e,u.y=c.b*t.x+c.d*t.y+c.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(n,i,s,a,{},null,c=>!!d||(d=c.isPointInPath(u.x,u.y),d),(c,g,f)=>{if(d)return!0;const p=g.lineWidth||f.lineWidth,v=g.pickStrokeBuffer||f.pickStrokeBuffer;return i.lineWidth=si(i,p+v,i.dpr),d=c.isPointInStroke(u.x,u.y),d}),this.canvasRenderer.z=0,i.modelMatrix!==h&&ie.free(i.modelMatrix),i.modelMatrix=h,i.highPerformanceRestore(),d}};og=f2([Z(),v2(0,At(Ml)),p2("design:paramtypes",[Object])],og);let Rm=!1;const m2=new ht((n,t,e,i)=>{Rm||(Rm=!0,n(Uv).to(og).inSingletonScope(),n($e).toService(Uv))});var C2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},b2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},_2=function(n,t){return function(e,i){t(e,i,n)}};let sg=class{constructor(n){this.canvasRenderer=n,this.type="line",this.numberType=Ms}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).line;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,l=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=d+c,a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};sg=C2([Z(),_2(0,At(Ml)),b2("design:paramtypes",[Object])],sg);let Em=!1;const y2=new ht((n,t,e,i)=>{Em||(Em=!0,n(Pv).to(sg).inSingletonScope(),n(tr).toService(Pv))});function Dh(){Dh.__loaded||(Dh.__loaded=!0,c2(),pt.load(g2),pt.load(hn?m2:y2))}Dh.__loaded=!1;const ag=Dh,Pm=["path","customPath",...ki];class ea extends vi{constructor(t){super(t),this.type="path",this.numberType=wl}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return t!=null&&t!==""}getParsedPathShape(){const t=X(this).path;if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof Ke?e.path:(ut(this.cache)&&this.doUpdatePathShape(),this.cache instanceof Ke?this.cache:t.path)}doUpdateAABBBounds(){const t=X(this).path;this.doUpdatePathShape(),this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updatePathAABBBounds(e,X(this).path,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}doUpdatePathShape(){const t=this.attribute;ue(t.path,!0)?this.cache=new Ke().fromString(t.path):t.customPath&&(this.cache=new Ke,t.customPath(this.cache,this))}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return X(this).path[t]}needUpdateTags(t){return super.needUpdateTags(t,Pm)}needUpdateTag(t){return super.needUpdateTag(t,Pm)}toCustomPath(){return new Ke().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new ea(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ea.NOWORK_ANIMATE_ATTR}}ea.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},fi);function w2(n){return new ea(n)}function D2(){ct.RegisterGraphicCreator("path",w2)}const S2=Bo,A2=Vr;var x2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},B2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Hm=function(n,t){return function(e,i){t(e,i,n)}};let Sh=class extends Si{constructor(n){super(),this.pathRenderContribitions=n,this.numberType=wl,this.builtinContributions=[A2,S2],this.init(n)}drawShape(n,t,e,i,r,o,s,a){var l,h,u;const d=(l=this.tempTheme)!==null&&l!==void 0?l:X(n,o==null?void 0:o.theme).path,{x:c=d.x,y:g=d.y}=n.attribute,f=(h=this.z)!==null&&h!==void 0?h:0,p=this.valid(n,d,s,a);if(!p)return;const{fVisible:v,sVisible:m,doFill:C,doStroke:b}=p;if(t.beginPath(),n.pathShape)Yn(n.pathShape.commandList,t,e,i,1,1,f);else{const _=(u=n.attribute.path)!==null&&u!==void 0?u:d.path;Yn(_.commandList,t,e,i,1,1,f)}t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,d),this.beforeRenderStep(n,t,e,i,C,b,v,m,d,r,s,a),b&&(a?a(t,n.attribute,d):m&&(t.setStrokeStyle(n,n.attribute,c-e,g-i,d),t.stroke())),C&&(s?s(t,n.attribute,d):v&&(t.setCommonStyle(n,n.attribute,c-e,g-i,d),t.fill())),this.afterRenderStep(n,t,e,i,C,b,v,m,d,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).path;this.tempTheme=r,this._draw(n,r,!1,e,i),this.tempTheme=null}};Sh=x2([Z(),Hm(0,At(Le)),Hm(0,Ne(Hc)),B2("design:paramtypes",[Object])],Sh);let Lm=!1;const F2=new ht(n=>{Lm||(Lm=!0,n(Sh).toSelf().inSingletonScope(),n(Rl).to(Sh).inSingletonScope(),n(We).toService(Rl),n(Hc).toService(an),Qe(n,Hc))});var T2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},M2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},R2=function(n,t){return function(e,i){t(e,i,n)}};let lg=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=wl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).path;i.highPerformanceSave();const o=this.transform(n,r,i),{x:s,y:a,z:l,lastModelMatrix:h}=o;let u=t;if(i.camera){u=t.clone();const c=n.parent.globalTransMatrix;u.x=c.a*t.x+c.c*t.y+c.e,u.y=c.b*t.x+c.d*t.y+c.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(n,i,s,a,{},null,(c,g,f)=>!!d||(d=c.isPointInPath(u.x,u.y),d),(c,g,f)=>{if(d)return!0;const p=g.lineWidth||f.lineWidth,v=g.pickStrokeBuffer||f.pickStrokeBuffer;return i.lineWidth=si(i,p+v,i.dpr),d=c.isPointInStroke(u.x,u.y),d}),this.canvasRenderer.z=0,i.modelMatrix!==h&&ie.free(i.modelMatrix),i.modelMatrix=h,i.highPerformanceRestore(),d}};lg=T2([Z(),R2(0,At(Rl)),M2("design:paramtypes",[Object])],lg);let km=!1;const E2=new ht((n,t,e,i)=>{km||(km=!0,n(Kv).to(lg).inSingletonScope(),n($e).toService(Kv))});var P2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},H2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},L2=function(n,t){return function(e,i){t(e,i,n)}};let hg=class{constructor(n){this.canvasRenderer=n,this.type="path",this.numberType=wl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).path;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=d+c,a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};hg=P2([Z(),L2(0,At(Rl)),H2("design:paramtypes",[Object])],hg);let Im=!1;const k2=new ht((n,t,e,i)=>{Im||(Im=!0,n(Hv).to(hg).inSingletonScope(),n(tr).toService(Hv))});function Ah(){Ah.__loaded||(Ah.__loaded=!0,D2(),pt.load(F2),pt.load(hn?E2:k2))}Ah.__loaded=!1;const Om=Ah,zm=["points","cornerRadius",...ki];class ko extends vi{constructor(t){super(t),this.type="polygon",this.numberType=Dl}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}doUpdateAABBBounds(){const t=X(this).polygon;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updatePolygonAABBBounds(e,X(this).polygon,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),this._AABBBounds}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}_interpolate(t,e,i,r,o){t==="points"&&(o.points=ec(i,r,e))}getDefaultAttribute(t){return X(this).polygon[t]}needUpdateTags(t){return super.needUpdateTags(t,zm)}needUpdateTag(t){return super.needUpdateTag(t,zm)}toCustomPath(){const t=this.attribute.points,e=new Ke;return t.forEach((i,r)=>{r===0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)}),e.closePath(),e}clone(){return new ko(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ko.NOWORK_ANIMATE_ATTR}}ko.NOWORK_ANIMATE_ATTR=fi;function I2(n){return new ko(n)}function O2(){ct.RegisterGraphicCreator("polygon",I2)}function Wm(n,t,e,i){n.moveTo(t[0].x+e,t[0].y+i);for(let r=1;r<t.length;r++)n.lineTo(t[r].x+e,t[r].y+i)}function z2(n,t,e,i,r,o=!0){var s;if(t.length<3)return void Wm(n,t,e,i);let a=0,l=t.length-1;o||(a+=1,l-=1,n.moveTo(t[0].x+e,t[0].y+i));for(let h=a;h<=l;h++){const u=t[h===0?l:(h-1)%t.length],d=t[h%t.length],c=t[(h+1)%t.length],g=d.x-u.x,f=d.y-u.y,p=d.x-c.x,v=d.y-c.y,m=(Math.atan2(f,g)-Math.atan2(v,p))/2,C=Math.abs(Math.tan(m));let b=Array.isArray(r)?(s=r[h%t.length])!==null&&s!==void 0?s:0:r,_=b/C;const y=xh(g,f),w=xh(p,v),S=Math.min(y,w);_>S&&(_=S,b=S*C);const D=ug(d,_,y,g,f),A=ug(d,_,w,p,v),x=2*d.x-D.x-A.x,B=2*d.y-D.y-A.y,F=xh(x,B),T=ug(d,xh(_,b),F,x,B);let R=Math.atan2(D.y-T.y,D.x-T.x);const M=Math.atan2(A.y-T.y,A.x-T.x);let E=M-R;E<0&&(R=M,E=-E),E>Math.PI&&(E-=Math.PI),h===0?n.moveTo(D.x+e,D.y+i):n.lineTo(D.x+e,D.y+i),E&&n.arcTo(d.x+e,d.y+i,A.x+e,A.y+i,b),n.lineTo(A.x+e,A.y+i)}o||n.lineTo(t[l+1].x+e,t[l+1].y+i)}function xh(n,t){return Math.sqrt(n*n+t*t)}function ug(n,t,e,i,r){const o=t/e;return{x:n.x-i*o,y:n.y-r*o}}const W2=Bo,N2=Vr;var j2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},V2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Nm=function(n,t){return function(e,i){t(e,i,n)}};let dg=class extends Si{constructor(n){super(),this.polygonRenderContribitions=n,this.numberType=Dl,this.builtinContributions=[N2,W2],this.init(n)}drawShape(n,t,e,i,r,o,s,a){const l=X(n,o==null?void 0:o.theme).polygon,{points:h=l.points,cornerRadius:u=l.cornerRadius,x:d=l.x,y:c=l.y,closePath:g=l.closePath}=n.attribute,f=this.valid(n,l,s,a);if(!f)return;const{fVisible:p,sVisible:v,doFill:m,doStroke:C}=f;t.beginPath(),u<=0||rt(u)&&u.every(b=>b===0)?Wm(t.camera?t:t.nativeContext,h,e,i):z2(t.camera?t:t.nativeContext,h,e,i,u,g),g&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,m,C,p,v,l,r,s,a),m&&(s?s(t,n.attribute,l):p&&(t.setCommonStyle(n,n.attribute,d-e,c-i,l),t.fill())),C&&(a?a(t,n.attribute,l):v&&(t.setStrokeStyle(n,n.attribute,d-e,c-i,l),t.stroke())),this.afterRenderStep(n,t,e,i,m,C,p,v,l,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).polygon;this._draw(n,r,!1,e,i)}};dg=j2([Z(),Nm(0,At(Le)),Nm(0,Ne(Lc)),V2("design:paramtypes",[Object])],dg);let jm=!1;const G2=new ht(n=>{jm||(jm=!0,n(El).to(dg).inSingletonScope(),n(We).toService(El),n(Lc).toService(an),Qe(n,Lc))});var U2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},K2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Y2=function(n,t){return function(e,i){t(e,i,n)}};let cg=class{constructor(n){this.canvasRenderer=n,this.type="polygon",this.numberType=Dl}contains(n,t,e){if(!n.AABBBounds.contains(t.x,t.y))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).polygon;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=si(i,d+c,i.dpr),a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};cg=U2([Z(),Y2(0,At(El)),K2("design:paramtypes",[Object])],cg);let Vm=!1;const $2=new ht((n,t,e,i)=>{Vm||(Vm=!0,n(Zv).to(cg).inSingletonScope(),n($e).toService(Zv))});var X2=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},q2=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Z2=function(n,t){return function(e,i){t(e,i,n)}};let gg=class{constructor(n){this.canvasRenderer=n,this.type="polygon",this.numberType=Dl}contains(n,t,e){if(!n.AABBBounds.contains(t.x,t.y))return!1;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).polygon;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=d+c,a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};gg=X2([Z(),Z2(0,At(El)),q2("design:paramtypes",[Object])],gg);let Gm=!1;const J2=new ht((n,t,e,i)=>{Gm||(Gm=!0,n(Ov).to(gg).inSingletonScope(),n(tr).toService(Ov))});function Bh(){Bh.__loaded||(Bh.__loaded=!0,O2(),pt.load(G2),pt.load(hn?$2:J2))}Bh.__loaded=!1;const Um=Bh;class Fh extends ko{constructor(t){super(t),this.type="pyramid3d",this.numberType=nc}doUpdateAABBBounds(){const t=X(this).polygon;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updatePyramid3dAABBBounds(e,X(this).polygon,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),this._AABBBounds}findFace(){const{points:t}=this.attribute,e=t.map((a,l)=>{const h=l===3?t[0]:t[l+1],u=a.x-h.x;return u===0?0:(a.y-h.y)/u}),i=t.map(a=>({p:a,d:0}));let r=!1,o=0;for(let a=0;a<e.length-1;a++){for(let l=a+1;l<e.length;l++){if(e[a]===e[l]){r=!0;const h=_n.distancePP(i[a].p,i[a+1].p);i[a].d=h,i[a+1].d=h,o=Cn(o,h);const u=_n.distancePP(i[l].p,i[l+1].p);i[l].d=u,i[l+1].d=u,o=Cn(o,u)}if(r)break}if(r)break}for(let a=t.length-1;a>=0;a--){const l=t[a];i.unshift({p:l,d:0})}for(let a=0;a<t.length;a++){const l=(o-i[a+t.length].d)/2;i[a].d+=l,i[a+t.length].d+=l}const s={polygons:[],vertices:[],edges:[]};return i.forEach(a=>{s.vertices.push([a.p.x,a.p.y,a.d])}),s.polygons.push({polygon:[0,4,5,1],normal:[0,-1,0]}),s.polygons.push({polygon:[7,6,2,3],normal:[0,1,0]}),s.polygons.push({polygon:[0,4,7,3],normal:[-1,0,0]}),s.polygons.push({polygon:[1,5,6,2],normal:[1,0,0]}),s.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),s.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),s.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],s}_isValid(){return super._isValid()&&this.attribute.points.length===4}getNoWorkAnimateAttr(){return Fh.NOWORK_ANIMATE_ATTR}}Fh.NOWORK_ANIMATE_ATTR=fi;function Q2(n){return new Fh(n)}function tF(){ct.RegisterGraphicCreator("pyramid3d",Q2)}var eF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let fg=class extends Si{constructor(){super(...arguments),this.type="pyramid3d",this.numberType=nc}drawShape(n,t,e,i,r,o,s,a){var l;const h=X(n,o==null?void 0:o.theme).polygon,{fill:u=h.fill,stroke:d=h.stroke,face:c=[!0,!0,!0,!0,!0,!0]}=n.attribute,g=(l=this.z)!==null&&l!==void 0?l:0;if(!this.valid(n,h,s,a))return;const{light:f,camera:p}=r.stage||{},v=n.findFace();if(u!==!1){t.setCommonStyle(n,n.attribute,e,i,h);let m=u;typeof m!="string"&&(m="black"),this.fill(e,i,g,v,c,m,t,f,p,n,h,s)}d!==!1&&(t.setStrokeStyle(n,n.attribute,e,i,h),this.stroke(e,i,g,v,t))}stroke(n,t,e,i,r){const o=i.vertices;i.edges.forEach(s=>{const a=o[s[0]],l=o[s[1]],h={x:n+a[0],y:t+a[1],z:e+a[2]},u={x:n+l[0],y:t+l[1],z:e+l[2]};r.beginPath(),r.moveTo(h.x,h.y,h.z),r.lineTo(u.x,u.y,u.z),r.stroke()})}fill(n,t,e,i,r,o,s,a,l,h,u,d){const c=Ce.Get(o,Mi.Color255),g=i.vertices,f=g.map(v=>s.view(v[0],v[1],v[2])[2]),p=[];i.polygons.forEach((v,m)=>{if(!r[m])return;p.push({faceIdx:m,polygon:v});const{polygon:C,normal:b}=v,_=f[C[0]],y=f[C[1]],w=f[C[2]],S=f[C[3]];v.ave_z=_+y+w+S}),p.sort((v,m)=>m.polygon.ave_z-v.polygon.ave_z),p.forEach(v=>{const{polygon:m,normal:C}=v.polygon,b=g[m[0]],_=g[m[1]],y=g[m[2]],w=g[m[3]],S={x:n+b[0],y:t+b[1],z:e+b[2]},D={x:n+_[0],y:t+_[1],z:e+_[2]},A={x:n+y[0],y:t+y[1],z:e+y[2]},x={x:n+w[0],y:t+w[1],z:e+w[2]};s.beginPath(),s.moveTo(S.x,S.y,S.z),s.lineTo(D.x,D.y,D.z),s.lineTo(A.x,A.y,A.z),s.lineTo(x.x,x.y,x.z),s.closePath(),d?d(s,h.attribute,u):(s.fillStyle=a?a.computeColor(C,c):o,s.fill())})}draw(n,t,e){const i=X(n).polygon;this._draw(n,i,!1,e)}};fg=eF([Z()],fg);let Km=!1;const iF=new ht(n=>{Km||(Km=!0,n(cc).to(fg).inSingletonScope(),n(We).toService(cc))});var nF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},rF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},oF=function(n,t){return function(e,i){t(e,i,n)}};let pg=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="pyramid3d",this.numberType=nc}contains(n,t,e){const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).polygon;i.highPerformanceSave();const o=this.transform(n,r,i),{x:s,y:a,z:l,lastModelMatrix:h}=o;let u=t;if(i.camera){u=t.clone();const c=n.parent.globalTransMatrix;u.x=c.a*t.x+c.c*t.y+c.e,u.y=c.b*t.x+c.d*t.y+c.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(n,i,s,a,{},null,(c,g,f)=>!!d||(d=c.isPointInPath(u.x,u.y),d),(c,g,f)=>!1),this.canvasRenderer.z=0,i.modelMatrix!==h&&ie.free(i.modelMatrix),i.modelMatrix=h,i.highPerformanceRestore(),d}};pg=nF([Z(),oF(0,At(cc)),rF("design:paramtypes",[Object])],pg);let Ym=!1;const sF=new ht((n,t,e,i)=>{Ym||(Ym=!0,n(Jv).to(pg).inSingletonScope(),n($e).toService(Jv))});function Th(){Th.__loaded||(Th.__loaded=!0,tF(),pt.load(iF),pt.load(sF))}Th.__loaded=!1;const aF=Th,lF=n=>{if(!n)return{x:0,y:0,width:0,height:0};let t=ut(n.width)?n.x1-n.x:n.width,e=ut(n.height)?n.y1-n.y:n.height,i=0,r=0;return t<0?(i=t,t=-t):Number.isNaN(t)&&(t=0),e<0?(r=e,e=-e):Number.isNaN(e)&&(e=0),{x:i,y:r,width:t,height:e}},$m=["width","x1","y1","height","cornerRadius",...ki];class Kr extends vi{constructor(t){super(t),this.type="rect",this.numberType=Sl}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}doUpdateAABBBounds(){const t=X(this).rect;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateRectAABBBounds(e,X(this).rect,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return X(this).rect[t]}needUpdateTags(t){return super.needUpdateTags(t,$m)}needUpdateTag(t){return super.needUpdateTag(t,$m)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:r,height:o}=lF(t),s=new Ke;return s.moveTo(e,i),s.rect(e,i,r,o),s}clone(){return new Kr(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Kr.NOWORK_ANIMATE_ATTR}}Kr.NOWORK_ANIMATE_ATTR=fi;function Ge(n){return new Kr(n)}function hF(){ct.RegisterGraphicCreator("rect",Ge)}var Xm=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};class uF{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{outerBorder:g,innerBorder:f}=t.attribute,p=g&&g.visible!==!1,v=f&&f.visible!==!1;if(!p&&!v)return;const{cornerRadius:m=h.cornerRadius,opacity:C=h.opacity,x:b=h.x,y:_=h.y,scaleX:y=h.scaleX,scaleY:w=h.scaleY,x1:S,y1:D}=t.attribute;let{width:A,height:x}=t.attribute;A=(A!=null?A:S-i)||0,x=(x!=null?x:D-r)||0;const B=!(!g||!g.stroke),F=!(!f||!f.stroke);if(p){const{distance:T=h.outerBorder.distance}=g,R=si(e,T,e.dpr),M=i-R,E=r-R,P=2*R;if(m===0||rt(m)&&m.every(I=>I===0)?(e.beginPath(),e.rect(M,E,A+P,x+P)):(e.beginPath(),Qn(e,M,E,A+P,x+P,m)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,g,h.outerBorder);else if(B){const I=h.outerBorder.opacity;h.outerBorder.opacity=C,e.setStrokeStyle(t,g,(b-i)/y,(_-r)/w,h.outerBorder),h.outerBorder.opacity=I,e.stroke()}}if(v){const{distance:T=h.innerBorder.distance}=f,R=si(e,T,e.dpr),M=i+R,E=r+R,P=2*R;if(m===0||rt(m)&&m.every(I=>I===0)?(e.beginPath(),e.rect(M,E,A-P,x-P)):(e.beginPath(),Qn(e,M,E,A-P,x-P,m)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,f,h.innerBorder);else if(F){const I=h.innerBorder.opacity;h.innerBorder.opacity=C,e.setStrokeStyle(t,f,(b-i)/y,(_-r)/w,h.innerBorder),h.innerBorder.opacity=I,e.stroke()}}}}let Io=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{stroke:g=l.stroke}=n.attribute;Array.isArray(g)&&g.some(f=>f===!1)&&(c.doStroke=!1)}};Io=Xm([Z()],Io);let Oo=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){const{width:c=l.width,height:g=l.height,stroke:f=l.stroke}=n.attribute;if(Array.isArray(f)&&f.some(p=>p===!1)){if(t.setStrokeStyle(n,n.attribute,e,i,l),t.beginPath(),t.moveTo(e,i),f[0]?t.lineTo(e+c,i):t.moveTo(e+c,i),f[1]?t.lineTo(e+c,i+g):t.moveTo(e+c,i+g),f[2]?t.lineTo(e,i+g):t.moveTo(e,i+g),f[3]){const p=f[0]?i-t.lineWidth/2:i;t.lineTo(e,p)}else t.moveTo(e,i);t.stroke()}}};Oo=Xm([Z()],Oo);const dF=new uF,cF=Bo,gF=Vr;var fF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},pF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},qm=function(n,t){return function(e,i){t(e,i,n)}};let Mh=class extends Si{constructor(n){super(),this.rectRenderContribitions=n,this.type="rect",this.numberType=Sl,this.builtinContributions=[dF,gF,cF],this.init(n)}drawShape(n,t,e,i,r,o,s,a){var l;const h=(l=this.tempTheme)!==null&&l!==void 0?l:X(n,o==null?void 0:o.theme).rect,{fill:u=h.fill,background:d,stroke:c=h.stroke,cornerRadius:g=h.cornerRadius,opacity:f=h.opacity,fillOpacity:p=h.fillOpacity,lineWidth:v=h.lineWidth,strokeOpacity:m=h.strokeOpacity,visible:C=h.visible,x1:b,y1:_,x:y=h.x,y:w=h.y}=n.attribute;let{width:S,height:D}=n.attribute;S=(S!=null?S:b-y)||0,D=(D!=null?D:_-w)||0;const A=Fc(f,p,S,D,u),x=Mc(f,m,S,D),B=Wr(u,d),F=Ao(c,v);if(!n.valid||!C||!B&&!F||!(A||x||s||a||d))return;g===0||rt(g)&&g.every(R=>R===0)?(t.beginPath(),t.rect(e,i,S,D)):(t.beginPath(),Qn(t,e,i,S,D,g));const T={doFill:B,doStroke:F};t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),this.beforeRenderStep(n,t,e,i,B,F,A,x,h,r,s,a,T),T.doFill&&(s?s(t,n.attribute,h):A&&(t.setCommonStyle(n,n.attribute,y-e,w-i,h),t.fill())),T.doStroke&&(a?a(t,n.attribute,h):x&&(t.setStrokeStyle(n,n.attribute,y-e,w-i,h),t.stroke())),this.afterRenderStep(n,t,e,i,B,F,A,x,h,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).rect;this.tempTheme=r,this._draw(n,r,!1,e,i),this.tempTheme=null}};Mh=fF([Z(),qm(0,At(Le)),qm(0,Ne(jr)),pF("design:paramtypes",[Object])],Mh);let Zm=!1;const vF=new ht(n=>{Zm||(Zm=!0,n(Mh).toSelf().inSingletonScope(),n(Pl).to(Mh).inSingletonScope(),n(We).toService(Pl),n(Oo).toSelf(),n(Io).toSelf(),n(jr).toService(Oo),n(jr).toService(Io),n(jr).toService(an),Qe(n,jr))});var mF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},bF=function(n,t){return function(e,i){t(e,i,n)}};const vg=new me;let mg=class{constructor(n){this.canvasRenderer=n,this.type="rect",this.numberType=Sl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).rect,{cornerRadius:o=r.cornerRadius}=n.attribute;let{x:s=r.x,y:a=r.y}=n.attribute;i.highPerformanceSave();let l=!0;if(n.transMatrix.onlyTranslate()){const u=n.getOffsetXY(r);s+=u.x,a+=u.y,i.setTransformForCurrent()}else s=0,a=0,l=!1,i.transformFromMatrix(n.transMatrix,!0);let h=!0;if(!l||n.shadowRoot||lt(o,!0)&&o!==0||rt(o)&&o.some(u=>u!==0))h=!1,this.canvasRenderer.drawShape(n,i,s,a,{},null,(u,d,c)=>!!h||(h=u.isPointInPath(t.x,t.y),h),(u,d,c)=>{if(h)return!0;const g=d.lineWidth||c.lineWidth,f=d.pickStrokeBuffer||c.pickStrokeBuffer;return i.lineWidth=si(i,g+f,i.dpr),h=u.isPointInStroke(t.x,t.y),h});else{const{fill:u=r.fill,stroke:d=r.stroke,lineWidth:c=r.lineWidth}=n.attribute;if(u)h=!0;else if(d){const g=n.AABBBounds;vg.setValue(g.x1,g.y1,g.x2,g.y2),vg.expand(-c/2),h=!vg.containsPoint(t)}}return i.highPerformanceRestore(),h}};mg=mF([Z(),bF(0,At(Pl)),CF("design:paramtypes",[Object])],mg);let Jm=!1;const _F=new ht((n,t,e,i)=>{Jm||(Jm=!0,n(Yv).to(mg).inSingletonScope(),n($e).toService(Yv))});var yF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},wF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},DF=function(n,t){return function(e,i){t(e,i,n)}};const Cg=new me;let bg=class{constructor(n){this.canvasRenderer=n,this.type="rect",this.numberType=Sl}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).rect,{cornerRadius:o=r.cornerRadius}=n.attribute;let{x:s=r.x,y:a=r.y}=n.attribute;i.highPerformanceSave();let l=!0;if(n.transMatrix.onlyTranslate()){const u=n.getOffsetXY(r);s+=u.x,a+=u.y,i.setTransformForCurrent()}else s=0,a=0,l=!1,i.transformFromMatrix(n.transMatrix,!0);let h=!0;if(!l||lt(o,!0)&&o!==0||rt(o)&&o.some(u=>u!==0))h=!1,this.canvasRenderer.drawShape(n,i,s,a,{},null,(u,d,c)=>!!h||(h=u.isPointInPath(t.x,t.y),h),(u,d,c)=>{if(h)return!0;const g=d.lineWidth||c.lineWidth,f=d.pickStrokeBuffer||c.pickStrokeBuffer;return i.lineWidth=g+f,h=u.isPointInStroke(t.x,t.y),h});else if(h){const{fill:u=r.fill,stroke:d=r.stroke,lineWidth:c=r.lineWidth}=n.attribute;if(u)h=!0;else if(d){const g=n.AABBBounds;Cg.setValue(g.x1,g.y1,g.x2,g.y2),Cg.expand(-c/2),h=!Cg.containsPoint(t)}}return i.highPerformanceRestore(),h}};bg=yF([Z(),DF(0,At(Pl)),wF("design:paramtypes",[Object])],bg);let Qm=!1;const SF=new ht((n,t,e,i)=>{Qm||(Qm=!0,n(Lv).to(bg).inSingletonScope(),n(tr).toService(Lv))});function Rh(){Rh.__loaded||(Rh.__loaded=!0,hF(),pt.load(vF),pt.load(hn?_F:SF))}Rh.__loaded=!1;const Yr=Rh,tC=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]];class Eh extends Kr{constructor(t){super(t),this.type="rect3d",this.numberType=rc}findFace(){const t={polygons:[],vertices:[],edges:[]},e=X(this).rect3d,{x1:i,y1:r,x:o,y:s,length:a=Ue(e.width,e.height)}=this.attribute;let{width:l,height:h}=this.attribute;l=l!=null?l:i-o,h=h!=null?h:r-s;for(let u=0;u<tC.length;u++){const d=tC[u];t.vertices.push([d[0]*l,d[1]*h,d[2]*a])}return t.polygons.push({polygon:[0,1,5,4],normal:[0,-1,0]}),t.polygons.push({polygon:[2,3,7,6],normal:[0,1,0]}),t.polygons.push({polygon:[4,7,3,0],normal:[-1,0,0]}),t.polygons.push({polygon:[1,2,6,5],normal:[1,0,0]}),t.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),t.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),t.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],t}getNoWorkAnimateAttr(){return Eh.NOWORK_ANIMATE_ATTR}}Eh.NOWORK_ANIMATE_ATTR=fi;function AF(n){return new Eh(n)}function xF(){ct.RegisterGraphicCreator("rect3d",AF)}var BF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let _g=class extends Si{constructor(){super(...arguments),this.type="rect3d",this.numberType=rc}drawShape(n,t,e,i,r,o,s,a){var l;const h=X(n,o==null?void 0:o.theme).rect3d,{fill:u=h.fill,stroke:d=h.stroke,x1:c,y1:g,x:f,y:p,opacity:v=h.opacity,fillOpacity:m=h.fillOpacity,lineWidth:C=h.lineWidth,strokeOpacity:b=h.strokeOpacity,visible:_=h.visible}=n.attribute;let{width:y,height:w}=n.attribute;y=(y!=null?y:c-f)||0,w=(w!=null?w:g-p)||0;const S=(l=this.z)!==null&&l!==void 0?l:0,D=Fc(v,m,y,w,u),A=Mc(v,b,y,w),x=Wr(u),B=Ao(d,C);if(!n.valid||!_||!x&&!B||!(D||A||s||a))return;const{light:F,camera:T}=r.stage||{},R=n.findFace();if(u!==!1){t.setCommonStyle(n,n.attribute,e,i,h);let M=u;typeof M!="string"&&(M="black"),this.fill(e,i,S,R,M,t,F,s)}d!==!1&&(t.setStrokeStyle(n,n.attribute,e,i,h),this.stroke(e,i,S,R,t))}stroke(n,t,e,i,r){const o=i.vertices;i.edges.forEach(s=>{const a=o[s[0]],l={x:n+a[0],y:t+a[1],z:e+a[2]},h=o[s[1]],u={x:n+h[0],y:t+h[1],z:e+h[2]};r.beginPath(),r.moveTo(l.x,l.y,l.z),r.lineTo(u.x,u.y,u.z),r.stroke()})}fill(n,t,e,i,r,o,s,a){const l=Ce.Get(r,Mi.Color255),h=i.vertices,u=h.map(c=>o.view(c[0],c[1],c[2])[2]),d=[];i.polygons.forEach((c,g)=>{d.push({faceIdx:g,polygon:c});const{polygon:f,normal:p}=c,v=u[f[0]],m=u[f[1]],C=u[f[2]],b=u[f[3]];c.ave_z=v+m+C+b}),d.sort((c,g)=>g.polygon.ave_z-c.polygon.ave_z),d.forEach(c=>{const{polygon:g,normal:f}=c.polygon,p=h[g[0]],v=h[g[1]],m=h[g[2]],C=h[g[3]],b={x:n+p[0],y:t+p[1],z:e+p[2]},_={x:n+v[0],y:t+v[1],z:e+v[2]},y={x:n+m[0],y:t+m[1],z:e+m[2]},w={x:n+C[0],y:t+C[1],z:e+C[2]};o.beginPath(),o.moveTo(b.x,b.y,b.z),o.lineTo(_.x,_.y,_.z),o.lineTo(y.x,y.y,y.z),o.lineTo(w.x,w.y,w.z),o.closePath(),a?a(o,null,null):(o.fillStyle=s?s.computeColor(f,l):r,o.fill())})}draw(n,t,e){const i=X(n).rect;this._draw(n,i,!1,e)}};_g=BF([Z()],_g);let eC=!1;const FF=new ht(n=>{eC||(eC=!0,n(hc).to(_g).inSingletonScope(),n(We).toService(hc))});var TF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},MF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},RF=function(n,t){return function(e,i){t(e,i,n)}};const _W=new me;let yg=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="rect3d",this.numberType=rc}contains(n,t,e){const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).rect;i.highPerformanceSave();const o=this.transform(n,r,i),{x:s,y:a,z:l,lastModelMatrix:h}=o;let u=t;if(i.camera){u=t.clone();const c=n.parent.globalTransMatrix;u.x=c.a*t.x+c.c*t.y+c.e,u.y=c.b*t.x+c.d*t.y+c.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(n,i,s,a,e,null,(c,g,f)=>!!d||(d=c.isPointInPath(u.x,u.y),d)),this.canvasRenderer.z=0,i.modelMatrix!==h&&ie.free(i.modelMatrix),i.modelMatrix=h,i.highPerformanceRestore(),d}};yg=TF([Z(),RF(0,At(hc)),MF("design:paramtypes",[Object])],yg);let iC=!1;const EF=new ht((n,t,e,i)=>{iC||(iC=!0,n($v).to(yg).inSingletonScope(),n($e).toService($v))});function Ph(){Ph.__loaded||(Ph.__loaded=!0,xF(),pt.load(FF),pt.load(EF))}Ph.__loaded=!1;const PF=Ph;class HF{constructor(t,e,i,r,o,s,a,l,h,u,d,c,g,f){this.left=t,this.top=e,this.width=i,this.height=r,this.actualHeight=0,this.bottom=e+r,this.right=t+i,this.ellipsis=o,this.wordBreak=s,this.verticalDirection=a,this.lines=[],this.globalAlign=l,this.globalBaseline=h,this.layoutDirection=u,this.directionKey=Id[this.layoutDirection],this.isWidthMax=d,this.isHeightMax=c,this.singleLine=g,f?(f.clear(),this.icons=f):this.icons=new Map}draw(t,e){const{width:i,height:r}=this.getActualSize(),o=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let s=this.isHeightMax?Math.min(this.height,r):this.height||r||0;s=Math.min(s,r);let a=0;switch(this.globalBaseline){case"top":a=0;break;case"middle":a=-s/2;break;case"bottom":a=-s}let l=0;this.globalAlign==="right"||this.globalAlign==="end"?l=-o:this.globalAlign==="center"&&(l=-o/2);let h=this[this.directionKey.height];this.singleLine&&(h=this.lines[0].height+1);let u=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=h&&h!==0)for(let d=0;d<this.lines.length;d++){const{top:c,height:g}=this.lines[d];if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return u;let f=!1;this.ellipsis&&this.lines[d+1]&&this.lines[d+1].top+this.lines[d+1].height>this[this.directionKey.top]+h&&(f=!0,u=!0),this.lines[d].draw(t,f,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+a,e)}else{const d=Math.floor((h-this.actualHeight)/2);this.layoutDirection==="vertical"?l+=d:a+=d;for(let c=0;c<this.lines.length;c++)this.lines[c].draw(t,!1,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,e)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let d=0;d<this.lines.length;d++){const{top:c,height:g}=this.lines[d],f=h-this.lines[d].top-this.lines[d].height;if(h===0)this.lines[d].draw(t,!1,l,f+a,e);else{if(f+g>this[this.directionKey.top]+h||f<this[this.directionKey.top])return u;{let p=!1;this.ellipsis&&this.lines[d+1]&&f-this.lines[d+1].height<this[this.directionKey.top]&&(p=!0,u=!0),this.lines[d].draw(t,p,l,f+a,e)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(l+=this.lines[0].height+1);for(let d=0;d<this.lines.length;d++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(l-=this.lines[d].height+this.lines[d].top);const{top:c,height:g}=this.lines[d];if(h===0)this.lines[d].draw(t,!1,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+a,e);else{if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return u;{let f=!1;this.ellipsis&&this.lines[d+1]&&this.lines[d+1].top+this.lines[d+1].height>this[this.directionKey.top]+h&&(f=!0,u=!0),this.lines[d].draw(t,f,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+a,e)}}}}return u}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>t&&(t=r.actualWidth),e+=r.height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:r}=this.getRawActualSize();this.width;let o=this.height||r||0;o=Math.min(o,r);let s=this[this.directionKey.height];if(this.singleLine&&(s=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=s&&s!==0)for(let a=0;a<this.lines.length;a++){const{top:l,height:h}=this.lines[a];if(!(l+h<this[this.directionKey.top]||l+h>this[this.directionKey.top]+s))if(this.ellipsis&&this.lines[a+1]&&this.lines[a+1].top+this.lines[a+1].height>this[this.directionKey.top]+s){const u=this.lines[a].getWidthWithEllips();u>t&&(t=u),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else{Math.floor((s-this.actualHeight)/2);for(let a=0;a<this.lines.length;a++)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else if(this.verticalDirection==="bottom")for(let a=0;a<this.lines.length;a++){const{top:l,height:h}=this.lines[a],u=s-this.lines[a].top-this.lines[a].height;if(s===0)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height;else if(!(u+h>this[this.directionKey.top]+s||u<this[this.directionKey.top]))if(this.ellipsis&&this.lines[a+1]&&u-this.lines[a+1].height<this[this.directionKey.top]){const d=this.lines[a].getWidthWithEllips();d>t&&(t=d),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else for(let a=0;a<this.lines.length;a++){const{top:l,height:h}=this.lines[a];if(s===0)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height;else if(!(l+h<this[this.directionKey.top]||l+h>this[this.directionKey.top]+s))if(this.ellipsis&&this.lines[a+1]&&this.lines[a+1].top+this.lines[a+1].height>this[this.directionKey.top]+s){const u=this.lines[a].getWidthWithEllips();u>t&&(t=u),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}}class ia{constructor(t,e,i){this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic";const r=Jn(i.lineHeight,this.fontSize);this.lineHeight=typeof r=="number"?r>this.fontSize?r:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:o,height:s,descent:a,width:l}=go(t,i);let h=0,u=0,d=0;this.height>s&&(h=(this.height-s)/2,u=Math.ceil(h),d=Math.floor(h)),this.textBaseline==="top"?(this.ascent=h,this.descent=s-h):this.textBaseline==="bottom"?(this.ascent=s-h,this.descent=h):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=o+u,this.descent=a+d),this.length=t.length,this.width=l||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height)}updateWidth(){const{width:t}=go(this.text,this.character);this.width=t,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}draw(t,e,i,r,o){let s=this.text,a=this.left+i;e+=this.top;let l=this.direction;if(this.verticalEllipsis)s="...",l="vertical",e-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")s+="...",o!=="right"&&o!=="end"||(a-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const h=Od(s,(l==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,s.length-1);if(s=s.slice(0,h),s+="...",o==="right"||o==="end"){const{width:u}=go(this.text.slice(h),this.character);l==="vertical"||(a-=this.ellipsisWidth-u)}}}switch(this.character.script){case"super":e-=this.ascent*(1/3);break;case"sub":e+=this.descent/2}l==="vertical"&&(t.save(),t.rotateAbout(Math.PI/2,a,e),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(a,e),a=0,e=0),this.character.stroke&&(mD(t,this.character),t.strokeText(s,a,e)),vD(t,this.character),this.character.fill&&t.fillText(s,a,e),this.character.fill&&(typeof this.character.lineThrough=="boolean"||typeof this.character.underline=="boolean"?(this.character.underline&&t.fillRect(a,1+e,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1),this.character.lineThrough&&t.fillRect(a,1+e-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)):this.character.textDecoration==="underline"?t.fillRect(a,1+e,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1):this.character.textDecoration==="line-through"&&t.fillRect(a,1+e-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)),l==="vertical"&&t.restore()}getWidthWithEllips(t){let e=this.text;const i=t==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){const r=Od(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,r),e+="...";const{width:o}=go(this.text.slice(r),this.character);return i+this.ellipsisWidth-o}return i}}function LF(n,t){const e=n.text.slice(0,t),i=n.text.slice(t);return[new ia(e,n.newLine,n.character),new ia(i,!0,n.character)]}class nr extends ir{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],t.backgroundShowMode==="always"&&(this._hovered=!0),t.margin){const e=Ye(t.margin);this._marginArray=typeof e=="number"?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(e,i,r)=>{if(rt(r)&&r.indexOf("margin")!==-1||r==="margin")if(i.margin){const o=Ye(i.margin);this._marginArray=typeof o=="number"?[o,o,o,o]:o}else this._marginArray=[0,0,0,0]}}get width(){var t;return((t=this.attribute.width)!==null&&t!==void 0?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return((t=this.attribute.height)!==null&&t!==void 0?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=Cs.width,height:e=Cs.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:r=e}=this.attribute,o=(i-t)/2,s=(r-e)/2;return this._AABBBounds.expand([0,2*o,2*s,0]),this._AABBBounds}setHoverState(t){this.attribute.backgroundShowMode==="hover"&&this._hovered!==t&&(this._hovered=t)}}class kF{constructor(t,e,i,r,o,s,a,l){this.left=t,this.width=e,this.baseline=i,this.ascent=r,this.descent=o,this.top=i-r,this.paragraphs=s.map(u=>u),this.textAlign=(this.paragraphs[0]instanceof nr?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=a,this.directionKey=Id[this.direction],this.actualWidth=0;let h=0;this.paragraphs.forEach((u,d)=>{if(d===0&&u instanceof ia){const c=pD.exec(u.text);(c==null?void 0:c.index)!==0&&(u.text=u.text.slice(c==null?void 0:c.index),u.updateWidth())}this.actualWidth+=u[this.directionKey.width],h=Math.max(u[this.directionKey.height],h)}),this.height=h,this.blankWidth=l?0:this.width-this.actualWidth,this.calcOffset(e,l)}calcOffset(t,e){const i=this.directionKey,r=this.height;let o=this.left,s=0;this.actualWidth<t&&!e&&(this.textAlign==="right"||this.textAlign==="end"?o=t-this.actualWidth:this.textAlign==="center"?o=(t-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?o=(t-this.actualWidth)/2:s=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(a){a instanceof nr?(a["_"+i.x]=o,o+=a[i.width]+s,a["_"+i.y]=a.attribute.textBaseline==="top"?0:a.attribute.textBaseline==="bottom"?r-a.height:(r-a.height)/2):(a[i.left]=o,o+=a[i.width]+s)})}draw(t,e,i,r,o){if(e){let s=0;for(let a=this.paragraphs.length-1;a>=0;a--){const l=this.paragraphs[a];if(l instanceof nr)break;if(this.direction==="vertical"&&l.direction!=="vertical"){l.verticalEllipsis=!0;break}const{width:h}=go("...",l.character),u=h||0;if(u<=this.blankWidth+s){l.ellipsis="add";break}if(u<=this.blankWidth+s+l.width){l.ellipsis="replace",l.ellipsisWidth=u,l.ellipsisOtherParagraphWidth=this.blankWidth+s;break}l.ellipsis="hide",s+=l.width}}this.paragraphs.map((s,a)=>{if(s instanceof nr)return s.setAttributes({x:i+s._x,y:r+s._y}),void o(s,t,i+s._x,r+s._y,this.ascent);s.draw(t,r+this.ascent,i,a===0,this.textAlign)})}getWidthWithEllips(){let t=0;for(let i=this.paragraphs.length-1;i>=0;i--){const r=this.paragraphs[i];if(r instanceof nr)break;const{width:o}=go("...",r.character),s=o||0;if(s<=this.blankWidth+t){r.ellipsis="add",r.ellipsisWidth=s;break}if(s<=this.blankWidth+t+r.width){r.ellipsis="replace",r.ellipsisWidth=s,r.ellipsisOtherParagraphWidth=this.blankWidth+t;break}r.ellipsis="hide",t+=r.width}let e=0;return this.paragraphs.map((i,r)=>{e+=i instanceof nr?i.width:i.getWidthWithEllips(this.direction)}),e}}class IF{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=Id[this.direction]}store(t){if(t instanceof nr){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;t.attribute.textBaseline==="top"?(e=0,i=t.height):t.attribute.textBaseline==="bottom"?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),t.text.length!==0?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(this.lineBuffer.length===0)return;const t=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,e=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new kF(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t){t instanceof nr?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineBuffer.length===0?(this.store(t),this.send()):(this.send(),this.deal(t)):typeof this.width!="number"||this.width<0||(t.newLine&&this.send(),t.text.length!==0&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t)))}cut(t){const e=this[this.directionKey.width]-this.lineWidth||0,i=Math.ceil(e/t[this.directionKey.width]*t.length)||0,r=Od(t.text,e,t.character,i,this.frame.wordBreak==="break-word");if(r!==0){const[o,s]=LF(t,r);this.store(o),this.deal(s)}else this.lineBuffer.length!==0&&(this.send(),this.deal(t))}}const nC=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection",...ki];class An extends vi{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=oc}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:En.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:En.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return(t=this.attribute.ellipsis)!==null&&t!==void 0?t:En.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return(t=this.attribute.wordBreak)!==null&&t!==void 0?t:En.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return(t=this.attribute.verticalDirection)!==null&&t!==void 0?t:En.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return(t=this.attribute.textAlign)!==null&&t!==void 0?t:En.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return(t=this.attribute.textBaseline)!==null&&t!==void 0?t:En.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return(t=this.attribute.textConfig)!==null&&t!==void 0?t:En.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}doUpdateAABBBounds(){const t=X(this).richtext;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateRichTextAABBBounds(e,X(this).richtext,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return En[t]}needUpdateTags(t){return super.needUpdateTags(t,nC)}needUpdateTag(t){return super.needUpdateTag(t,nC)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:s,fontWeight:a}=this.attribute;return Object.assign({fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:s,fontWeight:a},t)}doUpdateFrameCache(){var t;const{textConfig:e=[],maxWidth:i,maxHeight:r,width:o,height:s,ellipsis:a,wordBreak:l,verticalDirection:h,textAlign:u,textBaseline:d,layoutDirection:c,singleLine:g}=this.attribute,f=[];for(let y=0;y<e.length;y++)if("image"in e[y]){const w=this.combinedStyleToCharacter(e[y]),S=w.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(w.id);if(S)f.push(S);else{const D=new nr(w);D.successCallback=()=>{var A;this.addUpdateBoundTag(),(A=this.stage)===null||A===void 0||A.renderNextFrame()},D.richtextId=w.id,f.push(D)}}else{const w=this.combinedStyleToCharacter(e[y]);if(lt(w.text)&&(w.text=`${w.text}`),w.text&&w.text.includes(`
`)){const S=w.text.split(`
`);for(let D=0;D<S.length;D++)f.push(new ia(S[D],D!==0,w))}else w.text&&f.push(new ia(w.text,!1,w))}const p=typeof i=="number"&&Number.isFinite(i)&&i>0,v=typeof r=="number"&&Number.isFinite(r)&&r>0,m=typeof o=="number"&&Number.isFinite(o)&&o>0&&(!p||o<=i),C=typeof s=="number"&&Number.isFinite(s)&&s>0&&(!v||s<=r),b=new HF(0,0,(m?o:p?i:0)||0,(C?s:v?r:0)||0,a,l,h,u,d,c||"horizontal",!m&&p,!C&&v,g||!1,(t=this._frameCache)===null||t===void 0?void 0:t.icons),_=new IF(b);for(let y=0;y<f.length;y++)_.deal(f[y]);if(_.send(),!(b.layoutDirection==="horizontal"?m:C)){const y=b.getActualSizeWidthEllipsis();let w=b.layoutDirection==="horizontal"?y.width:y.height;(b.layoutDirection==="horizontal"?p:v)&&(w=Math.min(w,b.layoutDirection==="horizontal"?i:r)),b.lines.forEach(function(S){S.calcOffset(w,!1)})}this._frameCache=b}clone(){return new An(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach(i=>{i.setStage(t,e)})}bindIconEvent(){this.addEventListener("pointermove",t=>{var e,i,r,o,s;const a=this.pickIcon(t.global);a&&a===this._currentHoverIcon||(a?((e=this._currentHoverIcon)===null||e===void 0||e.setHoverState(!1),this._currentHoverIcon=a,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(a.attribute.cursor),(r=this.stage)===null||r===void 0||r.renderNextFrame()):!a&&this._currentHoverIcon&&(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(o=this.stage)===null||o===void 0||o.setCursor(),(s=this.stage)===null||s===void 0||s.renderNextFrame()))}),this.addEventListener("pointerleave",t=>{var e,i;this._currentHoverIcon&&(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(e=this.stage)===null||e===void 0||e.setCursor(),(i=this.stage)===null||i===void 0||i.renderNextFrame())})}pickIcon(t){const e=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let o;return e.icons.forEach(s=>{var a,l;s.AABBBounds.containsPoint({x:t.x-i,y:t.y-r})&&(o=s,o.globalX=((a=o.attribute.x)!==null&&a!==void 0?a:0)+i,o.globalY=((l=o.attribute.y)!==null&&l!==void 0?l:0)+r)}),o}getNoWorkAnimateAttr(){return An.NOWORK_ANIMATE_ATTR}}An.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},fi);function OF(n){return new An(n)}function zF(){ct.RegisterGraphicCreator("richtext",OF)}let Hh,Lh;function wg(n){return Hh||(Hh=ct.CreateGraphic("text",{})),Hh.initAttributes(n),Hh.AABBBounds}function yW(n){return Lh||(Lh=graphicCreator.CreateGraphic("richtext",{})),Lh.setAttributes(n),Lh.AABBBounds}class WF extends Ws{constructor(){super(...arguments),this.time=Nt.beforeFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p,v,m,C,b,_,y,w;const{backgroundMode:S=h.backgroundMode,backgroundFit:D=h.backgroundFit}=t.attribute;let A,{background:x}=t.attribute;if(!x)return;const B=ye(x)&&x.background,F=t.transMatrix.onlyTranslate();if(B){const T=t.AABBBounds,R=((g=x.x)!==null&&g!==void 0?g:T.x1)+((f=x.dx)!==null&&f!==void 0?f:0),M=((p=x.y)!==null&&p!==void 0?p:T.y1)+((v=x.dy)!==null&&v!==void 0?v:0),E=(m=x.width)!==null&&m!==void 0?m:T.width(),P=(C=x.height)!==null&&C!==void 0?C:T.height();if(A=Ul.allocate(R,M,R+E,M+P),x=x.background,!F){const I=A.width(),k=A.height();A.set(((b=x.x)!==null&&b!==void 0?b:0)+((_=x.dx)!==null&&_!==void 0?_:0),((y=x.y)!==null&&y!==void 0?y:0)+((w=x.dy)!==null&&w!==void 0?w:0),I,k)}}else A=t.AABBBounds,F||(A=wg(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const T=t.resources.get(x);if(T.state!=="success"||!T.data)return;e.highPerformanceSave(),F&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,r,h),this.doDrawImage(e,T.data,A,S,D),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:T}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=x,T?(Qn(e,A.x1,A.y1,A.width(),A.height(),T),e.fill()):e.fillRect(A.x1,A.y1,A.width(),A.height()),e.highPerformanceRestore()}B&&Ul.free(A)}}const rC=new WF;var NF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},jF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Dg=class extends Si{constructor(){super(),this.numberType=oc,this.builtinContributions=[rC],this.init()}drawShape(n,t,e,i,r){const o=X(n).richtext,{strokeOpacity:s=o.strokeOpacity,opacity:a=o.opacity,fillOpacity:l=o.fillOpacity,visible:h=o.visible}=n.attribute;if(!n.valid||!h)return;const u=Nr(a,l,!0),d=Nr(a,s,!0);u&&(t.translate(e,i),this.beforeRenderStep(n,t,e,i,u,d,u,d,o,r),n.getFrameCache().draw(t,this.drawIcon),this.afterRenderStep(n,t,e,i,u,d,u,d,o,r))}drawIcon(n,t,e,i,r){var o;const s=X(n).richtextIcon,{width:a=s.width,height:l=s.height,opacity:h=s.opacity,image:u,backgroundFill:d=s.backgroundFill,backgroundFillOpacity:c=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:f=s.backgroundStrokeOpacity,backgroundRadius:p=s.backgroundRadius,margin:v}=n.attribute,{backgroundWidth:m=a,backgroundHeight:C=l}=n.attribute;if(v&&(e+=n._marginArray[3],i+=n._marginArray[0]),n._hovered){const _=(m-a)/2,y=(C-l)/2;p===0?(t.beginPath(),t.rect(e-_,i-y,m,C)):(t.beginPath(),Qn(t,e-_,i-y,m,C,p)),d&&(t.globalAlpha=c,t.fillStyle=d,t.fill()),g&&(t.globalAlpha=f,t.strokeStyle=g,t.stroke())}const b=u&&((o=n==null?void 0:n.resources)===null||o===void 0?void 0:o.get(u));b&&b.state==="success"&&(t.globalAlpha=h,t.drawImage(b.data,e,i,a,l))}draw(n,t,e){const i=X(n).richtext;this._draw(n,i,!1,e)}};Dg=NF([Z(),jF("design:paramtypes",[])],Dg);let oC=!1;const VF=new ht(n=>{oC||(oC=!0,n(dc).to(Dg).inSingletonScope(),n(We).toService(dc))});var GF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},UF=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},KF=function(n,t){return function(e,i){t(e,i,n)}};let Sg=class{constructor(n){this.canvasRenderer=n,this.type="richtext",this.numberType=oc}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};Sg=GF([Z(),KF(0,At(dc)),UF("design:paramtypes",[Object])],Sg);let sC=!1;const YF=new ht((n,t,e,i)=>{sC||(sC=!0,n(Qv).to(Sg).inSingletonScope(),n($e).toService(Qv))});let aC=!1;const $F=new ht((n,t,e,i)=>{aC||(aC=!0,n(nh).to(Lo).inSingletonScope(),n(Lo).toService(nh))});function kh(){kh.__loaded||(kh.__loaded=!0,zF(),pt.load(VF),pt.load(hn?YF:$F))}kh.__loaded=!1;const Ih=kh;class XF extends Di{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function qF(n){return new XF(n)}function ZF(){ct.RegisterGraphicCreator("shadowRoot",qF)}function Oh(){Oh.__loaded||(Oh.__loaded=!0,ZF())}Oh.__loaded=!1;const JF=Oh;class Oe{bounds(t,e){if(lt(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}}function lC(n,t,e,i,r){return r?n.arc(e,i,t,0,ti,!1,r):n.arc(e,i,t,0,ti),!1}class QF extends Oe{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,r,o){return lC(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,s){return lC(t,e/2+o,i,r,s)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e-o}, ${i} a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0`}}var tT=new QF;function eT(n,t,e,i,r){return n.moveTo(-3*t+e,-t+i,r),n.lineTo(-t+e,-t+i,r),n.lineTo(-t+e,-3*t+i,r),n.lineTo(t+e,-3*t+i,r),n.lineTo(t+e,-t+i,r),n.lineTo(3*t+e,-t+i,r),n.lineTo(3*t+e,t+i,r),n.lineTo(t+e,t+i,r),n.lineTo(t+e,3*t+i,r),n.lineTo(-t+e,3*t+i,r),n.lineTo(-t+e,t+i,r),n.lineTo(-3*t+e,t+i,r),n.closePath(),!0}function iT(n,t,e,i,r,o){return n.moveTo(-3*t+e-r,-t+i-r,o),n.lineTo(-t+e-r,-t+i-r,o),n.lineTo(-t+e-r,-3*t+i-r,o),n.lineTo(t+e+r,-3*t+i-r,o),n.lineTo(t+e+r,-t+i-r,o),n.lineTo(3*t+e+r,-t+i-r,o),n.lineTo(3*t+e+r,t+i+r,o),n.lineTo(t+e+r,t+i+r,o),n.lineTo(t+e+r,3*t+i+r,o),n.lineTo(-t+e-r,3*t+i+r,o),n.lineTo(-t+e-r,t+i+r,o),n.lineTo(-3*t+e-r,t+i+r,o),n.closePath(),!0}class nT extends Oe{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,r,o){return eT(t,e/6,i,r,o)}drawOffset(t,e,i,r,o,s){return iT(t,e/6,i,r,o,s)}}var rT=new nT;function Ag(n,t,e,i,r){return n.moveTo(e,i-t,r),n.lineTo(t+e,i,r),n.lineTo(e,i+t,r),n.lineTo(e-t,i,r),n.closePath(),!0}class oT extends Oe{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,r,o){return Ag(t,e/2,i,r,o)}drawFitDir(t,e,i,r,o){return Ag(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,s){return Ag(t,e/2+o,i,r,s)}}var sT=new oT;function hC(n,t,e,i){const r=2*t;return n.rect(e-t,i-t,r,r),!1}class aT extends Oe{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,r){return hC(t,e/2,i,r)}drawOffset(t,e,i,r,o){return hC(t,e/2+o,i,r)}}var lT=new aT;function hT(n,t,e,i){return n.moveTo(e+t,t+i),n.lineTo(e-t,t+i),n.lineTo(e,i-t),n.closePath(),!0}function uT(n,t,e,i,r){return n.moveTo(e+t+2*r,t+i+r),n.lineTo(e-t-2*r,t+i+r),n.lineTo(e,i-t-2*r),n.closePath(),!0}class xg extends Oe{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,r){return hT(t,e/2,i,r)}drawOffset(t,e,i,r,o){return uT(t,e/2,i,r,o)}}var dT=new xg;const wW=null;class cT extends xg{constructor(){super(...arguments),this.type="triangle"}}var gT=new cT;const uC=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),fT=Math.sin(ti/10)*uC,pT=-Math.cos(ti/10)*uC;function dC(n,t,e,i){const r=fT*t,o=pT*t;n.moveTo(e,-t+i),n.lineTo(r+e,o+i);for(let s=1;s<5;++s){const a=ti*s/5,l=Math.cos(a),h=Math.sin(a);n.lineTo(h*t+e,-l*t+i),n.lineTo(l*r-h*o+e,h*r+l*o+i)}return n.closePath(),!0}class vT extends Oe{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,r){return dC(t,e/2,i,r)}drawOffset(t,e,i,r,o){return dC(t,e/2+o,i,r)}}var mT=new vT;const CT=yi(3);function cC(n,t,e,i){const r=t,o=r/CT,s=o/5,a=t;return n.moveTo(0+e,-r+i),n.lineTo(o/2+e,i),n.lineTo(s/2+e,i),n.lineTo(s/2+e,a+i),n.lineTo(-s/2+e,a+i),n.lineTo(-s/2+e,i),n.lineTo(-o/2+e,i),n.closePath(),!0}class bT extends Oe{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,r){return cC(t,e/2,i,r)}drawOffset(t,e,i,r,o){return cC(t,e/2+o,i,r)}}var _T=new bT;function gC(n,t,e,i){const r=2*t;return n.moveTo(e,-t+i),n.lineTo(r/3/2+e,t+i),n.lineTo(-r/3/2+e,t+i),n.closePath(),!0}class yT extends Oe{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,r){return gC(t,e/2,i,r)}drawOffset(t,e,i,r,o){return gC(t,e/2+o,i,r)}}var wT=new yT;function fC(n,t,e,i){return n.moveTo(-t+e,i),n.lineTo(e,t+i),!1}class DT extends Oe{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,r){return fC(t,e/2,i,r)}drawOffset(t,e,i,r,o){return fC(t,e/2+o,i,r)}}var ST=new DT;const un=-.5,dn=yi(3)/2,Bg=1/yi(12),DW=3*(Bg/2+1);function pC(n,t,e,i){const r=t/2,o=t*Bg,s=r,a=t*Bg+t,l=-s,h=a;return n.moveTo(r+e,o+i),n.lineTo(s+e,a+i),n.lineTo(l+e,h+i),n.lineTo(un*r-dn*o+e,dn*r+un*o+i),n.lineTo(un*s-dn*a+e,dn*s+un*a+i),n.lineTo(un*l-dn*h+e,dn*l+un*h+i),n.lineTo(un*r+dn*o+e,un*o-dn*r+i),n.lineTo(un*s+dn*a+e,un*a-dn*s+i),n.lineTo(un*l+dn*h+e,un*h-dn*l+i),n.closePath(),!1}class AT extends Oe{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,r){return pC(t,e/2,i,r)}drawOffset(t,e,i,r,o){return pC(t,e/2+o,i,r)}}var xT=new AT;function BT(n,t,e,i){return n.moveTo(-t+e,i),n.lineTo(t+e,t+i),n.lineTo(t+e,i-t),n.closePath(),!0}function FT(n,t,e,i,r){return n.moveTo(-t+e-2*r,i),n.lineTo(t+e+r,t+i+2*r),n.lineTo(t+e+r,i-t-2*r),n.closePath(),!0}class TT extends Oe{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,r){return BT(t,e/2,i,r)}drawOffset(t,e,i,r,o){return FT(t,e/2,i,r,o)}}var MT=new TT;function RT(n,t,e,i){return n.moveTo(e-t,t+i),n.lineTo(t+e,i),n.lineTo(e-t,i-t),n.closePath(),!0}function ET(n,t,e,i,r){return n.moveTo(e-t-r,t+i+2*r),n.lineTo(t+e+2*r,i),n.lineTo(e-t-r,i-t-2*r),n.closePath(),!0}class PT extends Oe{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,r){return RT(t,e/2,i,r)}drawOffset(t,e,i,r,o){return ET(t,e/2,i,r,o)}}var HT=new PT;function LT(n,t,e,i){return n.moveTo(e-t,i-t),n.lineTo(e+t,i-t),n.lineTo(e,i+t),n.closePath(),!0}function kT(n,t,e,i,r){return n.moveTo(e-t-2*r,i-t-r),n.lineTo(e+t+2*r,i-t-r),n.lineTo(e,i+t+2*r),n.closePath(),!0}class IT extends Oe{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,r){return LT(t,e/2,i,r)}drawOffset(t,e,i,r,o){return kT(t,e/2,i,r,o)}}var OT=new IT;const Fg=yi(3);function vC(n,t,e,i){const r=t*Fg;return n.moveTo(e,i+-r/3*2),n.lineTo(t+e,i+r),n.lineTo(e-t,i+r),n.closePath(),!0}class zT extends xg{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,r){return vC(t,e/2/Fg,i,r)}drawOffset(t,e,i,r,o){return vC(t,e/2/Fg+o,i,r)}}var WT=new zT;function mC(n,t,e,i){const r=2*t;return n.moveTo(t+e,i-r),n.lineTo(e-t,i),n.lineTo(t+e,r+i),!0}class NT extends Oe{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,r){return mC(t,e/4,i,r)}drawOffset(t,e,i,r,o){return mC(t,e/4+o,i,r)}}var jT=new NT;function CC(n,t,e,i){const r=2*t;return n.moveTo(e-t,i-r),n.lineTo(e+t,i),n.lineTo(e-t,r+i),!0}class VT extends Oe{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,r){return CC(t,e/4,i,r)}drawOffset(t,e,i,r,o){return CC(t,e/4+o,i,r)}}var GT=new VT;function bC(n,t,e,i){const r=2*t;return n.moveTo(e-r,i+t),n.lineTo(e,i-t),n.lineTo(e+r,i+t),!0}class UT extends Oe{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,r){return bC(t,e/4,i,r)}drawOffset(t,e,i,r,o){return bC(t,e/4+o,i,r)}}var KT=new UT;function _C(n,t,e,i){const r=2*t;return n.moveTo(e-r,i-t),n.lineTo(e,i+t),n.lineTo(e+r,i-t),!0}class YT extends Oe{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,r){return _C(t,e/4,i,r)}drawOffset(t,e,i,r,o){return _C(t,e/4+o,i,r)}}var $T=new YT;function yC(n,t,e,i,r){return n.moveTo(e,i-t),n.lineTo(e,i+t),!0}class XT extends Oe{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,r,o){return yC(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,s){return yC(t,e/2+o,i,r,s)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e}, ${i-o} L ${e},${i+o}`}}var qT=new XT;function wC(n,t,e,i,r){return n.moveTo(e-t,i),n.lineTo(e+t,i),!0}class ZT extends Oe{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,r,o){return wC(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,s){return wC(t,e/2+o,i,r,s)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e-o}, ${i} L ${e+o},${i}`}}var JT=new ZT;function DC(n,t,e,i,r){return n.moveTo(e-t,i-t),n.lineTo(e+t,i+t),n.moveTo(e+t,i-t),n.lineTo(e-t,i+t),!0}class QT extends Oe{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,r,o){return DC(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,s){return DC(t,e/2+o,i,r,s)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e-o}, ${i-o} L ${e+o},${i+o} M ${e+o}, ${i-o} L ${e-o},${i+o}`}}var tM=new QT;function SC(n,t,e,i){return n.rect(e-t[0]/2,i-t[1]/2,t[0],t[1]),!1}function AC(n,t,e,i){const r=t,o=t/2;return n.rect(e-r/2,i-o/2,r,o),!1}class eM extends Oe{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,r){return lt(e)?AC(t,e,i,r):SC(t,e,i,r)}drawOffset(t,e,i,r,o){return lt(e)?AC(t,e+2*o,i,r):SC(t,[e[0]+2*o,e[1]+2*o],i,r)}}var iM=new eM;const nM=[tT,rT,sT,lT,WT,gT,mT,_T,wT,ST,xT,MT,HT,dT,OT,jT,GT,KT,$T,iM,qT,JT,tM],xC={};nM.forEach(n=>{xC[n.type]=n});const rM={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"},na=new me;class BC{constructor(t,e,i=!1){this.pathStr="",this.type=t,rt(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,r,o,s,a){return this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{t.beginPath(),Yn(l.path.commandList,t,i,r,e,e),a&&a(l.path,l.attribute)}),!1):(Yn(this.path.commandList,t,i,r,e+o,e+o),!1)}draw(t,e,i,r,o,s){return this.isSvg?!!this.svgCache&&(this.svgCache.forEach(a=>{t.beginPath(),Yn(a.path.commandList,t,i,r,e,e),s&&s(a.path,a.attribute)}),!1):(Yn(this.path.commandList,t,i,r,e,e),!1)}bounds(t,e){if(this.isSvg)return this.svgCache?(e.clear(),void this.svgCache.forEach(({path:i})=>{na.x1=i.bounds.x1*t,na.y1=i.bounds.y1*t,na.x2=i.bounds.x2*t,na.y2=i.bounds.y2*t,e.union(na)})):void 0;this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const oM=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",SW=oM+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040";function sM(n,t){const e=[];let i=t.exec(n);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const o=i.length;for(let s=0;s<o;s++)r.push(i[s]);e.push(r),i=t.exec(n)}return e}class Tg{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function FC(n,t,e,i){const r=n.indexOf(t,e);if(r===-1)throw new Error(i);return r+t.length-1}function aM(n,t,e=">"){let i,r="";for(let o=t;o<n.length;o++){let s=n[o];if(i)s===i&&(i="");else if(s==='"'||s==="'")i=s;else if(s===e[0]){if(!e[1])return{data:r,index:o};if(n[o+1]===e[1])return{data:r,index:o}}else s==="	"&&(s=" ");r+=s}}function TC(n,t,e,i=">"){const r=aM(n,t+1,i);if(!r)return;let o=r.data;const s=r.index,a=o.search(/\s/);let l=o,h=!0;a!==-1&&(l=o.substr(0,a).replace(/\s\s*$/,""),o=o.substr(a+1));const u=l;if(e){const d=l.indexOf(":");d!==-1&&(l=l.substr(d+1),h=l!==r.data.substr(d+1))}return{tagName:l,tagExp:o,closeIndex:s,attrExpPresent:h,rawTagName:u}}const lM=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");class hM{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const r=e.tagname;typeof r=="string"&&(e.tagname=r),t.addChild(e)}buildAttributesMap(t,e,i){const r={};if(!t)return;const o=sM(t,lM),s=o.length;for(let a=0;a<s;a++){const l=o[a][1],h=o[a][4],u=l;l&&(r[u]=h===void 0||(isNaN(h)?h:Number(h)))}return r}parseXml(t){t=t.replace(/\r\n?/g,`
`);const e=new Tg("!xml");let i=e,r="",o="";for(let s=0;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="/"){const a=FC(t,">",s,"Closing Tag is not closed."),l=o.lastIndexOf(".");o=o.substring(0,l),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",s=a}else if(t[s+1]==="?")s=TC(t,s,!1,"?>").closeIndex+1;else if(t.substr(s+1,3)==="!--")s=FC(t,"-->",s+4,"Comment is not closed.");else{const a=TC(t,s,!1);let l=a.tagName,h=a.tagExp;const u=a.attrExpPresent,d=a.closeIndex;if(l!==e.tagname&&(o+=o?"."+l:l),h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),o=o.substr(0,o.length-1),h=l):h=h.substr(0,h.length-1);const c=new Tg(l);l!==h&&u&&(c[":@"]=this.buildAttributesMap(h,o,l)),this.addChild(i,c,o),o=o.substr(0,o.lastIndexOf("."))}else{const c=new Tg(l);this.tagsNodeStack.push(i),l!==h&&u&&(c[":@"]=this.buildAttributesMap(h,o,l)),this.addChild(i,c,o),i=c}r="",s=d}else r+=t[s];return e.child}}function uM(n,t){return MC(n)}function MC(n,t){const e={};for(let i=0;i<n.length;i++){const r=n[i],o=dM(r);let s="";if(s=t===void 0?o:t+"."+o,o!==void 0&&r[o]){const a=MC(r[o],s);gM(a),r[":@"]&&cM(a,r[":@"],s),e[o]!==void 0&&e.hasOwnProperty(o)?(Array.isArray(e[o])||(e[o]=[e[o]]),e[o].push(a)):e[o]=a}}return e}function dM(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function cM(n,t,e){if(t){const i=Object.keys(t),r=i.length;for(let o=0;o<r;o++){const s=i[o];n[s]=t[s]}}}function gM(n){return Object.keys(n).length===0}class zh{constructor(t){this.options=Object.assign({},zh.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;const e=new hM(this.options).parseXml(t);return uM(e,this.options)}}zh.defaultOptions={};function fM(n){return n.startsWith("<svg")||n.startsWith("<?xml")}function AW(n){return n.startsWith("<")}const Wh=new me,RC=["symbolType","size",...ki];class rr extends vi{constructor(t={symbolType:"circle"}){super(t),this.type="symbol",this.numberType=Al}getParsedPath(){return this.shouldUpdateShape()&&(this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return rt(t)?t.length===2&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const t=X(this).symbol;let{symbolType:e=t.symbolType}=this.attribute,i=xC[e];if(i)return this._parsedPath=i,i;if(i=rr.userSymbolMap[e],i)return this._parsedPath=i,i;if(e=rM[e]||e,fM(e)===!0){const l=new zh,{svg:h}=l.parse(e);if(!h)return null;const u=rt(h.path)?h.path:[h.path];Wh.clear();const d=[];u.forEach(p=>{const v=new Ke().fromString(p.d),m={};wS.forEach(C=>{p[C]&&(m[Zp[C]]=p[C])}),d.push({path:v,attribute:m}),Wh.union(v.bounds)});const c=Wh.width(),g=Wh.height(),f=1/Cn(c,g);return d.forEach(p=>p.path.transform(0,0,f,f)),this._parsedPath=new BC(e,d,!0),rr.userSymbolMap[e]=this._parsedPath,this._parsedPath}const r=new Ke().fromString(e),o=r.bounds.width(),s=r.bounds.height(),a=1/Cn(o,s);return r.transform(0,0,a,a),this._parsedPath=new BC(e,r),rr.userSymbolMap[e]=this._parsedPath,this._parsedPath}doUpdateAABBBounds(t){const e=X(this).symbol;this._AABBBounds.clear();const i=this.attribute,r=$.graphicService.updateSymbolAABBBounds(i,X(this).symbol,this._AABBBounds,t,this),{boundsPadding:o=e.boundsPadding}=i,s=Ye(o);return s&&r.expand(s),this.clearUpdateBoundTag(),r}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return X(this).symbol[t]}needUpdateTags(t){return super.needUpdateTags(t,RC)}needUpdateTag(t){return super.needUpdateTag(t,RC)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=rt(e)?e:[e,e];return t.path?new Ke().fromCustomPath2D(t.path,0,0,i[0],i[1]):new Ke().fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new rr(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return rr.NOWORK_ANIMATE_ATTR}}rr.userSymbolMap={},rr.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},fi);function ra(n){return new rr(n)}function pM(){ct.RegisterGraphicCreator("symbol",ra)}class vM{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const g=t.getParsedPath();if(!g)return;const{outerBorder:f,innerBorder:p}=t.attribute,v=f&&f.visible!==!1,m=p&&p.visible!==!1;if(!v&&!m)return;const{size:C=h.size,opacity:b=h.opacity,x:_=h.x,y=h.y,scaleX:w=h.scaleX,scaleY:S=h.scaleY}=t.attribute,D=!(!f||!f.stroke),A=!(!p||!p.stroke);if(v){const{distance:x=h.outerBorder.distance}=f,B=si(e,x,e.dpr);if(e.beginPath(),g.drawOffset(e,C,i,r,B)===!1&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,f,h.outerBorder);else if(D){const F=h.outerBorder.opacity;h.outerBorder.opacity=b,e.setStrokeStyle(t,f,(_-i)/w,(y-r)/S,h.outerBorder),h.outerBorder.opacity=F,e.stroke()}}if(m){const{distance:x=h.innerBorder.distance}=p,B=si(e,x,e.dpr);if(e.beginPath(),g.drawOffset(e,C,i,r,-B)===!1&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,p,h.innerBorder);else if(A){const F=h.innerBorder.opacity;h.innerBorder.opacity=b,e.setStrokeStyle(t,p,(_-i)/w,(y-r)/S,h.innerBorder),h.innerBorder.opacity=F,e.stroke()}}}}const mM=new vM,CM=Bo,bM=Vr;var _M=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},yM=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},EC=function(n,t){return function(e,i){t(e,i,n)}};let Nh=class extends Si{constructor(n){super(),this.symbolRenderContribitions=n,this.numberType=Al,this.builtinContributions=[mM,bM,CM],this.init(n)}drawShape(n,t,e,i,r,o,s,a){var l;const h=X(n,o==null?void 0:o.theme).symbol,{size:u=h.size,x:d=h.x,y:c=h.y,scaleX:g=h.scaleX,scaleY:f=h.scaleY}=n.attribute,p=this.valid(n,h,s,a);if(!p)return;const{fVisible:v,sVisible:m,doFill:C,doStroke:b}=p,_=n.getParsedPath();if(!_)return;const{keepDirIn3d:y=h.keepDirIn3d}=n.attribute,w=(l=this.z)!==null&&l!==void 0?l:0;if(t.beginPath(),y&&t.camera&&t.project){const S=t.project(e,i,w),D=t.camera;t.camera=null,_.draw(t,rt(u)?[u[0]*g,u[1]*f]:u*g,S.x,S.y,void 0,(A,x)=>{var B,F,T;if(n._parsedPath.svgCache){const R=Object.assign({},x);R.fill=(B=x.fill)!==null&&B!==void 0?B:n.attribute.fill,R.opacity=(F=x.fill)!==null&&F!==void 0?F:n.attribute.opacity,R.fillOpacity=n.attribute.fillOpacity,R.stroke=(T=x.stroke)!==null&&T!==void 0?T:n.attribute.stroke,x=R}x.fill&&(s?s(t,n.attribute,h):(t.setCommonStyle(n,x,d-e,c-i,h),t.fill())),x.stroke&&(a?a(t,n.attribute,h):(t.setStrokeStyle(n,x,(d-e)/g,(c-i)/f,h),t.stroke()))})===!1&&t.closePath(),t.camera=D}else _.draw(t,u,e,i,w,(S,D)=>{var A,x,B;if(n._parsedPath.svgCache){const F=Object.assign({},D);F.fill=(A=D.fill)!==null&&A!==void 0?A:n.attribute.fill,F.opacity=(x=D.opacity)!==null&&x!==void 0?x:n.attribute.opacity,F.fillOpacity=n.attribute.fillOpacity,F.stroke=(B=D.stroke)!==null&&B!==void 0?B:n.attribute.stroke,D=F}D.fill&&(s?s(t,n.attribute,h):(t.setCommonStyle(n,D,d-e,c-i,h),t.fill())),D.stroke&&(a?a(t,n.attribute,h):(t.setStrokeStyle(n,D,(d-e)/g,(c-i)/f,h),t.stroke()))})===!1&&t.closePath();t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),this.beforeRenderStep(n,t,e,i,C,b,v,m,h,r,s,a),C&&!_.isSvg&&(s?s(t,n.attribute,h):v&&(t.setCommonStyle(n,n.attribute,d-e,c-i,h),t.fill())),b&&!_.isSvg&&(a?a(t,n.attribute,h):m&&(t.setStrokeStyle(n,n.attribute,(d-e)/g,(c-i)/f,h),t.stroke())),this.afterRenderStep(n,t,e,i,C,b,v,m,h,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).symbol;this._draw(n,r,!1,e,i)}};Nh=_M([Z(),EC(0,At(Le)),EC(0,Ne(kc)),yM("design:paramtypes",[Object])],Nh);let PC=!1;const wM=new ht(n=>{PC||(PC=!0,n(Nh).toSelf().inSingletonScope(),n(Hl).to(Nh).inSingletonScope(),n(We).toService(Hl),n(kc).toService(an),Qe(n,kc))});var DM=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SM=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},AM=function(n,t){return function(e,i){t(e,i,n)}};let Mg=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=Al}contains(n,t,e){const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=n.getParsedPath();if(!i.camera){if(!n.AABBBounds.containsPoint(t))return!1;if(r.isSvg||n.attribute.pickMode==="imprecise")return!0}i.highPerformanceSave();const o=X(n).symbol,s=this.transform(n,o,i),{x:a,y:l,z:h,lastModelMatrix:u}=s;let d=t;if(i.camera){d=t.clone();const g=n.parent.globalTransMatrix;d.x=g.a*t.x+g.c*t.y+g.e,d.y=g.b*t.x+g.d*t.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(n,i,a,l,{},null,(g,f,p)=>!!c||(c=g.isPointInPath(d.x,d.y),c),(g,f,p)=>{if(c)return!0;const v=f.lineWidth||p.lineWidth,m=f.pickStrokeBuffer||p.pickStrokeBuffer;return i.lineWidth=si(i,v+m,i.dpr),c=g.isPointInStroke(d.x,d.y),c}),this.canvasRenderer.z=0,i.modelMatrix!==u&&ie.free(i.modelMatrix),i.modelMatrix=u,i.highPerformanceRestore(),c}};Mg=DM([Z(),AM(0,At(Hl)),SM("design:paramtypes",[Object])],Mg);let HC=!1;const xM=new ht((n,t,e,i)=>{HC||(HC=!0,n(Xv).to(Mg).inSingletonScope(),n($e).toService(Xv))});var BM=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FM=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},TM=function(n,t){return function(e,i){t(e,i,n)}};let Rg=class{constructor(n){this.canvasRenderer=n,this.type="symbol",this.numberType=Al}contains(n,t,e){if(!n.AABBBounds.containsPoint(t))return!1;if(n.attribute.pickMode==="imprecise")return!0;const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=X(n).symbol;let{x:o=r.x,y:s=r.y}=n.attribute;if(i.highPerformanceSave(),n.transMatrix.onlyTranslate()){const l=n.getOffsetXY(r);o+=l.x,s+=l.y,i.setTransformForCurrent()}else o=0,s=0,i.transformFromMatrix(n.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(n,i,o,s,{},null,(l,h,u)=>!!a||(a=l.isPointInPath(t.x,t.y),a),(l,h,u)=>{if(a)return!0;const d=h.lineWidth||u.lineWidth,c=h.pickStrokeBuffer||u.pickStrokeBuffer;return i.lineWidth=d+c,a=l.isPointInStroke(t.x,t.y),a}),i.highPerformanceRestore(),a}};Rg=BM([Z(),TM(0,At(Hl)),FM("design:paramtypes",[Object])],Rg);let LC=!1;const MM=new ht((n,t,e,i)=>{LC||(LC=!0,n(kv).to(Rg).inSingletonScope(),n(tr).toService(kv))});function jh(){jh.__loaded||(jh.__loaded=!0,pM(),pt.load(wM),pt.load(hn?xM:MM))}jh.__loaded=!1;const zo=jh;class Eg{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i){if(e==="left"||e==="start")t.xOffset=0;else if(e==="center")t.xOffset=t.width/-2;else{if(e!=="right"&&e!=="end")throw new Error("\u975E\u6CD5\u7684textAlign");t.xOffset=-t.width}return t.yOffset=i==="top"?0:i==="middle"?t.height/-2:i==="alphabetic"?-.79*t.height:-t.height,t}GetLayout(t,e,i,r,o,s,a,l,h){const u=[],d=[e,i],c=[0,0];for(;t.length>0;){const{str:f}=this.textMeasure.clipTextWithSuffix(t,this.textOptions,e,a,l,h);u.push({str:f,width:this.textMeasure.measureTextWidth(f,this.textOptions)}),t=t.substring(f.length)}r==="left"||r==="start"||(r==="center"?c[0]=d[0]/-2:r!=="right"&&r!=="end"||(c[0]=-d[0])),o==="top"||(o==="middle"?c[1]=d[1]/-2:o==="bottom"&&(c[1]=-d[1]));const g={xOffset:c[0],yOffset:c[1],width:d[0],height:d[1]};return this.layoutWithBBox(g,u,r,o,s)}GetLayoutByLines(t,e,i,r,o="",s,a,l="end"){t=t.map(c=>c.toString());const h=[],u=[0,0];if(typeof a=="number"&&a!==1/0){let c;for(let g=0,f=t.length;g<f;g++)c=Math.min(this.textMeasure.measureTextWidth(t[g],this.textOptions),a),h.push({str:this.textMeasure.clipTextWithSuffix(t[g],this.textOptions,c,o,s,l).str,width:c});u[0]=a}else{let c,g;a=0;for(let f=0,p=t.length;f<p;f++)g=t[f],c=this.textMeasure.measureTextWidth(g,this.textOptions),a=Math.max(a,c),h.push({str:g,width:c});u[0]=a}u[1]=h.length*r,u[0]=h.reduce((c,g)=>Math.max(c,g.width),0);const d={xOffset:0,yOffset:0,width:u[0],height:u[1]};return this.LayoutBBox(d,e,i),this.layoutWithBBox(d,h,e,i,r)}layoutWithBBox(t,e,i,r,o){const s=[0,0],a=e.length*o;r==="top"||(r==="middle"?s[1]=(t.height-a)/2:r==="bottom"&&(s[1]=t.height-a));for(let l=0;l<e.length;l++)this.lineOffset(t,e[l],i,r,o,s);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:o,textAlign:i,textBaseline:r}}lineOffset(t,e,i,r,o,s){return i==="left"||i==="start"?e.leftOffset=0:i==="center"?e.leftOffset=(t.width-e.width)/2:i!=="right"&&i!=="end"||(e.leftOffset=t.width-e.width),e.topOffset=(o-this.textOptions.fontSize)/2+.79*this.textOptions.fontSize+s[1],s[1]+=o,e}}const kC=["text","maxLineWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...ki];class De extends vi{get font(){const t=X(this).text;return this._font||(this._font=Vc(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=X(this).text;if(!this.isSimplify())return;const{maxLineWidth:r=i.maxLineWidth}=e;return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((t=e.text)!==null&&t!==void 0?t:i.text).toString()}get clipedWidth(){if(this.isSimplify())return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){const t=X(this).text,e=this.attribute;if(this.isMultiLine)return;const{maxLineWidth:i=t.maxLineWidth}=e;return!!Number.isFinite(i)&&(this.tryUpdateAABBBounds(),e.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(r=>r.text).join("")!==e.text.toString():this.clipedText!=null&&this.clipedText!==e.text.toString())}get multilineLayout(){if(this.isMultiLine)return this.tryUpdateAABBBounds(),this.cache.layoutData}isSimplify(){return!this.isMultiLine&&this.attribute.direction!=="vertical"}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(t={text:"",fontSize:16}){super(t),this.type="text",this.numberType=xl,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return rt(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}doUpdateAABBBounds(){const t=X(this).text;this._AABBBounds.clear();const e=this.attribute,i=$.graphicService.updateTextAABBBounds(e,t,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=this.attribute,o=Ye(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}updateWrapAABBBounds(t){var e,i,r,o;const s=X(this).text,{fontFamily:a=s.fontFamily,textAlign:l=s.textAlign,textBaseline:h=s.textBaseline,fontSize:u=s.fontSize,ellipsis:d=s.ellipsis,maxLineWidth:c,stroke:g=s.stroke,lineWidth:f=s.lineWidth,wordBreak:p=s.wordBreak,fontWeight:v=s.fontWeight,ignoreBuf:m=s.ignoreBuf,suffixPosition:C=s.suffixPosition,heightLimit:b=0,lineClamp:_}=this.attribute,y=(e=Jn(this.attribute.lineHeight,this.attribute.fontSize||s.fontSize))!==null&&e!==void 0?e:this.attribute.fontSize||s.fontSize,w=m?0:2;if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const M=this.cache.layoutData.bbox;return this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}const S=$.graphicUtil.textMeasure,D=new Eg(a,{fontSize:u,fontWeight:v,fontFamily:a},S),A=rt(t)?t.map(M=>M.toString()):[t.toString()],x=[],B=[0,0];let F=1/0;if(b>0&&(F=Math.max(Math.floor(b/y),1)),_&&(F=Math.min(F,_)),typeof c=="number"&&c!==1/0){if(c>0)for(let E=0;E<A.length;E++){const P=A[E];let I=!0;if(E===F-1){const H=D.textMeasure.clipTextWithSuffix(P,D.textOptions,c,d,!1,C);x.push({str:H.str,width:H.width});break}const k=D.textMeasure.clipText(P,D.textOptions,c,p==="break-word");if(P!==""&&k.str===""){if(d){const H=D.textMeasure.clipTextWithSuffix(P,D.textOptions,c,d,!1,C);k.str=(r=H.str)!==null&&r!==void 0?r:"",k.width=(o=H.width)!==null&&o!==void 0?o:0}else k.str="",k.width=0;I=!1}if(x.push({str:k.str,width:k.width}),k.str.length!==P.length){if(I){const H=P.substring(k.str.length);A.splice(E+1,0,H)}}}let M=0;x.forEach(E=>{M=Math.max(M,E.width)}),B[0]=M}else{let M,E,P=0;for(let I=0,k=A.length;I<k;I++){if(I===F-1){const H=D.textMeasure.clipTextWithSuffix(A[I],D.textOptions,c,d,!1,C);x.push({str:H.str,width:H.width}),P=Math.max(P,H.width);break}E=A[I],M=D.textMeasure.measureTextWidth(E,D.textOptions,p==="break-word"),P=Math.max(P,M),x.push({str:E,width:M})}B[0]=P}B[1]=x.length*(y+w);const T={xOffset:0,yOffset:0,width:B[0],height:B[1]};D.LayoutBBox(T,l,h);const R=D.layoutWithBBox(T,x,l,h,y);return this.cache.layoutData=R,this.clearUpdateShapeTag(),this._AABBBounds.set(T.xOffset,T.yOffset,T.xOffset+T.width,T.yOffset+T.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}updateSingallineAABBBounds(t){const e=X(this).text,{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,o=i==="horizontal"?this.updateHorizontalSinglelineAABBBounds(t):this.updateVerticalSinglelineAABBBounds(t);return i==="horizontal"&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}updateMultilineAABBBounds(t){const e=X(this).text,{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,o=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return i==="horizontal"&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}updateHorizontalSinglelineAABBBounds(t){var e,i;const r=X(this).text,{wrap:o=r.wrap}=this.attribute;if(o)return this.updateWrapAABBBounds([t]);const s=$.graphicUtil.textMeasure;let a,l;const h=this.attribute,{maxLineWidth:u=r.maxLineWidth,ellipsis:d=r.ellipsis,textAlign:c=r.textAlign,textBaseline:g=r.textBaseline,fontFamily:f=r.fontFamily,fontSize:p=r.fontSize,fontWeight:v=r.fontWeight,stroke:m=r.stroke,lineWidth:C=r.lineWidth,ignoreBuf:b=r.ignoreBuf,whiteSpace:_=r.whiteSpace,suffixPosition:y=r.suffixPosition}=h;if(_==="normal")return this.updateWrapAABBBounds(t);const w=b?0:Math.max(2,.075*p),S=h.fontSize||r.fontSize,D=(e=Jn(h.lineHeight,S))!==null&&e!==void 0?e:S+w;if(!this.shouldUpdateShape()&&this.cache){a=(i=this.cache.clipedWidth)!==null&&i!==void 0?i:0;const F=Ln(c,a),T=kn(g,D,p);return this._AABBBounds.set(F,T,F+a,T+D),m&&this._AABBBounds.expand(C/2),this._AABBBounds}if(Number.isFinite(u)){if(d){const F=d===!0?r.ellipsis:d,T=s.clipTextWithSuffix(t.toString(),{fontSize:p,fontWeight:v,fontFamily:f},u,F,!1,y);l=T.str,a=T.width}else{const F=s.clipText(t.toString(),{fontSize:p,fontWeight:v,fontFamily:f},u,!1);l=F.str,a=F.width}this.cache.clipedText=l,this.cache.clipedWidth=a}else a=s.measureTextWidth(t.toString(),{fontSize:p,fontWeight:v,fontFamily:f}),this.cache.clipedText=t.toString(),this.cache.clipedWidth=a;this.clearUpdateShapeTag();const A=Ln(c,a);let x=D;$.global&&$.global.isSafari()&&(x+=.2*p);const B=kn(g,x,p,w);return this._AABBBounds.set(A,B,A+a,B+x),m&&this._AABBBounds.expand(C/2),this._AABBBounds}getBaselineMapAlign(){return De.baselineMapAlign}getAlignMapBaseline(){return De.alignMapBaseline}updateVerticalSinglelineAABBBounds(t){var e,i,r;const o=X(this).text,s=$.graphicUtil.textMeasure;let a;const l=this.attribute,{ignoreBuf:h=o.ignoreBuf}=l,u=h?0:2,{maxLineWidth:d=o.maxLineWidth,ellipsis:c=o.ellipsis,fontSize:g=o.fontSize,fontWeight:f=o.fontWeight,fontFamily:p=o.fontFamily,stroke:v=o.stroke,lineWidth:m=o.lineWidth,verticalMode:C=o.verticalMode,suffixPosition:b=o.suffixPosition}=l,_=(e=Jn(l.lineHeight,l.fontSize||o.fontSize))!==null&&e!==void 0?e:(l.fontSize||o.fontSize)+u;let{textAlign:y=o.textAlign,textBaseline:w=o.textBaseline}=l;if(!C){const x=y;y=(i=De.baselineMapAlign[w])!==null&&i!==void 0?i:"left",w=(r=De.alignMapBaseline[x])!==null&&r!==void 0?r:"top"}if(!this.shouldUpdateShape()&&this.cache){a=this.cache.clipedWidth;const x=Ln(y,a),B=kn(w,_,g);return this._AABBBounds.set(B,x,B+_,x+a),v&&this._AABBBounds.expand(m/2),this._AABBBounds}let S=[Up(t.toString())];if(Number.isFinite(d)){if(c){const x=c===!0?o.ellipsis:c,B=s.clipTextWithSuffixVertical(S[0],{fontSize:g,fontWeight:f,fontFamily:p},d,x,!1,b);S=[B.verticalList],a=B.width}else{const x=s.clipTextVertical(S[0],{fontSize:g,fontWeight:f,fontFamily:p},d,!1);S=[x.verticalList],a=x.width}this.cache.verticalList=S,this.cache.clipedWidth=a}else a=0,S[0].forEach(x=>{const B=x.direction===Or.HORIZONTAL?g:s.measureTextWidth(x.text,{fontSize:g,fontWeight:f,fontFamily:p});a+=B,x.width=B}),this.cache.verticalList=S,this.cache.clipedWidth=a;this.clearUpdateShapeTag();const D=Ln(y,a),A=kn(w,_,g);return this._AABBBounds.set(A,D,A+_,D+a),v&&this._AABBBounds.expand(m/2),this._AABBBounds}updateHorizontalMultilineAABBBounds(t){var e,i;const r=X(this).text,{wrap:o=r.wrap}=this.attribute;if(o)return this.updateWrapAABBBounds(t);const s=this.attribute,{fontFamily:a=r.fontFamily,textAlign:l=r.textAlign,textBaseline:h=r.textBaseline,fontSize:u=r.fontSize,fontWeight:d=r.fontWeight,ellipsis:c=r.ellipsis,maxLineWidth:g,stroke:f=r.stroke,lineWidth:p=r.lineWidth,whiteSpace:v=r.whiteSpace,suffixPosition:m=r.suffixPosition}=s,C=(e=Jn(s.lineHeight,s.fontSize||r.fontSize))!==null&&e!==void 0?e:s.fontSize||r.fontSize;if(v==="normal")return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const w=this.cache.layoutData.bbox;return this._AABBBounds.set(w.xOffset,w.yOffset,w.xOffset+w.width,w.yOffset+w.height),f&&this._AABBBounds.expand(p/2),this._AABBBounds}const b=$.graphicUtil.textMeasure,_=new Eg(a,{fontSize:u,fontWeight:d,fontFamily:a},b).GetLayoutByLines(t,l,h,C,c===!0?r.ellipsis:c||void 0,!1,g,m),{bbox:y}=_;return this.cache.layoutData=_,this.clearUpdateShapeTag(),this._AABBBounds.set(y.xOffset,y.yOffset,y.xOffset+y.width,y.yOffset+y.height),f&&this._AABBBounds.expand(p/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){var e,i,r;const o=X(this).text,s=$.graphicUtil.textMeasure;let a;const l=this.attribute,{ignoreBuf:h=o.ignoreBuf}=l,u=h?0:2,{maxLineWidth:d=o.maxLineWidth,ellipsis:c=o.ellipsis,fontFamily:g=o.fontFamily,fontSize:f=o.fontSize,fontWeight:p=o.fontWeight,stroke:v=o.stroke,lineWidth:m=o.lineWidth,verticalMode:C=o.verticalMode,suffixPosition:b=o.suffixPosition}=l,_=(e=Jn(l.lineHeight,l.fontSize||o.fontSize))!==null&&e!==void 0?e:(l.fontSize||o.fontSize)+u;let{textAlign:y=o.textAlign,textBaseline:w=o.textBaseline}=l;if(!C){const B=y;y=(i=De.baselineMapAlign[w])!==null&&i!==void 0?i:"left",w=(r=De.alignMapBaseline[B])!==null&&r!==void 0?r:"top"}if(a=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(R=>{const M=R.reduce((E,P)=>E+P.width,0);a=Cn(M,a)});const B=Ln(y,a),F=this.cache.verticalList.length*_,T=kn(w,F,f);return this._AABBBounds.set(T,B,T+F,B+a),v&&this._AABBBounds.expand(m/2),this._AABBBounds}const S=t.map(B=>Up(B.toString()));S.forEach((B,F)=>{if(Number.isFinite(d))if(c){const T=c===!0?o.ellipsis:c,R=s.clipTextWithSuffixVertical(B,{fontSize:f,fontWeight:p,fontFamily:g},d,T,!1,b);S[F]=R.verticalList,a=R.width}else{const T=s.clipTextVertical(B,{fontSize:f,fontWeight:p,fontFamily:g},d,!1);S[F]=T.verticalList,a=T.width}else a=0,B.forEach(T=>{const R=T.direction===Or.HORIZONTAL?f:s.measureTextWidth(T.text,{fontSize:f,fontWeight:p,fontFamily:g});a+=R,T.width=R})}),this.cache.verticalList=S,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(B=>{const F=B.reduce((T,R)=>T+R.width,0);a=Cn(F,a)});const D=Ln(y,a),A=this.cache.verticalList.length*_,x=kn(w,A,f);return this._AABBBounds.set(x,D,x+A,D+a),v&&this._AABBBounds.expand(m/2),this._AABBBounds}tryUpdateOBBBounds(){throw new Error("\u6682\u4E0D\u652F\u6301")}getDefaultAttribute(t){return X(this).text[t]}needUpdateTags(t,e=kC){return super.needUpdateTags(t,e)}needUpdateTag(t,e=kC){return super.needUpdateTag(t,e)}clone(){return new De(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return De.NOWORK_ANIMATE_ATTR}}De.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},fi),De.baselineMapAlign={top:"left",bottom:"right",middle:"center"},De.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function IC(n){return new De(n)}function RM(){ct.RegisterGraphicCreator("text",IC)}var EM=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PM=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},OC=function(n,t){return function(e,i){t(e,i,n)}};let Pg=class extends Si{constructor(n){super(),this.textRenderContribitions=n,this.numberType=xl,this.builtinContributions=[rC],this.init(n)}drawShape(n,t,e,i,r,o,s,a){var l,h,u;const d=X(n,o==null?void 0:o.theme).text,{text:c,underline:g=d.underline,lineThrough:f=d.lineThrough,keepDirIn3d:p=d.keepDirIn3d,direction:v=d.direction,whiteSpace:m=d.whiteSpace,fontSize:C=d.fontSize,verticalMode:b=d.verticalMode,x:_=d.x,y=d.y}=n.attribute;let{textAlign:w=d.textAlign,textBaseline:S=d.textBaseline}=n.attribute;if(!b&&v==="vertical"){const P=w;w=(l=n.getBaselineMapAlign()[S])!==null&&l!==void 0?l:"left",S=(h=n.getAlignMapBaseline()[P])!==null&&h!==void 0?h:"top"}const D=(u=Jn(n.attribute.lineHeight,C))!==null&&u!==void 0?u:C,A=this.valid(n,d,s,a);if(!A)return;const{fVisible:x,sVisible:B,doFill:F,doStroke:T}=A,R=!p,M=this.z||0;t.beginPath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,d),this.beforeRenderStep(n,t,e,i,F,T,x,B,d,r,s,a),R&&this.transformUseContext2d(n,d,M,t);const E=(P,I,k,H)=>{let O=e+I;const z=i+k;if(H){t.highPerformanceSave(),O+=C;const j=on.allocate(1,0,0,1,0,0);j.rotateByCenter(Math.PI/2,O,z),t.transformFromMatrix(j,!0),on.free(j)}T&&(a?a(t,n.attribute,d):B&&(t.setStrokeStyle(n,n.attribute,_-e,y-i,d),t.strokeText(P,O,z,M))),F&&(s?s(t,n.attribute,d):x&&(t.setCommonStyle(n,n.attribute,_-e,y-i,d),t.fillText(P,O,z,M),this.drawUnderLine(g,f,n,O,z,M,d,t))),H&&(t.highPerformanceRestore(),t.setTransformForCurrent())};if(n.isMultiLine)if(t.setTextStyleWithoutAlignBaseline(n.attribute,d,M),v==="horizontal"){const{multilineLayout:P}=n;if(!P)return void t.highPerformanceRestore();const{xOffset:I,yOffset:k}=P.bbox;T&&(a?a(t,n.attribute,d):B&&(t.setStrokeStyle(n,n.attribute,_-e,y-i,d),P.lines.forEach(H=>{t.strokeText(H.str,(H.leftOffset||0)+I+e,(H.topOffset||0)+k+i,M)}))),F&&(s?s(t,n.attribute,d):x&&(t.setCommonStyle(n,n.attribute,_-e,y-i,d),P.lines.forEach(H=>{t.fillText(H.str,(H.leftOffset||0)+I+e,(H.topOffset||0)+k+i,M),this.drawMultiUnderLine(g,f,n,(H.leftOffset||0)+e,(H.topOffset||0)+k+i-ex("bottom",C)-.05*C,M,H.width,d,t)})))}else{n.tryUpdateAABBBounds();const P=n.cache,{verticalList:I}=P;t.textAlign="left",t.textBaseline="top";const k=D*I.length;let H=0;I.forEach(j=>{const U=j.reduce((W,V)=>W+(V.width||0),0);H=Cn(U,H)});let O=0,z=0;S==="bottom"?z=-k:S==="middle"&&(z=-k/2),w==="center"?O-=H/2:w==="right"&&(O-=H),I.forEach((j,U)=>{const W=j.reduce((G,K)=>G+(K.width||0),0),V=H-W;let L=O;w==="center"?L+=V/2:w==="right"&&(L+=V),j.forEach(G=>{const{text:K,width:Y,direction:nt}=G;E(K,k-(U+1)*D+z,L,nt),L+=Y})})}else if(v==="horizontal"){t.setTextStyle(n.attribute,d,M);const P=n.clipedText;let I=0;D!==C&&(S==="top"?I=(D-C)/2:S==="middle"||S==="bottom"&&(I=-(D-C)/2)),E(P,0,I,0)}else{n.tryUpdateAABBBounds();const P=n.cache;if(P){t.setTextStyleWithoutAlignBaseline(n.attribute,d,M);const{verticalList:I}=P;let k=0;const H=I[0].reduce((z,j)=>z+(j.width||0),0);let O=0;S==="bottom"?O=-D:S==="middle"&&(O=-D/2),w==="center"?k-=H/2:w==="right"&&(k-=H),t.textAlign="left",t.textBaseline="top",I[0].forEach(z=>{const{text:j,width:U,direction:W}=z;E(j,O,k,W),k+=U})}}R&&this.restoreTransformUseContext2d(n,d,M,t),this.afterRenderStep(n,t,e,i,F,T,x,B,d,r,s,a)}draw(n,t,e,i){const r=X(n,i==null?void 0:i.theme).text,{keepDirIn3d:o=r.keepDirIn3d}=n.attribute,s=!o;this._draw(n,r,s,e,i)}drawUnderLine(n,t,e,i,r,o,s,a){if(t+n<=0)return;const{textAlign:l=s.textAlign,textBaseline:h=s.textBaseline,fontSize:u=s.fontSize,fill:d=s.fill,opacity:c=s.opacity,underlineOffset:g=s.underlineOffset,underlineDash:f=s.underlineDash,fillOpacity:p=s.fillOpacity}=e.attribute,v=e.clipedWidth,m=Ln(l,v),C=kn(h,u,u),b={lineWidth:0,stroke:d,opacity:c,strokeOpacity:p};if(n){b.lineWidth=n,a.setStrokeStyle(e,b,i,r,s),a.setLineDash(f),a.beginPath();const _=r+C+u+g;a.moveTo(i+m,_,o),a.lineTo(i+m+v,_,o),a.stroke()}if(t){b.lineWidth=t,a.setStrokeStyle(e,b,i,r,s),a.beginPath();const _=r+C+u/2;a.moveTo(i+m,_,o),a.lineTo(i+m+v,_,o),a.stroke()}}drawMultiUnderLine(n,t,e,i,r,o,s,a,l){if(t+n<=0)return;const{textAlign:h=a.textAlign,fontSize:u=a.fontSize,fill:d=a.fill,opacity:c=a.opacity,underlineOffset:g=a.underlineOffset,underlineDash:f=a.underlineDash,fillOpacity:p=a.fillOpacity}=e.attribute,v=Ln(h,s),m=kn("alphabetic",u,u),C={lineWidth:0,stroke:d,opacity:c,strokeOpacity:p};let b=-3;if(n){C.lineWidth=n,l.setStrokeStyle(e,C,i,r,a),l.setLineDash(f),l.beginPath();const _=r+m+u+b+g;l.moveTo(i+v,_,o),l.lineTo(i+v+s,_,o),l.stroke()}if(b=-1,t){C.lineWidth=t,l.setStrokeStyle(e,C,i,r,a),l.beginPath();const _=r+m+u/2+b;l.moveTo(i+v,_,o),l.lineTo(i+v+s,_,o),l.stroke()}}};Pg=EM([Z(),OC(0,At(Le)),OC(0,Ne(ql)),PM("design:paramtypes",[Object])],Pg);let zC=!1;const HM=new ht(n=>{zC||(zC=!0,n(uc).to(Pg).inSingletonScope(),n(We).toService(uc),n(ql).toService(an),Qe(n,ql))});var LM=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},kM=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},IM=function(n,t){return function(e,i){t(e,i,n)}};let Hg=class extends er{constructor(n){super(),this.canvasRenderer=n,this.type="text",this.numberType=xl}contains(n,t,e){const{pickContext:i}=e!=null?e:{};if(!i)return!1;const r=n.AABBBounds;if(!i.camera)return!!r.containsPoint(t);i.highPerformanceSave();const o=X(n).text,{keepDirIn3d:s=o.keepDirIn3d}=n.attribute,a=!s,l=this.transform(n,o,i,a),{x:h,y:u,z:d,lastModelMatrix:c}=l;this.canvasRenderer.z=d;let g=t;if(i.camera){g=t.clone();const p=n.parent.globalTransMatrix;g.x=p.a*t.x+p.c*t.y+p.e,g.y=p.b*t.x+p.d*t.y+p.f}let f=!1;return this.canvasRenderer.drawShape(n,i,h,u,{},null,(p,v,m)=>{if(f)return!0;const{fontSize:C=o.fontSize,textBaseline:b=o.textBaseline,textAlign:_=o.textAlign}=n.attribute,y=n.AABBBounds,w=y.height(),S=y.width(),D=kn(b,w,C),A=Ln(_,S);return p.rect(A+h,D+u,S,w,d),f=p.isPointInPath(g.x,g.y),f},(p,v,m)=>f),this.canvasRenderer.z=0,i.modelMatrix!==c&&ie.free(i.modelMatrix),i.modelMatrix=c,i.highPerformanceRestore(),f}};Hg=LM([Z(),IM(0,At(uc)),kM("design:paramtypes",[Object])],Hg);let WC=!1;const OM=new ht((n,t,e,i)=>{WC||(WC=!0,n(qv).to(Hg).inSingletonScope(),n($e).toService(qv))});var zM=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Lg=class{constructor(){this.type="text",this.numberType=xl}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};Lg=zM([Z()],Lg);let NC=!1;const WM=new ht((n,t,e,i)=>{NC||(NC=!0,n(Iv).to(Lg).inSingletonScope(),n(tr).toService(Iv))});function Vh(){Vh.__loaded||(Vh.__loaded=!0,RM(),pt.load(HM),pt.load(hn?OM:WM))}Vh.__loaded=!1;const oa=Vh,Gh=["heightLimit","lineClamp"];class Uh extends De{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return rt(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}updateMultilineAABBBounds(t){var e,i,r,o;const s=X(this).text,{fontFamily:a=s.fontFamily,textAlign:l=s.textAlign,textBaseline:h=s.textBaseline,fontSize:u=s.fontSize,ellipsis:d=s.ellipsis,maxLineWidth:c,stroke:g=s.stroke,lineWidth:f=s.lineWidth,wordBreak:p=s.wordBreak,fontWeight:v=s.fontWeight,ignoreBuf:m=s.ignoreBuf,heightLimit:C=0,suffixPosition:b=s.suffixPosition,lineClamp:_}=this.attribute,y=(e=Jn(this.attribute.lineHeight,this.attribute.fontSize||s.fontSize))!==null&&e!==void 0?e:this.attribute.fontSize||s.fontSize,w=m?0:2;if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const M=this.cache.layoutData.bbox;return this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}const S=$.graphicUtil.textMeasure,D=new Eg(a,{fontSize:u,fontWeight:v,fontFamily:a},S),A=t.map(M=>M.toString()),x=[],B=[0,0];let F=1/0;if(C>0&&(F=Math.max(Math.floor(C/y),1)),_&&(F=Math.min(F,_)),typeof c=="number"&&c!==1/0){if(c>0)for(let E=0;E<A.length;E++){const P=A[E];let I=!0;if(E===F-1){const H=D.textMeasure.clipTextWithSuffix(P,D.textOptions,c,d,!1,b);x.push({str:H.str,width:H.width});break}const k=D.textMeasure.clipText(P,D.textOptions,c,p==="break-word");if(P!==""&&k.str===""){if(d){const H=D.textMeasure.clipTextWithSuffix(P,D.textOptions,c,d,!1,b);k.str=(r=H.str)!==null&&r!==void 0?r:"",k.width=(o=H.width)!==null&&o!==void 0?o:0}else k.str="",k.width=0;I=!1}if(x.push({str:k.str,width:k.width}),k.str.length!==P.length){if(I){const H=P.substring(k.str.length);A.splice(E+1,0,H)}}}let M=0;x.forEach(E=>{M=Math.max(M,E.width)}),B[0]=M}else{let M,E,P=0;for(let I=0,k=A.length;I<k;I++){if(I===F-1){const H=D.textMeasure.clipTextWithSuffix(A[I],D.textOptions,c,d,!1,b);x.push({str:H.str,width:H.width}),P=Math.max(P,H.width);break}E=A[I],M=D.textMeasure.measureTextWidth(E,D.textOptions,p==="break-word"),P=Math.max(P,M),x.push({str:E,width:M})}B[0]=P}B[1]=x.length*(y+w);const T={xOffset:0,yOffset:0,width:B[0],height:B[1]};D.LayoutBBox(T,l,h);const R=D.layoutWithBBox(T,x,l,h,y);return this.cache.layoutData=R,this.clearUpdateShapeTag(),this._AABBBounds.set(T.xOffset,T.yOffset,T.xOffset+T.width,T.yOffset+T.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<Gh.length;e++){const i=Gh[e];if(t.indexOf(i)!==-1)return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<Gh.length;e++)if(t===Gh[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return Uh.NOWORK_ANIMATE_ATTR}}function NM(n){return new Uh(n)}function jM(){ct.RegisterGraphicCreator("wrapText",NM)}function Kh(){Kh.__loaded||(Kh.__loaded=!0,jM())}Kh.__loaded=!1;const Yh=Kh;var be=n=>n===void 0;class $h extends Ss{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){throw new Error("Method not implemented.")}}class Oi extends $h{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const r=new Oi(this.manager);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyPointerData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice(),r.type=this.type,r}}class Dr extends $h{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const r=new Dr(this.manager);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyWheelData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice(),r.type=this.type,r}}Dr.DOM_DELTA_PIXEL=0,Dr.DOM_DELTA_LINE=1,Dr.DOM_DELTA_PAGE=2;const jC="*",$r=typeof performance=="object"&&performance.now?performance:Date,BW=2048;function Sr(n){return n==="mouse"||n==="pen"}const FW=200;class VM{constructor(t,e){this.dispatch=new(Ds()),this.cursorTarget=null,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,r)=>{if(!(i instanceof Oi))return void te.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(o,"pointerdown"),o.pointerType==="touch")this.dispatchEvent(o,"touchstart");else if(Sr(o.pointerType)){const s=o.button===2;this.dispatchEvent(o,s?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=o.composedPath(),this.freeEvent(o)},this.onPointerMove=(i,r)=>{var o,s;if(!(i instanceof Oi))return void te.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.createPointerEvent(i,i.type,r),l=Sr(a.pointerType),h=this.trackingData(i.pointerId),u=this.findMountedTarget(h.overTargets);if(h.overTargets&&u&&u!==this.rootTarget&&u!==a.target){const d=i.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(i,d,u||void 0);if(this.dispatchEvent(c,"pointerout"),l&&this.dispatchEvent(c,"mouseout"),!a.composedPath().includes(u)){const g=this.createPointerEvent(i,"pointerleave",u||void 0);for(g.eventPhase=g.AT_TARGET;g.target&&!a.composedPath().includes(g.target);)g.currentTarget=g.target,this.notifyTarget(g),l&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(c)}if(u!==a.target){const d=i.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(a,d);this.dispatchEvent(c,"pointerover"),l&&this.dispatchEvent(c,"mouseover");let g=u==null?void 0:u.parent;for(;g&&g!==this.rootTarget.parent&&g!==a.target;)g=g.parent;if(!g||g===this.rootTarget.parent){const f=this.clonePointerEvent(a,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==u&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),l&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}this.dispatchEvent(a,"pointermove"),a.pointerType==="touch"&&this.dispatchEvent(a,"touchmove"),l&&(this.dispatchEvent(a,"mousemove"),this.cursorTarget=a.target,this.cursor=((s=(o=a.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0?void 0:s.cursor)||this.rootTarget.getCursor()),h.overTargets=a.composedPath(),this.freeEvent(a)},this.onPointerOver=(i,r)=>{var o,s;if(!(i instanceof Oi))return void te.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.trackingData(i.pointerId),l=this.createPointerEvent(i,i.type,r),h=Sr(l.pointerType);this.dispatchEvent(l,"pointerover"),h&&this.dispatchEvent(l,"mouseover"),l.pointerType==="mouse"&&(this.cursorTarget=l.target,this.cursor=((s=(o=l.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0?void 0:s.cursor)||this.rootTarget.getCursor());const u=this.clonePointerEvent(l,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),h&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;a.overTargets=l.composedPath(),this.freeEvent(l),this.freeEvent(u)},this.onPointerOut=(i,r)=>{if(!(i instanceof Oi))return void te.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId);if(o.overTargets){const s=Sr(i.pointerType),a=this.findMountedTarget(o.overTargets),l=this.createPointerEvent(i,"pointerout",a||void 0);this.dispatchEvent(l),s&&this.dispatchEvent(l,"mouseout");const h=this.createPointerEvent(i,"pointerleave",a||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),s&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;o.overTargets=[],this.freeEvent(l),this.freeEvent(h)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,r)=>{var o;if(!(i instanceof Oi))return void te.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=$r.now(),a=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(a,"pointerup"),a.pointerType==="touch")this.dispatchEvent(a,"touchend");else if(Sr(a.pointerType)){const d=a.button===2;this.dispatchEvent(a,d?"rightup":"mouseup")}const l=this.trackingData(i.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[i.button]);let u=h;if(h&&!a.composedPath().includes(h)){let d=h;for(;d&&!a.composedPath().includes(d);){if(a.currentTarget=d,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch")this.notifyTarget(a,"touchendoutside");else if(Sr(a.pointerType)){const c=a.button===2;this.notifyTarget(a,c?"rightupoutside":"mouseupoutside")}d=d.parent}delete l.pressTargetsByButton[i.button],u=d}if(u){const d=this.clonePointerEvent(a,"click");d.target=u,d.path=[],l.clicksByButton[i.button]||(l.clicksByButton[i.button]={clickCount:0,target:d.target,timeStamp:s});const c=l.clicksByButton[i.button];c.target===d.target&&s-c.timeStamp<((o=this._config.clickInterval)!==null&&o!==void 0?o:200)?++c.clickCount:c.clickCount=1,c.target=d.target,c.timeStamp=s,d.detail=c.clickCount,Sr(d.pointerType)?(this.dispatchEvent(d,"click"),c.clickCount===2&&this.dispatchEvent(d,"dblclick")):d.pointerType==="touch"&&(this.dispatchEvent(d,"tap"),c.clickCount===2&&this.dispatchEvent(d,"dbltap")),this.dispatchEvent(d,"pointertap"),this.freeEvent(d)}this.freeEvent(a)},this.onPointerUpOutside=(i,r)=>{if(!(i instanceof Oi))return void te.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId),s=this.findMountedTarget(o.pressTargetsByButton[i.button]),a=this.createPointerEvent(i,i.type,r);if(s){let l=s;for(;l;)a.currentTarget=l,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch"?this.notifyTarget(a,"touchendoutside"):Sr(a.pointerType)&&this.notifyTarget(a,a.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete o.pressTargetsByButton[i.button]}this.freeEvent(a)},this.onWheel=(i,r)=>{if(!(i instanceof Dr))return void te.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const o=this.createWheelEvent(i,r);this.dispatchEvent(o),this.freeEvent(o)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,r)=>i.priority-r.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,r,o,s,a,l;if(!this.rootTarget)return;const h=this.mappingTable[t.type];let u;const d=`${t.canvasX}-${t.canvasY}`;if(!((e=this._prePointTargetCache)===null||e===void 0)&&e[d]&&(!((r=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[d])===null||r===void 0)&&r.stage)&&((s=(o=this._prePointTargetCache)===null||o===void 0?void 0:o[d])===null||s===void 0?void 0:s.stage.renderCount)===((a=this._prePointTargetCache)===null||a===void 0?void 0:a.stageRenderCount)?u=this._prePointTargetCache[d]:(u=this.pickTarget(t.canvasX,t.canvasY,t),t.pickParams||(this._prePointTargetCache={[d]:u,stageRenderCount:(l=u==null?void 0:u.stage.renderCount)!==null&&l!==void 0?l:-1})),h)for(let c=0,g=h.length;c<g;c++)h[c].fn(t,u);else te.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,o=i.length-1;r<o;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){e=e!=null?e:t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const r=this.allocateEvent(Oi);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i||this.pickTarget(r.global.x,r.global.y,r),typeof e=="string"&&(r.type=e),r}createWheelEvent(t,e){const i=this.allocateEvent(Dr);return this.copyWheelData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=e||this.pickTarget(i.global.x,i.global.y,i),i}clonePointerEvent(t,e){const i=this.allocateEvent(Oi);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e!=null?e:i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Oi&&e instanceof Oi&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof $h&&e instanceof $h&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(i=>{e[i].x=t[i].x,e[i].y=t[i].y}))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=$r.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=((e=this.eventPool.get(t))===null||e===void 0?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(e=this.eventPool.get(i))===null||e===void 0||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeEventListener(e,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events[jC];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e)}pickTarget(t,e,i){let r;const o=this.rootTarget.pick(t,e);return r=o&&o.graphic?o.graphic:o&&o.group?o.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=o.params),r}}const TW=1,GM={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class UM{constructor(t){this.resolution=1,this.onPointerDown=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const c=this.normalizeToPointerData(d);this.autoPreventDefault&&c[0].isNormalized&&(d.cancelable||!("cancelable"in d))&&d.preventDefault();for(let g=0,f=c.length;g<f;g++){const p=c[g],v=this.bootstrapEvent(this.rootPointerEvent,p);this.manager.mapEvent(v)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onPointerMove=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch"||this.isEventOutsideOfTargetElement(d))return;const c=this.normalizeToPointerData(d);for(let g=0,f=c.length;g<f;g++){const p=this.bootstrapEvent(this.rootPointerEvent,c[g]);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onPointerUp=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const c=this.isEventOutsideOfTargetElement(d)?"outside":"",g=this.normalizeToPointerData(d);for(let f=0,p=g.length;f<p;f++){const v=this.bootstrapEvent(this.rootPointerEvent,g[f]);v.type+=c,this.manager.mapEvent(v)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onPointerOverOut=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const c=this.normalizeToPointerData(d);for(let g=0,f=c.length;g<f;g++){const p=this.bootstrapEvent(this.rootPointerEvent,c[g]);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onWheel=d=>{const c=this.normalizeWheelEvent(d);this.manager.mapEvent(c)};const{targetElement:e,resolution:i,rootNode:r,global:o,viewport:s,autoPreventDefault:a=!1,clickInterval:l,supportsTouchEvents:h=o.supportsTouchEvents,supportsPointerEvents:u=o.supportsPointerEvents}=t;this.manager=new VM(r,{clickInterval:l}),this.globalObj=o,this.supportsPointerEvents=u,this.supportsTouchEvents=h,this.supportsMouseEvents=o.supportsMouseEvents,this.applyStyles=o.applyStyles,this.autoPreventDefault=a,this.eventsAdded=!1,this.viewport=s,this.rootPointerEvent=new Oi,this.rootWheelEvent=new Dr,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.setTargetElement(null)}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===t)return;this.currentCursor=t;const o=this.cursorStyles[t];o?typeof o=="string"&&i?r.style.cursor=o:typeof o=="function"?o(t):typeof o=="object"&&i&&Object.assign(r.style,o):i&&ue(t)&&!xp(this.cursorStyles,t)&&(r.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().addEventListener("pointermove",this.onPointerMove,!0),t.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().addEventListener("mousemove",this.onPointerMove,!0),t.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().removeEventListener("pointermove",this.onPointerMove,!0),t.getDocument().removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().removeEventListener("mousemove",this.onPointerMove,!0),t.getDocument().removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){const e=this.viewport,{x:i,y:r}=t;return{x:i-e.x,y:r-e.y}}mapToCanvasPoint(t){var e;const i=(e=this.globalObj)===null||e===void 0?void 0:e.mapToCanvasPoint(t,this.domElement);if(i)return i;const{clientX:r,clientY:o}=t,s=this.domElement.getBoundingClientRect();return{x:r-s.left,y:o-s.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,r=t.changedTouches.length;i<r;i++){const o=t.changedTouches[i];be(o.button)&&(o.button=0),be(o.buttons)&&(o.buttons=1),be(o.isPrimary)&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),be(o.width)&&(o.width=o.radiusX||1),be(o.height)&&(o.height=o.radiusY||1),be(o.tiltX)&&(o.tiltX=0),be(o.tiltY)&&(o.tiltY=0),be(o.pointerType)&&(o.pointerType="touch"),be(o.pointerId)&&(o.pointerId=o.identifier||0),be(o.pressure)&&(o.pressure=o.force||.5),be(o.twist)&&(o.twist=0),be(o.tangentialPressure)&&(o.tangentialPressure=0),be(o.layerX)&&(o.layerX=o.offsetX=o.clientX),be(o.layerY)&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(this.globalObj.supportsMouseEvents&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof PointerEvent))e.push(t);else{const i=t;be(i.isPrimary)&&(i.isPrimary=!0),be(i.width)&&(i.width=1),be(i.height)&&(i.height=1),be(i.tiltX)&&(i.tiltX=0),be(i.tiltY)&&(i.tiltY=0),be(i.pointerType)&&(i.pointerType="mouse"),be(i.pointerId)&&(i.pointerId=1),be(i.pressure)&&(i.pressure=.5),be(i.twist)&&(i.twist=0),be(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:o,y:s}=this.mapToViewportPoint(e);return e.viewport.x=o,e.viewport.y=s,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:o,y:s}=this.mapToViewportPoint(t);return t.viewport.x=o,t.viewport.y=s,t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=GM[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=$r.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}}class KM{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,$.graphicService.hooks.onAttributeUpdate.tap(this.key,e=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&e.stage.renderNextFrame()}),$.graphicService.hooks.onSetStage.tap(this.key,e=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&e.stage.renderNextFrame()})}deactivate(t){$.graphicService.hooks.onAttributeUpdate.taps=$.graphicService.hooks.onAttributeUpdate.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.onSetStage.taps=$.graphicService.hooks.onSetStage.taps.filter(e=>e.name!==this.key)}}class YM{constructor(){this.name="ViewTransform3dPlugin",this.activeEvent="onRegister",this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid,this.onMouseDown=t=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!0,this.pageX=t.page.x,this.pageY=t.page.y)},this.onMouseUp=t=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!1)},this.onMouseMove=t=>{var e,i;const r=this.pluginService.stage;if(this.option3d||(this.option3d=r.option3d),this.option3d&&this.mousedown)if(this.pageX&&this.pageY){const o=t.page.x-this.pageX,s=t.page.y-this.pageY;this.pageX=t.page.x,this.pageY=t.page.y;const a=o/100,l=s/100;this.option3d.alpha=((e=this.option3d.alpha)!==null&&e!==void 0?e:0)+a,this.option3d.beta=((i=this.option3d.beta)!==null&&i!==void 0?i:0)+l,r.set3dOptions(this.option3d),r.renderNextFrame()}else this.pageX=t.page.x,this.pageY=t.page.y}}activate(t){this.pluginService=t;const e=t.stage;this.option3d=e.option3d,e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mousemove",this.onMouseMove)}deactivate(t){const e=t.stage;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("mousemove",this.onMouseMove)}}class $M{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,$.graphicService.hooks.onAddIncremental.tap(this.key,(e,i,r)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))}),$.graphicService.hooks.onClearIncremental.tap(this.key,(e,i)=>{e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))})}deactivate(t){$.graphicService.hooks.onAddIncremental.taps=$.graphicService.hooks.onAddIncremental.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.onClearIncremental.taps=$.graphicService.hooks.onClearIncremental.taps.filter(e=>e.name!==this.key)}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,$.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const r=e.layer.subLayers.get(e._uid);r&&r.drawContribution&&r.drawContribution.draw(t.renderService,Object.assign({x:t.x,y:t.y,width:i.viewWidth,height:i.viewHeight,stage:t,layer:i,clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}class XM{constructor(){this.name="HtmlAttributePlugin",this.activeEvent="onRegister",this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&this.drawHTML(t.stage.renderService)}),$.graphicService.hooks.onRemove.tap(this.key,e=>{this.removeDom(e)}),$.graphicService.hooks.onRelease.tap(this.key,e=>{this.removeDom(e)})}deactivate(t){t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key)}drawHTML(t){$.global.env==="browser"&&t.renderTreeRoots.sort((e,i)=>{var r,o;return((r=e.attribute.zIndex)!==null&&r!==void 0?r:fe.zIndex)-((o=i.attribute.zIndex)!==null&&o!==void 0?o:fe.zIndex)}).forEach(e=>{this.renderGroupHTML(e)})}renderGroupHTML(t){this.renderGraphicHTML(t),t.forEachChildren(e=>{e.isContainer?this.renderGroupHTML(e):this.renderGraphicHTML(e)})}removeDom(t){t.bindDom&&t.bindDom.size&&(t.bindDom.forEach(e=>{e.dom&&e.dom.parentElement.removeChild(e.dom)}),t.bindDom.clear())}renderGraphicHTML(t){const{html:e}=t.attribute;if(!e)return void(t.bindDom&&t.bindDom.size&&(t.bindDom.forEach(_=>{_.dom&&_.dom.parentElement.removeChild(_.dom)}),t.bindDom.clear()));const i=t.stage;if(!i)return;const{dom:r,container:o,width:s,height:a,style:l,anchorType:h="boundsLeftTop"}=e;t.bindDom||(t.bindDom=new Map);const u=t.bindDom.get(r);let d,c;if(!u||o&&o!==u.container){let _;t.bindDom.forEach(({wrapGroup:w})=>{$.global.removeDom(w)}),typeof r=="string"?(_=new DOMParser().parseFromString(r,"text/html").firstChild,_.lastChild&&(_=_.lastChild.firstChild)):_=r;const y=o||(i.params.enableHtmlAttribute===!0?null:i.params.enableHtmlAttribute);c=y?typeof y=="string"?$.global.getElementById(y):y:t.stage.window.getContainer(),d=$.global.createDom({tagName:"div",width:s,height:a,style:l,parent:c}),d&&(d.appendChild(_),t.bindDom.set(r,{dom:_,container:o,wrapGroup:d}))}else d=u.wrapGroup,c=d.parentNode;d.style.pointerEvents="none",d.style.position||(d.style.position="absolute",c.style.position="relative");let g=0,f=0;const p=t.globalAABBBounds;if(h==="position"||p.empty()){const _=t.globalTransMatrix;g=_.e,f=_.f}else g=p.x1,f=p.y1;const v=$.global.getElementTopLeft(c,!1),m=i.window.getTopLeft(!1),C=g+m.left-v.left,b=f+m.top-v.top;d.style.left=`${C}px`,d.style.top=`${b}px`}}const VC=new me;class qM{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&e.dirtyBounds.clear()}),$.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,r,o)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!e.shouldSelfChangeUpdateAABBBounds()||r&&(VC.setValue(o.x1,o.y1,o.x2,o.y2),i.dirty(VC,e.parent&&e.parent.globalTransMatrix)))}),$.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,r,o,s)=>{i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!s||i.dirty(o.globalAABBBounds))}),$.graphicService.hooks.onRemove.tap(this.key,e=>{const i=e.stage;i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(e.globalAABBBounds)})}deactivate(t){$.graphicService.hooks.beforeUpdateAABBBounds.taps=$.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.afterUpdateAABBBounds.taps=$.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.onRemove.taps=$.graphicService.hooks.onRemove.taps.filter(e=>e.name!==this.key)}}const GC=new me;class ZM{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=Gt.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new me}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t,e=!0){if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const r=X(i).group,{display:o=r.display}=i.attribute;if(o!=="flex")return;const{flexDirection:s=r.flexDirection,flexWrap:a=r.flexWrap,alignItems:l=r.alignItems,clip:h=r.clip}=i.attribute,{alignContent:u=l!=null?l:r.alignContent}=i.attribute;let{width:d,height:c,justifyContent:g=r.justifyContent}=i.attribute;const f=i.getChildren();if(d==null||c==null){let D=0,A=0,x=0;if(f.forEach(B=>{const F=this.getAABBBounds(B);F.empty()||(s==="column"||s==="column-reverse"?(A+=F.height(),D=Math.max(D,F.width())):(D+=F.width(),A=Math.max(A,F.height())),x+=F.x1,x+=F.y1,x+=F.x2,x+=F.y2)}),!isFinite(x))return;d=D,c=A}i.attribute.width=d,i.attribute.height=c,this.tempBounds.copy(i._AABBBounds);const p={main:{len:d,field:"x"},cross:{len:c,field:"y"}},v=p.main,m=p.cross;s!=="column"&&s!=="column-reverse"||(v.len=c,m.len=d,v.field="y",m.field="x"),s!=="row-reverse"&&s!=="column-reverse"||(g==="flex-start"?g="flex-end":g==="flex-end"?g="flex-start":f.reverse());let C=0,b=0;const _=[];f.forEach(D=>{const A=this.getAABBBounds(D);if(A.empty())return;const x=v.field==="x"?A.width():A.height(),B=m.field==="x"?A.width():A.height();_.push({mainLen:x,crossLen:B}),C+=x,b=Math.max(b,B)});const y=[];if(C>v.len&&a==="wrap"){let D=0,A=0;_.forEach(({mainLen:x,crossLen:B},F)=>{D+x>v.len?D===0?(y.push({idx:F,mainLen:D+x,crossLen:B}),D=0,A=0):(y.push({idx:F-1,mainLen:D,crossLen:B}),D=x,A=B):(D+=x,A=Math.max(A,B))}),y.push({idx:_.length-1,mainLen:D,crossLen:A})}else y.push({idx:_.length-1,mainLen:C,crossLen:b});let w=0;if(y.forEach(D=>{this.layoutMain(i,f,g,v,_,w,D),w=D.idx+1}),b=y.reduce((D,A)=>D+A.crossLen,0),y.length===1){const D={"flex-start":0,"flex-end":m.len,center:m.len/2};this.layoutCross(f,l,m,D,_,y[0],0)}else if(u==="flex-start"){w=0;let D=0;y.forEach((A,x)=>{const B={"flex-start":D,"flex-end":D+A.crossLen,center:D+A.crossLen/2};this.layoutCross(f,"flex-start",m,B,_,y[x],w),w=A.idx+1,D+=A.crossLen})}else if(u==="center"){w=0;let D=Math.max(0,(m.len-b)/2);y.forEach((A,x)=>{const B={"flex-start":D,"flex-end":D+A.crossLen,center:D+A.crossLen/2};this.layoutCross(f,"center",m,B,_,y[x],w),w=A.idx+1,D+=A.crossLen})}else if(u==="space-around"){w=0;const D=Math.max(0,(m.len-b)/y.length/2);let A=D;y.forEach((x,B)=>{const F={"flex-start":A,"flex-end":A+x.crossLen,center:A+x.crossLen/2};this.layoutCross(f,"flex-start",m,F,_,y[B],w),w=x.idx+1,A+=x.crossLen+2*D})}else if(u==="space-between"){w=0;const D=Math.max(0,(m.len-b)/(2*y.length-2));let A=0;y.forEach((x,B)=>{const F={"flex-start":A,"flex-end":A+x.crossLen,center:A+x.crossLen/2};this.layoutCross(f,"flex-start",m,F,_,y[B],w),w=x.idx+1,A+=x.crossLen+2*D})}f.forEach((D,A)=>{D.addUpdateBoundTag(),D.addUpdatePositionTag(),D.clearUpdateLayoutTag()}),i.addUpdateLayoutTag();const S=this.getAABBBounds(i);h||this.tempBounds.equals(S)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(e!=null?e:0)-i}layoutMain(t,e,i,r,o,s,a){if(i==="flex-start"){let l=0;for(let h=s;h<=a.idx;h++){const u=l+In(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}else if(i==="flex-end"){let l=r.len;for(let h=s;h<=a.idx;h++){l-=o[h].mainLen;const u=l+In(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`]))}}else if(i==="space-around")if(a.mainLen>=r.len){let l=0;for(let h=s;h<=a.idx;h++){const u=l+In(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}else{const l=a.idx-s+1,h=(r.len-a.mainLen)/l/2;let u=h;for(let d=s;d<=a.idx;d++){const c=u+In(e[d],r.field),g=this.getAABBBounds(e[d]);!g.empty()&&(e[d].attribute[r.field]=this.updateChildPos(c,e[d].attribute[r.field],g[`${r.field}1`])),u+=o[d].mainLen+2*h}}else if(i==="space-between")if(a.mainLen>=r.len){let l=0;for(let h=s;h<=a.idx;h++){const u=l+In(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}else{const l=a.idx-s+1,h=(r.len-a.mainLen)/(2*l-2);let u=0;for(let d=s;d<=a.idx;d++){const c=u+In(e[d],r.field),g=this.getAABBBounds(e[d]);!g.empty()&&(e[d].attribute[r.field]=this.updateChildPos(c,e[d].attribute[r.field],g[`${r.field}1`])),u+=o[d].mainLen+2*h}}else if(i==="center"){let l=(r.len-a.mainLen)/2;for(let h=s;h<=a.idx;h++){const u=l+In(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}}layoutCross(t,e,i,r,o,s,a){var l;for(let h=a;h<=s.idx;h++){const u=t[h];let{alignSelf:d}=u.attribute;d&&d!=="auto"||(d=e);const c=this.getAABBBounds(u),g=(l=r[d])!==null&&l!==void 0?l:r["flex-start"];d==="flex-end"?!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g-o[h].crossLen+In(u,i.field),u.attribute[i.field],c[`${i.field}1`])):d==="center"?!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g-o[h].crossLen/2+In(u,i.field),u.attribute[i.field],c[`${i.field}1`])):!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g+In(u,i.field),u.attribute[i.field],c[`${i.field}1`]))}}activate(t){this.pluginService=t,$.graphicService.hooks.onAttributeUpdate.tap(this.key,e=>{e.glyphHost&&(e=e.glyphHost),e.stage&&e.stage===this.pluginService.stage&&this.tryLayout(e,!1)}),$.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,r,o)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&e.isContainer&&!this.skipBoundsTrigger&&GC.copy(o)}),$.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,r,o,s)=>{i&&i===this.pluginService.stage&&e.isContainer&&!this.skipBoundsTrigger&&(GC.equals(r)||this.tryLayout(e,!1))}),$.graphicService.hooks.onSetStage.tap(this.key,e=>{e.glyphHost&&(e=e.glyphHost),this.tryLayout(e,!1)})}deactivate(t){$.graphicService.hooks.onAttributeUpdate.taps=$.graphicService.hooks.onAttributeUpdate.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.beforeUpdateAABBBounds.taps=$.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.afterUpdateAABBBounds.taps=$.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),$.graphicService.hooks.onSetStage.taps=$.graphicService.hooks.onSetStage.taps.filter(e=>e.name!==this.key)}}function In(n,t){return 0}class sa{constructor(){this.time=0}static Avaliable(){return!0}avaliable(){return sa.Avaliable()}tick(t,e){this.time=Math.max(0,t+this.time),e(this,{once:!0})}tickTo(t,e){this.time=Math.max(0,t),e(this,{once:!0})}release(){this.timerId>0&&(this.timerId=-1)}getTime(){return this.time}}class Xh{static Avaliable(){return!0}avaliable(){return Xh.Avaliable()}tick(t,e){this.timerId=setTimeout(()=>{e(this)},t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class aa{static Avaliable(){return!!$.global.getRequestAnimationFrame()}avaliable(){return aa.Avaliable()}tick(t,e){$.global.getRequestAnimationFrame()(()=>{this.released||e(this)})}release(){this.released=!0}getTime(){return Date.now()}}var cn;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSE=2]="PAUSE"})(cn||(cn={}));class JM{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(t=[]){this.handleTick=(e,i)=>{const{once:r=!1}=i!=null?i:{};this.ifCanStop()?this.stop():(this._handlerTick(e),r||e.tick(this.interval,this.handleTick))},this._handlerTick=e=>{const i=this.tickerHandler.getTime();let r=0;this.lastFrameTime>=0&&(r=i-this.lastFrameTime),this.lastFrameTime=i,this.status===cn.RUNNING&&(this.tickCounts++,this.timelines.forEach(o=>{o.tick(r)}))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=cn.INITIAL,$.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),$.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter(e=>e!==t)}initHandler(){if(this._mode)return null;const t=[{mode:"raf",cons:aa},{mode:"timeout",cons:Xh},{mode:"manual",cons:sa}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new aa;break;case"timeout":t=new Xh;break;case"manual":t=new sa;break;default:te.getInstance().warn("\u975E\u6CD5\u7684\u8BA1\u65F6\u5668\u6A21\u5F0F"),t=new aa}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,e=>{this.handleTick(e,{once:!0})})}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,e=>{this.handleTick(e,{once:!0})})}pause(){return this.status!==cn.INITIAL&&(this.status=cn.PAUSE,!0)}resume(){return this.status!==cn.INITIAL&&(this.status=cn.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((t,e)=>t+e.animateCount,0)===0))}start(t=!1){return this.status===cn.RUNNING||!this.tickerHandler||!t&&(this.status===cn.PAUSE||!this.timelines.length||this.timelines.reduce((e,i)=>e+i.animateCount,0)===0)?!1:(this.status=cn.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=cn.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}}class MW extends null{set mode(t){this.setupTickHandler()}get mode(){return this._mode}initHandler(){return this.mode="manual",null}setupTickHandler(){const t=new sa;return this._mode="manual",this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0}tickAt(t){this.tickerHandler.tick(t-this.lastFrameTime,e=>{this.handleTick(e,{once:!0})})}ifCanStop(){return!1}}const kg=new JM;kg.addTimeline(Fp);const RW=60;kg.setFPS(60);class QM{constructor(t,e,i=.8){this.dir=t,this.color=e,this.colorRgb=Ce.Get(e,Mi.Color1),this.ambient=i;const r=yi(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.formatedDir=[t[0]/r,t[1]/r,t[2]/r]}computeColor(t,e){const i=this.formatedDir,r=Ue(Cn((t[0]*i[0]+t[1]*i[1]+t[2]*i[2])*(1-this.ambient/2),0)+this.ambient,1);let o;o=ue(e)?Ce.Get(e,Mi.Color1):e;const s=this.colorRgb;return`rgb(${s[0]*o[0]*r}, ${s[1]*o[1]*r}, ${s[2]*o[2]*r})`}}class tR{set params(t){this._params=Object.assign({},t),this._projectionMatrixCached=this.forceGetProjectionMatrix(),this._viewMatrixCached=this.forceGetViewMatrix()}get params(){return Object.assign({},this._params)}constructor(t){this.params=t}getViewMatrix(){return this._viewMatrixCached||(this._viewMatrixCached=ie.allocate()),this._viewMatrixCached}forceGetViewMatrix(){this._viewMatrixCached||(this._viewMatrixCached=ie.allocate());const{pos:t,center:e,up:i}=this.params.viewParams;return qA(this._viewMatrixCached,t,e,i),this._vp||(this._vp=ie.allocate()),this._vp=Bv(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._viewMatrixCached}getProjectionMatrix(){return this._projectionMatrixCached||(this._projectionMatrixCached=ie.allocate()),this._projectionMatrixCached}forceGetProjectionMatrix(){this._projectionMatrixCached||(this._projectionMatrixCached=ie.allocate());const{left:t,top:e,right:i,bottom:r}=this._params;return ZA(this._projectionMatrixCached,t,i,r,e,0,-2e6),this._vp||(this._vp=ie.allocate()),this._vp=Bv(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._projectionMatrixCached}getField(){const{fieldRatio:t=.8,fieldDepth:e,left:i,right:r}=this._params;return(e!=null?e:r-i)*t}getProjectionScale(t){const e=this.getField();return e/(e+t)}view(t,e,i){const r=[0,0,0];return Ii(r,[t,e,i],this._viewMatrixCached),r}vp(t,e,i){const r=[0,0,0],{pos:o}=this._params.viewParams;Ii(r,[t,e,i],this._viewMatrixCached),t=r[0],e=r[1],i=r[2];const s=this.getProjectionScale(i);return{x:t*s+o[0],y:e*s+o[1]}}}const UC={WIDTH:500,HEIGHT:500,X:0,Y:0,BACKGROUND:"white"};class eR extends Di{set viewBox(t){this._viewBox.setValue(t.x1,t.y1,t.x2,t.y2)}get viewBox(){return this._viewBox}get x(){return this._viewBox.x1}set x(t){this._viewBox.translate(t-this._viewBox.x1,0)}get y(){return this._viewBox.y1}set y(t){this._viewBox.translate(0,t-this._viewBox.y1)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this._viewBox.width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this._viewBox.height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return(t=this._background)!==null&&t!==void 0?t:UC.BACKGROUND}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(t={}){var e;super({}),this._onVisibleChange=i=>{this._skipRender<0||(i?(this.dirtyBounds&&this.dirtyBounds.setValue(0,0,this._viewBox.width(),this._viewBox.height()),this._skipRender>1&&this.renderNextFrame(),this._skipRender=0):this._skipRender=1)},this.beforeRender=i=>{this._beforeRender&&this._beforeRender(i)},this.afterRender=i=>{this.renderCount++,this._afterRender&&this._afterRender(i),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(r=>r(i)),this._afterNextRenderCbs=null},this.params=t,this.theme=new ws,this.hooks={beforeRender:new Hi(["stage"]),afterRender:new Hi(["stage"])},this.global=$.global,!this.global.env&&ih()&&this.global.setEnv("browser"),this.window=pt.get(ul),this.renderService=pt.get(av),this.pluginService=pt.get(gv),this.layerService=pt.get(ac),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:t.canvasControled!==!1,title:t.title||"",canvas:t.canvas}),this._viewBox=new me,t.viewBox?this._viewBox.setValue(t.viewBox.x1,t.viewBox.y1,t.viewBox.x2,t.viewBox.y2):this._viewBox.setValue(0,0,this.width,this.height),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._subView=!(this._viewBox.width()===this.width&&this._viewBox.height()===this.height),this._background=(e=t.background)!==null&&e!==void 0?e:UC.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.disableDirtyBounds===!1&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||kg,this.supportInteractiveLayer=t.interactiveLayer!==!1,this.timeline=new Bp,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&ue(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background})}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new UM(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents,viewport:{viewBox:this._viewBox,get x(){return this.viewBox.x1},get y(){return this.viewBox.y1},get width(){return this.viewBox.width()},get height(){return this.viewBox.height()}}},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(t=!1){t&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:o=0,camera:s,fieldRatio:a=1,fieldDepth:l}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:r,beta:o,camera:s,fieldRatio:a,fieldDepth:l})}set3dOptions(t){var e,i,r,o,s,a;this.option3d=t;const l=this.get3dOptions(t),{light:h,center:u,camera:d,alpha:c,beta:g,fieldRatio:f,fieldDepth:p}=l,{dir:v=[1,1,-1],color:m="white",ambient:C}=h,b=((e=u.x)!==null&&e!==void 0?e:this.width/2)+((i=u.dx)!==null&&i!==void 0?i:0),_=((r=u.y)!==null&&r!==void 0?r:this.height/2)+((o=u.dy)!==null&&o!==void 0?o:0),y=[b,_,((s=u.z)!==null&&s!==void 0?s:0)+((a=u.dz)!==null&&a!==void 0?a:0)];let w=0,S=0,D=0;d||(w=Math.sin(c)+b,S=Math.sin(g)+_,D=Math.cos(c)*Math.cos(g)*1),this.light=new QM(v,m,C);const A={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:f,fieldDepth:p,viewParams:{pos:[w,S,D],center:y,up:[0,1,0]}};this.camera?this.camera.params=A:this.camera=new tR(A),t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){this.view3dTranform||(this.view3dTranform=!0,this.pluginService.register(new YM))}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new KM))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new $M))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Ji;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new qM,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableLayout(){this._enableLayout||(this._enableLayout=!0,this.pluginService.register(new ZM))}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableHtmlAttribute(t){this.htmlAttribute||(this.htmlAttribute=t,this.pluginService.register(new XM))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this._viewBox;return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}createLayer(t,e){const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach(i=>{this.appendChild(i)})}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(this._viewBox,t)}render(t,e){this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this.renderLayerList(this.children,e),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear(),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach(i=>{this.nextFrameRenderLayerSet.add(i)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.hooks.afterRender.call(this),this.nextFrameRenderLayerSet.clear()),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let r=0;r<t.length;r++){let o=t[r];o.layerMode==="virtual"&&(o=o.getNativeHandler().mainHandler.layer),i.includes(o)||i.push(o)}i.forEach(r=>{r.renderCount>this.renderCount||(r.renderCount=this.renderCount+1,r.render({renderService:this.renderService,background:r===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())},Object.assign({renderStyle:this.renderStyle,keepMatrix:this.params.renderKeepMatrix},e)))}),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())},Object.assign({renderStyle:this.renderStyle},e))}resizeWindow(t,e,i=!0){this.window.resize(t,e),i&&this.render()}resize(t,e,i=!0){this.window.resize(t,e),this.forEachChildren(r=>{r.resize(t,e)}),this._subView||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render()}resizeView(t,e,i=!0){this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren(r=>{r.resizeView(t,e)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render()}setViewBox(t,e,i,r,o){let s=!0;typeof t=="object"?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),e===!1&&(s=!1)):(this.viewBox.setValue(t,e,t+i,e+r),o===!1&&(s=!1)),this.forEachChildren(a=>{a.resizeView(this.viewBox.width(),this.viewBox.height())}),s&&this.render()}setDpr(t,e=!0){this.forEachChildren(i=>{i.setDpr(t)}),e&&this.render()}setOrigin(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}export(t){throw new Error("\u6682\u4E0D\u652F\u6301")}pick(t,e){this.pickerService||(this.pickerService=pt.get(yo));const i=this.pickerService.pick(this.children,new xe(t,e),{bounds:this.AABBBounds});return!(!(i!=null&&i.graphic)&&!(i!=null&&i.group))&&i}startAnimate(t){throw new Error("\u6682\u4E0D\u652F\u6301")}setToFrame(t){throw new Error("\u6682\u4E0D\u652F\u6301")}release(){super.release(),this.eventSystem&&this.eventSystem.release(),this.pluginService.release(),this.forEach(t=>{t.release()}),this.interactiveLayer&&this.interactiveLayer.release(),this.window.release()}setStage(t){}dirty(t,e){e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t)}getLayer(t){return this.children.filter(e=>e.name===t)[0]}renderTo(t,e){this.forEachChildren((i,r)=>{i.drawTo(t,Object.assign(Object.assign({},e),{renderService:this.renderService,background:i===this.defaultLayer?this.background:void 0,clear:r===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())}))})}renderToNewWindow(t=!0,e){const i=pt.get(ul);if(t)i.create({width:this.viewWidth,height:this.viewHeight,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""});else{const s=e?e.width():Math.min(this.viewWidth,this.window.width-this.x),a=e?e.height():Math.min(this.viewHeight,this.window.height-this.y);i.create({width:s,height:a,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""})}const r=e?-e.x1:0,o=e?-e.y1:0;return this.renderTo(i,{x:r,y:o,width:e?e.x2:i.width,height:e?e.y2:i.height}),i}toCanvas(t=!0,e){const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}}function iR(n){return new eR(n)}const KC={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"},EW=Object.keys(KC);function PW(n){return graphicCreator.arc(n?n.attribute:{})}function HW(n){return graphicCreator.arc3d(n?n.attribute:{})}function LW(n){return graphicCreator.area(n?n.attribute:{})}function kW(n){return graphicCreator.circle(n?n.attribute:{})}function IW(n){return graphicCreator.group(n?n.attribute:{})}function OW(n){return graphicCreator.glyph(n?n.attribute:{})}function zW(n){return graphicCreator.image(n?n.attribute:{})}function WW(n){return graphicCreator.line(n?n.attribute:{})}function NW(n){return graphicCreator.path(n?n.attribute:{})}function jW(n){return graphicCreator.polygon(n?n.attribute:{})}function VW(n){return graphicCreator.pyramid3d(n?n.attribute:{})}function GW(n){return graphicCreator.rect(n?n.attribute:{})}function UW(n){return graphicCreator.rect3d(n?n.attribute:{})}function KW(n){return graphicCreator.symbol(n?n.attribute:{})}function YW(n){return graphicCreator.text(n?n.attribute:{})}function YC(n){return ct.richtext(n?n.attribute:{})}YC.Text=function(n){return Object.assign({type:"rich/text"},n)},YC.Image=function(n){return Object.assign({type:"rich/image"},n)};const $W=251,XW=9,qW=.3,ZW=10,JW=300,$C=(n,t)=>{const e=t.x-n.x,i=t.y-n.y;return Math.abs(e)>Math.abs(i)?e>0?"right":"left":i>0?"down":"up"},qh=(n,t)=>{const e=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y);return Math.sqrt(e*e+i*i)},nR=n=>{const t=n.length;if(t===1)return{x:Math.round(n[0].x),y:Math.round(n[0].y)};let e=0,i=0,r=0;for(;r<t;)e+=n[r].x,i+=n[r].y,r++;return{x:Math.round(e/t),y:Math.round(i/t)}};class rR extends Ds(){constructor(t,e={}){var i,r,o,s,a,l,h,u,d,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=g=>{this.reset(),this.startTime=$r.now();const{cachedEvents:f,startPoints:p}=this;g&&f.push(g.clone()),p.length=f.length;for(let v=0;v<f.length;v++){const{x:m,y:C}=f[v],b={x:m,y:C};p[v]=b}if(p.length!==1)this.startDistance=qh(p[0],p[1]),this.center=nR([p[0],p[1]]);else{const v=f[0];this.pressTimeout=setTimeout(()=>{v.direction="none",v.deltaX=0,v.deltaY=0,v.points=p,this.triggerStartEvent("press",v),this.triggerEvent("press",v),this.eventType="press",this.direction="none"},this.config.press.time)}},this.onMove=g=>{this.clearPressTimeout();const{startPoints:f,cachedEvents:p}=this;if(!f.length)return;const v=g.clone(),{x:m,y:C,pointerId:b}=v;for(let A=0,x=p.length;A<x;A++)if(b===p[A].pointerId){p[A]=v;break}const _={x:m,y:C},y=p.map(A=>({x:A.x,y:A.y})),w=$r.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=w,this.lastMovePoint=_,f.length===1){const A=f[0],x=m-A.x,B=C-A.y,F=this.direction||$C(A,_);this.direction=F;const T=this.getEventType(_);return v.direction=F,v.deltaX=x,v.deltaY=B,v.points=y,this.triggerStartEvent(T,v),void this.triggerEvent(T,v)}const{startDistance:S}=this,D=qh(y[0],y[1]);v.scale=D/S,v.center=this.center,v.points=y,this.triggerStartEvent("pinch",v),this.triggerEvent("pinch",v)},this.onEnd=g=>{const f=g.clone(),{cachedEvents:p,startPoints:v}=this,m=p.map(C=>({x:C.x,y:C.y}));if(f.points=m,this.triggerEndEvent(f),p.length===1){const C=$r.now(),b=this.lastMoveTime;if(C-b<100){const _=b-(this.prevMoveTime||this.startTime);if(_>0){const y=this.prevMovePoint||v[0],w=this.lastMovePoint||v[0],S=qh(y,w),D=S/_;D>this.config.swipe.velocity&&S>this.config.swipe.threshold&&(f.velocity=D,f.direction=$C(y,w),this.triggerEvent("swipe",f))}}C-this.lastTapTime<this.config.tap.interval&&g.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=C,this.lastTapTarget=g.target,this.tapCount===1?this.triggerEvent("tap",f):this.tapCount===2&&(this.triggerEvent("doubletap",f),this.tapCount=0)}for(let C=0,b=p.length;C<b;C++)if(p[C].pointerId===f.pointerId){p.splice(C,1),v.splice(C,1);break}this.reset(),p.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(r=(i=e==null?void 0:e.press)===null||i===void 0?void 0:i.time)!==null&&r!==void 0?r:251,threshold:(s=(o=e==null?void 0:e.press)===null||o===void 0?void 0:o.threshold)!==null&&s!==void 0?s:9},swipe:{threshold:(l=(a=e==null?void 0:e.swipe)===null||a===void 0?void 0:a.threshold)!==null&&l!==void 0?l:10,velocity:(u=(h=e==null?void 0:e.swipe)===null||h===void 0?void 0:h.velocity)!==null&&u!==void 0?u:.3},tap:{interval:(c=(d=e==null?void 0:e.tap)===null||d===void 0?void 0:d.interval)!==null&&c!==void 0?c:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:r}=this;if(e)return e;let o;return o=$r.now()-i>this.config.press.time&&qh(r[0],t)<this.config.press.threshold?"press":"pan",this.eventType=o,o}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,r={type:t,ev:e};for(let o=0,s=i.length;o<s;o++)if(i[o].type===t)return void i.splice(o,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=$.global.getRequestAnimationFrame()(()=>{for(let o=0,s=r.length;o<s;o++){const{type:a,ev:l}=r[o];this.emitEvent(a,l)}this.throttleTimer=0,this.emitThrottles.length=0}))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach(i=>{this.triggerEvent(`${i}end`,t),i==="press"&&this.triggerEvent(`${i}up`,t),delete e[i]})}emitEvent(t,e){const i=this.element._events[jC];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,o=i.length;r<o&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t);this.emit(t,e)}}const QW=null;let XC=!1;function qC(){XC||(XC=!0,Gs(),ih()?$s(pt):YA()&&qs(pt),Jx(),uB(),wB(),zB(),JB(),Dn(),Fm(),ag(),Om(),Um(),aF(),Yr(),PF(),Ih(),JF(),zo(),oa(),Yh())}var St;(function(n){n.default="default",n.grabing="grabing",n.scrolling="scrolling"})(St||(St={}));var de;(function(n){n.single="single",n.column="column",n.row="row",n.cross="cross",n.none="none"})(de||(de={}));var zi;(function(n){n.top="top",n.bottom="bottom",n.left="left",n.right="right"})(zi||(zi={}));var Ft;(function(n){n.expand="expand",n.collapse="collapse",n.none="none"})(Ft||(Ft={}));var Et;(function(n){n.RECORD="RECORD",n.NONE="NONE",n.SUM="SUM",n.MIN="MIN",n.MAX="MAX",n.AVG="AVG",n.COUNT="COUNT",n.CUSTOM="CUSTOM"})(Et||(Et={}));var Ig;(function(n){n.ASC="ASC",n.DESC="DESC"})(Ig||(Ig={}));var Qt;(function(n){n.inlineFront="inlineFront",n.inlineEnd="inlineEnd",n.left="left",n.right="right",n.absoluteRight="absoluteRight",n.contentLeft="contentLeft",n.contentRight="contentRight",n.absolute="absolute"})(Qt||(Qt={}));var ne;(function(n){n.frozen="frozen",n.sort="sort",n.dropDown="dropDown",n.dropDownState="dropDownState",n.play="play",n.damagePic="damagePic",n.expand="expand",n.collapse="collapse",n.drillDown="drillDown",n.drillUp="drillUp"})(ne||(ne={}));var Wi;(function(n){n.upwardIconName="sort_upward",n.downwardIconName="sort_downward",n.normalIconName="sort_normal",n.freezeIconName="freeze",n.frozenIconName="frozen",n.frozenCurrentIconName="frozenCurrent",n.dropdownIconName="dropdownIcon",n.expandIconName="expand",n.collapseIconName="collapse"})(Wi||(Wi={}));let oR=1;class Zh{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const r=oR++;return this.listenersData.listenerData[r]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[r];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},r}off(t,e){var i;if(e){const r=t;this.removeEventListener(r,e)}else{const r=t;if(!this.listenersData)return;(i=this.listenersData.listenerData[r])===null||i===void 0||i.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===t&&r.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map(r=>r.call(this,e)).filter(r=>N(r)):[]}release(){delete this.listenersData}}let ZC;const sR={CHANGE_STYLE:"change_style"};class xn extends Zh{static get EVENT_TYPE(){return sR}static get DEFAULT(){return ZC||(ZC=new xn)}constructor(t={},e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R;super(),this._defaultPadding=[10,16,10,16],this._textAlign=(i=t==null?void 0:t.textAlign)!==null&&i!==void 0?i:e==null?void 0:e.textAlign,this._textBaseline=(r=t==null?void 0:t.textBaseline)!==null&&r!==void 0?r:e==null?void 0:e.textBaseline,this._color=(o=t==null?void 0:t.color)!==null&&o!==void 0?o:e==null?void 0:e.color,this._fontSize=(s=t.fontSize)!==null&&s!==void 0?s:e==null?void 0:e.fontSize,this._fontFamily=(a=t.fontFamily)!==null&&a!==void 0?a:e==null?void 0:e.fontFamily,this._fontWeight=(l=t.fontWeight)!==null&&l!==void 0?l:e==null?void 0:e.fontWeight,this._fontVariant=(h=t.fontVariant)!==null&&h!==void 0?h:e==null?void 0:e.fontVariant,this._fontStyle=(u=t.fontStyle)!==null&&u!==void 0?u:e==null?void 0:e.fontStyle,this._padding=(c=(d=t==null?void 0:t.padding)!==null&&d!==void 0?d:e==null?void 0:e.padding)!==null&&c!==void 0?c:this._defaultPadding,this._borderColor=(g=t==null?void 0:t.borderColor)!==null&&g!==void 0?g:e==null?void 0:e.borderColor,this._textOverflow=(f=t==null?void 0:t.textOverflow)!==null&&f!==void 0?f:e==null?void 0:e.textOverflow,this._textStick=(v=(p=t.textStick)!==null&&p!==void 0?p:e==null?void 0:e.textStick)!==null&&v!==void 0&&v,this._bgColor=(m=t==null?void 0:t.bgColor)!==null&&m!==void 0?m:e==null?void 0:e.bgColor,this._lineHeight=(C=t==null?void 0:t.lineHeight)!==null&&C!==void 0?C:e==null?void 0:e.lineHeight,this._underline=(b=t==null?void 0:t.underline)!==null&&b!==void 0?b:e==null?void 0:e.underline,this._underlineColor=(_=t==null?void 0:t.underlineColor)!==null&&_!==void 0?_:e==null?void 0:e.underlineColor,this._underlineDash=(y=t==null?void 0:t.underlineDash)!==null&&y!==void 0?y:e==null?void 0:e.underlineDash,this._underlineOffset=(w=t==null?void 0:t.underlineOffset)!==null&&w!==void 0?w:e==null?void 0:e.underlineOffset,this._lineThrough=(S=t==null?void 0:t.lineThrough)!==null&&S!==void 0?S:e==null?void 0:e.lineThrough,this._lineThroughColor=(D=t==null?void 0:t.lineThroughColor)!==null&&D!==void 0?D:e==null?void 0:e.lineThroughColor,this._lineThroughDash=(A=t==null?void 0:t.lineThroughDash)!==null&&A!==void 0?A:e==null?void 0:e.lineThroughDash,this._linkColor=(x=t==null?void 0:t.linkColor)!==null&&x!==void 0?x:e==null?void 0:e.linkColor,this._cursor=(B=t.cursor)!==null&&B!==void 0?B:e==null?void 0:e.cursor,this._borderLineWidth=(F=t.borderLineWidth)!==null&&F!==void 0?F:e==null?void 0:e.borderLineWidth,this._borderLineDash=(T=t.borderLineDash)!==null&&T!==void 0?T:e==null?void 0:e.borderLineDash,this._marked=(R=t.marked)!==null&&R!==void 0?R:e==null?void 0:e.marked}get color(){return this._color}set color(t){this._color=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new xn(this,null)}}let JC;class Jh extends xn{static get DEFAULT(){return JC||(JC=new Jh)}constructor(t={},e={}){super(t,e)}clone(){return new Jh(this,null)}}let QC;class la extends xn{static get DEFAULT(){return QC||(QC=new la)}constructor(t={},e={}){var i,r;super(t,e),this._autoWrapText=(i=t==null?void 0:t.autoWrapText)!==null&&i!==void 0?i:e==null?void 0:e.autoWrapText,this._lineClamp=(r=t==null?void 0:t.lineClamp)!==null&&r!==void 0?r:e==null?void 0:e.lineClamp}clone(){return new la(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let tb;class Og extends null{static get DEFAULT(){return tb||(tb=new Og)}constructor(t={},e={}){super(t,e)}clone(){return new Og(this,null)}}let eb;class Xr extends xn{static get DEFAULT(){return eb||(eb=new Xr)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A;super(t,e),this._size=((o=(r=t==null?void 0:t.size)!==null&&r!==void 0?r:e==null?void 0:e.size)!==null&&o!==void 0?o:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((a=(s=t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=(h=(l=t==null?void 0:t.checkboxStyle)===null||l===void 0?void 0:l.defaultFill)!==null&&h!==void 0?h:i==null?void 0:i.defaultFill,this._defaultStroke=(d=(u=t==null?void 0:t.checkboxStyle)===null||u===void 0?void 0:u.defaultStroke)!==null&&d!==void 0?d:i==null?void 0:i.defaultStroke,this._disableFill=(g=(c=t==null?void 0:t.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i==null?void 0:i.disableFill,this._checkedFill=(p=(f=t==null?void 0:t.checkboxStyle)===null||f===void 0?void 0:f.checkedFill)!==null&&p!==void 0?p:i==null?void 0:i.checkedFill,this._checkedStroke=(m=(v=t==null?void 0:t.checkboxStyle)===null||v===void 0?void 0:v.checkedStroke)!==null&&m!==void 0?m:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(b=(C=t==null?void 0:t.checkboxStyle)===null||C===void 0?void 0:C.disableCheckedFill)!==null&&b!==void 0?b:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(y=(_=t==null?void 0:t.checkboxStyle)===null||_===void 0?void 0:_.disableCheckedStroke)!==null&&y!==void 0?y:i==null?void 0:i.disableCheckedStroke,this._checkIconImage=(S=(w=t==null?void 0:t.checkboxStyle)===null||w===void 0?void 0:w.checkIconImage)!==null&&S!==void 0?S:i==null?void 0:i.checkIconImage,this._indeterminateIconImage=(A=(D=t==null?void 0:t.checkboxStyle)===null||D===void 0?void 0:D.indeterminateIconImage)!==null&&A!==void 0?A:i==null?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new Xr(t,this)}clone(){return new Xr(this)}}const{EVENT_TYPE:t6}=xn;function zg(n,t,e,i=xn,r,o){var s;return n||t?n instanceof xn?n:typeof n=="function"?zg(n(e),t,e,i,r,o):(n||(n={}),r&&!N(n.autoWrapText)&&(n.autoWrapText=!0),i===Xr?new Xr(n!=null?n:{},t!=null?t:{},(s=o.checkboxStyle)!==null&&s!==void 0?s:{}):new i(n!=null?n:{},t!=null?t:{})):i.DEFAULT}let ib;const aR={CHANGE_STYLE:"change_style"};class qr extends Zh{static get EVENT_TYPE(){return aR}static get DEFAULT(){return ib||(ib=new qr)}constructor(t={},e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M;super(),this._defaultPadding=[10,16,10,16],this._color=(i=t.color)!==null&&i!==void 0?i:e==null?void 0:e.color,this._fontSize=(r=t.fontSize)!==null&&r!==void 0?r:e==null?void 0:e.fontSize,this._fontFamily=(o=t.fontFamily)!==null&&o!==void 0?o:e==null?void 0:e.fontFamily,this._fontWeight=(s=t.fontWeight)!==null&&s!==void 0?s:e==null?void 0:e.fontWeight,this._fontVariant=(a=t.fontVariant)!==null&&a!==void 0?a:e==null?void 0:e.fontVariant,this._fontStyle=(l=t.fontStyle)!==null&&l!==void 0?l:e==null?void 0:e.fontStyle,this._textOverflow=((h=t.textOverflow)!==null&&h!==void 0?h:e==null?void 0:e.textOverflow)||"ellipsis",this._textStick=(d=(u=t.textStick)!==null&&u!==void 0?u:e==null?void 0:e.textStick)!==null&&d!==void 0&&d,this._marked=(g=(c=t.marked)!==null&&c!==void 0?c:e==null?void 0:e.marked)!==null&&g!==void 0&&g,this._textAlign=((f=t.textAlign)!==null&&f!==void 0?f:e==null?void 0:e.textAlign)||"left",this._textBaseline=((p=t.textBaseline)!==null&&p!==void 0?p:e==null?void 0:e.textBaseline)||"middle",this._bgColor=(v=t.bgColor)!==null&&v!==void 0?v:e==null?void 0:e.bgColor,this._padding=(C=(m=t.padding)!==null&&m!==void 0?m:e==null?void 0:e.padding)!==null&&C!==void 0?C:this._defaultPadding,this._borderColor=(b=t.borderColor)!==null&&b!==void 0?b:e==null?void 0:e.borderColor,this._lineHeight=(_=t.lineHeight)!==null&&_!==void 0?_:e==null?void 0:e.lineHeight,this._underline=(y=t.underline)!==null&&y!==void 0?y:e==null?void 0:e.underline,this._underlineColor=(w=t.underlineColor)!==null&&w!==void 0?w:e==null?void 0:e.underlineColor,this._underlineDash=(S=t.underlineDash)!==null&&S!==void 0?S:e==null?void 0:e.underlineDash,this._underlineOffset=(D=t.underlineOffset)!==null&&D!==void 0?D:e==null?void 0:e.underlineOffset,this._lineThrough=(A=t.lineThrough)!==null&&A!==void 0?A:e==null?void 0:e.lineThrough,this._lineThroughColor=(x=t.lineThroughColor)!==null&&x!==void 0?x:e==null?void 0:e.lineThroughColor,this._lineThroughDash=(B=t.lineThroughDash)!==null&&B!==void 0?B:e==null?void 0:e.lineThroughDash,this._linkColor=(F=t.linkColor)!==null&&F!==void 0?F:e==null?void 0:e.linkColor,this._cursor=(T=t.cursor)!==null&&T!==void 0?T:e==null?void 0:e.cursor,this._borderLineWidth=(R=t.borderLineWidth)!==null&&R!==void 0?R:e==null?void 0:e.borderLineWidth,this._borderLineDash=(M=t.borderLineDash)!==null&&M!==void 0?M:e==null?void 0:e.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){var t;return(t=this._padding)!==null&&t!==void 0?t:this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new qr(this)}}let nb;class Qh extends qr{static get DEFAULT(){return nb||(nb=new Qh)}constructor(t={},e=null){var i,r;super(t,e),this._autoWrapText=(i=t==null?void 0:t.autoWrapText)!==null&&i!==void 0?i:e==null?void 0:e.autoWrapText,this._lineClamp=(r=t==null?void 0:t.lineClamp)!==null&&r!==void 0?r:e==null?void 0:e.lineClamp}clone(){return new Qh(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let rb;class Zr extends qr{static get DEFAULT(){return rb||(rb=new Zr)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A;super(t,e),this._size=((o=(r=t==null?void 0:t.size)!==null&&r!==void 0?r:e==null?void 0:e.size)!==null&&o!==void 0?o:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((a=(s=t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=(h=(l=t==null?void 0:t.checkboxStyle)===null||l===void 0?void 0:l.defaultFill)!==null&&h!==void 0?h:i==null?void 0:i.defaultFill,this._defaultStroke=(d=(u=t==null?void 0:t.checkboxStyle)===null||u===void 0?void 0:u.defaultStroke)!==null&&d!==void 0?d:i==null?void 0:i.defaultStroke,this._disableFill=(g=(c=t==null?void 0:t.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i==null?void 0:i.disableFill,this._checkedFill=(p=(f=t==null?void 0:t.checkboxStyle)===null||f===void 0?void 0:f.checkedFill)!==null&&p!==void 0?p:i==null?void 0:i.checkedFill,this._checkedStroke=(m=(v=t==null?void 0:t.checkboxStyle)===null||v===void 0?void 0:v.checkedStroke)!==null&&m!==void 0?m:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(b=(C=t==null?void 0:t.checkboxStyle)===null||C===void 0?void 0:C.disableCheckedFill)!==null&&b!==void 0?b:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(y=(_=t==null?void 0:t.checkboxStyle)===null||_===void 0?void 0:_.disableCheckedStroke)!==null&&y!==void 0?y:i==null?void 0:i.disableCheckedStroke,this._checkIconImage=(S=(w=t==null?void 0:t.checkboxStyle)===null||w===void 0?void 0:w.checkIconImage)!==null&&S!==void 0?S:i==null?void 0:i.checkIconImage,this._indeterminateIconImage=(A=(D=t==null?void 0:t.checkboxStyle)===null||D===void 0?void 0:D.indeterminateIconImage)!==null&&A!==void 0?A:i==null?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new Zr(t,this)}clone(){return new Zr(this)}}function tu(n,t,e,i,r,o){var s;return n||t?n instanceof qr?n:typeof n=="function"?tu(n(e),t,e,i,r,o):(n||(n={}),r&&!N(n.autoWrapText)&&(n.autoWrapText=!0),i===Zr?new Zr(n!=null?n:{},t!=null?t:{},(s=o.checkboxStyle)!==null&&s!==void 0?s:{}):new i(n!=null?n:{},t!=null?t:{})):i.DEFAULT}class Pt{static get mode(){return Pt._mode||(Pt._mode=lR()),Pt._mode}static set mode(t){Pt._mode=t}static RegisterCreateCanvas(t){Pt.CreateCanvas=t}static RegisterLoadImage(t){Pt.LoadImage=t}static GetCreateCanvasFunc(){return Pt.CreateCanvas?Pt.CreateCanvas:Pt.mode==="worker"?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(t){Pt.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(Pt.RequestAnimationFrame)return Pt.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){Pt.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(Pt.CancelAnimationFrame)return Pt.CancelAnimationFrame}}function lR(){let n="browser";try{window.type==="node"?n="node":typeof window=="undefined"||window.performance?typeof window=="undefined"&&(n="node"):n="miniApp"}catch(t){n="node"}return n}Pt.dpr=0;function hR(){if(Pt.mode==="node")return;const n=document.createElement("style");n.id="vtable-style-styleSheet",n.textContent=`
.vtable .input-container {
	position: absolute;
	top:0px;
}
.vtable .table-scrollable {
	position: absolute;
	overflow: scroll;
}
.vtable .table-scrollable::-webkit-scrollbar-button{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-track-piece{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-corner {
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-thumb {
	border-radius      : 4px;
	background-color   : rgba(100, 100, 100, .5);
}

.vtable .table-scroll-end-point {
	opacity: 0;
	position: relative;
}
.vtable {
	/* \u8BBE\u7F6Eoverflow: auto \u5E94\u8BE5\u662F\u4E3A\u4E86\u6EDA\u52A8\u6761\u7684\u67D0\u4E2A\u95EE\u9898 \u4F46\u8BBE\u7F6E\u4E86auto\u4E4B\u540E dom\u7684\u4E0B\u62C9\u83DC\u5355\u53EA\u80FD\u663E\u793A\u5728vtable\u8282\u70B9\u4E2D \u8D85\u51FA\u4F1A\u622A\u65AD;\u73B0\u5728\u53BB\u6389auto \u6682\u65F6\u6EDA\u52A8\u6761\u7684\u95EE\u9898\u6CA1\u6709\u53D1\u73B0 */
	/* overflow: auto; */
	position: relative;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;
}
.vtable > canvas {
	position: absolute;
	width: 0;
	height: 0;
}
.vtable .table-focus-control {
	position: relative !important;
	width: 1px;
	height: 1px;
	opacity: 0;
	padding: 0;
	margin: 0;
	box-sizing: border-box;
	pointer-events: none;
	max-width: 500px;
	max-height: 500px;
	float: none !important;
}
.vtable input.table-focus-control::-ms-clear {
	visibility: hidden;
}
.vtable input.table-focus-control.composition {
	opacity: 1;
	max-width: none;
	max-height: none;
}
`,document.head.appendChild(n)}function ob(n){var t;return n!=null&&n.hoverOn||(n==null?void 0:n.visible)==="none"?0:(t=n==null?void 0:n.width)!==null&&t!==void 0?t:7}const uR=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},Ri=(n,t)=>uR(n)===t,Ar=n=>Ri(n,"object"),e6=n=>Ri(n,"function"),i6=n=>Ri(n,"array"),dR=n=>Ri(n,"string"),cR=n=>Ri(n,"number"),n6=n=>Ri(n,"regExp"),gR=n=>Ri(n,"boolean"),r6=n=>Ri(n,"symbol"),o6=n=>Ri(n,"date"),s6=n=>Ri(n,"undefined"),a6=n=>Ri(n,"null"),l6=n=>Ri(n,"error"),h6=n=>Ri(n,"document"),u6=n=>Ri(n,"global");function sb(n,...t){if(!t.length)return n||{};const e=t.shift();if(Ar(n)&&Ar(e))for(const i in e)Ar(e[i])?(n[i]||Object.assign(n,{[i]:{}}),Ar(n[i])||Object.assign(n,{[i]:e[i]}),sb(n[i],e[i])):Object.assign(n,{[i]:e[i]});return sb(n,...t)}function Ee(n,...t){if(!t.length)return n||{};const e=t.shift();if(Ar(n)&&Ar(e))for(const i in e)Ar(e[i])?(n[i]||Object.assign(n,{[i]:{}}),Ar(n[i])||Object.assign(n,{[i]:e[i]}),Ee(n[i],e[i])):e[i]!==null&&e[i]!==void 0&&Object.assign(n,{[i]:e[i]});return Ee(n,...t)}function Wg(n){return typeof n=="function"&&(n=n()),N(n)?`${n}`:""}function Ng(n){if((n==null?void 0:n.length)<=0)return n;const t=n.length,e=n[0].length,i=new Array(e);for(let r=0;r<t;r++)for(let o=0;o<e;o++)i[o]||(i[o]=new Array(t)),i[o][r]=n[r][o];return i}function d6(n,t,e=!1){let i,r;return function(...o){if(i&&clearTimeout(i),e){if(!i)return r=n.apply(this,o),r;i=setTimeout(()=>i=0,t)}else i=setTimeout(()=>n.apply(this,o),t)}}function ab(n,t){let e=null;return function(...i){e||(n.apply(this,i),e=setTimeout(()=>{e=null},t))}}function fR(n,t){let e=null;return function(...i){e||(e=setTimeout(()=>{n.apply(this,i),e=null},t))}}function jg(n,t){for(n=`${n}`;n.length<t;)n="0"+n;return n}function eu(n,t,e){n=(n=n.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const i=Math.round(256*t)*(e?-1:1),r=n.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),o=r&&N(r[4])?r[4]:null,s=r?[r[1],r[2],r[3]]:n.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`}).split(/,/);return r?`rgb${o!==null?"a":""}(${Math[e?"max":"min"](parseInt(s[0],10)+i,e?0:255)}, ${Math[e?"max":"min"](parseInt(s[1],10)+i,e?0:255)}, ${Math[e?"max":"min"](parseInt(s[2],10)+i,e?0:255)}${o!==null?`, ${o}`:""})`:["#",jg(Math[e?"max":"min"](parseInt(s[0],10)+i,e?0:255).toString(16),2),jg(Math[e?"max":"min"](parseInt(s[1],10)+i,e?0:255).toString(16),2),jg(Math[e?"max":"min"](parseInt(s[2],10)+i,e?0:255).toString(16),2)].join("")}function c6(n,t=0){return parseFloat(n.toFixed(t))}function Vg(n){return dR(n)||cR(n)||gR(n)?n.toString():""}function Gg(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function Ug(n,t,e){return e!=="desc"?n===t?0:n>t?1:-1:n===t?0:n<t?1:-1}function pR(n,t){let e,i=n;for(;e=t.shift();)i=i[e];return i}function g6({x:n,y:t},{left:e,top:i,width:r,height:o}){return n>e&&n<e+r&&t>i&&t<i+o}const f6=(n,t)=>n.length===t.length&&n.every((e,i)=>Object.is(e,t[i]));function p6(n){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-".split("");let e=5381,i=n.length-1;for(;i>-1;i--)e+=(e<<5)+n.charCodeAt(i);let r=2147483647&e,o="";do o+=t[63&r];while(r>>=6);return o}function vR(n,t){let e=n;for(let i=0;i<t.length;i++){const r=t[i];if(!e[r])return;e=e[r],e&&e.children&&i+1<t.length&&(e=e.children)}return e}function v6(n){return typeof n=="string"&&(n==="false"||n==="off"||/^0+$/.exec(n))?!1:!!n}function Kg(n){return/^-?\d+(\.\d+)?$/.test(n)}function ha(n){const t=[];for(let e=0;e<n.length;e++)t.indexOf(n[e])===-1&&t.push(n[e]);return t}const lb=typeof window=="undefined"||window.window===void 0;let Yg,$g;const hb={get find(){return Yg||(Yg=Array.prototype.find?(n,t)=>Array.prototype.find.call(n,t):(n,t)=>{const e=hb.findIndex(n,t);return e>=0?n[e]:void 0},Yg)},get findIndex(){return $g||($g=Array.prototype.findIndex?(n,t)=>Array.prototype.findIndex.call(n,t):(n,t)=>{const{length:e}=n;for(let i=0;i<e;i++)if(t(n[i],i,n))return i;return-1},$g)}};function mR(){if(lb)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const n=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(n),Edge:n.indexOf("edge")>-1,Chrome:n.indexOf("chrome")>-1&&n.indexOf("edge")===-1,Firefox:n.indexOf("firefox")>-1,Safari:n.indexOf("safari")>-1&&n.indexOf("edge")===-1}}const{IE:CR,Chrome:ub,Firefox:db,Edge:bR,Safari:_R}=mR();function yR(n){return n===Object(n)}function m6(n,t){const e={};for(const i in n)t.indexOf(i)>=0||Object.defineProperty(e,i,{get:()=>n[i],set(r){n[i]=r},configurable:!0,enumerable:!0});return e}function C6(n,t){const e=[],i={};for(const r in n)e.push(r),Object.defineProperty(i,r,{get(){const o=n[r];return o===void 0?t[r]:o},set(o){n[r]=o},configurable:!0,enumerable:!0});for(const r in t)e.indexOf(r)>=0||Object.defineProperty(i,r,{get(){const o=n[r];return o===void 0?t[r]:o},set(o){n[r]=o},configurable:!0,enumerable:!0});return i}function ua(...n){const t={};return n.forEach(e=>{for(const i in e)Object.defineProperty(t,i,{get:()=>e[i],set(r){e[i]=r},configurable:!0,enumerable:!0})}),t}function cb(n,t,...e){let i=n;for(let r=0;r<e.length&&i!=null;r++)i=t(i,e[r]);return i}function iu(n,...t){return cb(n,(e,i)=>e[i],...t)}function Xe(n,...t){return typeof n=="function"?n(...t):n}function wR(n,t,e){const i=Vg(n);(typeof e!="number"||!isFinite(e)||Math.floor(e)!==e||e>i.length)&&(e=i.length),e-=t.length;const r=i.lastIndexOf(t,e);return r!==-1&&r===e}function xr(n){return!!(n&&typeof n.then=="function")}function DR(n){return!!n.changedTouches}function SR(n,t){if(n[t])return n[t];const e=t.toLowerCase();if(n[e])return n[e];const i=t.toLowerCase();if(n[i])return n[i];for(const r in n)if(r.toLowerCase()===e)return n[r]}function AR(n){return Array.isArray(n)?n.length===3?[n[0],n[1],n[2],n[1]]:n.length===2?[n[0],n[1],n[0],n[1]]:n.length===1?[n[0],n[0],n[0],n[0]]:[n[0],n[1],n[2],n[3]]:[n,n,n,n]}function Bn(n,t,e){return n.start.col<=t&&t<=n.end.col&&n.start.row<=e&&e<=n.end.row||n.end.col<=t&&t<=n.start.col&&n.end.row<=e&&e<=n.start.row}function xR(n,t,e){for(let i=0;i<n.length;i++){const r=n[i];if(r.start.col<=t&&t<=r.end.col&&r.start.row<=e&&e<=r.end.row||r.end.col<=t&&t<=r.start.col&&r.end.row<=e&&e<=r.start.row)return!0}return!1}function nu(n){return{start:{col:Math.min(n.start.col,n.end.col),row:Math.min(n.start.row,n.end.row)},end:{col:Math.max(n.start.col,n.end.col),row:Math.max(n.start.row,n.end.row)}}}function BR(n,t){const e=nu(n),i=nu(t);return Math.max(e.start.col,i.start.col)<=Math.min(e.end.col,i.end.col)&&Math.max(e.start.row,i.start.row)<=Math.min(e.end.row,i.end.row)}function b6(n,t){const e=nu(n),i=nu(t);return e.start.col<=i.start.col&&e.end.col>=i.end.col&&e.start.row<=i.start.row&&e.end.row>=i.end.row}const _6={IE:CR,Edge:bR,Chrome:ub,Firefox:db,Safari:_R,heightLimit:ub?33554431:db?17895588:10737433},gb={isObject:yR},ru={endsWith:wR},FR={isTouchEvent:DR},TR={toBoxArray:AR},MR=Function.prototype;function y6(n,t,e,i){return e.col<=n&&n<=i.col&&e.row<=t&&t<=i.row||i.col<=n&&n<=e.col&&i.row<=t&&t<=e.row}function w6(n,t){return!(n.x2<=t.x1||n.x1>=t.x2||n.y2<=t.y1||n.y1>=t.y2)&&!(n.x1<=t.x1&&n.x2>=t.x2&&n.y1<=t.y1&&n.y2>=t.y2||t.x1<=n.x1&&t.x2>=n.x2&&t.y1<=n.y1&&t.y2>=n.y2)}const Q={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",CHANGE_HEADER_POSITION:"change_header_position",SORT_CLICK:"sort_click",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value"},RR=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},Ei=(n,t)=>RR(n)===t,ER=n=>Ei(n,"object"),D6=n=>Ei(n,"function"),S6=n=>Ei(n,"array"),A6=n=>Ei(n,"string"),x6=n=>Ei(n,"number"),B6=n=>Ei(n,"regExp"),F6=n=>Ei(n,"boolean"),T6=n=>Ei(n,"symbol"),M6=n=>Ei(n,"date"),R6=n=>Ei(n,"undefined"),E6=n=>Ei(n,"null"),P6=n=>Ei(n,"error"),H6=n=>Ei(n,"document"),L6=n=>Ei(n,"global");function fb(n,t,e){let i,r,o,s,a,l,h=0,u=!1,d=!1,c=!0;const g=!t&&t!==0&&typeof requestAnimationFrame=="function";if(typeof n!="function")throw new TypeError("Expected a function");function f(C){const b=i,_=r;return r=void 0,i=void 0,h=C,s=n.apply(_,b),s}function p(C,b){return g?requestAnimationFrame(C):setTimeout(C,b)}function v(C){const b=C-l;return l===void 0||b>=t||b<0||u&&C-h>=o}function m(){const C=Date.now();if(v(C))return function(b){return a=void 0,c&&i?f(b):(r=void 0,i=void 0,s)}(C);a=p(m,function(b){const _=b-h,y=t&&-(b-l);return u?Math.min(y,o-_):y}(C))}return t=+t||0,ER(e)&&(d=!!e.leading,u="maxWait"in e,u&&(o=Math.max(+e.maxWait||0,t)),c="trailing"in e?!!e.trailing:c),function(...C){const b=Date.now(),_=v(b);if(i=C,r=this,l=b,_){if(a===void 0)return function(y){return h=y,a=p(m,t),d?f(y):s}(l);if(u)return a=p(m,t),f(l)}return a===void 0&&(a=p(m,t)),s}}let PR=1;class HR{constructor(t,e,i){var r;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const o=this.getSize();o.width===this.lastSize.width&&o.height===this.lastSize.height||(this.lastSize=o,this.cb&&this.cb(Object.assign({},this.lastSize)))},this.onResize=()=>{this.checkSize()&&this.callBackDebounce()},this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=fb(this.callBack,this.resizeTime),window==null||window.addEventListener("resize",this.onResize),"ResizeObserver"in window){const o=window.ResizeObserver;this.observer=new o(this.mutationResize),(r=this.observer)===null||r===void 0||r.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(t){this.lastSize=t}checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}}class ou{constructor(){this.listeners={},this.reseizeListeners={}}on(t,e,i,...r){if(Pt.mode==="node")return-1;const o=PR++;if(t!=null&&t.addEventListener)if(e!=="resize"||t===window)t==null||t.addEventListener(e,i,...r);else{const a=new HR(t,i,this.resizeTime);this.reseizeListeners[o]=a}const s={target:t,type:e,listener:i,options:r};return this.listeners[o]=s,o}once(t,e,i,...r){if(Pt.mode==="node")return-1;const o=this.on(t,e,(...s)=>{this.off(o),i(...s)},...r);return o}off(t){var e;if(Pt.mode==="node"||t==null)return;const i=(e=this.listeners)===null||e===void 0?void 0:e[t];i&&(delete this.listeners[t],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(t,e,...i){if(Pt.mode!=="node")for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&o.listener.call(o.target,...i)}}hasListener(t,e){if(Pt.mode==="node")return!1;let i=!1;for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if(Pt.mode!=="node"){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e==null||e.disConnect()}this.listeners={}}}release(){Pt.mode!=="node"&&(this.clear(),this.listeners={})}}const da=(n,t)=>{let e=0,i=n.length-1;for(;e<=i;){const r=Math.floor((e+i)/2);if(n[r]===t)return r;n[r]>t?i=r-1:e=r+1}return i<0?0:i};class Wo{constructor(){this._keys=[],this._vals={},this._sorted=!1}count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:r}=this;if(this._sorted||(r.sort((s,a)=>s<a?-1:s>a?1:0),this._sorted=!0),t>e){const s=[];for(let a=da(r,t+i-1);a>=0;a--){const l=r[a];if(l>=t)s.push(this.get(l));else if(e<=l&&l<t)this.put(l+i,this.get(l));else if(l<e)break}for(let a=0;a<i;a++)this.put(e+a,s[i-1-a])}const{length:o}=r;if(t<e){const s=[];for(let a=da(r,t);a<o;a++){const l=r[a];if(l>=t&&l<t+i)s.push(this.get(l));else if(t+i<=l&&l<=e)this.put(l-i,this.get(l));else if(l>e)break}for(let a=0;a<i;a++)this.put(e+a,s[a])}}exchangeOrder(t,e,i,r,o){const{_keys:s}=this;if(this._sorted||(s.sort((a,l)=>a<l?-1:a>l?1:0),this._sorted=!0),t>i){const a=[],l=[];for(let h=da(s,i);h<t+e;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(o+e+h,a[h])}else{const a=[],l=[];for(let h=da(s,t);h<i+r;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(t+h,a[h])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);e!==-1&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return N(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:r}=this,{length:o}=r;this._sorted||(r.sort((s,a)=>s<a?-1:s>a?1:0),this._sorted=!0);for(let s=da(r,t);s<o;s++){const a=r[s];if(t<=a&&a<=e){if(i(this.get(a),a)===!1)break}else if(e<a)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),N(e)&&this.put(t,e)}}class On{constructor(t,e,i,r){this.bounds=new Ji,this.bounds.set(t,e,t+i,e+r)}static bounds(t,e,i,r){return new On(t,e,Math.round(i-t),Math.round(r-e))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new On(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}}function LR(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#282a2e":"#2d3137"}var pb={underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:LR,fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function kR(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#FFF":"#F4F8FF"}var vb={underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:kR,borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function IR(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#fbfbfc":"#FFF"}var mb={underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:IR,borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function OR(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#FDFDFD":"#FAF9FB"}var Cb={underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:OR,hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,inlineColumnBgColor:"#CCE0FF",inlineRowBgColor:"#CCE0FF",cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function zR(n){const{row:t,table:{frozenRowCount:e}}=n;return e-1===t?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}function WR(n){const{col:t,table:e}=n,{colCount:i,frozenColCount:r}=e,o="#ccc7c7";return r-1===t||i-1===t?[o,"#f2f2f2","#ccc7c7",null]:[o,null,"#ccc7c7",null]}var bb={underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:WR,hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:zR},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};const NR={},_b=16,yb="Arial,sans-serif",jR="#FFF",VR="#000",GR=1,UR=[],KR="#000",Xg=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,YR=16,qg="$$indicator$$",$R='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',XR='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',qR={type:"line"};function ZR(n){return{defaultAxisStyle:ca(n.defaultAxisStyle),leftAxisStyle:ca(n.leftAxisStyle),rightAxisStyle:ca(n.rightAxisStyle),topAxisStyle:ca(n.topAxisStyle),bottomAxisStyle:ca(n.bottomAxisStyle)}}function ca(n){return n||{}}const JR={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function ga(n,t,e,i){return iu(n,...e)||iu(t,...e)||i&&iu(n,...i)||i&&iu(t,...i)}class Ni{constructor(t,e){this._defaultStyle=null,this._header=null,this._cornerHeader=null,this._cornerRightTopCell=null,this._cornerLeftBottomCell=null,this._cornerRightBottomCell=null,this._rightFrozen=null,this._bottomFrozen=null,this._rowHeader=null,this._body=null,this._scroll=null,this._tooltip=null,this._frameStyle=null,this._columnResize=null,this._dragHeaderSplitLine=null,this._frozenColumnLine=null,this._selectionStyle=null,this._axisStyle=null,this._checkboxStyle=null,this._textPopTipStyle=null,this.isPivot=!1,this.internalTheme={obj:t,superTheme:e}}get font(){const{obj:t,superTheme:e}=this.internalTheme;return ga(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return ga(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){const{obj:t,superTheme:e}=this.internalTheme;return!!ga(t,e,["cellInnerBorder"])}get cellBorderClipDirection(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=ga(e,i,["cellBorderClipDirection"]))!==null&&t!==void 0?t:"top-left"}get _contentOffset(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=ga(e,i,["_contentOffset"]))!==null&&t!==void 0?t:0}get defaultStyle(){if(!this._defaultStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.defaultStyle,t.defaultStyle);this._defaultStyle={get fontSize(){var r;return(r=i.fontSize)!==null&&r!==void 0?r:_b},get fontFamily(){var r;return(r=i.fontFamily)!==null&&r!==void 0?r:yb},get fontWeight(){return i.fontWeight},get fontVariant(){return i.fontVariant},get fontStyle(){return i.fontStyle},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:jR},get color(){var r;return(r=i.color)!==null&&r!==void 0?r:KR},get borderColor(){var r;return(r=i.borderColor)!==null&&r!==void 0?r:VR},get borderLineWidth(){var r;return(r=i.borderLineWidth)!==null&&r!==void 0?r:GR},get borderLineDash(){var r;return(r=i.borderLineDash)!==null&&r!==void 0?r:UR},get hover(){if(i.hover)return{get cellBgColor(){var r,o;return(o=(r=i.hover)===null||r===void 0?void 0:r.cellBgColor)!==null&&o!==void 0?o:void 0},get inlineColumnBgColor(){var r,o,s,a,l,h;return(h=(o=(r=i.hover)===null||r===void 0?void 0:r.inlineColumnBgColor)!==null&&o!==void 0?o:!((s=i.hover)===null||s===void 0)&&s.cellBgColor&&typeof((a=i.hover)===null||a===void 0?void 0:a.cellBgColor)=="string"?eu((l=i.hover)===null||l===void 0?void 0:l.cellBgColor,.1,!1):void 0)!==null&&h!==void 0?h:void 0},get inlineRowBgColor(){var r,o,s,a,l,h;return(h=(o=(r=i.hover)===null||r===void 0?void 0:r.inlineRowBgColor)!==null&&o!==void 0?o:!((s=i.hover)===null||s===void 0)&&s.cellBgColor&&typeof((a=i.hover)===null||a===void 0?void 0:a.cellBgColor)=="string"?eu((l=i.hover)===null||l===void 0?void 0:l.cellBgColor,.1,!1):void 0)!==null&&h!==void 0?h:void 0}}},get padding(){var r;return(r=i.padding)!==null&&r!==void 0?r:[10,16,10,16]},get textAlign(){var r;return(r=i.textAlign)!==null&&r!==void 0?r:"left"},get textBaseline(){var r;return(r=i.textBaseline)!==null&&r!==void 0?r:"middle"},get textOverflow(){var r;return(r=i.textOverflow)!==null&&r!==void 0?r:"ellipsis"},get lineHeight(){return i.lineHeight},get autoWrapText(){var r;return(r=i.autoWrapText)!==null&&r!==void 0&&r},get lineClamp(){var r;return(r=i.lineClamp)!==null&&r!==void 0?r:"auto"},get linkColor(){var r;return(r=i.linkColor)!==null&&r!==void 0?r:"#3772ff"},get cursor(){var r;return(r=i.cursor)!==null&&r!==void 0?r:"auto"},get marked(){var r;return(r=i.marked)!==null&&r!==void 0&&r},get underline(){var r;return(r=i.underline)!==null&&r!==void 0&&r},get underlineColor(){return i.underlineColor},get underlineDash(){return i.underlineDash},get underlineOffset(){return i.underlineOffset},get lineThrough(){var r;return(r=i.lineThrough)!==null&&r!==void 0&&r},get lineThroughColor(){return i.lineThroughColor},get lineThroughDash(){return i.lineThroughDash}}}return this._defaultStyle}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=Ee({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=Ee({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=Ee({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=Ee({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=Ee({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){var t;if(!this._rowHeader){const{obj:e,superTheme:i}=this.internalTheme,r=Ee({},this.defaultStyle,i.rowHeaderStyle,(t=e.rowHeaderStyle)!==null&&t!==void 0?t:this.isPivot?null:e.headerStyle);this._rowHeader=this.getStyle(r)}return this._rowHeader}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){var r;return(r=i.scrollSliderColor)!==null&&r!==void 0?r:"#C0C0C0"},get scrollRailColor(){return i.scrollRailColor},get visible(){var r;return(r=i.visible)!==null&&r!==void 0?r:"scrolling"},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:7},get hoverOn(){var r;return(r=i.hoverOn)===null||r===void 0||r}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){var r;return(r=i.fontFamily)!==null&&r!==void 0?r:yb},get fontSize(){var r;return(r=i.fontSize)!==null&&r!==void 0?r:_b},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#000"},get padding(){var r;return(r=i.padding)!==null&&r!==void 0?r:[6,8]},get color(){var r;return(r=i.color)!==null&&r!==void 0?r:"#FFF"}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"#416EFF"},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#D9E2FF"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:1},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:i.lineWidth+2},get labelColor(){var r;return(r=i.labelColor)!==null&&r!==void 0?r:"#FFF"},get labelFontSize(){var r;return(r=i.labelFontSize)!==null&&r!==void 0?r:10},get labelFontFamily(){var r;return(r=i.labelFontFamily)!==null&&r!==void 0?r:"sans-serif"},get labelBackgroundFill(){var r;return(r=i.labelBackgroundFill)!==null&&r!==void 0?r:"#3073F2"},get labelBackgroundCornerRadius(){var r;return(r=i.labelBackgroundCornerRadius)!==null&&r!==void 0?r:5}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"blue"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:2},get shadowBlockColor(){var r;return(r=i.shadowBlockColor)!==null&&r!==void 0?r:"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:24},get startColor(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.startColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0.06)"},get endColor(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.endColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0)"}}},get border(){if(i.border)return{get lineColor(){var r,o;return(o=(r=i.border)===null||r===void 0?void 0:r.lineColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0.06)"},get bgColor(){var r,o,s,a;return(a=(o=(r=i.border)===null||r===void 0?void 0:r.bgColor)!==null&&o!==void 0?o:(s=i.border)===null||s===void 0?void 0:s.lineColor)!==null&&a!==void 0?a:"rgba(00, 24, 47, 0.06)"},get lineWidth(){var r,o;return(o=(r=i.border)===null||r===void 0?void 0:r.lineWidth)!==null&&o!==void 0?o:4},get width(){var r,o,s,a;return(a=(o=(r=i.border)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:(s=i.border)===null||s===void 0?void 0:s.lineWidth)!==null&&a!==void 0?a:4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){var r;return(r=i==null?void 0:i.cellBgColor)!==null&&r!==void 0?r:"rgba(0, 0, 255,0.1)"},get cellBorderColor(){var r;return(r=i==null?void 0:i.cellBorderColor)!==null&&r!==void 0?r:"#3073f2"},get cellBorderLineWidth(){var r;return(r=i==null?void 0:i.cellBorderLineWidth)!==null&&r!==void 0?r:2}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.axisStyle,t.axisStyle);this._axisStyle=ZR(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Ee({},JR,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return wb(e,t)||wb(i,t)}extends(t){return new Ni(t,this)}getStyle(t){return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){var e,i;return(i=(e=t.hover)===null||e===void 0?void 0:e.cellBgColor)!==null&&i!==void 0?i:void 0},get inlineColumnBgColor(){var e,i,r,o,s,a;return(a=(i=(e=t.hover)===null||e===void 0?void 0:e.inlineColumnBgColor)!==null&&i!==void 0?i:!((r=t.hover)===null||r===void 0)&&r.cellBgColor&&typeof((o=t.hover)===null||o===void 0?void 0:o.cellBgColor)=="string"?eu((s=t.hover)===null||s===void 0?void 0:s.cellBgColor,.1,!1):void 0)!==null&&a!==void 0?a:void 0},get inlineRowBgColor(){var e,i,r,o,s,a;return(a=(i=(e=t.hover)===null||e===void 0?void 0:e.inlineRowBgColor)!==null&&i!==void 0?i:!((r=t.hover)===null||r===void 0)&&r.cellBgColor&&typeof((o=t.hover)===null||o===void 0?void 0:o.cellBgColor)=="string"?eu((s=t.hover)===null||s===void 0?void 0:s.cellBgColor,.1,!1):void 0)!==null&&a!==void 0?a:void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){var e,i;return(i=(e=t.frameStyle)===null||e===void 0?void 0:e.borderColor)!==null&&i!==void 0?i:void 0},get borderLineWidth(){var e,i;return(i=(e=t.frameStyle)===null||e===void 0?void 0:e.borderLineWidth)!==null&&i!==void 0?i:void 0},get borderLineDash(){var e,i;return(i=(e=t.frameStyle)===null||e===void 0?void 0:e.borderLineDash)!==null&&i!==void 0?i:void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){var e;return(e=t.underline)!==null&&e!==void 0&&e},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){var e;return(e=t.lineThrough)!==null&&e!==void 0&&e},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function wb(n,t){if(n instanceof Ni)return n.hasProperty(t);let e=n;if(!e)return!1;for(let i=0;i<t.length;i++)if(e=e[t[i]],!e)return!1;return!!e}const Db=new Ni(pb,pb),Sb=new Ni(vb,vb),Ab=new Ni(mb,mb),xb=new Ni(Cb,Cb),Bb=new Ni(bb,bb),QR={DEFAULT:xb,SIMPLIFY:Bb,ARCO:Ab,DARK:Db,BRIGHT:Sb},tE={TableTheme:Ni};function eE(n){if(!n)return null;if(typeof n=="string"){const t=SR(Fb(),n);return t?t instanceof Ni?t:new Ni(t,t):null}return n instanceof Ni?n:new Ni(n,n)}function Fb(){return ua(QR,NR)}var zn={DARK:Db,BRIGHT:Sb,ARCO:Ab,DEFAULT:xb,SIMPLIFY:Bb,theme:tE,of:eE,get:Fb};function ze(n,t,e){var i;if(n.internalProps.customMergeCell){const o=n.getCustomMerge(t,e);if(o)return o.range}if(!n.isHeader(t,e)&&!(!((i=n.getBodyColumnDefine(t,e))===null||i===void 0)&&i.mergeCell))return!1;const r=n.getCellRange(t,e);return!(r.start.col===r.end.col&&r.start.row===r.end.row)&&r}var iE=n=>typeof n=="object"&&n!==null,No=function(n){if(!iE(n)||!lo(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t};function Tb(n,t,e=!1){if(t){if(n===t)return;if(N(t)&&typeof t=="object"){const i=Object(t),r=[];for(const a in i)r.push(a);let{length:o}=r,s=-1;for(;o--;){const a=r[++s];N(i[a])&&typeof i[a]=="object"?nE(n,t,a,e):Mb(n,a,i[a])}}}}function nE(n,t,e,i=!1){const r=n[e],o=t[e];let s=t[e],a=!0;if(rt(o)){if(i)s=[];else if(rt(r))s=r;else if(Ac(r)){s=new Array(r.length);let l=-1;const h=r.length;for(;++l<h;)s[l]=r[l]}}else No(o)?(s=r,typeof r!="function"&&typeof r=="object"||(s={})):a=!1;a&&Tb(s,o,i),Mb(n,e,s)}function Mb(n,t,e){(e!==void 0&&!rE(n[t],e)||e===void 0&&!(t in n))&&(n[t]=e)}function rE(n,t){return n===t||Number.isNaN(n)&&Number.isNaN(t)}function gt(n,...t){let e=-1;const i=t.length;for(;++e<i;)Tb(n,t[e],!0);return n}var oE=n=>({}).toString.call(n).replace(/^\[object /,"").replace(/]$/,"");const sE=Object.prototype;var aE=function(n){const t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||sE)};const lE=Object.prototype.hasOwnProperty;function hE(n){if(ut(n))return!0;if(Ac(n))return!n.length;const t=oE(n);if(t==="Map"||t==="Set")return!n.size;if(aE(n))return!Object.keys(n).length;for(const e in n)if(lE.call(n,e))return!1;return!0}var Bt=hE,qe=(n,t,e)=>{const i=ue(t)?t.split("."):t;for(let r=0;r<i.length;r++)n=n?n[i[r]]:void 0;return n===void 0?e:n};const uE=1e-10,dE=1e-10;function jo(n,t,e=dE,i=uE){const r=i,o=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,o)}function Rb(n,t,e,i){return n>t&&!jo(n,t,e,i)}function Eb(n,t,e,i){return n<t&&!jo(n,t,e,i)}function Wn(n){if(we(n))return[n,n,n,n];if(rt(n)){const t=n.length;if(t===1){const e=n[0];return[e,e,e,e]}if(t===2){const[e,i]=n;return[e,i,e,i]}if(t===3){const[e,i,r]=n;return[e,i,r,i]}if(t===4)return n}if(ye(n)){const{top:t=0,right:e=0,bottom:i=0,left:r=0}=n;return[t,e,i,r]}return[0,0,0,0]}function cE(n){if(!n)return[];if(Object.keys)return Object.keys(n);const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(e);return t}function gE(n,t,e){const i=cE(t);for(let r=0;r<i.length;r++){const o=i[r];(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}return n}function fE(n,t,e=!0){if(n="prototype"in n?n.prototype:n,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let r=0;r<i.length;r++){const o=i[r];o!=="constructor"&&(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}}else gE(n,t,e)}const Pb=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class Nn extends Di{constructor(t,e){super(t),e!=null&&e.mode&&(this.mode=e.mode,this.setMode(e.mode)),e!=null&&e.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(t,e,i){No(this.attribute[t])&&No(e)&&!ge(this.attribute[t])&&!ge(e)?gt(this.attribute[t],e):this.attribute[t]=e,Pb.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every(r=>Pb.includes(r))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){ut(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const r=e[i];!No(this.attribute[r])||ge(this.attribute[r])||ge(t[r])?this.attribute[r]=t[r]:gt(this.attribute[r],t[r])}}bindEvents(){}_getNodeId(t){return`${this.id}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const r=new $d(t,e);r.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(r)}}function pE(){Dn(),ag(),Um(),zo()}pE();class su extends Nn{getStartAngle(){return this._startAngle}getEndAngle(){return this._endAngle}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},su.defaultAttributes,t)),this.name="segment"}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:o=!0,multiSegment:s,mainSegmentIndex:a}=this.attribute;if(!o)return;this._computeLineAngle();const l=this._renderSymbol(t,"start"),h=this._renderSymbol(e,"end");if(this.startSymbol=l,this.endSymbol=h,s){const u=[...this.attribute.points];if(we(a))u[a]=this._clipPoints(u[a]);else{const d=this._clipPoints(Bc(u));u[0][0]=d[0],u[u.length-1][u[u.length-1].length-1]=d[d.length-1]}u.forEach((d,c)=>{var g,f;const p=ct.line(Object.assign(Object.assign({points:d},rt(i)?(g=i[c])!==null&&g!==void 0?g:i[i.length-1]:i),{fill:!1}));p.name=`${this.name}-line`,p.id=this._getNodeId("line"+c),Bt(r==null?void 0:r.line)||(p.states=rt(r.line)?(f=r.line[c])!==null&&f!==void 0?f:r.line[r.line.length-1]:r.line),this.add(p)})}else{const u=ct.polygon(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},xc(i)[0]),{fill:!1,closePath:!1}));u.name=`${this.name}-line`,u.id=this._getNodeId("line"),Bt(r==null?void 0:r.line)||(u.states=[].concat(r.line)[0]),this.add(u)}}_renderSymbol(t,e){const i=this._getMainSegmentPoints();if(!i.length)return;const{autoRotate:r=!0}=t;let o;if(t&&t.visible){const s=this._startAngle,a=this._endAngle,{state:l}=this.attribute,h=i[0],u=i[i.length-1],{refX:d=0,refY:c=0,refAngle:g=0,style:f,symbolType:p,size:v=12}=t;let m,C;e==="start"?(m={x:h.x+(we(s)?d*Math.cos(s)+c*Math.cos(s-Math.PI/2):0),y:h.y+(we(s)?d*Math.sin(s)+c*Math.sin(s-Math.PI/2):0)},C=s+Math.PI/2):(m={x:u.x+(we(a)?d*Math.cos(a)+c*Math.cos(a-Math.PI/2):0),y:u.y+(we(a)?d*Math.sin(a)+c*Math.sin(a-Math.PI/2):0)},C=a+Math.PI/2),o=ct.symbol(Object.assign(Object.assign(Object.assign({},m),{symbolType:p,size:v,angle:r?C+g:0,strokeBoundsBuffer:0}),f)),o.name=`${this.name}-${e}-symbol`,o.id=this._getNodeId(`${e}-symbol`),Bt(l==null?void 0:l.symbol)||(o.states=l.symbol),this.add(o)}return o}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let r;return r=e?we(i)?t[i]:Bc(t):t,this._mainSegmentPoints=r,r}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let r=t;if(e.visible){const o=e.clip?e.size||10:0;r=[{x:t[0].x-o/2*(Math.cos(this._startAngle)||0),y:t[0].y-o/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const o=i.clip?i.size||10:0,s={x:t[t.length-1].x-o/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-o/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),s]}return r}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],r=t[t.length-2],o=t[t.length-1],s=[e.x-i.x,e.y-i.y],a=Math.atan2(s[1],s[0]),l=[o.x-r.x,o.y-r.y],h=Math.atan2(l[1],l[0]);this._startAngle=a,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}su.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};function vE(n,t){return[n[0]*t,n[1]*t]}function N6(n){const[t,e]=n;return Math.sqrt(t*t+e*e)}function mE(n){const[t,e]=n;let i=t*t+e*e;return i>0&&(i=1/Math.sqrt(i)),[n[0]*i,n[1]*i]}function CE(n,t){const[e,i]=n,[r,o]=t,s=Math.sqrt((e*e+i*i)*(r*r+o*o)),a=s&&(e*r+i*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function bE(n,t){return n[0]*t[1]-t[0]*n[1]}function _E(n,t,e){const i=CE(n,t),r=bE(n,t)>=0;return e?r?2*Math.PI-i:i:r?i:2*Math.PI-i}var yE=n=>lo(n,"Date");function Ot(n){let t;if(!N(n)||typeof n!="object")return n;const e=rt(n),i=n.length;t=e?new Array(i):typeof n=="object"?{}:Li(n)||lt(n)||ue(n)?n:yE(n)?new Date(+n):void 0;const r=e?void 0:Object.keys(Object(n));let o=-1;if(t)for(;++o<(r||n).length;){const s=r?r[o]:o,a=n[s];t[s]=Ot(a)}return t}function fa(n,t){n.forEachChildren(e=>{const i=t(e);e.isContainer&&!i&&fa(e,t)})}const V6=n=>!isNil(n)&&n.visible!==!1;function G6(n,t){if(!t)return[];const e=n.find(i=>i.name===t,!0);return e?e.getChildren():[]}function U6(n,t){if(!t)return[];const e=n.find(i=>i.name===t,!0);return e?e.findAll(i=>i.type!=="group",!0):[]}const K6=-.5*Math.PI,Y6=1.5*Math.PI,wE="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",$6=11;var Ai;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(Ai||(Ai={}));const Vo={[Ai.selectedReverse]:{},[Ai.selected]:{},[Ai.hover]:{},[Ai.hoverReverse]:{}},Hb={container:"",width:30,height:30,style:{}},X6=(n,t,e)=>new TextMeasure(Object.assign({defaultFontParams:{fontFamily:DEFAULT_TEXT_FONT_FAMILY,fontSize:DEFAULT_TEXT_FONT_SIZE},getTextBounds:e?void 0:getTextBounds,specialCharSet:`-/: .,@%'"~`+TextMeasure.ALPHABET_CHAR_SET+TextMeasure.ALPHABET_CHAR_SET.toUpperCase()},t!=null?t:{}),n);function Zg(n,t,e=wE){var i,r;if(!n)return{width:0,height:0};const o=wg({text:n,fontFamily:(i=t.fontFamily)!==null&&i!==void 0?i:e,fontSize:t.fontSize||12,fontWeight:t.fontWeight,textAlign:(r=t.textAlign)!==null&&r!==void 0?r:"center",textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||12});return{width:o.width(),height:o.height()}}function au(n,t="type"){return t in n&&n[t]==="rich"||ye(n.text)&&n.text.type==="rich"}function lu(n){var t,e;return n.width=(t=n.width)!==null&&t!==void 0?t:0,n.height=(e=n.height)!==null&&e!==void 0?e:0,n.maxWidth=n.maxLineWidth,n.textConfig=n.text.text||n.text,n}var ji;(function(n){n.innerView="inner-view",n.axisContainer="axis-container",n.labelContainer="axis-label-container",n.tickContainer="axis-tick-container",n.tick="axis-tick",n.subTick="axis-sub-tick",n.label="axis-label",n.title="axis-title",n.gridContainer="axis-grid-container",n.grid="axis-grid",n.gridRegion="axis-grid-region",n.line="axis-line",n.background="axis-background",n.axisLabelBackground="axis-label-background"})(ji||(ji={}));var Go;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(Go||(Go={}));const Uo={[Go.selectedReverse]:{},[Go.selected]:{},[Go.hover]:{},[Go.hoverReverse]:{}},Jg={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}};function Lb(){Dn(),Yr(),zo(),Ih(),oa()}var Qg=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};Lb();class pa extends Nn{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},pa.defaultAttributes,t)),this.name="tag"}render(){var t,e;const{text:i="",textStyle:r={},shape:o={},panel:s={},space:a=4,minWidth:l,maxWidth:h,padding:u=4,visible:d,state:c,type:g,textAlwaysCenter:f}=this.attribute,p=Wn(u),v=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let m,C=p[1]+p[3],b=p[0]+p[2],_=0,y=0;const{visible:w}=o,S=Qg(o,["visible"]);if(Li(w)){const A=(S==null?void 0:S.size)||10,x=lt(A)?A:Math.max(A[0],A[1]);m=v.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:A,strokeBoundsBuffer:0},S),{visible:w,x:x/2,y:x/2}),"symbol"),Bt(c==null?void 0:c.shape)||(m.states=c.shape),w&&(y=x+a)}let D;if(C+=y,_+=y,au({text:i})||g==="rich"){const A=Object.assign(Object.assign(Object.assign({},lu(Object.assign({type:g,text:i},r))),r),{visible:N(i)&&d!==!1,x:_,y:0});D=v.createOrUpdateChild("tag-text",A,"richtext");const{visible:x}=s,B=Qg(s,["visible"]);if(d&&Li(x)){const F=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},B),{visible:x&&!!i,x:D.AABBBounds.x1,y:D.AABBBounds.y1,width:D.AABBBounds.width(),height:D.AABBBounds.height()}),"rect");Bt(c==null?void 0:c.panel)||(F.states=c.panel)}}else{const A=Object.assign(Object.assign({text:ye(i)&&"type"in i&&i.type==="text"?i.text:i,visible:N(i)&&d!==!1,lineHeight:r==null?void 0:r.fontSize},r),{x:_,y:0});ut(A.lineHeight)&&(A.lineHeight=r.fontSize),D=v.createOrUpdateChild("tag-text",A,"text"),Bt(c==null?void 0:c.text)||(D.states=c.text);const x=Zg(A.text,r,(t=this.stage)===null||t===void 0?void 0:t.getTheme().text.fontFamily),B=x.width,F=x.height;C+=B;const T=(e=o.size)!==null&&e!==void 0?e:10,R=lt(T)?T:Math.max(T[0],T[1]);b+=Math.max(F,o.visible?R:0);const{textAlign:M,textBaseline:E}=r;(N(l)||N(h))&&(N(l)&&C<l&&(C=l),N(h)&&C>h&&(C=h,D.setAttribute("maxLineWidth",h-p[1]-p[2])));let P=0,I=0,k=0;if(M==="left"||M==="start"?k=1:M==="right"||M==="end"?k=-1:M==="center"&&(k=0),k?k<0?(P-=C,m&&m.setAttribute("x",(m.attribute.x||0)-B),v.setAttribute("x",-p[1]-y)):k>0&&v.setAttribute("x",p[3]):(P-=C/2,m&&m.setAttribute("x",(m.attribute.x||0)-B/2),v.setAttribute("x",-y/2)),f&&k){const z=C-p[1]-p[3],j=B+y,U=(z-j)/2+y+B/2,W=(z-j)/2+R/2;D.setAttributes({x:U*k,textAlign:"center"}),m==null||m.setAttributes({x:W*k}),v.setAttribute("x",p[2+k]*k)}E==="middle"?(I-=b/2,m&&m.setAttribute("y",0)):E==="bottom"?(I-=b,m&&m.setAttribute("y",-F/2),v.setAttribute("y",-p[2])):E==="top"&&(v.setAttribute("y",p[0]),m&&m.setAttribute("y",F/2));const{visible:H}=s,O=Qg(s,["visible"]);if(d&&Li(H)){const z=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},O),{visible:H&&!!i,x:P,y:I,width:C,height:b}),"rect");Bt(c==null?void 0:c.panel)||(z.states=c.panel)}}}}pa.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};class DE extends Nn{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{const e=t.target;e!==this._lastHover&&e.name&&!Bt(e.states)&&(e.addState(Ai.hover,!0),fa(this.axisContainer,i=>{i!==e&&i.name&&!Bt(i.states)&&i.addState(Ai.hoverReverse,!0)}),this._lastHover=e)},this._onUnHover=t=>{this._lastHover&&(fa(this.axisContainer,e=>{e.name&&!Bt(e.states)&&(e.removeState(Ai.hoverReverse),e.removeState(Ai.hover))}),this._lastHover=null)},this._onClick=t=>{const e=t.target;if(this._lastSelect===e&&e.hasState(Ai.selected))return this._lastSelect=null,void fa(this.axisContainer,i=>{i.name&&!Bt(i.states)&&(i.removeState(Ai.selectedReverse),i.removeState(Ai.selected))});e.name&&!Bt(e.states)&&(e.addState(Ai.selected,!0),fa(this.axisContainer,i=>{i!==e&&i.name&&!Bt(i.states)&&i.addState(Ai.selectedReverse,!0)}),this._lastSelect=e)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=Ot(this.attribute);gt(this.attribute,t);const i=ct.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this.removeAllChild(!0),this._prevInnerView=this._innerView,this._innerView=ct.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:r,line:o,items:s}=this.attribute,a=ct.group({x:0,y:0,zIndex:1});if(a.name=ji.axisContainer,a.id=this._getNodeId("container"),a.setMode(this.mode),this.axisContainer=a,t.add(a),o&&o.visible&&this.renderLine(a),s&&s.length&&(this.data=this._transformItems(s[0]),r&&r.visible&&this.renderTicks(a),i&&i.visible)){const l=ct.group({x:0,y:0,pickable:!1});l.name=ji.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,a.add(l),s.forEach((h,u)=>{const d=this.renderLabels(l,h,u),c=d.getChildren();this.beforeLabelsOverlap(c,h,d,u,s.length),this.handleLabelsOverlap(c,h,d,u,s.length),this.afterLabelsOverlap(c,h,d,u,s.length);let g=0,f=0,p="center",v="middle";c.forEach(m=>{var C;const b=m.attribute,_=(C=b.angle)!==null&&C!==void 0?C:0,y=m.AABBBounds;let w=y.width(),S=y.height();_&&(w=Math.abs(w*Math.cos(_)),S=Math.abs(S*Math.sin(_))),g=Math.max(g,w),f=Math.max(f,S),p=b.textAlign,v=b.textBaseline}),this.axisLabelLayerSize[u]={width:g,height:f,textAlign:p,textBaseline:v}})}e&&e.visible&&this.renderTitle(a)}renderTicks(t){const e=this.getTickLineItems(),i=ct.group({x:0,y:0,pickable:!1});i.name=ji.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((o,s)=>{var a;const l=ct.line(Object.assign({},this._getTickLineAttribute("tick",o,s,e)));if(l.name=ji.tick,l.id=this._getNodeId(o.id),Bt((a=this.attribute.tick)===null||a===void 0?void 0:a.state))l.states=Vo;else{const h=this.data[s],u=gt({},Vo,this.attribute.tick.state);Object.keys(u).forEach(d=>{ge(u[d])&&(u[d]=u[d](h.rawValue,s,h,this.data))}),l.states=u}i.add(l)}),this.tickLineItems=e;const{subTick:r}=this.attribute;if(r&&r.visible){const o=this.getSubTickLineItems();o.length&&o.forEach((s,a)=>{const l=ct.line(Object.assign({},this._getTickLineAttribute("subTick",s,a,e)));if(l.name=ji.subTick,l.id=this._getNodeId(`${a}`),Bt(r.state))l.states=Vo;else{const h=gt({},Vo,r.state);Object.keys(h).forEach(u=>{ge(h[u])&&(h[u]=h[u](s.value,a,s,e))}),l.states=h}i.add(l)}),this.subTickLineItems=o}}renderLabels(t,e,i){const{dataFilter:r}=this.attribute.label;r&&ge(r)&&(e=r(e,i));const o=this._transformItems(e),s=ct.group({x:0,y:0,pickable:!1});return s.name=`${ji.labelContainer}-layer-${i}`,s.id=this._getNodeId(`label-container-layer-${i}`),t.add(s),o.forEach((a,l)=>{var h;const u=this._getLabelAttribute(a,l,o,i);let d;if(d=au(u)?ct.richtext(lu(u)):ct.text(u),d.name=ji.label,d.id=this._getNodeId(`layer${i}-label-${a.id}`),Bt((h=this.attribute.label)===null||h===void 0?void 0:h.state))d.states=Vo;else{const c=gt({},Vo,this.attribute.label.state);Object.keys(c).forEach(g=>{ge(c[g])&&(c[g]=c[g](a,l,o,i))}),d.states=c}s.add(d)}),s}renderTitle(t){const e=this.getTitleAttribute(),i=new pa(Object.assign({},e));i.name=ji.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){const r=this.getVerticalVector(e,i,t);return{x:t.x+r[0],y:t.y+r[1]}}getTextAlign(t){let e="center";return jo(t[0],0)?jo(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:r,inside:o=!1,length:s,dataFilter:a}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(a&&ge(a)?a(e):e).forEach(h=>{let u=h.point,d=h.value;if(!r){const g=h.value-l/2;if(this.isInValidValue(g))return;u=this.getTickCoord(g),d=g}const c=this.getVerticalCoord(u,s,o);if(this.mode==="3d"){const g=this.getVerticalVector(s,o,u);let f=0,p=0;kt(g[0])>kt(g[1])?f=Kt/2*(c.x>u.x?1:-1):p=Kt/2*(c.y>u.y?-1:1),i.push({start:u,end:c,value:d,id:`tick-${h.id}`,anchor:[u.x,u.y],alpha:f,beta:p})}else i.push({start:u,end:c,value:d,id:`tick-${h.id}`})}),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:r=!1,length:o=2}=t,s=this.tickLineItems,a=s.length;if(a>=2)for(let l=0;l<a-1;l++){const h=s[l],u=s[l+1];for(let d=0;d<i;d++){const c=(d+1)/(i+1),g=(1-c)*h.value+c*u.value,f=this.getTickCoord(g),p=this.getVerticalCoord(f,o,r);e.push({start:f,end:p,value:g,id:`sub-tick-${g}`})}}return e}_getTickLineAttribute(t,e,i,r){let o=qe(this.attribute,`${t}.style`);const s=this.data[i];o=ge(o)?gt({},qe(Jg,`${t}.style`),t==="tick"?o(s.rawValue,i,s,this.data):o(e.value,i,e,r)):o;const{start:a,end:l,anchor:h,alpha:u,beta:d}=e;return Object.assign({points:[a,l],anchor:h,alpha:u,beta:d},o)}_getLabelAttribute(t,e,i,r){var o,s;const{space:a=4,inside:l=!1,formatMethod:h,type:u="text",text:d}=this.attribute.label;let c=a,g=0;!((o=this.attribute.tick)===null||o===void 0)&&o.visible&&this.attribute.tick.inside===l&&(g=this.attribute.tick.length||4),!((s=this.attribute.subTick)===null||s===void 0)&&s.visible&&this.attribute.subTick.inside===l&&(g=Math.max(g,this.attribute.subTick.length||2)),c+=g;const f=this.getRelativeVector(t.point);r>0&&(f[1]===0?c+=(this.axisLabelLayerSize[r-1].height+qe(this.attribute,"label.space",4))*r:c+=(this.axisLabelLayerSize[r-1].width+qe(this.attribute,"label.space",4))*r);const p=this.getVerticalCoord(t.point,c,l),v=this.getVerticalVector(c||1,l,p),m=h?h(`${t.label}`,t,e,i,r):t.label;let{style:C}=this.attribute.label;C=ge(C)?gt({},Jg.label.style,C(t,e,i,r)):C;const b=this.getLabelAlign(v,l,C.angle);return C=gt(b,C),ge(C.text)&&(C.text=C.text({label:t.label,value:t.rawValue,index:t.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,v,m,C)),{text:d!=null?d:m,lineHeight:C==null?void 0:C.fontSize,type:u}),C)}getLabelPosition(t,e,i,r){return t}_transformItems(t){const e=[];return t.forEach(i=>{var r;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(r=i.id)!==null&&r!==void 0?r:i.label}))}),e}}function SE(n,t,e,i,r){return{x:(n-i)*Math.cos(e)+(t-r)*Math.sin(e)+i,y:(n-i)*Math.sin(e)+(r-t)*Math.cos(e)+r}}function AE(n){const t=n.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:n.attribute.x,centerY:n.attribute.y,angle:n.attribute.angle}}function kb(n){n.forEach(t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=AE(t),i=SE(e.centerX,e.centerY,e.angle,t.attribute.x,t.attribute.y),r=i.x-e.centerX,o=i.y-e.centerY;e.x1+=r,e.x2+=r,e.y1+=o,e.y2+=o,e.centerX+=r,e.centerY+=o,t.rotatedBounds=e})}function xE(n,t){return _c(n.AABBBounds,t.AABBBounds,!1)&&(!n.rotatedBounds||!t.rotatedBounds||sA(n.rotatedBounds,t.rotatedBounds,!0))}function q6(n,t){return isRectIntersect(n.AABBBounds,t.AABBBounds,!1)&&(!n.rotatedBounds||!t.rotatedBounds||isRotateAABBIntersect(n.rotatedBounds,t.rotatedBounds,!0))}const Ib={parity:function(n){return n.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(n,t){let e;return n.filter((i,r)=>r&&tf(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function tf(n,t,e){const i=n.AABBBounds,r=t.AABBBounds;return e>Math.max(r.x1-i.x2,i.x1-r.x2,r.y1-i.y2,i.y1-r.y2)&&(!n.rotatedBounds||!t.rotatedBounds||e>Math.max(t.rotatedBounds.x1-n.rotatedBounds.x2,n.rotatedBounds.x1-t.rotatedBounds.x2,t.rotatedBounds.y1-n.rotatedBounds.y2,n.rotatedBounds.y1-t.rotatedBounds.y2))}function Ob(n,t){for(let e,i=1,r=n.length,o=n[0];i<r;o=e,++i)if(tf(o,e=n[i],t))return!0}function BE(n){const t=n.AABBBounds;return t.width()>1&&t.height()>1}function FE(n){return n.forEach(t=>t.setAttribute("opacity",1)),n}function TE(n,t){if(Bt(n))return;const e=n.filter(BE);if(Bt(e))return;let i;i=FE(e),kb(i);const{method:r="parity",separation:o=0}=t,s=ge(r)?r:Ib[r]||Ib.parity;if(i.length>=3&&Ob(i,o)){do i=s(i,o);while(i.length>=3&&Ob(i,o));if(i.length<3||t.lastVisible){const a=Yl(e);if(!a.attribute.opacity){const l=i.length;if(l>1){a.setAttribute("opacity",1);for(let h=l-1;h>=0&&tf(i[h],a,o);h--)i[h].setAttribute("opacity",0)}}}}e.forEach(a=>{a.setAttribute("visible",!!a.attribute.opacity)})}function ME(n,t){if(Bt(n))return;const{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||n.some(s=>!!s.attribute.angle))return;let r=0,o=0;for(i&&i.length>0&&(o=i.length);r<o;){const s=i[r++];if(n.forEach(a=>{a.attribute.angle=ao(s)}),EE(e,n),!RE(n))break}}function RE(n){for(let t=1;t<n.length;t++)if(xE(n[t-1],n[t]))return!0;return!1}function EE(n,t){n!=="bottom"&&n!=="top"||HE(n,t),n!=="left"&&n!=="right"||PE(n,t),kb(t)}function hu(n=0){if(n<0)for(;n<0;)n+=2*Math.PI;if(n>0)for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function PE(n,t){t.forEach((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Wb(n,e.attribute.angle)),{angle:hu(e.attribute.angle)}))})}function HE(n,t){t.forEach(e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},zb(n,e.attribute.angle)),{angle:hu(e.attribute.angle)}))})}function zb(n,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];n==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const r=(t=hu(t))/(.5*Math.PI);let o;return o=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[o],textBaseline:i[o]}}function Wb(n,t=0){let e=["right","right","center","left","center","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];n==="right"&&(e=["left","right","right","right","left","left","left","left","right"],i=["middle","bottom","middle","top","top","top","middle","bottom","bottom"]);const r=(t=hu(t))/(.5*Math.PI);let o;return o=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[o],textBaseline:i[o]}}function LE(n,t){const{limitLength:e,verticalLimitLength:i,ellipsis:r="...",orient:o}=t;!Bt(n)&&we(e)&&n.forEach(s=>{var a;const l=s.attribute.angle,h=!ut(l)&&l!==0;if((o==="top"||o==="bottom")&&(h&&Math.floor(s.AABBBounds.height())<=e||!h&&Math.floor(s.AABBBounds.width())<=i))return;const u=s.attribute.direction;if((o==="left"||o==="right")&&(u==="vertical"&&Math.floor(s.AABBBounds.height())<=i||u!=="vertical"&&Math.floor(s.AABBBounds.width())<=e))return;let d=null;d=h?Math.abs(e/Math.sin(l)):o==="top"||o==="bottom"||u==="vertical"?i:e,we(s.attribute.maxLineWidth)&&(d=we(d)?Math.min(s.attribute.maxLineWidth,d):s.attribute.maxLineWidth),s.setAttributes({maxLineWidth:d,ellipsis:(a=s.attribute.ellipsis)!==null&&a!==void 0?a:r})})}function kE(n,t,e,i,r){if(i==="right"||i==="left"){if(r==="left"){const o=i==="right"?0:-1;n.forEach(s=>{s.setAttributes({x:t+e*o,textAlign:"left"})})}else if(r==="right"){const o=i==="right"?1:0;n.forEach(s=>{s.setAttributes({x:t+e*o,textAlign:"right"})})}else if(r==="center"){const o=i==="right"?1:-1;n.forEach(s=>{s.setAttributes({x:t+.5*e*o,textAlign:"center"})})}}else if(i==="bottom"||i==="top"){if(r==="top"){const o=i==="bottom"?0:-1;n.forEach(s=>{s.setAttributes({y:t+e*o,textBaseline:"top"})})}else if(r==="bottom"){const o=i==="bottom"?1:0;n.forEach(s=>{s.setAttributes({y:t+e*o,textBaseline:"bottom"})})}else if(r==="middle"){const o=i==="bottom"?1:-1;n.forEach(s=>{s.setAttributes({y:t+.5*e*o,textBaseline:"middle"})})}}}class IE{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:r=1}=this.attribute,o=this.getRelativeVector(),s=mE(o),a=[s[1],-1*s[0]];return vE(a,t*(e?1:-1)*r)}}function Nb(){Dn(),ag(),Ih(),oa()}function OE(){Nb(),Yr()}function Z6(){Nb(),registerCircle()}function J6(){registerGroup(),registerPath()}function Q6(){registerGroup(),registerPath()}var jb=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};OE();class va extends DE{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},va.defaultAttributes,t),e)}_renderInner(t){var e;super._renderInner(t);const{panel:i}=this.attribute;if(i&&i.visible){const r=this.axisContainer,o=r.AABBBounds,s=ct.rect(Object.assign({x:o.x1,y:o.y1,width:o.width(),height:o.height()},i.style));s.name=ji.background,s.id=this._getNodeId("background"),s.states=gt({},Uo,(e=i.state)!==null&&e!==void 0?e:{}),r.insertBefore(s,r.firstChild)}}renderLine(t){const{start:e,end:i,line:r}=this.attribute,o=r,{startSymbol:s,endSymbol:a,style:l,breakRange:h,breakShape:u,breakShapeStyle:d,state:c}=o,g=jb(o,["startSymbol","endSymbol","style","breakRange","breakShape","breakShapeStyle","state"]),f=Object.assign({points:[e,i],startSymbol:s,endSymbol:a,lineStyle:l},g);Bt(c)||(f.state={line:gt({},Uo,c),symbol:gt({},Uo,c)});const p=new su(f);p.name=ji.line,p.id=this._getNodeId("line"),t.add(p)}getTitleAttribute(){var t,e,i;const r=this.attribute.title,{position:o="middle",space:s=4,textStyle:a={},autoRotate:l=!0,shape:h,background:u,state:d={}}=r,c=jb(r,["position","space","textStyle","autoRotate","shape","background","state"]);let g=.5;o==="start"?g=0:o==="end"&&(g=1);const{verticalFactor:f=1}=this.attribute,p=-1*f,v=this.getTickCoord(g),m=this.getRelativeVector();let C=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const B=+qe(this.attribute,"label.space",4);C+=B;const F=Object.keys(this.axisLabelLayerSize).length;if(m[1]===0){const T=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(T)?C+=T+(F-1)*B:C=0}else{if(m[0]===0){const P=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.width():0;isFinite(P)?C+=P+(F-1)*B:C=0}else Object.keys(this.axisLabelLayerSize).forEach((P,I)=>{C+=this.axisLabelLayerSize[P].width+(I>0?B:0)});const T=this.axisLabelLayerSize[0].textAlign,R=T==="start"||T==="left",M=T==="center",E=m[1]>0;C=p===1?E?R?C:M?C/2:B:R?B:M?C/2:C:E?R?B:M?C/2:C:R?C:M?C/2:B}}let b=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(b=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(b=Math.max(b,this.attribute.subTick.length||2));const _=b+C+s,y=this.getVerticalCoord(v,_,!1),w=this.getVerticalVector(_,!1,{x:0,y:0});let S,D,{angle:A}=c;if(S=o==="start"?"start":o==="end"?"end":"center",ut(A)&&l){A=_E(m,[1,0],!0);const{verticalFactor:B=1}=this.attribute;D=-1*B===1?"bottom":"top"}else S=this.getTextAlign(w),D=this.getTextBaseline(w,!1);const x=Object.assign(Object.assign(Object.assign({},y),c),{textStyle:Object.assign({textAlign:S,textBaseline:D},a),state:{text:gt({},Uo,d.text),shape:gt({},Uo,d.shape),panel:gt({},Uo,d.background)}});return x.angle=A,h&&h.visible&&(x.shape=Object.assign({visible:!0},h.style),h.space&&(x.space=h.space)),u&&u.visible&&(x.panel=Object.assign({visible:!0},u.style)),x}getTextBaseline(t,e){let i="middle";const{verticalFactor:r=1}=this.attribute,o=(e?1:-1)*r;return jo(t[1],0)?i=!jo(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":o===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const r=this.attribute.orient;if(we(i)||t[0]===0&&t[1]===0){if(r==="top"||r==="bottom")return zb(r,i);if(r==="left"||r==="right")return Wb(r,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,r,o){var s,a,l,h;const{flush:u=!1}=this.attribute.label||{};if(u&&t.length){const{orient:d,start:c,end:g}=this.attribute,f=d==="bottom"||d==="top",p=t[0],v=Yl(t),m=f?p.attribute.x>v.attribute.x:p.attribute.y<v.attribute.y;if(f){const C=m?v:p,b=m?p:v,_=c.x,y=g.x,w=C.AABBBounds.x1,S=b.AABBBounds.x2;w<_&&(C.attribute.angle?C.setAttributes({dx:((s=C.attribute.dx)!==null&&s!==void 0?s:0)+_-w}):C.setAttributes({x:_,textAlign:"left"})),S>y&&(b.attribute.angle?b.setAttributes({dx:((a=b.attribute.dx)!==null&&a!==void 0?a:0)+y-S}):b.setAttributes({x:y,textAlign:"right"}))}else{const C=m?v:p,b=m?p:v,_=C.AABBBounds.y2,y=b.AABBBounds.y1,w=c.y,S=g.y;y<w&&(b.attribute.angle?b.setAttributes({dy:((l=b.attribute.dy)!==null&&l!==void 0?l:0)+w-y}):b.setAttributes({y:w,textBaseline:"top"})),_>S&&(C.attribute.angle?C.setAttributes({dy:((h=C.attribute.dy)!==null&&h!==void 0?h:0)+S-_}):C.setAttributes({y:S,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,r,o){if(Bt(t))return;const{verticalLimitSize:s,label:a,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(s,o),{layoutFunc:u,autoRotate:d,autoRotateAngle:c,autoLimit:g,limitEllipsis:f,autoHide:p,autoHideMethod:v,autoHideSeparation:m,lastVisible:C}=a;if(ge(u))u(t,e,r,this);else{if(d&&ME(t,{labelRotateAngle:c,orient:l}),g&&we(h)&&h>0){const b=l==="left"||l==="right"?Math.abs(this.attribute.start.y-this.attribute.end.y)/t.length:p||d?1/0:Math.abs(this.attribute.start.x-this.attribute.end.x)/t.length;LE(t,{limitLength:h,verticalLimitLength:b,ellipsis:f,orient:l})}p&&TE(t,{orient:l,method:v,separation:m,lastVisible:C})}}afterLabelsOverlap(t,e,i,r,o){const{verticalLimitSize:s,orient:a}=this.attribute,l=a==="bottom"||a==="top",h=i.AABBBounds;let u=l?h.height():h.width();const{verticalMinSize:d}=this.attribute;if(we(d)&&(!we(s)||d<=s)){const c=this._getAxisLabelLimitLength(d,o);let g,f;u=Math.max(u,c),a==="left"?(g=h.x2-u,f=h.y1):a==="right"?(g=h.x1,f=h.y1):a==="top"?(g=h.x1,f=h.y2-u):a==="bottom"&&(g=h.x1,f=h.y1);const p=ct.rect({x:g,y:f,width:l?h.width():u,height:l?u:h.height(),pickable:!1});p.name=ji.axisLabelBackground,p.id=this._getNodeId("axis-label-background"),i.insertBefore(p,i.firstChild)}if(N(this.attribute.label.containerAlign)){let c;a==="left"?c=h.x2:a==="right"?c=h.x1:a==="top"?c=h.y2:a==="bottom"&&(c=h.y1),kE(t,c,u,a,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,r,o,s;const{label:a,title:l,line:h,tick:u}=this.attribute,d=(i=a.space)!==null&&i!==void 0?i:4;let c=t,g=0,f=0;const p=h&&h.visible?(r=h.style.lineWidth)!==null&&r!==void 0?r:1:0,v=u&&u.visible?(o=u.length)!==null&&o!==void 0?o:4:0;if(l&&l.visible&&typeof l.text=="string"){g=Zg(l.text,l.textStyle,(s=this.stage)===null||s===void 0?void 0:s.getTheme().text.fontFamily).height;const m=Wn(l.padding);f=l.space+m[0]+m[2]}return c&&(c=(c-d-f-g-p-v)/e),c}}va.defaultAttributes=Jg,fE(va,IE);function ef(n,t){if(!n||!No(n))return n;const e={};return Object.keys(n).forEach(i=>{const r=n[i];let o=!1;t.forEach(s=>{(ue(s)&&s===i||s instanceof RegExp&&i.match(s))&&(o=!0)}),o||(e[i]=r)}),e}function Vb(n){var t,e;const i=Object.assign({},n);return Bt(n.style)||(i.textStyle=Pe(n.style)),Bt(n.textStyle)||gt(i.textStyle,Pe(n.textStyle)),!((t=n.shape)===null||t===void 0)&&t.style&&Pe(i.shape.style),!((e=n.background)===null||e===void 0)&&e.style&&Pe(i.background.style),i}function Pe(n){return Bt(n)||n.angle&&(n.angle=ao(n.angle)),n}function Fn(n={}){return Bt(n.style)||(n.style=Pe(n.style)),Bt(n.state)||Object.keys(n.state).forEach(t=>{Bt(n.state[t])||(n.state[t]=Pe(n.state[t]))}),n}function Jr(n){return Bt(n)?null:(Object.keys(n).forEach(t=>{Bt(n[t])||(n[t]=Pe(n[t]))}),n)}function zE(n){return Fn(n),Fn(n.startSymbol),Fn(n.endSymbol),n}const WE={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},Qr="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",Ko=14,ma={FONT_FAMILY:Qr,LABEL_FONT_SIZE:14,MAP_LABEL_FONT_SIZE:10,TITLE_FONT_SIZE:18,AXIS_TICK_SIZE:4},uu={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:ma.AXIS_TICK_SIZE,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:ma.AXIS_TICK_SIZE/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:ma.LABEL_FONT_SIZE,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:ma.LABEL_FONT_SIZE,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function NE(n){var t,e;return!((e=(t=n==null?void 0:n.colorScheme)===null||t===void 0?void 0:t.default)===null||e===void 0)&&e.palette?gt({},uu,{tick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:n.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:n.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):uu}function Gb(n){var t,e,i,r,o,s,a,l,h,u,d,c,g;const f=gt({},n);let p,v=(e=(t=f.title)===null||t===void 0?void 0:t.angle)!==null&&e!==void 0?e:0;f.orient!=="left"&&f.orient!=="right"||!((i=f.title)===null||i===void 0)&&i.autoRotate&&ut(f.title.angle)&&(v=f.orient==="left"?-90:90,p=WE[f.orient]);const m=ef(f.label,["style","formatMethod","state"]);return{orient:f.orient,select:f.select,hover:f.hover,line:zE(f.domainLine),label:Object.assign({style:Pe(f.label.style),formatMethod:f.label.formatMethod?(C,b,_)=>f.label.formatMethod(b.rawValue,b):null,state:Jr(f.label.state)},m),tick:{visible:f.tick.visible,length:f.tick.tickSize,inside:f.tick.inside,alignWithLabel:f.tick.alignWithLabel,style:Pe(f.tick.style),state:Jr(f.tick.state),dataFilter:f.tick.dataFilter},subTick:{visible:f.subTick.visible,length:f.subTick.tickSize,inside:f.subTick.inside,count:f.subTick.tickCount,style:Pe(f.subTick.style),state:Jr(f.subTick.state)},grid:{type:"line",visible:f.grid.visible,alternateColor:f.grid.alternateColor,alignWithLabel:f.grid.alignWithLabel,style:Pe(f.grid.style)},subGrid:{type:"line",visible:f.subGrid.visible,alternateColor:f.subGrid.alternateColor,style:Pe(f.subGrid.style)},title:{visible:f.title.visible,position:f.title.position,space:f.title.space,autoRotate:!1,angle:v?ao(v):null,textStyle:gt({},p,Pe(f.title.style)),padding:f.title.padding,shape:{visible:(r=f.title.shape)===null||r===void 0?void 0:r.visible,space:(o=f.title.shape)===null||o===void 0?void 0:o.space,style:Pe((s=f.title.shape)===null||s===void 0?void 0:s.style)},background:{visible:(a=f.title.background)===null||a===void 0?void 0:a.visible,style:Pe((l=f.title.background)===null||l===void 0?void 0:l.style)},state:{text:Jr(f.title.state),shape:Jr((h=f.title.shape)===null||h===void 0?void 0:h.state),background:Jr((u=f.title.background)===null||u===void 0?void 0:u.state)}},panel:{visible:(d=f.background)===null||d===void 0?void 0:d.visible,style:Pe((c=f.background)===null||c===void 0?void 0:c.style),state:Jr((g=f.background)===null||g===void 0?void 0:g.state)}}}function nf(n){return n==="bottom"||n==="top"}function jE(n){return n==="left"||n==="right"}function Ca(n){return Number(n)}var oe;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(oe||(oe={}));const Ub={};Object.values(oe).forEach(n=>{Ub[n]=!0});function t8(n){switch(n){case oe.Linear:case oe.Log:case oe.Pow:case oe.Sqrt:case oe.Symlog:case oe.Time:return!0;default:return!1}}function e8(n){return!!Ub[n]}function i8(n){switch(n){case oe.Ordinal:case oe.Point:case oe.Band:return!0;default:return!1}}function n8(n){switch(n){case oe.Quantile:case oe.Quantize:case oe.Threshold:return!0;default:return!1}}function r8(n){switch(n){case oe.Linear:case oe.Log:case oe.Pow:case oe.Sqrt:case oe.Symlog:case oe.Time:case oe.Band:case oe.Point:return!0;default:return!1}}function VE(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function GE(n,t,e=0,i){for(ut(i)&&(i=n.length);e<i;){const r=e+i>>>1;VE(n[r],t)>0?i=r:e=r+1}return e}function Yo(n){return n}const o8=n=>t=>t<0?-Math.pow(-t,n):Math.pow(t,n),s8=n=>n<0?-Math.sqrt(-n):Math.sqrt(n),a8=n=>n<0?-n*n:n*n,l8=n=>Math.log(n),h8=n=>Math.exp(n),UE=n=>-Math.log(-n),KE=n=>-Math.exp(-n),YE=n=>isFinite(n)?Math.pow(10,n):n<0?0:n,Kb=n=>n===10?YE:n===Math.E?Math.exp:t=>Math.pow(n,t),Yb=n=>n===Math.E?Math.log:n===10?Math.log10:n===2?Math.log2:(n=Math.log(n),t=>Math.log(t)/n),$b=n=>t=>Math.sign(t)*Math.log1p(Math.abs(t/n)),Xb=n=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*n;function rf(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function qb(n,t,e){const i=n[0],r=n[1],o=t[0],s=t[1];let a,l;return r<i?(a=rf(r,i),l=e(s,o)):(a=rf(i,r),l=e(o,s)),h=>l(a(h))}function of(n,t,e){let i;return i=n===1?n+2*e:n-t+2*e,n?i>0?i:1:0}function $E(n,t,e,i){return e===1&&(e=0),of(n,e,i)*(t/(1-e))}function XE(n,t,e,i,r){const o=of(n,e,i);let s=t/Math.max(1,o||1);r&&(s=Math.floor(s));let a=s*(1-e);return r&&(a=Math.round(a)),a}function Zb(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function qE(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),o=new Array(i);let s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=rf(n[s],n[s+1]),o[s]=e(t[s],t[s+1]);return function(a){const l=GE(n,a,1,i)-1;return o[l](r[l](a))}}const Jb=(n,t)=>{const e=n.slice();let i=0,r=e.length-1,o=e[i],s=e[r];return s<o&&([i,r]=[r,i],[o,s]=[s,o]),e[i]=t.floor(o),e[r]=t.ceil(s),e},sf=(n,t=!1)=>{const e=Math.floor(Math.log10(n)),i=n/Math.pow(10,e);let r;return r=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,r*Math.pow(10,e)},ZE=(n,t)=>{let e,i;return t[0]<t[1]?(e=t[0],i=t[1]):(e=t[1],i=t[0]),Math.min(Math.max(n,e),i)};class Qb{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:N(this._rangeFactorStart)&&N(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=Zb(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(r=>r>=0&&r<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):N(this._rangeFactorStart)&&N(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return ut(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!ut(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return ut(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!ut(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),s=o[0],a=o[o.length-1],l=Math.min(s,a),h=Math.max(s,a),u=Xn((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),d=ut(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*d;const g=e/d;this._fishEyeTransform=f=>{const p=Math.abs(f-u);if(p>=d)return f;if(p<=1e-6)return u;const v=c*(1-Math.exp(-p*g))/p*.75+.25;return u+(f-u)*v}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}}const af=Symbol("implicit");class lf extends Qb{specified(t){var e;return t?(this._specified=Object.assign((e=this._specified)!==null&&e!==void 0?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=oe.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=af}clone(){const t=new lf().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return N(this._rangeFactorStart)&&N(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==af)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const o=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(o):o}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const i=`${e}`;this._index.has(i)||this._index.set(i,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&(e=this._index.get(`${t}`))!==null&&e!==void 0?e:-1}}function hf(n,t){let e;return n>t&&(e=n,n=t,t=e),i=>Math.max(n,Math.min(t,i))}function t_(n,t,e,i){let r;const o=[];let s;if(t=Math.floor(+t),n=Math.floor(+n),!(e=Math.floor(+e)))return[];if(n===t)return[n];if(r=t<n){const h=n;n=t,t=h}let a=hf(1,t-n+1)(e);if(s=Math.floor((t-n+1)/a),!i)for(;Math.ceil((t-n+1)/s)>e&&a>1;)a-=1,s=Math.floor((t-n)/a);let l=n;for(;l<=t;)o.push(l),l+=s;return r&&o.reverse(),o}function JE(n,t,e){const i=[];let r;if(t=Math.floor(+t),n=Math.floor(+n),e=hf(1,t-n+1)(Math.floor(+e)),r=t<n){const s=n;n=t,t=s}let o=n;for(;o<=t;)i.push(o),o+=e;return r&&i.reverse(),i}class du extends lf{constructor(t){super(),this.type=oe.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),r=super.domain().length,o=i[1]<i[0];let s=i[Number(o)-0];const a=i[1-Number(o)],l=of(r,this._paddingInner,this._paddingOuter);return this._step=(a-s)/Math.max(1,l||1),this._round&&(this._step=Math.floor(this._step)),s+=(a-s-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(s=Math.round(s),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:o,start:o?s+this._step*(r-1):s,count:r},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==af)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const{count:o,start:s,reverse:a}=this._bandRangeState,l=s+(a?-1:1)*((r-1)%o)*this._step;return this._fishEyeTransform?this._fishEyeTransform(l):l}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(N(this._rangeFactorStart)&&N(this._rangeFactorEnd)&&t.length===2){const o=Zb(t,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(o[1]-o[0])}else i=Math.abs(t[1]-t[0]);const r=XE(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);r<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):r>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=r,this._isFixed=!1)}if(this.isBandwidthFixed()){const i=$E(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(t[1]-t[0]),r=Math.min((t[1]-t[0])/i,1);if(N(this._rangeFactorStart)&&N(this._rangeFactorEnd)){if(i>0){const a=t[0]-i*this._rangeFactorStart,l=a+i;this._wholeRange=[a,l]}else{const a=t[1]+i*(1-this._rangeFactorEnd),l=a-i;this._wholeRange=[l,a]}const o=this._rangeFactorStart+r<=1,s=this._rangeFactorEnd-r>=0;e==="rangeFactorStart"&&o?this._rangeFactorEnd=this._rangeFactorStart+r:e==="rangeFactorEnd"&&s?this._rangeFactorStart=this._rangeFactorEnd-r:t[0]<=t[1]?o?this._rangeFactorEnd=this._rangeFactorStart+r:s?this._rangeFactorStart=this._rangeFactorEnd-r:(this._rangeFactorStart=0,this._rangeFactorEnd=r):s?this._rangeFactorStart=this._rangeFactorEnd-r:o?this._rangeFactorEnd=this._rangeFactorStart+r:(this._rangeFactorStart=1-r,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=r,this._wholeRange=[t[0],t[0]+i];return this._wholeRange}return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(N(this._rangeFactorStart)&&N(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),r=this._getInvertIndex(t[1]);return e.slice(Math.min(i,r),Math.max(i,r)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[Ca(t[0]),Ca(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[Ca(t[0]),Ca(t[1])],this._round=!0,this.rescale(e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return t===-1?e:t_(0,e.length-1,t,!1).map(i=>e[i])}tickData(t=10){return this.ticks(t).map((e,i)=>({index:i,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return t_(0,e.length-1,t,!0).filter(i=>i<e.length).map(i=>e[i])}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return JE(0,e.length-1,t).map(i=>e[i])}_getInvertIndex(t){let e=0;const i=this.step()/2,r=this.bandwidth()/2,o=this._domain.length,s=this.range(),a=s[0]>s[s.length-1];for(e=0;e<o;e++){const l=this.scale(this._domain[e])+r;if(e===0&&(!a&&!Rb(t,l+i)||a&&!Eb(t,l-i))||e===o-1||!Eb(t,l-i)&&!Rb(t,l+i))break}return e>=0&&e<=o-1?e:o-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return t!==void 0?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return t!==void 0?(this._round=t,this.rescale(e)):this._round}align(t,e){return t!==void 0?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return ut(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return ut(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?(t==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&lt(this._userBandwidth)}clone(){var t,e,i;return new du(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((t=this._userBandwidth)!==null&&t!==void 0?t:"auto",!0).maxBandwidth((e=this._maxBandwidth)!==null&&e!==void 0?e:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}}class QE{constructor(){this._scale=new du,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{const r=Math.min(t.length,this._scales.length);for(let o=0;o<r;o++)e+=this._scales[o].scale(t[o]);i=this._scales[r-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,r;const{bandPadding:o,paddingInner:s,paddingOuter:a}=this,l=rt(o),h=rt(s),u=rt(a);for(let d=0;d<this._scales.length;d++){const c=l?o[d]:o,g=h?s[d]:s,f=u?a[d]:a;this._scales[d].paddingInner((i=g!=null?g:c)!==null&&i!==void 0?i:t,!0).paddingOuter((r=f!=null?f:c)!==null&&r!==void 0?r:e)}}dataToPosition(t,e={}){var i;if(t.length===0||this._scales.length===0)return 0;const{position:r,bandScale:o}=this.getPosition(t);return r+o.bandwidth()*((i=e.bandPosition)!==null&&i!==void 0?i:.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function tP(n,t,e){n.getTransform(t)||n.registerTransform(t,e)}function eP(n,t,e){n.getParser(t)||n.registerParser(t,e)}let uf=0;const iP=1e8;function e_(n="dataset"){return uf>iP&&(uf=0),n+"_"+uf++}const nP=(n,t)=>{var e,i;if(!(t!=null&&t.fields)||n.length===0)return n;const r=t.fields,o=n[0],s={},a=[];for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)){const h=r[l];if(!h.type){let d=o;l in o||(d=(e=n.find(c=>l in c))!==null&&e!==void 0?e:o),h.type=typeof d[l]=="number"?"linear":"ordinal"}let u;if(typeof h.sortIndex=="number"&&(u={key:l,type:h.type,index:h.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:h.sortReverse===!0},a.push(u)),((i=h.domain)===null||i===void 0?void 0:i.length)>0)if(h.type==="ordinal"){h._domainCache={},s[l]=h;const d={};h.domain.forEach((c,g)=>{d[c]=g,h._domainCache[c]=g}),u&&(u.sortIndex=d,u.sortIndexCount=h.domain.length)}else h.domain.length>=2&&(s[l]=h)}return Object.keys(s).length>0&&(n=n.filter(l=>{for(const h in s){const u=s[h];if(u.type==="ordinal"){if(!(l[h]in u._domainCache))return!1}else if(u.domain[0]>l[h]||u.domain[1]<l[h])return!1}return!0})),a.sort((l,h)=>l.index-h.index),n.sort((l,h)=>rP(l,h,a)),n};function rP(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];let o=0;if(r.type==="ordinal"?(r.sortIndex[t[r.key]]===void 0&&(r.sortIndex[t[r.key]]=r.sortIndexCount++),r.sortIndex[n[r.key]]===void 0&&(r.sortIndex[n[r.key]]=r.sortIndexCount++),o=r.sortIndex[n[r.key]]-r.sortIndex[t[r.key]]):r.type==="linear"&&(o=n[r.key]-t[r.key]),r.sortReverse&&(o=-o),o!==0)return o}return 0}const df="_data-view-diff-rank";class cf{constructor(t,e){let i;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new(Ds()),this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(r={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach(o=>{this.executeTransform(o,{pushHistory:r.pushHistory,emitMessage:!1}),this.isLastTransform(o)&&this.diffLastData()}),this.isRunning=!1,r.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=e!=null&&e.name?e.name:e_("dataview"),this.name=i,e!=null&&e.history&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(e==null?void 0:e.fields)}parse(t,e,i=!1){var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const o=this.cloneParseData(t,e);if(e!=null&&e.type){const s=((r=this.dataSet.getParser(e.type))!==null&&r!==void 0?r:this.dataSet.getParser("bytejson"))(o,e.options,this);this.rawData=o,this.parserData=s,this.history&&this.historyData.push(o,s),this.latestData=s}else this.parserData=o,this.rawData=o,this.history&&this.historyData.push(o),this.latestData=o;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t,e=!0){if(this.isRunning=!0,t&&t.type){let i=!0;if(t.type==="fields"){this._fields=t.options.fields;const r=this.transformsArr.findIndex(o=>o.type===t.type);r>=0&&(i=!1,this.transformsArr[r].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const r=this.isLastTransform(t);this.executeTransform(t),r&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((t,e)=>{var i,r;return((i=t.level)!==null&&i!==void 0?i:0)-((r=e.level)!==null&&r!==void 0?r:0)})}executeTransform(t,e={pushHistory:!0,emitMessage:!0}){const{pushHistory:i,emitMessage:r}=e,o=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&i!==!1&&this.historyData.push(o),this.latestData=o,r!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData||!this.latestData.forEach||!(!((t=this._diffKeys)===null||t===void 0)&&t.length))return;const e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(i=>{i[df]=e,this._diffMap.set(this._diffKeys.reduce((r,o)=>r+i[o],""),i)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(r=>{r[df]=e,i=this._diffKeys.reduce((o,s)=>o+r[s],""),this._diffMap.get(i)?this.latestDataAUD.update.push(r):this.latestDataAUD.add.push(r),this._diffMap.set(i,r)}),this._diffMap.forEach((r,o)=>{r[df]<e&&(this.latestDataAUD.del.push(r),this._diffMap.delete(o))})}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof cf||(e==null?void 0:e.clone)!==!0||(i=!0),i?Ot(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:((t=this.parseOption)===null||t===void 0?void 0:t.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t,e=!1){this._fields=t&&e?gt({},this._fields,t):t;const i=this.transformsArr.find(r=>r.type==="fields");!ut(this._fields)&&ut(i)?(this.dataSet.registerTransform("fields",nP),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}var Se;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(Se||(Se={}));const i_={};Object.values(Se).forEach(n=>{i_[n]=!0});function n_(n){switch(n){case Se.Linear:case Se.Log:case Se.Pow:case Se.Sqrt:case Se.Symlog:case Se.Time:return!0;default:return!1}}function u8(n){return!!i_[n]}function oP(n){switch(n){case Se.Ordinal:case Se.Point:case Se.Band:return!0;default:return!1}}function d8(n){switch(n){case Se.Quantile:case Se.Quantize:case Se.Threshold:return!0;default:return!1}}function c8(n){switch(n){case Se.Linear:case Se.Log:case Se.Pow:case Se.Sqrt:case Se.Symlog:case Se.Time:case Se.Band:case Se.Point:return!0;default:return!1}}var Ze=n=>n!=null,cu=n=>typeof n=="function",sP=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)};function aP(n){return isValid(n)?isArray(n)?n:[n]:[]}function gu(n){if(sP(n))return n[n.length-1]}const v8=n=>n.length<=1?0:gu(n)-n[0],r_=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=t==null?void 0:t(o,i))!==null&&e!==void 0?e:o-i>0)&&(i=o)}return i},o_=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=t==null?void 0:t(o,i))!==null&&e!==void 0?e:o-i<0)&&(i=o)}return i};function m8(n,t){if(!isArray(n)||!isArray(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function C8(n){return n&&isArray(n)?Array.from(new Set(aP(n))):n}function b8(n,t=Math.random){let e,i,r=n.length;for(;r;)e=Math.floor(t()*r),i=n[--r],n[r]=n[e],n[e]=i;return n}function lP(n){if(!isArray(n))return[n];const t=[];for(const e of n)t.push(...lP(e));return t}const s_=5;var a_=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,l_=n=>Array.isArray?Array.isArray(n):a_(n,"Array");function hP(n,t,e){const{x1:i,y1:r,x2:o,y2:s}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*o+e.c*r+e.e,e.b*o+e.d*r+e.f),n.add(e.a*o+e.c*s+e.e,e.b*o+e.d*s+e.f),n.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),t)}function w8(n,t,e,i,r,o,s){if(!(abs(i)<=epsilon||abs(r)<=epsilon)){if(i!==1&&n.scaleX(i),r!==1&&n.scaleY(r),isFinite(o)&&Math.abs(o)>epsilon){let a=0,l=0;s!==void 0&&(a=s[0],l=s[1]),n.rotate(o,a,l)}n.translate(t,e)}}class gf{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new gf(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return l_(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return hP(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:s,y2:a}=this,l=Math.cos(t),h=Math.sin(t),u=e-e*l+i*h,d=i-e*h-i*l;return[l*r-h*o+u,h*r+l*o+d,l*r-h*a+u,h*r+l*a+d,l*s-h*o+u,h*s+l*o+d,l*s-h*a+u,h*s+l*a+d]}scalePoints(t,e,i,r){const{x1:o,y1:s,x2:a,y2:l}=this;return[t*o+(1-t)*i,e*s+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}}class fu extends gf{}class D8 extends null{}function uP(n){return n*(Math.PI/180)}function S8(n){return 180*n/Math.PI}const A8=(n=0)=>{if(n<0)for(;n<-tau;)n+=tau;else if(n>0)for(;n>tau;)n-=tau;return n},x8=null,B8=(n=0)=>n>360||n<-360?n%360:n,F8=null;function dP(n,t,e){return{x:n.x+t*Math.cos(e),y:n.y+t*Math.sin(e)}}function T8(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}var Vi=n=>n==null,cP=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||a_(n,"String")};function E8(n,t=!0){if(typeof n!="string"||n.length===0||(n=gP(n)).length===0)return 0;n=n.replace(pP(),"  ");const e=t?1:2;let i=0;for(const r of n){const o=r.codePointAt(0);if(!(o<=31||o>=127&&o<=159)&&!(o>=768&&o<=879))switch(ff(r)){case"F":case"W":i+=2;break;case"A":i+=e;break;default:i+=1}}return i}const gP=n=>{if(typeof n!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof n}\``);return n.replace(fP(),"")},fP=({onlyFirst:n=!1}={})=>{const t=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"].join("|");return new RegExp(t,n?void 0:"g")},ff=n=>{let t=n.charCodeAt(0),e=n.length===2?n.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"},pP=()=>/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC08\uDC26](?:\u200D\u2B1B)?|[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC2\uDECE-\uDEDB\uDEE0-\uDEE8]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g;function vP(n,t={}){const{fontStyle:e=t.fontStyle,fontVariant:i=t.fontVariant,fontWeight:r=t.fontWeight,fontSize:o=t.fontSize,fontFamily:s=t.fontFamily}=n;return(e?e+" ":"")+(i?i+" ":"")+(r?r+" ":"")+o+"px "+(s||"sans-serif")}class Gi{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e!=null?e:{},this.textSpec=this._initSpec(),Ze(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=Ze(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(Vi(this._canvas)&&(Ze(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),Vi(this._canvas)&&typeof window!="undefined"&&window.document!==void 0&&globalThis&&Ze(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),Vi(this._context)&&Ze(this._canvas)){const t=this._canvas.getContext("2d");Ze(t)&&(t.save(),t.font=vP(this.textSpec),this._contextSaved=!0,this._context=t)}return!Vi(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:s=r.fontVariant,fontWeight:a=(t=r.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=r.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=r.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:u,textAlign:d=u!=null?u:"center",baseline:c,textBaseline:g=c!=null?c:"middle",ellipsis:f,limit:p}=this._userSpec;let{lineHeight:v=l}=this._userSpec;if(cP(v)&&v[v.length-1]==="%"){const m=Number.parseFloat(v.substring(0,v.length-1))/100;v=l*m}return{fontStyle:o,fontVariant:s,fontFamily:h,fontSize:l,fontWeight:a,textAlign:d,textBaseline:g,ellipsis:f,limit:p,lineHeight:v}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(Vi(t))return{width:0,height:0};if(Vi(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:a,limit:l,lineHeight:h}=this.textSpec;let u;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});u={width:d.width(),height:d.height()}}catch(d){this._notSupportVRender=!0,u=this.measureWithNaiveCanvas(t)}return u}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:(e=o)!==null&&e!==void 0?e:r}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);Vi(o)&&Gi.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),Vi(o)&&["F","W"].includes(ff(r))&&(o=this._measureFullSizeChar()),Vi(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let s=0;s<t.length;s++){const a=t[s],l=["F","W"].includes(ff(a))?1:.53;i.width+=l*r}return i.height=(e=o)!==null&&e!==void 0?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,s={width:0,height:0};if(Vi(t))return s;if(l_(t)){const a=t.filter(Ze).map(l=>l.toString());return a.length===0?s:a.length===1?e(a[0]):{width:a.reduce((l,h)=>Math.max(l,e(h).width),0),height:a.length*(((i=o)!==null&&i!==void 0?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(Vi(this._numberCharSize)){const t=this._standardMethod(Gi.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Gi.NUMBERS_CHAR_SET.length,height:t.height}}return this._numberCharSize}_measureFullSizeChar(){return Vi(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Gi.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(Vi(this._letterCharSize)){const t=this._standardMethod(Gi.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Gi.ALPHABET_CHAR_SET.length,height:t.height}}return this._letterCharSize}_measureSpecialChar(t){return Ze(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){Ze(this._canvas)&&(this._canvas=null),Ze(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}Gi.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Gi.NUMBERS_CHAR_SET="0123456789",Gi.FULL_SIZE_CHAR="\u5B57";class mP{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}}const CP=new mP;let pu,vu;function bP(n){return pu||(pu=CP.CreateGraphic("text",{})),pu.initAttributes(n),pu.AABBBounds}function P8(n){return vu||(vu=graphicCreator.CreateGraphic("richtext",{})),vu.setAttributes(n),vu.AABBBounds}const h_=(n,t,e,i)=>new Gi(Object.assign({defaultFontParams:Object.assign({fontFamily:"PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:14},i),getTextBounds:e?void 0:bP,specialCharSet:`-/: .,@%'"~`+Gi.ALPHABET_CHAR_SET+Gi.ALPHABET_CHAR_SET.toUpperCase()},t!=null?t:{}),n);function _P(n){for(;n<0;)n+=2*Math.PI;for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function yP(n){let t="center",e="middle";return t=(n=_P(n))>=Math.PI*(5/3)||n<=Math.PI*(1/3)?"left":n>=Math.PI*(2/3)&&n<=Math.PI*(4/3)?"right":"center",e=n>=Math.PI*(7/6)&&n<=Math.PI*(11/6)?"bottom":n>=Math.PI*(1/6)&&n<=Math.PI*(5/6)?"top":"middle",{align:t,baseline:e}}const or=n=>n.map((t,e)=>({index:e,value:t})),u_=(n,t,e=0)=>{const i=new fu(n).expand(e/2),r=new fu(t).expand(e/2);return i.intersects(r)},H8=(n,t)=>{let e=0;n.x2<t.x1?e=t.x1-n.x2:t.x2<n.x1&&(e=n.x1-t.x2);let i=0;return n.y2<t.y1?i=t.y1-n.y2:t.y2<n.y1&&(i=n.y1-t.y2),[e,i]};function d_(n,t,e){return e>Math.max(t.x1-n.x2,n.x1-t.x2,t.y1-n.y2,n.y1-t.y2)}function wP(n,t){for(let e,i=1,r=n.length,o=n[0];i<r;o=e,++i)if(e=n[i],d_(o.AABBBounds,e.AABBBounds,t))return!0;return!1}const L8=12,c_=(n,t,e)=>{var i;const{labelStyle:r,axisOrientType:o,labelFlush:s,labelFormatter:a,startAngle:l=0}=e;let h=(i=r.angle)!==null&&i!==void 0?i:0;r.direction==="vertical"&&(h+=uP(90));const u=["bottom","top"].includes(o),d=["left","right"].includes(o);let c=1,g=0;u||(d?(c=0,g=1):l&&(c=Math.cos(l),g=-Math.sin(l)));const f=h_(r);return t.map((v,m)=>{var C,b;const _=a?a(v):`${v}`,{width:y,height:w}=f.quickMeasure(_),S=Math.max(y,12),D=Math.max(w,12),A=n.scale(v),x=c*A,B=g*A;let F,T,R=x,M=B;F=s&&u&&m===0?"left":s&&u&&m===t.length-1?"right":(C=r.textAlign)!==null&&C!==void 0?C:"center",F==="right"?R-=S:F==="center"&&(R-=S/2),T=s&&d&&m===0?"top":s&&d&&m===t.length-1?"bottom":(b=r.textBaseline)!==null&&b!==void 0?b:"middle",T==="bottom"?M-=D:T==="middle"&&(M-=D/2);const E=new fu().set(R,M,R+S,M+D);return h&&E.rotate(h,x,B),E})},DP=(n,t,e)=>{var i;const{labelStyle:r,getRadius:o,labelOffset:s,labelFormatter:a}=e,l=o==null?void 0:o(),h=(i=r.angle)!==null&&i!==void 0?i:0,u=h_(r);return t.map(d=>{const c=a?a(d):`${d}`,{width:g,height:f}=u.quickMeasure(c),p=Math.max(g,12),v=Math.max(f,12),m=n.scale(d);let C=0,b=0;const _=yP(m),{x:y,y:w}=dP({x:0,y:0},l+s,m);return C=y+(_.align==="right"?-p:_.align==="center"?-p/2:0),b=w+(_.baseline==="bottom"?-v:_.baseline==="middle"?-v/2:0),new fu().set(C,b,C+p,b+v).rotate(h,C+p/2,b+v/2)})},SP=n=>["bottom","top","z"].includes(n),AP=(n,t)=>{if(!n_(n.type))return or(n.domain());const e=n.range(),i=Math.abs(e[e.length-1]-e[0]);if(i<2)return or([n.domain()[0]]);const{tickCount:r,forceTickCount:o,tickStep:s,noDecimals:a=!1,labelStyle:l}=t;let h;if(Ze(s))h=n.stepTicks(s);else if(Ze(o))h=n.forceTicks(o);else if(t.tickMode==="d3"){const u=cu(r)?r({axisLength:i,labelStyle:l}):r;h=n.d3Ticks(u!=null?u:s_,{noDecimals:a})}else{const u=cu(r)?r({axisLength:i,labelStyle:l}):r;h=n.ticks(u!=null?u:s_,{noDecimals:a})}if(t.sampling&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:u=4,labelFlush:d}=t;let c=c_(n,h,t).map((f,p)=>({AABBBounds:f,value:h[p]}));for(;c.length>=3&&wP(c,u);)c=xP.parity(c);const g=c.map(f=>f.value);g.length<3&&d&&(g.length>1&&g.pop(),gu(g)!==gu(h)&&g.push(gu(h))),h=g}return or(h)},xP={parity:function(n){return n.filter((t,e)=>e%2==0)},greedy:function(n,t){let e;return n.filter((i,r)=>(!r||!d_(e.AABBBounds,i.AABBBounds,t))&&(e=i,!0))}},k8=(n,t)=>g_(0,n.length,e=>t(n[e])),g_=(n,t,e)=>{let i=n,r=t;for(;i<r;){const o=Math.floor((i+r)/2);e(o)>=0?r=o:i=o+1}return i},f_=(n,t,e,i)=>c_(n,t,e).map(r=>i?[r.x1,r.x2,r.width()]:[r.y1,r.y2,r.height()]),p_=(n,t,e=0)=>Math.max(n[0],t[0])-e/2<=Math.min(n[1],t[1])+e/2,v_=(n,t)=>n[1]<t[0]?t[0]-n[1]:t[1]<n[0]?n[0]-t[1]:0,BP=(n,t)=>{var e;const i=n.domain();if(!i.length)return[];const{tickCount:r,forceTickCount:o,tickStep:s,labelGap:a=4,axisOrientType:l,labelStyle:h}=t,u=SP(l),d=n.range(),c=n.calculateWholeRangeSize();if(c<2)return t.labelLastVisible?or([i[i.length-1]]):or([i[0]]);let g;if(Ze(s))g=n.stepTicks(s);else if(Ze(o))g=n.forceTicks(o);else if(Ze(r)){const f=cu(r)?r({axisLength:c,labelStyle:h}):r;g=n.ticks(f)}else if(t.sampling){const f=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,p=o_(d),v=r_(d);if(i.length<=c/f){const m=(v-p)/i.length,C=f_(n,i,t,u),b=Math.min(...C.map(y=>y[2])),_=FP(i,C,a,t.labelLastVisible,Math.floor(b/m),!1);g=n.stepTicks(_.step),t.labelLastVisible&&(_.delCount&&(g=g.slice(0,g.length-_.delCount)),g.push(i[i.length-1]))}else{const m=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],C=f_(n,m,t,u);let b=null;C.forEach(y=>{b?b[2]<y[2]&&(b=y):b=y});const _=v-p-a>0?Math.ceil(i.length*(a+b[2])/(v-p-a)):i.length-1;g=n.stepTicks(_),!t.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(n.scale(g[g.length-1])-n.scale(i[i.length-1]))<b[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}else g=n.domain();return or(g)},FP=(n,t,e,i,r,o)=>{let s=0,a=0,l=-1,h=Number.MAX_VALUE;const u=g=>{let f=!0,p=0;do p+g<n.length&&p_(t[p],t[p+g],e)&&(f=!1),p+=g;while(f&&p<n.length);return f},d=g_(r,n.length,g=>u(g)?1:-1);let c=d;do if(c>d&&!o&&!u(c))c++;else{if(!i){a=c;break}{const g=n.length-1;let f,p=0;f=n.length%c>0?n.length-n.length%c+c:n.length;do{if(f-=c,f!==g&&!p_(t[f],t[g],e))break;p++}while(f>0);if(f===g){a=c,s=p;break}{const v=Math.floor(n.length/c)-p+1;if(v<l)break;{l=v;const m=v_(t[f],t[g]),C=f-c>=0?v_(t[f-c],t[f]):m,b=Math.abs(m-C);if(b<h&&(h=b,a=c,s=p),m<=C)break}}}c++}while(c<=n.length);return{step:a,delCount:s}},TP=(n,t)=>{const{tickCount:e,forceTickCount:i,tickStep:r,getRadius:o,labelOffset:s,labelGap:a=0,labelStyle:l}=t,h=o==null?void 0:o();if(!h)return or(n.domain());let u;if(Ze(r))u=n.stepTicks(r);else if(Ze(i))u=n.forceTicks(i);else if(Ze(e)){const d=n.range(),c=Math.abs(d[d.length-1]-d[0]),g=cu(e)?e({axisLength:c,labelStyle:l}):e;u=n.ticks(g)}else if(t.sampling){const d=n.domain(),c=n.range(),g=DP(n,d,t),f=o_(c),p=r_(c),v=Math.abs(p-f)*(h+s)/d.length,{step:m,delCount:C}=MP(d,g,a,Math.floor(g.reduce((b,_)=>Math.min(b,_.width(),_.height()),Number.MAX_VALUE)/v));u=n.stepTicks(m),u=u.slice(0,u.length-C)}else u=n.domain();return or(u)},MP=(n,t,e,i)=>{let r=i;do{let s=!0;r++;let a=0;do a+r<n.length&&u_(t[a],t[a+r],e)&&(s=!1),a+=r;while(s&&a<n.length);if(s)break}while(r<=n.length);let o=0;if(n.length>2){let s=n.length-n.length%r;for(s>=n.length&&(s-=r);s>0&&u_(t[0],t[s]);)o++,s-=r}return{step:r,delCount:o}},RP=(n,t)=>{if(n_(n.type))return AP(n,t);if(oP(n.type)){if(t.coordinateType==="cartesian")return BP(n,t);if(t.coordinateType==="polar"&&t.axisOrientType==="angle")return TP(n,t)}return or(n.domain())};function EP(n,t,e){N(t)||(t=n,n=0),N(e)||(e=1);let i=-1;const r=0|Math.max(0,Math.ceil((t-n)/e)),o=new Array(r);for(;++i<r;)o[i]=n+i*e;return o}const $o=n=>{let t=null,e=null;return(...i)=>(t&&i.every((r,o)=>r===t[o])||(t=i,e=n(...i)),e)},PP=Math.sqrt(50),HP=Math.sqrt(10),LP=Math.sqrt(2),mu=[1,2,5,10],m_=(n,t,e)=>{let i=1,r=n;const o=Math.floor((t-1)/2),s=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&s<1?i=C_(s).step:(e||s>1)&&(r=Math.floor(n)-o*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),EP(0,t).map(a=>r+a*i)):n>0?Cu(0,-(t-1)/i,i):Cu((t-1)/i,0,i)},kP=$o((n,t,e,i)=>{let r,o,s,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(o=n,n=t,t=o),a=pf(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),u=Math.round(t/a);for(h*a<n&&++h,u*a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)*a}else if(a<0&&(i!=null&&i.noDecimals)){a=1;const h=Math.ceil(n),u=Math.floor(t);if(!(h<=u))return[];for(s=new Array(o=u-h+1);++l<o;)s[l]=h+l}else{a=-a;let h=Math.round(n*a),u=Math.round(t*a);for(h/a<n&&++h,u/a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)/a}return r&&s.reverse(),s}),Cu=(n,t,e)=>{let i,r,o=-1;if(e>0){let s=Math.floor(n/e),a=Math.ceil(t/e);for((s+1)*e<n&&++s,(a-1)*e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)*e}else{e=-e;let s=Math.floor(n*e),a=Math.ceil(t*e);for((s+1)/e<n&&++s,(a-1)/e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)/e}return r},IP=(n,t,e)=>{let i;const r=n[0],o=n[n.length-1],s=t-n.length;if(o<=0){const h=[];for(i=s;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=s;i++)n.push(o+i*e);return n}let a=[];const l=[];for(i=1;i<=s;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(o+Math.ceil(i/2)*e);return a.concat(n).concat(l)},bu=$o((n,t,e,i)=>{let r,o,s;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return m_(n,e,i==null?void 0:i.noDecimals);(r=t<n)&&(s=n,n=t,t=s);const a=pf(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:u,gap:d}=a,c=d===10?2*qi(10,u):1*qi(10,u);for(;h<=5&&(o=Cu(n,t,l),o.length>e+1)&&e>2;)l+=c,h+=1;e>2&&o.length<e-1&&(o=IP(o,e,l))}else i!=null&&i.noDecimals&&l<0&&(l=1),o=Cu(n,t,l);return r&&o.reverse(),o}),C_=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/qi(10,t);let i=mu[0];return e>=PP?i=mu[3]:e>=HP?i=mu[2]:e>=LP&&(i=mu[1]),t>=0?{step:i*qi(10,t),gap:i,power:t}:{step:-qi(10,-t)/i,gap:i,power:t}};function pf(n,t,e){const i=(t-n)/Math.max(0,e);return C_(i)}function b_(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=OP(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let o=0;o<e;o++)r[o]=n+o*i;return r}function OP(n,t,e){return(t-n)/Math.max(1,e-1)}function __(n,t,e){let i,r,o=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const s=Math.floor((t-n)/e+1),a=new Array(s);for(;++o<s;)a[o]=n+o*e;return r&&a.reverse(),a}function vf(n,t=10){let e,i,r=0,o=n.length-1,s=n[r],a=n[o],l=10;for(a<s&&(i=s,s=a,a=i,i=r,r=o,o=i);l-- >0;){if(i=pf(s,a,t).step,i===e)return n[r]=s,n[o]=a,n;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function mf(n,t){const e=lt(t.forceMin),i=lt(t.forceMax);let r=null;const o=[];let s=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?o[0]=t.forceMin:lt(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(o[0]=t.min),i?o[1]=t.forceMax:lt(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(o[1]=t.max),lt(o[0])&&lt(o[1])?(s=n.slice(),s[0]=o[0],s[s.length-1]=o[1]):r=lt(o[0])||lt(o[1])?lt(o[0])?"max":"min":"all",{niceType:r,niceDomain:s,niceMinMax:o,domainValidator:a}}const Cf=(n,t,e)=>Math.abs(t-n)<1?+e.toFixed(1):Math.round(+e),y_=$o((n,t,e,i,r,o,s)=>{let a=n,l=t;const h=l<a;h&&([a,l]=[l,a]);let u,d,c=r(a),g=r(l),f=[];if(!(i%1)&&g-c<e){if(c=Math.floor(c),g=Math.ceil(g),a>0){for(;c<=g;++c)for(u=1;u<i;++u)if(d=c<0?u/o(-c):u*o(c),!(d<a)){if(d>l)break;f.push(d)}}else for(;c<=g;++c)for(u=i-1;u>=1;--u)if(d=c>0?u/o(-c):u*o(c),!(d<a)){if(d>l)break;f.push(d)}2*f.length<e&&(f=bu(a,l,e))}else f=bu(c,g,Math.min(g-c,e)).map(o);return f=f.filter(p=>p!==0),s!=null&&s.noDecimals&&(f=Array.from(new Set(f.map(p=>Math.floor(p))))),h?f.reverse():f}),w_=$o((n,t,e,i,r,o)=>{const s=[],a={},l=r(n),h=r(t);let u=[];if(Number.isInteger(i))u=bu(l,h,e);else{const d=(h-l)/(e-1);for(let c=0;c<e;c++)u.push(l+c*d)}return u.forEach(d=>{const c=o(d),g=Number.isInteger(i)?Cf(n,t,c):Cf(n,t,sf(c)),f=Cf(n,t,ZE(g,[n,t]));!a[f]&&!isNaN(f)&&u.length>1&&(a[f]=1,s.push(f))}),s}),_u=$o((n,t,e,i,r)=>b_(i(n),i(t),e).map(o=>sf(r(o)))),I8=$o((n,t,e,i,r)=>__(i(n),i(t),e).map(o=>sf(r(o))));function zP(n,t){const e=n.r,i=t.r,r=n.g,o=t.g,s=n.b,a=t.b,l=n.opacity,h=t.opacity;return u=>{const d=Math.round(e*(1-u)+i*u),c=Math.round(r*(1-u)+o*u),g=Math.round(s*(1-u)+a*u);return new gi(d,c,g,l*(1-u)+h*u)}}function ba(n,t){return e=>n*(1-e)+t*e}function WP(n,t){return function(e){return Math.round(n*(1-e)+t*e)}}function NP(n,t){const e=n.valueOf(),i=t.valueOf(),r=new Date;return o=>(r.setTime(e*(1-o)+i*o),r)}const bf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_f=new RegExp(bf.source,"g");function jP(n){return function(){return n}}function VP(n){return function(t){return n(t)+""}}function O8(n,t){let e,i,r,o=bf.lastIndex=_f.lastIndex=0,s=-1;const a=[],l=[];for(n+="",t+="";(e=bf.exec(n))&&(i=_f.exec(t));)(r=i.index)>o&&(r=t.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(e=e[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:ba(e,i)})),o=_f.lastIndex;return o<t.length&&(r=t.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?VP(l[0].x):jP(t):(t=l.length,function(h){for(let u,d=0;d<t;++d)a[(u=l[d]).i]=u.x(h);return a.join("")})}const{interpolateRgb:yf}=_i;function GP(n,t){const e=typeof t;let i;if(ut(t)||e==="boolean")return()=>t;if(e==="number")return ba(n,t);if(e==="string"){if(i=rn.parseColorString(t)){const r=yf(rn.parseColorString(n),i);return o=>r(o).formatRgb()}return ba(Number(n),Number(t))}return t instanceof gi?yf(n,t):t instanceof rn?yf(n.color,t.color):t instanceof Date?NP(n,t):ba(Number(n),Number(t))}class D_ extends Qb{constructor(t=Yo,e=Yo){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Yo,this._piecewise=qb,this._interpolate=GP}calculateVisibleDomain(t){var e;return N(this._rangeFactorStart)&&N(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),ba)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,Ca);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=WP,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,o=this._range.length;let s=Math.min(r,o);if(r&&r<o&&this._forceAlign){const a=o-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let u=1;u<=a;u++)i[r-2+u]=l-h*(a-u);s=o}return this._autoClamp&&(this._clamp=hf(i[0],i[s-1])),this._piecewise=s>2?qE:qb,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Yo),this.rescale(i)):this._clamp!==Yo}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e!=null?e:[]).map((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return ut(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return ut(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}function S_(n){return t=>-n(-t)}function A_(n=Number.EPSILON){return t=>Math.max(t,n)}function UP(n=Number.EPSILON){return t=>Math.min(t,-n)}class yu extends D_{constructor(){super(Yb(10),Kb(10)),this.type=oe.Log,this._limit=A_(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new yu().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=Yb(this._base),r=Kb(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=S_(i),this._pows=S_(r),this._limit=UP(),this.transformer=UE,this.untransformer=KE):(this._logs=i,this._pows=r,this._limit=A_(),this.transformer=this._logs,this.untransformer=r),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return Yo}d3Ticks(t=10,e){const i=this.domain(),r=this._limit(i[0]),o=this._limit(i[i.length-1]);return y_(r,o,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return w_(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return _u(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return _u(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}nice(t=10,e){var i,r;const o=this._domain;let s=[],a=null;if(e){const l=mf(o,e);if(s=l.niceMinMax,this._domainValidator=l.domainValidator,a=l.niceType,l.niceDomain)return this._niceDomain=l.niceDomain,this.rescale(),this}else a="all";if(a){const l=Jb(o.slice(),{floor:h=>this._pows(Math.floor(this._logs(this._limit(h)))),ceil:h=>Math.abs(h)>=1?Math.ceil(h):this._pows(Math.ceil(this._logs(this._limit(h))))});return a==="min"?l[l.length-1]=(i=s[1])!==null&&i!==void 0?i:l[l.length-1]:a==="max"&&(l[0]=(r=s[0])!==null&&r!==void 0?r:l[0]),this._niceDomain=l,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}class Xo extends D_{constructor(){super(...arguments),this.type=oe.Linear}clone(){return new Xo().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return kP(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(N(this._rangeFactorStart)&&N(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,o=this._domain,s=r[0],a=r[r.length-1];let l=bu(o[0],o[o.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==s||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==s?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const u=Math.min(h[0],h[h.length-1]),d=Math.max(h[0],h[h.length-1]);l=l.filter(c=>c>=u&&c<=d)}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return b_(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return __(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const o=this._domain;let s=[];if(e){const a=mf(o,e);if(s=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=vf(o.slice(),t);this._niceType==="min"?a[a.length-1]=(i=s[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=s[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=vf(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=vf(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class wu extends Xo{constructor(){super($b(1),Xb(1)),this.type=oe.Symlog,this._const=1}clone(){return new wu().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=$b(t),this.untransformer=Xb(t),this.rescale(e)):this._const}d3Ticks(t=10,e){const i=this.domain(),r=i[0],o=i[i.length-1];return y_(r,o,t,this._const,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return w_(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return _u(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return _u(e[0],e[e.length-1],t,this.transformer,this.untransformer)}nice(t=10,e){var i,r;const o=this._domain;let s=[],a=null;if(e){const l=mf(o,e);if(s=l.niceMinMax,this._domainValidator=l.domainValidator,a=l.niceType,l.niceDomain)return this._niceDomain=l.niceDomain,this.rescale(),this}else a="all";if(a){const l=Jb(o.slice(),{floor:h=>Math.floor(h),ceil:h=>Math.ceil(h)});return a==="min"?l[l.length-1]=(i=s[1])!==null&&i!==void 0?i:l[l.length-1]:a==="max"&&(l[0]=(r=s[0])!==null&&r!==void 0?r:l[0]),this._niceDomain=l,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}const KP=Math.sqrt(50),YP=Math.sqrt(10),$P=Math.sqrt(2);class XP{constructor(t){this._extend={},this.type=t!=null?t:"linear",this._scale=t==="log"?new yu:t==="symlog"?new wu:new Xo,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,r,o,s){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=r,this.type==="log"?this._scale.base(o!=null?o:10):this.type==="symlog"&&this._scale.constant(s!=null?s:10)}transformScaleDomain(){this.type==="symlog"||this.type==="log"||this.setScaleNice()}setScaleNice(){this.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){var t,e,i,r,o,s;ut((t=this.domain)===null||t===void 0?void 0:t.min)&&ut((e=this.domain)===null||e===void 0?void 0:e.max)?this.nice&&this._scale.nice():N((i=this.domain)===null||i===void 0?void 0:i.min)&&ut((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.niceMax():ut((o=this.domain)===null||o===void 0?void 0:o.min)&&N((s=this.domain)===null||s===void 0?void 0:s.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){var t,e,i,r,o,s,a,l;let h=(e=(t=this.forceTickCount)!==null&&t!==void 0?t:this.tickCount)!==null&&e!==void 0?e:10;this.niceType==="accurateFirst"&&(h=Math.max(10,h)),ut((i=this.domain)===null||i===void 0?void 0:i.min)&&ut((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.nice(h):N((o=this.domain)===null||o===void 0?void 0:o.min)&&ut((s=this.domain)===null||s===void 0?void 0:s.max)?this.nice&&this._scale.niceMax(h):ut((a=this.domain)===null||a===void 0?void 0:a.min)&&N((l=this.domain)===null||l===void 0?void 0:l.max)?this.nice&&this._scale.niceMin(h):this.nice&&this._scale.nice(h)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach(i=>{const{min:r,max:o}=i;e[0]=e[0]===void 0?r:Math.min(e[0],r),e[1]=e[1]===void 0?o:Math.max(e[1],o)}),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];N(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),N(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if(N(t[0])||N(t[1])||this.type!=="linear")return t;if(Math.abs(yv(t)-_A(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let r=e/5;const o=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,o);r=(s>=KP?10:s>=YP?5:s>=$P?2:1)*Math.pow(10,o),t[0]=0,t[1]=10*r}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){var t,e,i,r,o,s,a,l;if(this.nice){let h=(e=(t=this.forceTickCount)!==null&&t!==void 0?t:this.tickCount)!==null&&e!==void 0?e:10;this.niceType==="accurateFirst"&&(h=Math.max(10,h)),ut((i=this.domain)===null||i===void 0?void 0:i.min)&&ut((r=this.domain)===null||r===void 0?void 0:r.max)?this._scale.nice(h):N((o=this.domain)===null||o===void 0?void 0:o.min)&&ut((s=this.domain)===null||s===void 0?void 0:s.max)?this._scale.niceMax(h):ut((a=this.domain)===null||a===void 0?void 0:a.min)&&N((l=this.domain)===null||l===void 0?void 0:l.max)?this._scale.niceMin(h):this._scale.nice(h)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,r=t[0]-t[i]>0,o=r?i:0,s=r?0:i;for(const a in this._extend)e=this._extend[a],e>t[s]&&(t[s]=e),e<t[o]&&(t[o]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;N(e)&&(t[0]=e),N(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=t!=null?t:this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function qP(n,t){const e=n.find(r=>r.name==="axis-label-container-layer-0",!0),i=n.find(r=>r.name==="axis-label-container-layer-1",!0);x_(e?e.getChildren():[],t),x_(i?i.getChildren():[],t)}function ZP(n,t){const{width:e,height:i}=t.getLayoutRect(),r=nf(t.orient),o=t.option.inverse===!0,s=n[0],a=Yl(n);if(r)if(o){const l=e,h=0,u=s.AABBBounds.x2,d=a.AABBBounds.x1;u>l&&s.setAttributes({x:l,textAlign:"right"}),d<h&&a.setAttributes({x:h,textAlign:"left"})}else{const h=e,u=s.AABBBounds.x1,d=a.AABBBounds.x2;u<0&&s.setAttributes({x:0,textAlign:"left"}),d>h&&a.setAttributes({x:h,textAlign:"right"})}else if(o){const l=s.AABBBounds.y1,h=a.AABBBounds.y2,u=0,d=i;l<u&&s.setAttributes({y:u,textBaseline:"top"}),h>d&&a.setAttributes({y:d,textBaseline:"bottom"})}else{const l=i,h=0,u=s.AABBBounds.y2,d=a.AABBBounds.y1;u>l&&s.setAttributes({y:l,textBaseline:"bottom"}),d<h&&a.setAttributes({y:h,textBaseline:"top"})}}function x_(n,t){var e;const i=t.option;Bt(n)||!((e=i==null?void 0:i.label)===null||e===void 0)&&e.flush&&ZP(n,t)}const z8=.1,W8=.3,JP=n=>n;class wf{constructor(t,e,i,r,o){var s,a,l;this.x=0,this.y=0,this.table=o,this.orient=(s=t.orient)!==null&&s!==void 0?s:"left",this.type=(a=t.type)!==null&&a!==void 0?a:"band",this.option=gt({},NE(t.__vtableChartTheme),QP(this.orient,o.theme),t3(this.orient,this.type,t.__vtableChartTheme),t),this.orient==="left"||this.orient==="right"?(this.width=e,this.height=i-r[2]-0,this.y=r[0]+0):(this.orient==="top"||this.orient==="bottom")&&(this.width=e-r[1]-0,this.height=i,this.x=r[3]+0),this.visible=(l=t.visible)===null||l===void 0||l,this.inverse="inverse"in t&&!!t.inverse,t.type==="band"&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;this.type==="band"||this.type==="point"?(this.scale=new QE,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):this.type!=="linear"&&this.type!=="time"&&this.type!=="log"&&this.type!=="symlog"||(this.scale=new XP(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){eP(this.table._vDataSet,"scale",JP),tP(this.table._vDataSet,"ticks",RP);const t=this.option.label||{},e=this.option.tick||{},i=new cf(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:this.option.sampling!==!1,tickCount:e.tickCount,forceTickCount:e.forceTickCount,tickStep:e.tickStep,tickMode:e.tickMode,noDecimals:e.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:t.style,labelFormatter:t.formatMethod,labelGap:t.minGap,labelLastVisible:t.lastVisible,labelFlush:t.flush}},!1);this.tickData=i,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=Gb(this.option),e=this.getUpdateAttribute();e.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component=new va(gt({},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:0,y:0})),this.component.originAxis=this}resize(t,e){this.width=t,this.height=e,this.updateScaleRange(),this.computeData();const i=Gb(this.option),r=this.getUpdateAttribute();r.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component.setAttributes(gt({},i,r)),this.component.setAttributes(this.setLayoutStartPosition({x:0,y:0})),this.overlap()}overlap(){qP(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){const t=this.table.tableNoFrameHeight,e=this.table.tableNoFrameWidth,{width:i,height:r}=this.getLayoutRect(),o=nf(this.orient),s=jE(this.orient);let a={x:0,y:0},l=0,h=0;o?(a={x:i,y:0},l=t,h=i):s&&(a={x:0,y:r},l=e,h=r);const u=this.orient==="top"||this.orient==="bottom"?r:i;return{start:{x:this.x,y:this.y},end:a,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(o)},items:this.getLabelItems(h),verticalLimitSize:u,verticalMinSize:u}}getLabelItems(t){return[this.tickData.latestData.map(e=>({id:e.value,label:e.value,value:t===0?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value})).filter(e=>e.value>=0&&e.value<=1)]}updateScaleRange(){var t,e,i,r,o,s,a,l;const h=(e=(t=this.option.innerOffset)===null||t===void 0?void 0:t.right)!==null&&e!==void 0?e:0,u=(r=(i=this.option.innerOffset)===null||i===void 0?void 0:i.left)!==null&&r!==void 0?r:0,d=(s=(o=this.option.innerOffset)===null||o===void 0?void 0:o.top)!==null&&s!==void 0?s:0,c=(l=(a=this.option.innerOffset)===null||a===void 0?void 0:a.bottom)!==null&&l!==void 0?l:0,{width:g,height:f}=this.getLayoutRect(),p=this.option.inverse||!1;let v=[0,0];nf(this.orient)?we(g)&&(v=p?[g-h,u]:[u,g-h]):we(f)&&(v=p?[d,f-c]:[f-c,d]),this.scale.updateRange(v)}setLayoutStartPosition(t){let{x:e,y:i}=t;return we(e)&&(e+=+(this.orient==="left")*this.getLayoutRect().width),we(i)&&(i+=+(this.orient==="top")*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){var e,i,r;if(this.option.title.visible&&ut((e=this.option.title.style)===null||e===void 0?void 0:e.maxLineWidth)){let o=((i=this.option.title.style)===null||i===void 0?void 0:i.angle)||0;if(!((r=this.option.title)===null||r===void 0)&&r.autoRotate&&ut(this.option.title.angle)&&(o=this.option.orient==="left"?-90:90),t){const l=this.getLayoutRect().width,h=Math.abs(Math.cos(ao(o)));return h<1e-6?1/0:l/h}const s=this.getLayoutRect().height,a=Math.abs(Math.sin(ao(o)));return a<1e-6?1/0:s/a}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function QP(n,t){let e;return n==="left"?e=t.axisStyle.leftAxisStyle:n==="right"?e=t.axisStyle.rightAxisStyle:n==="top"?e=t.axisStyle.topAxisStyle:n==="bottom"&&(e=t.axisStyle.bottomAxisStyle),gt({},t.axisStyle.defaultAxisStyle,e)}function t3(n,t,e){if(!e)return{};const i=e.axis;let r,o;return t==="linear"||t==="log"||t==="symlog"?r=e.axisLinear:t==="band"&&(r=e.axisBand),n==="top"||n==="bottom"?o=e.axisX:n!=="left"&&n!=="right"||(o=e.axisY),gt({},i,r,o)}function e3(n,t){const e=new Array(t);for(let i=0;i<t;i++)e[i]=n(i);return e}function B_(n,t,e,i,r,o){const s=e3(n,e);s.sort((a,l)=>i(o(a),o(l),r));for(let a=0;a<e;a++)t(a,s[a])}function i3(n,t,e,i,r,o){const s=o.columnHeaderLevelCount,a=[],l=[];for(let c=0;c<e.length;c++)i.includes(e[c])||l.push(r[c]);for(let c=0;c<i.length;c++)if(!e.includes(i[c])){const g={col:n,row:s+c};a.push(g)}let h=o.getParentCellId(n,t),u=o.getRowHeaderCellAddressByCellId(h);const d=[];for(u&&d.push(u);h;)h=o.getParentCellId(u.col,u.row),h&&(u=o.getRowHeaderCellAddressByCellId(h),d.push(u));return{addCellPositions:a,removeCellPositions:l,updateCellPositions:d}}function N8(n,t){const e=[],i=[];for(let r=0;r<n.length;r++){let o=!0;for(let s=0;s<t.length;s++)if(F_(n[r],t[s])){o=!1;break}o&&i.push(r)}for(let r=0;r<t.length;r++){let o=!0;for(let s=0;s<n.length;s++)if(F_(n[s],t[r])){o=!1;break}o&&e.push(r)}return{add:e,remove:i}}function F_(n,t){if(typeof n!=typeof t||typeof n=="number"&&typeof t=="number"&&n!==t||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function n3(n,t){const e=[],i=[],r=new Map;for(let o=0;o<n.length;o++){const s=n[o],a=JSON.stringify(s);r.has(a)?r.get(a).push(o):r.set(a,[o])}for(let o=0;o<t.length;o++){const s=t[o],a=JSON.stringify(s);if(r.has(a)){const l=r.get(a);l.shift(),l.length===0&&r.delete(a)}else e.push(o)}for(let o=0;o<n.length;o++){const s=n[o];t.some(a=>r3(a,s))||i.push(o)}return{add:e,remove:i}}function r3(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}class Br{constructor(t,e,i){this.className="Aggregator",this.isRecord=!0,this.records=[],this.field=t,this.formatFun=e,this.isRecord=i!=null?i:this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[]}}class T_ extends Br{constructor(){super(...arguments),this.type=Et.RECORD,this.isRecord=!0}push(t){this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t))}value(){return this.records}reset(){this.records=[]}recalculate(){}}class M_ extends Br{constructor(){super(...arguments),this.type=Et.NONE,this.isRecord=!0}push(t){this.isRecord&&(this.records=[t]),this.fieldValue=t[this.field]}value(){return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class o3 extends Br{constructor(t,e,i,r){super(t,e,i),this.type=Et.CUSTOM,this.isRecord=!0,this.values=[],this.aggregationFun=r}push(t){this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t)),this.values.push(t[this.field])}value(){var t;return this.fieldValue||(this.fieldValue=(t=this.aggregationFun)===null||t===void 0?void 0:t.call(this,this.values,this.records,this.field)),this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class R_ extends Br{constructor(t,e,i,r){super(t,e,i),this.type=Et.SUM,this.sum=0,this.positiveSum=0,this.nagetiveSum=0,this.needSplitPositiveAndNegativeForSum=!1,this.needSplitPositiveAndNegativeForSum=r!=null&&r}push(t){if(this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t)),t.className==="Aggregator"){const e=t.value();this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}}value(){return this.sum}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){this.records=[],this.sum=0}recalculate(){this.sum=0,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];if(e.className==="Aggregator"){const i=e.value();this.sum+=i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}else if(!isNaN(parseFloat(e[this.field]))){const i=parseFloat(e[this.field]);this.sum+=i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}}}}class E_ extends Br{constructor(){super(...arguments),this.type=Et.COUNT,this.count=0}push(t){this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t)),t.className==="Aggregator"?this.count+=t.value():this.count++}value(){return this.count}reset(){this.records=[],this.count=0}recalculate(){this.count=0,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];e.className==="Aggregator"?this.count+=e.value():this.count++}}}class P_ extends Br{constructor(){super(...arguments),this.type=Et.AVG,this.sum=0,this.count=0}push(t){this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t)),t.className==="Aggregator"&&t.type===Et.AVG?(this.sum+=t.sum,this.count+=t.count):isNaN(parseFloat(t[this.field]))||(this.sum+=parseFloat(t[this.field]),this.count++)}value(){return this.sum/this.count}reset(){this.records=[],this.sum=0,this.count=0}recalculate(){this.sum=0,this.count=0,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];e.className==="Aggregator"&&e.type===Et.AVG?(this.sum+=e.sum,this.count+=e.count):isNaN(parseFloat(e[this.field]))||(this.sum+=parseFloat(e[this.field]),this.count++)}}}class H_ extends Br{constructor(){super(...arguments),this.type=Et.MAX,this.max=Number.MIN_SAFE_INTEGER}push(t){this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t)),t.className==="Aggregator"?this.max=t.max>this.max?t.max:this.max:typeof t=="number"?this.max=t>this.max?t:this.max:typeof t[this.field]=="number"?this.max=t[this.field]>this.max?t[this.field]:this.max:isNaN(t[this.field])||(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)}value(){return this.max}reset(){this.records=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];e.className==="Aggregator"?this.max=e.max>this.max?e.max:this.max:typeof e=="number"?this.max=e>this.max?e:this.max:typeof e[this.field]=="number"?this.max=e[this.field]>this.max?e[this.field]:this.max:isNaN(e[this.field])||(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class L_ extends Br{constructor(){super(...arguments),this.type=Et.MIN,this.min=Number.MAX_SAFE_INTEGER}push(t){this.isRecord&&(t.className==="Aggregator"?this.records.push(...t.records):this.records.push(t)),t.className==="Aggregator"?this.min=t.min<this.min?t.min:this.min:typeof t=="number"?this.min=t<this.min?t:this.min:typeof t[this.field]=="number"&&(this.min=t[this.field]<this.min?t[this.field]:this.min)}value(){return this.min}reset(){this.records=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];e.className==="Aggregator"?this.min=e.min<this.min?e.min:this.min:typeof e=="number"?this.min=e<this.min?e:this.min:typeof e[this.field]=="number"&&(this.min=e[this.field]<this.min?e[this.field]:this.min)}}}function j8(n,t){return n&&t?n.toString().localeCompare(t.toString(),"zh"):n?1:-1}function s3(n,t){return n&&t?n.toString().localeCompare(t.toString(),"zh"):n?1:-1}function Fr(n,t){const e=/(\d+)|(\D+)/g,i=/\d/,r=/^0/;let o,s,a,l,h=0,u=0;if(t!==null&&n===null)return-1;if(n!==null&&t===null)return 1;if(typeof n=="number"&&isNaN(n))return-1;if(typeof t=="number"&&isNaN(t))return 1;if(h=+n,u=+t,h<u)return-1;if(h>u)return 1;if(typeof n=="number"&&typeof t!="number")return-1;if(typeof t=="number"&&typeof n!="number")return 1;if(typeof n=="number"&&typeof t=="number")return 0;if(isNaN(u)&&!isNaN(h))return-1;if(isNaN(h)&&!isNaN(u))return 1;if(o=String(n),a=String(t),o===a)return 0;if(!i.test(o)||!i.test(a))return o>a?1:-1;for(o=o.match(e),a=a.match(e);o.length&&a.length;)if(s=o.shift(),l=a.shift(),s!==l)return i.test(s)&&i.test(l)?s.replace(r,".0")-l.replace(r,".0"):s>l?1:-1;return o.length-a.length}function a3(n){let t;const e={},i={};for(let r=0;r<n.length;r++)t=n[r],e[t]=r,typeof t=="string"&&(i[t.toLowerCase()]=r);return function(r,o){return e[r]!==null&&e[r]!==void 0&&e[o]!==null&&e[o]!==void 0?e[r]-e[o]:e[r]!==null&&e[r]!==void 0?-1:e[o]!==null&&e[o]!==void 0?1:i[r]!==null&&e[r]!==void 0&&i[o]!==null&&e[o]!==void 0?i[r]-i[o]:i[r]===null||e[r]===void 0||i[o]===null||e[o]===void 0?0:i[r]!==null&&e[r]!==void 0?-1:i[o]!==null&&e[o]!==void 0?1:Fr(r,o)}}function l3(n){if(gb.isObject(n)){const t=n;if(N(t.get)&&N(t.set))return!0}return!1}const Du={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function to(n,t){const e=Xe(n);if(xr(e)){const i=e.then(r=>(t(r),r));return t(i),i}return e}function Su(n,t,e,i,r,o){if(n==null)return;if(xr(n))return n.then(l=>Su(l,t,e,i,r,o));const s=l3(t)?t.get:t;if(s in n)return to(n[s],o);if(typeof s=="function")return to(s(n,e,i,r),o);if(Array.isArray(s))return to(pR(n,[...s]),o);const a=`${s}`.split(".");return a.length<=1?to(n[s],o):to(cb(n,(l,h)=>Su(l,h,e,i,r,MR),...a),o)}function qo(n,t){if(!n)return t;const e=n[t];return N(e)?e:t}class eo extends Zh{static get EVENT_TYPE(){return Du}constructor(t,e,i,r,o){var s,a;super(),this.currentIndexedData=[],this.hierarchyExpandLevel=0,this.treeDataHierarchyState=new Map,this.beforeChangedRecordsMap=[],this.registedAggregators={},this.fieldAggregators=[],this.layoutColumnObjects=[],this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=(t==null?void 0:t.get.bind(t))||void 0,this.layoutColumnObjects=r,this._source=this.processRecords((s=t==null?void 0:t.source)!==null&&s!==void 0?s:t),this._sourceLength=((a=this._source)===null||a===void 0?void 0:a.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},o>=1&&(this.hierarchyExpandLevel=o),this.currentIndexedData=Array.from({length:this._sourceLength},(l,h)=>h),this.initTreeHierarchyState(),this.updatePagerData()}initTreeHierarchyState(){var t;if(this.hierarchyExpandLevel){this.treeDataHierarchyState=new Map;for(let e=0;e<this._sourceLength;e++)this.getOriginalRecord(e).children&&this.treeDataHierarchyState.set(e,Ft.collapse);if(this.currentIndexedData=Array.from({length:this._sourceLength},(e,i)=>i),this.hierarchyExpandLevel>1){let e=this._sourceLength;for(let i=0;i<e;i++){const r=this.currentIndexedData[i],o=this.getOriginalRecord(r);if(((t=o.children)===null||t===void 0?void 0:t.length)>0){this.treeDataHierarchyState.set(Array.isArray(r)?r.join(","):r,Ft.expand);const s=this.initChildrenNodeHierarchy(r,this.hierarchyExpandLevel,2,o);i+=s,e+=s}}}}}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(Et.RECORD,T_),this.registerAggregator(Et.SUM,R_),this.registerAggregator(Et.COUNT,E_),this.registerAggregator(Et.MAX,H_),this.registerAggregator(Et.MIN,L_),this.registerAggregator(Et.AVG,P_),this.registerAggregator(Et.NONE,M_),this.registerAggregator(Et.CUSTOM,o3)}_generateFieldAggragations(){const t=this.layoutColumnObjects;for(let e=0;e<(t==null?void 0:t.length);e++){t[e].aggregator=null;const i=t[e].field,r=t[e].aggregation;if(r)if(Array.isArray(r))for(let o=0;o<r.length;o++){const s=r[o],a=new this.registedAggregators[s.aggregationType](i,s.formatFun,!0,s.aggregationFun);this.fieldAggregators.push(a),t[e].aggregator||(t[e].aggregator=[]),t[e].aggregator.push(a)}else{const o=new this.registedAggregators[r.aggregationType](i,r.formatFun,!0,r.aggregationFun);this.fieldAggregators.push(o),t[e].aggregator=o}}}processRecords(t){var e,i;this._generateFieldAggragations();const r=[],o=this.fieldAggregators.length>=1,s=((i=(e=this.dataConfig)===null||e===void 0?void 0:e.filterRules)===null||i===void 0?void 0:i.length)>=1;if(s||o){for(let a=0,l=t.length;a<l;a++){const h=t[a];s?this.filterRecord(h)&&(r.push(h),o&&this.processRecord(h)):o&&this.processRecord(h)}if(s)return r}return t}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t)}initChildrenNodeHierarchy(t,e,i,r){var o,s,a;if(i>e)return 0;let l=0;const h=(s=(o=r.children)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0;for(let u=0;u<h;u++){l+=1;const d=r.children[u],c=Array.isArray(t)?t.concat(u):[t,u];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+l,0,c),((a=d.children)===null||a===void 0?void 0:a.length)>0&&(i<e?this.treeDataHierarchyState.set(Array.isArray(c)?c.join(","):c,Ft.expand):this.treeDataHierarchyState.set(Array.isArray(c)?c.join(","):c,Ft.collapse)),l+=this.initChildrenNodeHierarchy(c,e,i+1,d)}return l}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,r=e*(i||0),o=r+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let s=-1;for(let a=0;a<t.length;a++)if((Array.isArray(t[a])&&t[a].length===1||!Array.isArray(t[a]))&&s++,s>=r&&s<o)this._currentPagerIndexedData.push(t[a]);else if(s>=o)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}get source(){return this._source}get(t){return this.getOriginalRecord(qo(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(qo(this.currentPagerIndexedData,t))}getIndexKey(t){return qo(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?this.currentPagerIndexedData.findIndex(e=>Os(e,t)):this.currentPagerIndexedData.findIndex(e=>e===t)}getField(t,e,i,r,o){return this.getOriginalField(qo(this.currentPagerIndexedData,t),e,i,r,o)}getRawField(t,e,i,r,o){return this.getRawFieldData(qo(this.currentPagerIndexedData,t),e,i,r,o)}hasField(t,e){return this.hasOriginalField(qo(this.currentPagerIndexedData,t),e)}getHierarchyState(t){var e;const i=this.getIndexKey(t);return(e=this.treeDataHierarchyState.get(Array.isArray(i)?i.join(","):i))!==null&&e!==void 0?e:null}toggleHierarchyState(t){const e=this.currentIndexedData.slice(0),i=this.getIndexKey(t),r=this.getHierarchyState(t),o=this.getOriginalRecord(i);if(this.clearSortedIndexMap(),r===Ft.collapse)this.treeDataHierarchyState.set(Array.isArray(i)?i.join(","):i,Ft.expand),this.pushChildrenNode(i,Ft.expand,o);else if(r===Ft.expand){let s=0;const a=(l,h,u)=>{if(h&&h!==Ft.collapse&&h!==Ft.none&&u.children)for(let d=0;d<u.children.length;d++){s+=1;const c=Array.isArray(l)?l.concat([d]):[l,d];a(c,this.treeDataHierarchyState.get(c.join(",")),u.children[d])}};a(i,r,o),this.currentIndexedData.splice(this.currentIndexedData.indexOf(i)+1,s),this.treeDataHierarchyState.set(Array.isArray(i)?i.join(","):i,Ft.collapse)}return this.updatePagerData(),n3(e,this.currentIndexedData)}pushChildrenNode(t,e,i){if(!e||e===Ft.collapse||e===Ft.none)return 0;let r=0;if(i.children){const o=Array.from({length:i.children.length},(s,a)=>a);this.lastOrder&&this.lastOrder!=="normal"&&this.lastOrderField&&B_(s=>N(o[s])?o[s]:o[s]=s,(s,a)=>{o[s]=a},i.children.length,this.lastOrderFn,this.lastOrder,s=>this.getOriginalField(Array.isArray(t)?t.concat([s]):[t,s],this.lastOrderField));for(let s=0;s<o.length;s++){r+=1;const a=Array.isArray(t)?t.concat([o[s]]):[t,o[s]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+r,0,a);const l=this.treeDataHierarchyState.get(a.join(",")),h=this.getOriginalRecord(a);!l&&h.children&&this.treeDataHierarchyState.set(a.join(","),Ft.collapse),r+=this.pushChildrenNode(a,this.treeDataHierarchyState.get(a.join(",")),i.children[o[s]])}}return r}changeFieldValue(t,e,i,r,o,s){if(i!==null&&e>=0){const a=this.getIndexKey(e);if(!this.beforeChangedRecordsMap[a]){const l=this.getOriginalRecord(a);this.beforeChangedRecordsMap[a]=Ot(l)}if(typeof i=="string"||typeof i=="number"){const l=this.beforeChangedRecordsMap[a][i],h=this.getOriginalRecord(a);let u=t;typeof l=="number"&&Kg(t)&&(u=parseFloat(t)),xr(h)?h.then(d=>{d[i]=u}).catch(d=>{}):h[i]=u}}}setRecord(t,e){const i=this.getIndexKey(e);if(Array.isArray(i)){const r=i[i.length-1];this.getOriginalRecord(i.slice(0,i.length-1)).children.splice(r,1,t)}else this.source.splice(i,1,t)}addRecord(t,e){if(this.source.splice(e,0,t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:i,currentPage:r}=this.pagination;e<i*(r||0)+i&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData()}addRecords(t,e){if(Array.isArray(t)){this.source.splice(e,0,...t);for(let i=0;i<t.length;i++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:i,currentPage:r}=this.pagination;e<i*(r||0)+i&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData()}addRecordForSorted(t){this.source.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}addRecordsForSorted(t){if(Array.isArray(t)){this.source.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}deleteRecords(t){const e=[],i=t.sort((r,o)=>o-r);for(let r=0;r<i.length;r++){const o=i[r];o>=this._sourceLength||o<0||(e.push(o),this.source.splice(o,1),this.currentIndexedData.pop(),this._sourceLength-=1)}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),e}deleteRecordsForSorted(t){const e=t.sort((i,r)=>r-i);for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];this.source.splice(o,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateRecords(t,e){const i=[];for(let r=0;r<e.length;r++){const o=e[r];o>=this._sourceLength||o<0||(i.push(o),this.source[o]=t[r])}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){const i=[];for(let r=0;r<e.length;r++){const o=e[r];if(o>=this._sourceLength||o<0)continue;const s=this.currentIndexedData[o];if(typeof s!="number")return;i.push(o),this.source[s]=t[r]}this.sortedIndexMap.clear()}sort(t,e,i=e!=="desc"?(r,o)=>r===o?0:r>o?1:-1:(r,o)=>r===o?0:r<o?1:-1){this.lastOrderField=t,this.lastOrder=e,this.lastOrderFn=i;let r,o=this.sortedIndexMap.get(t);if(o&&(r=o[e],r&&r.length>0))return this.currentIndexedData=r,this.updatePagerData(),void this.fireListeners(Du.CHANGE_ORDER,null);const s=[];if(e==="normal")for(let a=0;a<this._sourceLength;a++)s[a]=a;else B_(a=>N(s[a])?s[a]:s[a]=a,(a,l)=>{s[a]=l},this._sourceLength,i,e,a=>this.getOriginalField(a,t));if(this.currentIndexedData=s,this.hierarchyExpandLevel){let a=s.length;window.performance.now();for(let l=0;l<a;l++){const h=this.pushChildrenNode(s[l],this.treeDataHierarchyState.get(s[l]),this.getOriginalRecord(s[l]));a+=h,l+=h}}o||(o={asc:[],desc:[],normal:[]},this.sortedIndexMap.set(t,o)),o[e]=s,this.updatePagerData(),this.fireListeners(Du.CHANGE_ORDER,null)}filterRecord(t){var e,i;let r=!0;for(let o=0;o<this.dataConfig.filterRules.length;o++){const s=(e=this.dataConfig)===null||e===void 0?void 0:e.filterRules[o];if(s.filterKey){const a=t[s.filterKey];if(s.filteredValues.indexOf(a)===-1){r=!1;break}}else if(!(!((i=s.filterFunc)===null||i===void 0)&&i.call(s,t))){r=!1;break}}return r}updateFilterRulesForSorted(t){var e,i,r;this.dataConfig.filterRules=t,this._source=this.processRecords((i=(e=this.dataSourceObj)===null||e===void 0?void 0:e.source)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},(o,s)=>s),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){var e,i,r;this.dataConfig.filterRules=t,this._source=this.processRecords((i=(e=this.dataSourceObj)===null||e===void 0?void 0:e.source)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},(o,s)=>s),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData()}clearSortedIndexMap(){this.lastOrderField&&this.lastOrder&&this.sortedIndexMap.forEach((t,e)=>{e!==this.lastOrderField?this.sortedIndexMap.delete(e):this.lastOrder==="asc"?(t.desc=[],t.normal=[]):this.lastOrder==="desc"?(t.asc=[],t.normal=[]):(t.desc=[],t.asc=[])})}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(Du.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){var t;(t=super.release)===null||t===void 0||t.call(this)}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach(t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)}),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){var e;return!((e=this.dataConfig)===null||e===void 0)&&e.filterRules?this.source[t]:to(this._get(t),i=>{this.recordPromiseCallBack(t,i)})}getRawRecord(t){var e;return!((e=this.beforeChangedRecordsMap)===null||e===void 0)&&e[t]?this.beforeChangedRecordsMap[t]:to(this._get(t),i=>{this.recordPromiseCallBack(t,i)})}getOriginalField(t,e,i,r,o){if(e!==null)return Su(this.getOriginalRecord(t),e,i,r,o,s=>{this.fieldPromiseCallBack(t,e,s)})}getRawFieldData(t,e,i,r,o){if(e!==null)return Su(this.getRawRecord(t),e,i,r,o,s=>{this.fieldPromiseCallBack(t,e,s)})}hasOriginalField(t,e){if(e===null)return!1;if(typeof e=="function")return!0;const i=this.getOriginalRecord(t);return!!(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}}eo.EMPTY=new eo({get(){},length:0});function h3(n,t,e,i){(n[t]||(n[t]=new Map)).set(e,i)}class Au extends eo{static get EVENT_TYPE(){return eo.EVENT_TYPE}static ofArray(t,e,i,r,o){return new Au({get:s=>Array.isArray(s)?vR(t,s):t[s],length:t.length,source:t},e,i,r,o)}constructor(t,e,i,r,o){super(t,e,i,r,o),this._recordCache={},this._fieldCache={}}getOriginalRecord(t){return this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getOriginalField(t,e,i,r,o){const s=this._fieldCache&&this._fieldCache[t];if(s){const a=s.get(e);if(a)return a}return super.getOriginalField(t,e,i,r,o)}clearCache(){this._recordCache&&(this._recordCache={}),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){h3(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache[t]=e}release(){var t;(t=super.release)===null||t===void 0||t.call(this)}}var u3=mt(10407),d3=mt.n(u3);function c3(n){return d3()(n)}function $t(n){var t,e,i,r;if(lt(n)||ue(n)||rt(n)){let o=Ye(n);return typeof o=="number"||typeof o=="string"?o=[o,o,o,o]:Array.isArray(o)&&(o=o.slice(0)),o}return n&&(isFinite(n.bottom)||isFinite(n.left)||isFinite(n.right)||isFinite(n.top))?[(t=n.top)!==null&&t!==void 0?t:0,(e=n.right)!==null&&e!==void 0?e:0,(i=n.bottom)!==null&&i!==void 0?i:0,(r=n.left)!==null&&r!==void 0?r:0]:[0,0,0,0]}const xu=0,k_=1,Bu=2,I_=3,O_=10,z_=11,W_=12,g3=9,f3=13,p3=10,v3=12,m3=32,C3=37,b3=46,_3=48,y3=57,w3=65,D3=90,S3=97,A3=122;function x3(n){return n>=w3&&n<=D3}function B3(n){return n>=S3&&n<=A3}function F3(n){return B3(n)||x3(n)}function T3(n){return n===g3||n===p3||n===v3||n===f3||n===m3}function Df(n){return n>=_3&&n<=y3}function N_(n){return n===b3}function j_(n){return F3(n)||n===C3}function _a(n){return new Error(`calc parse error: ${n}`)}function M3(n){const t=n.replace(/calc\(/g,"(").trim(),e=[],i=t.length;for(let a=0;a<i;a++){const l=t[a],h=l.charCodeAt(0);if(l==="("||l===")")e.push({value:l,type:xu});else if(l==="*"||l==="/")e.push({value:l,type:Bu});else if(l==="+"||l==="-")a=r(l,a+1)-1;else if(Df(h)||N_(h))a=o(l,a+1)-1;else if(!T3(h))throw _a(n)}function r(a,l){if(l<i){const h=t[l],u=h.charCodeAt(0);if(Df(u)||N_(u))return o(a+h,l+1)}return e.push({value:a,type:Bu}),l}function o(a,l){let h=l;for(;h<i;h++){const u=t[h],d=u.charCodeAt(0);if(Df(d))a+=u;else{if(u!=="."){if(j_(d))return s(a,u,h+1);break}if(a.indexOf(".")>=0)throw _a(n);a+=u}}if(a===".")throw _a(n);return e.push({value:parseFloat(a),type:I_}),h}function s(a,l,h){let u=h;for(;u<i;u++){const d=t[u];if(!j_(d.charCodeAt(0)))break;l+=d}return e.push({value:parseFloat(a),unit:l,type:k_}),u}return e}const V_={"*":3,"/":3,"+":2,"-":2};function G_(n,t){function e(r){const o=r.pop(),s=r.pop(),a=r.pop();if(!(a&&a.nodeType&&s&&s.type===Bu&&o&&o.nodeType))throw _a(t);return{nodeType:z_,left:a,op:s,right:o}}const i=[];for(;n.length;){const r=n.shift();if(r.type===xu&&r.value==="("){let o=0;const s=hb.findIndex(n,a=>{if(a.type===xu&&a.value==="(")o++;else if(a.type===xu&&a.value===")"){if(!o)return!0;o--}return!1});if(s===-1)throw _a(t);i.push(G_(n.splice(0,s),t)),n.shift()}else if(r.type===Bu){if(i.length>=3){const o=i[i.length-2].value;V_[r.value]<=V_[o]&&i.push(e(i))}i.push(r)}else if(r.type===k_){const{value:o,unit:s}=r;i.push({nodeType:O_,value:o,unit:s})}else r.type===I_&&i.push({nodeType:W_,value:r.value})}for(;i.length>1;)i.push(e(i));return i[0]}function R3(n){return G_(M3(n),n)}function Sf(n,t){if(n.nodeType===z_){const e=Sf(n.left,t),i=Sf(n.right,t);switch(n.op.value){case"+":return e+i;case"-":return e-i;case"*":return e*i;case"/":return e/i;default:throw new Error(`calc error. unknown operator: ${n.op.value}`)}}else if(n.nodeType===O_)switch(n.unit){case"%":return n.value*t.full/100;case"px":return n.value;default:throw new Error(`calc error. unknown unit: ${n.unit}`)}else if(n.nodeType===W_)return n.value;throw new Error("calc error.")}function E3(n,t){return Sf(R3(n),t)}function P3(n,t){return typeof n=="string"?E3(n.trim(),t):n-0}function H3(n){return!ut(n)&&(!!lt(n)||+n==+n)}function Af(n){return!!ue(n)&&!!n.endsWith("%")&&H3(n.substring(0,n.length-1))}function L3(n){var t,e;const i=document.createElement("div");i.setAttribute("tabindex","0"),i.classList.add("vtable"),i.style.outline="none",i.style.margin=`${n.top}px ${n.right}px ${n.bottom}px ${n.left}px`;const r=(i.offsetWidth||((t=i.parentElement)===null||t===void 0?void 0:t.offsetWidth)||1)-1,o=(i.offsetHeight||((e=i.parentElement)===null||e===void 0?void 0:e.offsetHeight)||1)-1;return i.style.width=r&&r-n.left-n.right+"px"||"0px",i.style.height=o&&o-n.top-n.bottom+"px"||"0px",i}function k3(n,t){var e,i;n.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const r=(n.offsetWidth||((e=n.parentElement)===null||e===void 0?void 0:e.offsetWidth)||1)-1,o=(n.offsetHeight||((i=n.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;n.style.width=r&&r-t.left-t.right+"px"||"0px",n.style.height=o&&o-t.top-t.bottom+"px"||"0px"}function U_(n,t){const{dataSourceEventIds:e}=n.internalProps;e&&e.forEach(i=>n.internalProps.handler.off(i)),t(n),n.internalProps.dataSourceEventIds=[n.internalProps.handler.on(n.internalProps.dataSource,eo.EVENT_TYPE.CHANGE_ORDER,()=>{n.dataSource.hierarchyExpandLevel&&n.refreshRowColCount(),n.render()})]}function K_(n,t=[]){U_(n,()=>{var e,i;const r=t;n.internalProps.records=t;const o=n.internalProps.dataSource=Au.ofArray(r,n.internalProps.dataConfig,n.pagination,n.internalProps.layoutMap.columnObjects,(e=n.options.hierarchyExpandLevel)!==null&&e!==void 0?e:!((i=n._hasHierarchyTreeHeader)===null||i===void 0)&&i.call(n)?1:void 0);n.addReleaseObj(o)})}function xf(n,t){U_(n,()=>{if(t)if(t instanceof eo)n.internalProps.dataSource=t;else{const e=n.internalProps.dataSource=new Au(t);n.addReleaseObj(e)}else n.internalProps.dataSource=eo.EMPTY;n.internalProps.records=null})}function I3(n,t){if(!n.internalProps.frozenRowCount)return null;let{scrollTop:e}=n;const i=n.internalProps.frozenRowCount;for(let r=0;r<i;r++){const o=n.getRowHeight(r),s=e+o;if(s>t)return{top:e,row:r,bottom:s,height:o};e=s}return null}function O3(n,t){if(!n.internalProps.frozenColCount)return null;let{scrollLeft:e}=n;const i=n.internalProps.frozenColCount;for(let r=0;r<i;r++){const o=n.getColWidth(r),s=e+o;if(s>t)return{left:e,col:r,right:s,width:o};e=s}return null}function ya(n,t){return Math.round(P3(t,n.internalProps.calcWidthContext))}function z3(n,t){return n?n.min&&n.min>t?n.min:n.max&&n.max<t?n.max:t:t}function V8(n){return!!(n&&typeof n=="string"&&n.toLowerCase()==="auto")}function W3(n){let t=0,e=0;n.frozenColCount>0&&(t=n.getFrozenColsWidth()),n.rightFrozenColCount>0&&(e=n.getRightFrozenColsWidth());let i=0,r=0;return n.frozenRowCount>0&&(i=n.getFrozenRowsHeight()),n.bottomFrozenRowCount>0&&(r=n.getBottomFrozenRowsHeight()),new On(n.scrollLeft+t,n.scrollTop+i,n.tableNoFrameWidth-t-e,n.tableNoFrameHeight-i-r)}function io(n,t,e,i,r,o=!0){const s=$t(r("padding",n,e,i,t)),a=r("bgColor",n,e,i,t),l=r("font",n,e,i,t);let h,u,d,c,g;if(l){const{family:M,size:E,weight:P,style:I,variant:k}=c3(l);h=M.join(" "),u=E,d=P,c=I,c=k}else h=r("fontFamily",n,e,i,t),u=r("fontSize",n,e,i,t),d=r("fontWeight",n,e,i,t),c=r("fontStyle",n,e,i,t),g=r("fontVariant",n,e,i,t);const f=r("textAlign",n,e,i,t),p=r("textBaseline",n,e,i,t),v=r("color",n,e,i,t),m=r("lineHeight",n,e,i,t),C=r("underline",n,e,i,t),b=r("underlineDash",n,e,i,t),_=r("underlineOffset",n,e,i,t),y=r("lineThrough",n,e,i,t),w=Math.max(1,Math.floor(u/10)),S=r("textOverflow",n,e,i,t),D=r("borderColor",n,e,i,t),A=r("borderLineWidth",n,e,i,t),x=r("borderLineDash",n,e,i,t),B=r("marked",n,e,i,t),F=r("cursor",n,e,i,t),T=!(s&&a&&l&&f&&p&&v&&S&&D&&A&&x&&typeof C=="boolean"&&typeof y=="boolean"&&typeof B=="boolean");if(!o)return{hasFunctionPros:T};const R={text:{fontFamily:h,fontSize:u,fontWeight:d,fontStyle:c,fontVariant:g,fill:v,textAlign:f,textBaseline:p,lineHeight:m!=null?m:u,underline:C?w:void 0,underlineDash:b,underlineOffset:_,lineThrough:y?w:void 0,ellipsis:S&&S!=="clip"?S==="ellipsis"?"...":S:void 0},group:{fill:a,lineDash:x,lineWidth:A,stroke:D,cursor:F==="auto"||F==="default"?void 0:F},_vtable:{padding:s,marked:B}};if(Array.isArray(A)&&(R.group.strokeArrayWidth=$t(A)),Array.isArray(D)){const M=$t(D);R.group.stroke=!M.every(E=>!E)&&M,R.group.strokeArrayColor=$t(D)}return{theme:R,hasFunctionPros:T}}function wa(n){var t;if(n.sortState){let e,i;if(Array.isArray(n.sortState)?n.sortState.length!==0&&({order:e,field:i}=(t=n.sortState)===null||t===void 0?void 0:t[0]):{order:e,field:i}=n.sortState,e&&i&&e!=="normal"){const r=n._getSortFuncFromHeaderOption(void 0,i),o=n.internalProps.layoutMap.headerObjects.find(s=>s&&s.field===i);n.dataSource.sort(o.field,e,r!=null?r:Ug)}}}function Bf(n,t,e){const i=e.theme.frameStyle.cornerRadius;if(i){if(n===0&&t===0)return[i,0,0,0];if(n===e.colCount-1&&t===0)return[0,i,0,0];if(n===0&&t===e.rowCount-1)return[0,0,0,i];if(n===e.colCount-1&&t===e.rowCount-1)return[0,0,i,0]}return 0}class no extends ir{constructor(t){super(t),this.attribute.visibleTime!=="mouseenter_cell"&&this.attribute.visibleTime!=="click_cell"||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image)}get backgroundWidth(){var t,e;return(e=(t=this.attribute.backgroundWidth)!==null&&t!==void 0?t:this.attribute.width)!==null&&e!==void 0?e:0}get backgroundHeight(){var t,e;return(e=(t=this.attribute.backgroundHeight)!==null&&t!==void 0?t:this.attribute.height)!==null&&e!==void 0?e:0}}function Zo(n,t,e,i,r,o,s,a,l,h){let u,d,c,g,f=!0,p=!1;if(typeof n=="function"){const v=n({col:e,row:i,dataValue:h.getCellOriginValue(e,i),value:h.getCellValue(e,i)||"",rect:{left:0,top:0,right:r,bottom:o,width:r,height:o},table:h});v.rootContainer&&(v.rootContainer=Da(v.rootContainer)),v.rootContainer instanceof Di&&(g=v.rootContainer,g.name="custom-container"),f=v.renderDefault,p=v.enableCellPadding}else if(typeof t=="function"){const v=t({col:e,row:i,dataValue:h.getCellOriginValue(e,i),value:h.getCellValue(e,i)||"",rect:{left:0,top:0,right:r,bottom:o,width:r,height:o},table:h});v&&(c=v.elements,f=v.renderDefault,u=v.expectedWidth,d=v.expectedHeight)}else t&&(u=t.expectedWidth,d=t.expectedHeight,c=t.elements,f=t.renderDefault);return c&&(g=N3(c,s?u:r,a?d:o,h.getCellValue(e,i))),p&&g.setAttributes({x:l[3],y:l[0],width:r-l[1]-l[3],height:o-l[0]-l[2]}),Fu(g,r,o),{elementsGroup:g,renderDefault:f}}function N3(n,t,e,i){const r=new Di({x:0,y:0,width:t,height:e,fill:!1,stroke:!1,pickable:!1});return r.name="custom-container",j3(n,t,e,i).forEach(o=>{var s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E;switch(o.clickable&&(o.pickable=o.clickable),o.type){case"arc":const P=Kc({x:o.x,y:o.y,dx:(s=o.dx)!==null&&s!==void 0?s:0,dy:(a=o.dy)!==null&&a!==void 0?a:0,fill:o.fill,stroke:o.stroke,outerRadius:o.radius,startAngle:o.startAngle,endAngle:o.endAngle,pickable:!!o.pickable,cursor:o.cursor});P.name=o.name,r.appendChild(P);break;case"text":if(o.background){const U=(h=(l=o.background)===null||l===void 0?void 0:l.expandX)!==null&&h!==void 0?h:0,W=(d=(u=o.background)===null||u===void 0?void 0:u.expandY)!==null&&d!==void 0?d:0,V=Ge({x:o.x-U,y:o.y-W,dx:(c=o.dx)!==null&&c!==void 0?c:0,dy:(g=o.dy)!==null&&g!==void 0?g:0,width:o.width+2*U,height:o.height+2*W,cornerRadius:(p=(f=o.background)===null||f===void 0?void 0:f.cornerRadius)!==null&&p!==void 0?p:0,fill:(m=(v=o.background)===null||v===void 0?void 0:v.fill)!==null&&m!==void 0?m:"#888"});r.appendChild(V)}const I=new De(Object.assign({pickable:!!o.pickable,fill:(C=o.color)!==null&&C!==void 0?C:o.fill},o));I.name=o.name,r.appendChild(I);break;case"rect":const k=Ge({x:o.x,y:o.y,dx:(b=o.dx)!==null&&b!==void 0?b:0,dy:(_=o.dy)!==null&&_!==void 0?_:0,width:o.width,height:o.height,cornerRadius:o.radius,fill:o.fill,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});k.name=o.name,r.appendChild(k);break;case"circle":const H=pm({x:o.x,y:o.y,dx:(y=o.dx)!==null&&y!==void 0?y:0,dy:(w=o.dy)!==null&&w!==void 0?w:0,radius:o.radius,fill:o.fill,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});H.name=o.name,r.appendChild(H);break;case"icon":const O=new no({x:o.x,y:o.y,dx:(S=o.dx)!==null&&S!==void 0?S:0,dy:(D=o.dy)!==null&&D!==void 0?D:0,width:o.width,height:o.height,image:o.svg,backgroundWidth:o.hover?(A=o.hover.width)!==null&&A!==void 0?A:o.width:void 0,backgroundHeight:o.hover?(x=o.hover.width)!==null&&x!==void 0?x:o.width:void 0,backgroundColor:o.hover?(B=o.hover.bgColor)!==null&&B!==void 0?B:"rgba(22,44,66,0.2)":void 0,pickable:!!o.pickable,cursor:o.cursor});O.name=o.name,O.role="icon-custom",r.appendChild(O);break;case"image":const z=new no({x:o.x,y:o.y,dx:(F=o.dx)!==null&&F!==void 0?F:0,dy:(T=o.dy)!==null&&T!==void 0?T:0,width:o.width,height:o.height,image:o.src,backgroundWidth:o.hover?(R=o.hover.width)!==null&&R!==void 0?R:o.width:void 0,backgroundHeight:o.hover?(M=o.hover.width)!==null&&M!==void 0?M:o.width:void 0,backgroundColor:o.hover?(E=o.hover.bgColor)!==null&&E!==void 0?E:"rgba(22,44,66,0.2)":void 0,pickable:!!o.pickable,cursor:o.cursor,shape:o.shape});z.name=o.name,z.role="image-custom",r.appendChild(z);break;case"line":const j=Sn({points:o.points,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});j.name=o.name,r.appendChild(j)}}),r}function j3(n,t,e,i){const r=[],o=[0,0,0,0];for(let s=0;s<n.length;s++){const a=n[s],l=Object.assign({},a);for(const u in l)l.hasOwnProperty(u)&&ge(l[u])&&(l[u]=l[u](i));const h=l;N(h.x)&&(h.x=ue(h.x)?sr(h.x,t-o[1]):Number(h.x)),N(h.y)&&(h.y=ue(h.y)?sr(h.y,e-o[2]):Number(h.y)),"width"in l&&(l.width=ue(l.width)?sr(l.width,t-o[1]):Number(l.width)),"height"in l&&(l.height=ue(l.height)?sr(l.height,e-o[2]):Number(l.height)),"radius"in l&&(l.radius=ue(l.radius)?sr(l.radius,Math.min(t-o[1],e-o[2])):Number(l.radius)),"hover"in l&&(l.hover.x=ue(l.hover.x)?sr(l.hover.x,t-o[1]):Number(l.hover.x),l.hover.y=ue(l.hover.y)?sr(l.hover.y,e-o[2]):Number(l.hover.y),l.hover.width=ue(l.hover.width)?sr(l.hover.width,t-o[1]):Number(l.hover.width),l.hover.height=ue(l.hover.height)?sr(l.hover.height,e-o[2]):Number(l.hover.height),l.hover.x+=0,l.hover.y+=0),h.x=h.x+0,h.y=h.y+0,r.push(l)}return r}function sr(n,t){return n.endsWith("px")?parseInt(n,10):n.endsWith("%")&&t?parseInt(n,10)/100*t:parseInt(n,10)}function Fu(n,t,e){n&&n.forEachChildren(i=>{var r,o;i&&(ye(i.attribute.width)&&i.attribute.width.percent&&i.setAttribute("width",i.attribute.width.percent/100*t+((r=i.attribute.width.delta)!==null&&r!==void 0?r:0)),ye(i.attribute.height)&&i.attribute.height.percent&&i.setAttribute("height",i.attribute.height.percent/100*e+((o=i.attribute.height.delta)!==null&&o!==void 0?o:0)),i.type==="group"&&Fu(i,i.attribute.width,i.attribute.height))})}function Da(n){if(!n||!n.$$typeof)return n;const t=n.type,{attribute:e,children:i,stateProxy:r}=n.props,o=t({attribute:e});return V3(o,n.props),r&&(o.stateProxy=r),o.id=e.id,o.name=e.name,rt(i)?i.forEach(s=>{const a=Da(s);a&&a.type&&o.add(a)}):i&&o.add(Da(i)),o}function V3(n,t){let e=!1;switch(n.type){case"richtext":case"rich/image":break;default:e=!0}e&&Object.keys(t).forEach(i=>{const r=KC[i];r&&n.on(r,t[i])})}const G3={};class Y_{static setIcon(t,e){this.cache.set(t,e)}static getIcon(t){return this.cache.has(t)?this.cache.get(t):null}static hasIcon(t){return this.cache.has(t)}static clear(t){return this.cache.delete(t)}static clearAll(){this.cache=new Map}}Y_.cache=new Map;const U3={get sort_downward(){return{type:"svg",svg:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="#282F38" fill-opacity="0.35"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="#416EFF"/> </svg>',width:16,height:16,funcType:ne.sort,name:"sort_downward",positionType:Qt.contentRight,marginLeft:3,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="#416EFF"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="#282F38" fill-opacity="0.35"/></svg> ',width:16,height:16,funcType:ne.sort,positionType:Qt.contentRight,name:"sort_upward",marginLeft:3,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="#282F38" fill-opacity="0.35"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="#282F38" fill-opacity="0.35"/></svg> ',width:16,height:16,funcType:ne.sort,positionType:Qt.contentRight,name:"sort_normal",marginLeft:3,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="#282F38" fill-opacity="0.2"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>',width:22,height:22,name:"freeze",funcType:ne.frozen,positionType:Qt.right,marginRight:0,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="#282F38" fill-opacity="0.35"/></svg>',width:22,height:22,name:"frozen",funcType:ne.frozen,positionType:Qt.right,marginRight:0,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="#416EFF"/></svg>',width:22,height:22,funcType:ne.frozen,positionType:Qt.right,name:"frozenCurrent",marginRight:0,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:ne.dropDown,positionType:Qt.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:ne.play,positionType:Qt.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:ne.damagePic,positionType:Qt.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:Qt.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="#141414" fill-opacity="0.65"/>
      </svg>`,width:16,height:16,funcType:ne.expand,name:"expand",positionType:Qt.contentLeft,marginLeft:0,marginRight:4,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z" fill="#141414" fill-opacity="0.65"/>
      </svg>`,width:16,height:16,funcType:ne.collapse,name:"collapse",positionType:Qt.contentLeft,marginLeft:0,marginRight:4,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:Qt.absolute,funcType:ne.drillDown,svg:$R,width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:Qt.absolute,funcType:ne.drillUp,svg:XR,width:13,height:13,cursor:"pointer"}}};function ar(){return ua(U3,G3)}class jt extends Di{clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren(r=>r.name===t&&(i=r,!0)),e&&this.forEachChildren(r=>{if(r.getChildByName){const o=r.getChildByName(t,!0);if(o)return i=o,!0}return!1}),i}get width(){var t;let e=this.AABBBounds.width();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,(t=this.attribute.width)!==null&&t!==void 0?t:0)}get height(){var t;let e=this.AABBBounds.height();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,(t=this.attribute.height)!==null&&t!==void 0?t:0)}setDeltaWidth(t){var e;t!==0&&(this.setAttribute("width",((e=this.attribute.width)!==null&&e!==void 0?e:0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){var e;t!==0&&(this.setAttribute("height",((e=this.attribute.height)!==null&&e!==void 0?e:0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){t!==0&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){t!==0&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t,e="border-rect",i=!1){if(i){let r=this._lastChild,o=0;for(;r;){if(r.name!==e&&t(r,o++))return;r=r._prev}}else{let r=this._firstChild,o=0;for(;r;){if(r.name!==e&&t(r,o++))return;r=r._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(this.childrenCount===0||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&e.name==="border-rect"?e._next:e}tryUpdateAABBBounds(){if(this.role==="cell"){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),K3(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if(this.role==="cell"){const t=this.attribute,{x:e,y:i,width:r,height:o}=t;return this._AABBBounds.setValue(e,i,e+r,i+o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this._AABBBounds}return this.role==="body"||this.role==="row-header"||this.role==="col-header"||this.role==="right-frozen"||this.role==="bottom-frozen"||this.role==="corner-header"||this.role==="corner-right-top-header"||this.role==="corner-right-bottom-header"||this.role==="corner-left-bottom-header"?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}}function K3(n,t){n.stage.dirtyBounds&&n.stage&&n.stage.renderCount&&(n.isContainer&&!t||n.stage.dirty(n.globalAABBBounds))}function Tu(n,t,e,i){const r=n/t;let o,s,a,l;return r>e/i?(o=e,s=o/r,a=0,l=(i-s)/2):(s=i,o=s*r,l=0,a=(e-o)/2),{width:o,height:s}}function Ff(n,t,e,i,r,o,s="left",a="middle",l=[0,0,0,0],h=0,u=0,d=0,c=0){const g=n+e,f=t+i;let p=n+l[3]+h;s==="right"||s==="end"?p=g-r-l[1]-u:s==="center"&&(p=n+(e-r+h-u)/2);let v=t+l[0]+d;return a==="bottom"||a==="alphabetic"||a==="ideographic"?v=f-o-l[2]-c:a==="middle"&&(v=t+(i-o+d-c)/2),{x:p,y:v}}function Ct(n,t,e,i,r){const o=t&&N(t[n])?t[n]:void 0;return typeof o=="function"?o({col:e,row:i,table:r,value:r.getCellValue(e,i),dataValue:r.getCellOriginValue(e,i),cellHeaderPaths:r.getCellHeaderPaths(e,i)}):o}function G8(n,t,e,i,r){const o=t&&isValid(t[n])?t[n]:void 0;if(typeof o!="function")return o}function Mu(n,t,e,i,r){const o=t&&N(t[n])?t[n]:void 0;if(typeof o=="function")return o({col:e,row:i,table:r,value:r.getCellValue(e,i),dataValue:r.getCellOriginValue(e,i),cellHeaderPaths:r.getCellHeaderPaths(e,i)})}function Jo(n,t,e,i){var r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y;let w=(o=(r=e==null?void 0:e.group)===null||r===void 0?void 0:r.strokeArrayWidth)!==null&&o!==void 0?o:void 0;return i.theme.cellInnerBorder&&(n===0&&(w=w!=null?w:[(s=e==null?void 0:e.group)===null||s===void 0?void 0:s.lineWidth,(a=e==null?void 0:e.group)===null||a===void 0?void 0:a.lineWidth,(l=e==null?void 0:e.group)===null||l===void 0?void 0:l.lineWidth,(h=e==null?void 0:e.group)===null||h===void 0?void 0:h.lineWidth],w[3]=0),n===i.colCount-1&&(w=w!=null?w:[(u=e==null?void 0:e.group)===null||u===void 0?void 0:u.lineWidth,(d=e==null?void 0:e.group)===null||d===void 0?void 0:d.lineWidth,(c=e==null?void 0:e.group)===null||c===void 0?void 0:c.lineWidth,(g=e==null?void 0:e.group)===null||g===void 0?void 0:g.lineWidth],w[1]=0),t===0&&(w=w!=null?w:[(f=e==null?void 0:e.group)===null||f===void 0?void 0:f.lineWidth,(p=e==null?void 0:e.group)===null||p===void 0?void 0:p.lineWidth,(v=e==null?void 0:e.group)===null||v===void 0?void 0:v.lineWidth,(m=e==null?void 0:e.group)===null||m===void 0?void 0:m.lineWidth],w[0]=0),t===i.rowCount-1&&(w=w!=null?w:[(C=e==null?void 0:e.group)===null||C===void 0?void 0:C.lineWidth,(b=e==null?void 0:e.group)===null||b===void 0?void 0:b.lineWidth,(_=e==null?void 0:e.group)===null||_===void 0?void 0:_.lineWidth,(y=e==null?void 0:e.group)===null||y===void 0?void 0:y.lineWidth],w[2]=0)),w}function Y3(n,t,e,i,r,o,s,a,l,h,u,d,c,g){var f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T;const R=c._getCellStyle(i,r),M=Mu("padding",R,i,r,c);N(M)&&(h=M),!((f=g==null?void 0:g.text)===null||f===void 0)&&f.textAlign&&(u=(p=g==null?void 0:g.text)===null||p===void 0?void 0:p.textAlign),!((v=g==null?void 0:g.text)===null||v===void 0)&&v.textBaseline&&(d=(m=g==null?void 0:g.text)===null||m===void 0?void 0:m.textBaseline);const E=Jo(i,r,g,c),P=new jt({x:t,y:e,width:o,height:s,lineWidth:(b=(C=g==null?void 0:g.group)===null||C===void 0?void 0:C.lineWidth)!==null&&b!==void 0?b:void 0,fill:(y=(_=g==null?void 0:g.group)===null||_===void 0?void 0:_.fill)!==null&&y!==void 0?y:void 0,stroke:(S=(w=g==null?void 0:g.group)===null||w===void 0?void 0:w.stroke)!==null&&S!==void 0?S:void 0,strokeArrayWidth:E!=null?E:void 0,strokeArrayColor:(A=(D=g==null?void 0:g.group)===null||D===void 0?void 0:D.strokeArrayColor)!==null&&A!==void 0?A:void 0,cursor:(B=(x=g==null?void 0:g.group)===null||x===void 0?void 0:x.cursor)!==null&&B!==void 0?B:void 0,lineDash:(T=(F=g==null?void 0:g.group)===null||F===void 0?void 0:F.lineDash)!==null&&T!==void 0?T:void 0,lineCap:"square",clip:!0,cornerRadius:g.group.cornerRadius});P.role="cell",P.col=i,P.row=r,n==null||n.addCellGroup(P);const I=c.getCellValue(i,r),k=yh({x:h[3],y:h[0],width:o-h[1]-h[3],height:s-h[0]-h[2],image:I,cursor:"pointer"});return k.name="image",k.keepAspectRatio=a,k.textAlign=u,k.textBaseline=d,a||l?k.resources&&k.resources.has(k.attribute.image)&&k.resources.get(k.attribute.image).state==="success"?setTimeout(()=>{X_(l,a,h,u,d,k,P,c)},0):k.successCallback=()=>{X_(l,a,h,u,d,k,P,c),c.scenegraph.updateNextFrame()}:k.resources&&k.resources.has(k.attribute.image)&&k.resources.get(k.attribute.image).state==="success"?Sa(P,i,r,c):k.successCallback=()=>{Sa(P,i,r,c)},k.failCallback=()=>{const H=ar();k.image=H.damage_pic.svg},P.appendChild(k),P}function $_(n,t,e,i,r,o,s){let a=!1,l=null,h=null;const{width:u,height:d,isMerge:c}=Qo(s,r.table);if(u<e+o[1]+o[3]&&(l=e+o[1]+o[3],a=!0),d<i+o[2]+o[0]&&(h=i+o[2]+o[0],a=!0),a){if(typeof l=="number")if(c)for(let g=s.mergeStartCol;g<=s.mergeEndCol;g++)r.setColWidth(g,l/(s.mergeEndCol-s.mergeStartCol+1));else r.setColWidth(n,l);if(typeof h=="number")if(c)for(let g=s.mergeStartRow;g<=s.mergeEndRow;g++)r.setRowHeight(g,h/(s.mergeEndRow-s.mergeStartRow+1));else r.setRowHeight(t,h);return r.component.updateScrollBar(),!0}return!1}function Sa(n,t,e,i){var r,o,s,a,l,h,u,d;const c=n.getChildByName("image");if(!c)return;const g=typeof c.attribute.image!="string"&&c.attribute.image||((r=c.resources)===null||r===void 0?void 0:r.get(c.attribute.image).data);if(!g)return;const f=i._getCellStyle(t,e),p=(o=Ct("textAlign",f,t,e,i))!==null&&o!==void 0?o:"left",v=(s=Ct("textBaseline",f,t,e,i))!==null&&s!==void 0?s:"middle",m=(a=$t(Ct("padding",f,t,e,i)))!==null&&a!==void 0?a:[0,0,0,0],{width:C,height:b,isMerge:_}=Qo(n,i),y=(l=n.mergeStartCol)!==null&&l!==void 0?l:n.col,w=(h=n.mergeStartRow)!==null&&h!==void 0?h:n.row,S=(u=n.mergeEndCol)!==null&&u!==void 0?u:n.col,D=(d=n.mergeEndCol)!==null&&d!==void 0?d:n.row;if(c.keepAspectRatio){const{width:A,height:x}=Tu(g.width||g.videoWidth,g.height||g.videoHeight,C-(m[1]+m[3]),b-(m[0]+m[2])),B=Ff(0,0,C,b,A,x,p,v,m);for(let F=y;F<=S;F++)for(let T=w;T<=D;T++){const R=i.scenegraph.getCell(F,T).getChildByName("image");R==null||R.setAttributes({x:B.x,y:B.y,width:A,height:x})}}else for(let A=y;A<=S;A++)for(let x=w;x<=D;x++){const B=i.scenegraph.getCell(A,x).getChildByName("image");B==null||B.setAttributes({x:m[3],y:m[0],width:C-m[1]-m[3],height:b-m[0]-m[2]})}if(n.getChildByName("play-icon")){const{width:B,height:F}=Qo(n,i),T=Math.floor(Math.min(B-m[1]-m[3],F-m[2]-m[0])/2),R=0+(B>c.attribute.width?c.attribute.x-0+c.attribute.width/2:B/2),M=0+(F>c.attribute.height?c.attribute.y-0+c.attribute.height/2:F/2);for(let E=y;E<=S;E++)for(let P=w;P<=D;P++)i.scenegraph.getCell(E,P).getChildByName("play-icon").setAttributes({x:R-T/2,y:M-T/2,width:T,height:T})}_&&Tf(n.mergeStartCol,n.mergeEndCol,n.mergeStartRow,n.mergeEndRow,i)}function Qo(n,t){return n.role==="cell"&&N(n.mergeStartCol)&&N(n.mergeEndCol)&&N(n.mergeStartRow)&&N(n.mergeEndRow)?{width:t.getColsWidth(n.mergeStartCol,n.mergeEndCol),height:t.getRowsHeight(n.mergeStartRow,n.mergeEndRow),isMerge:!0}:{width:n.attribute.width,height:n.attribute.height,isMerge:!1}}function Tf(n,t,e,i,r){for(let o=n;o<=t;o++)for(let s=e;s<=i;s++){const a=r.scenegraph.getCell(o,s);if(a){const l=a.getChildByName("image");l&&l.setAttributes({dx:-r.getColsWidth(a.mergeStartCol,o-1),dy:-r.getRowsHeight(a.mergeStartRow,s-1)});const h=a.getChildByName("play-icon");h&&h.setAttributes({dx:-r.getColsWidth(a.mergeStartCol,o-1),dy:-r.getRowsHeight(a.mergeStartRow,s-1)})}}}function X_(n,t,e,i,r,o,s,a){const l=o.resources.get(o.attribute.image).data,{col:h,row:u}=s;if(n&&!q_(o)&&$_(h,u,l.width,l.height,a.scenegraph,e,s),t||q_(o)){const{width:d,height:c,isMerge:g}=Qo(s,a),{width:f,height:p}=Tu(l.width,l.height,d-e[1]-e[3],c-e[0]-e[2]),v=Ff(0,0,d,c,f,p,i,r,e);o.setAttributes({x:v.x,y:v.y,width:f,height:p}),g&&Tf(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,a)}}function q_(n){const t=ar();return n.attribute.image===t.damage_pic.svg}function Mf(n,t,e,i,r,o,s,a,l){var h,u,d,c,g,f;n.dependField&&(r=(u=(h=l.getCellOriginRecord(o,s))===null||h===void 0?void 0:h[n.dependField])!==null&&u!==void 0?u:r),n.barType=(d=n.barType)!==null&&d!==void 0?d:"default",n.min=(c=n.min)!==null&&c!==void 0?c:0,n.max=(g=n.max)!==null&&g!==void 0?g:n.min+100;const p=l.getRowHeight(s);let v=e,m=p;const C=new jt({x:0,y:0,width:v,height:m});C.name="progress-bar";const{showBar:b,barColor:_,barBgColor:y,barPositiveColor:w,barNegativeColor:S,barAxisColor:D,barRightToLeft:A,showBarMark:x,barMarkPositiveColor:B,barMarkNegativeColor:F,barMarkWidth:T,barMarkPosition:R}=t;let{barHeight:M,barBottom:E,barPadding:P}=t;P.length===1?P=[P[0],P[0],P[0],P[0]]:P.length===2?P=[P[0],P[1],P[0],P[1]]:P.length===3&&(P=[P[0],P[1],P[2],P[1]]),P=P.map((V,L)=>{if(typeof V=="string"&&ru.endsWith(V,"%")){const G=Number(V.substr(0,V.length-1));return L===0||L===2?p*G/100:e*G/100}return Number(V)});const I=$t(Ct("borderLineWidth",t,o,s,l)),k=Math.max(P[0],Math.ceil(I[0]/2)),H=Math.max(P[1],Math.floor(I[1]/2)),O=Math.max(P[2],Math.floor(I[2]/2)),z=Math.max(P[3],Math.ceil(I[3]/2));v-=H+z,m-=O+k;const j=k,U=z,W=v;if(typeof M=="string"&&ru.endsWith(M,"%")?(M=Number(M.substr(0,M.length-1)),M=m*M/100):M=Number(M),typeof E=="string"&&ru.endsWith(E,"%")?(E=Number(E.substr(0,E.length-1)),E=m*E/100):E=Number(E),Xe(b,{col:o,row:s,table:l,context:null,value:i,dataValue:r})){let V=`${r}`;ru.endsWith(V,"%")&&(V=V.substr(0,V.length-1));const L=Number(V);if(isNaN(L))return C;if(((f=n.barType)!==null&&f!==void 0?f:"default")==="default"){const G=L<n.min?0:L>n.max?1:(L-n.min)/(n.max-n.min),K=v,Y=j+m-M-E,nt=Math.min(K*G,K),q=A?U+W-nt:U,ot=Xe(y,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:G});if(ot){const ft=Ge({x:q,y:Y,width:K,height:M,fill:ot});C.addChild(ft)}const at=Xe(_,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:G})||"#20a8d8",et=Ge({x:q,y:Y,width:nt,height:M,fill:at});C.addChild(et)}else if(n.barType==="negative"){const G=n.min<0?-n.min:0,K=n.max>0?n.max:0,Y=G/(G+K),nt=1-Y,q=L>0?L/K:0,ot=L<0?-L/G:0,at=v,et=j+m-M-E,ft=U,tt=Xe(y,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:q});if(tt){const ce=Ge({x:ft,y:et,width:at,height:M,fill:tt});C.addChild(ce)}const dt=A?nt*at:Y*at,J=Math.min(at*Y*ot,at),it=A?{left:ft+dt,top:et,width:J,height:M}:{left:ft+dt-J,top:et,width:J,height:M},_t=Xe(S,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:ot})||"#20a8d8",Xt=Ge({x:it.left,y:it.top,width:it.width,height:it.height,fill:_t});C.addChild(Xt);const ae=Math.min(at*nt*q,at),Vt=A?{left:ft+dt-ae,top:et,width:ae,height:M}:{left:ft+dt,top:et,width:ae,height:M},pn=Xe(w,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:q})||"#20a8d8",k0=Ge({x:Vt.left,y:Vt.top,width:Vt.width,height:Vt.height,fill:pn});C.addChild(k0);const qa=A?it.left:Vt.left,Hr=Xe(D),pr=Sn({x:0,y:0,stroke:Hr,lineWidth:1,lineDash:[2,2],points:[{x:qa,y:0},{x:qa,y:p}]});if(C.addChild(pr),x&&(q||ot)){const ce=T,He=[];let fs;if(q>0)if(fs=Xe(B,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:q})||"#20a8d8",R==="right"){const Za=A?Vt.left+T/2:Vt.left+Vt.width-T/2;He.push({x:Za,y:Vt.top}),He.push({x:Za,y:Vt.top+Vt.height})}else R==="bottom"&&(He.push({x:Vt.left,y:Vt.top+Vt.height-T/2}),He.push({x:Vt.left+Vt.width,y:Vt.top+Vt.height-T/2}));else if(ot>0)if(fs=Xe(F,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:ot})||"#20a8d8",R==="right"){const Za=A?it.left+it.width-T/2:it.left+T/2;He.push({x:Za,y:it.top}),He.push({x:Za,y:it.top+it.height})}else R==="bottom"&&(He.push({x:it.left,y:it.top+it.height-T/2}),He.push({x:it.left+it.width,y:it.top+it.height-T/2}));const YO=Sn({x:0,y:0,stroke:fs,lineWidth:ce,points:He});C.addChild(YO)}}else if(n.barType==="negative_no_axis"){const G=n.min<0?-n.min:0,K=n.max>0?n.max:0,Y=Math.max(G,K),nt=Y===0?0:Math.abs(L)/Y,q=v,ot=Math.min(q*nt,q),at=j+m-M-E,et=A?U+W-ot:U,ft=Xe(y,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:nt});if(ft){const it=Ge({x:et,y:at,width:q,height:M,fill:ft});C.addChild(it)}const tt={left:et,top:at,width:ot,height:M};let dt;dt=L>=0?Xe(w,{col:o,row:s,table:l,context:null,value:i,percentile:nt,dataValue:r})||"#20a8d8":Xe(S,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:nt})||"#20a8d8";const J=Ge({x:tt.left,y:tt.top,width:tt.width,height:tt.height,fill:dt});if(C.addChild(J),x&&L){const it=T,_t=[];let Xt;if(Xt=L>=0?Xe(B,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:nt})||"#20a8d8":Xe(F,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:nt})||"#20a8d8",R==="right"){const Vt=A?tt.left+T/2:tt.left+tt.width-T/2;_t.push({x:Vt,y:tt.top}),_t.push({x:Vt,y:tt.top+tt.height})}else R==="bottom"&&(_t.push({x:tt.left,y:tt.top+tt.height-T/2}),_t.push({x:tt.left+tt.width,y:tt.top+tt.height-T/2}));const ae=Sn({x:0,y:0,stroke:Xt,lineWidth:it,points:_t});C.addChild(ae)}}}return C}class $3 extends du{constructor(t){super(!1),this.type=oe.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}}const Tr=new $3,Mr=new Xo;function Rf(n,t,e,i,r,o,s,a,l,h,u){var d,c,g,f,p,v,m,C,b,_,y,w;if(!n){const D=Jo(r,o,u,h);(n=new jt({x:e,y:i,width:s,height:a,lineWidth:(c=(d=u==null?void 0:u.group)===null||d===void 0?void 0:d.lineWidth)!==null&&c!==void 0?c:void 0,fill:(f=(g=u==null?void 0:u.group)===null||g===void 0?void 0:g.fill)!==null&&f!==void 0?f:void 0,stroke:(v=(p=u==null?void 0:u.group)===null||p===void 0?void 0:p.stroke)!==null&&v!==void 0?v:void 0,strokeArrayWidth:D,strokeArrayColor:(C=(m=u==null?void 0:u.group)===null||m===void 0?void 0:m.strokeArrayColor)!==null&&C!==void 0?C:void 0,cursor:(_=(b=u==null?void 0:u.group)===null||b===void 0?void 0:b.cursor)!==null&&_!==void 0?_:void 0,lineDash:(w=(y=u==null?void 0:u.group)===null||y===void 0?void 0:y.lineDash)!==null&&w!==void 0?w:void 0,lineCap:"square",clip:!0,cornerRadius:u.group.cornerRadius})).role="cell",n.col=r,n.row=o,t==null||t.addCellGroup(n)}const S=X3(r,o,s,a,l,h);return S&&n.appendChild(S),n}function X3(n,t,e,i,r,o){let s,a;const l=o.internalProps.layoutMap.getBody(n,t).sparklineSpec,h=o.getCellValue(n,t);if(!Array.isArray(h))return;const u=r[3],d=r[0];e-=r[1]+r[3];const c=i-=r[0]+r[2];if(typeof l=="function"){const b={col:n,row:t,dataValue:o.getCellOriginValue(n,t)||"",value:o.getCellValue(n,t)||"",rect:o.getCellRangeRelativeRect(o.getCellRange(n,t)),table:o};s=l(b),a=Z_(s,u,d,e,i)}else s=l,a=Z_(l,u,d,e,i);const g=[],f=[];let p,v;if(typeof s.xField=="object")Tr.domain(s.xField.domain),p=s.xField.field;else if(typeof s.xField=="string"){const b=h.map(_=>_[s.xField]);Tr.domain(b),p=s.xField}else Array.isArray(h)&&(Tr.domain(Array.from({length:h.length},(b,_)=>_)),p=s.xField);if(Tr.range([0,e]),typeof s.yField=="object")Mr.domain(s.yField.domain),v=s.yField.field;else if(typeof s.yField=="string"){const b=h.map(_=>_[s.yField]);Mr.domain([Math.min(...b),Math.max(...b)]),v=s.yField}else Array.isArray(h)&&h.every(b=>typeof b=="number")&&(Mr.domain([Math.min(...h),Math.max(...h)]),v=s.yField);if(Mr.range([0,i]),typeof s.xField=="object"&&Array.isArray(s.xField.domain)){const b=h.map(y=>y[s.xField.field]),_=s.xField.domain;for(let y=0;y<_.length;y++){let w=!1;for(let S=0;S<b.length;S++)if(_[y]==b[S]){const D=h[S];if(!N(D[p])||!N(D[v]))break;g.push({x:0+Tr.scale(D[p]),y:c-Mr.scale(D[v]),defined:N(D[v])}),f.push(D),w=!0;break}w||(g.push({x:0+Tr.scale(_[y]),y:0,defined:!1}),f.push({[p]:_[y],[v]:null}))}}else for(let b=0;b<h.length;b++){const _=h[b];g.push({x:0+Tr.scale(p?_[p]:b),y:c-Mr.scale(v?_[v]:_),defined:N(v?_[v]:_),rawData:_}),f.push(_)}const m=a.getChildByName("sparkline-line");m&&m.setAttribute("points",g),m.bandwidth=Tr.step(),m.min=Mr.range()[0],m.max=Mr.range()[1];const C=a.getChildByName("sparkline-symbol-group");if(C){const b=s.pointShowRule==="isolatedPoint";if(s.pointShowRule==="all")for(let _=0;_<g.length;_++){const{x:y,y:w,defined:S}=g[_];if(S){const D=ra({x:y,y:w});C.appendChild(D)}}else if(b)for(let _=0;_<g.length;_++){const{x:y,y:w,defined:S}=g[_];if(S&&(!g[_-1]||!g[_-1].defined)&&(!g[_+1]||!g[_+1].defined)){const D=ra({x:y,y:w});C.appendChild(D)}}}return a}function Z_(n,t,e,i,r){var o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x;let B;B=typeof n=="function"?n(null):n;const F=new jt({x:t,y:e,width:i,height:r,stroke:!1,fill:!1});if(F.name="sparkline",B.type==="line"){const T=Sn({x:0,y:0,curveType:B.smooth?"monotoneX":"linear",stroke:(a=(s=(o=B.line)===null||o===void 0?void 0:o.style)===null||s===void 0?void 0:s.stroke)!==null&&a!==void 0?a:"blue",lineWidth:(u=(h=(l=B.line)===null||l===void 0?void 0:l.style)===null||h===void 0?void 0:h.strokeWidth)!==null&&u!==void 0?u:2});T.name="sparkline-line",F.addChild(T),B.crosshair&&(T.hover=(c=(d=B.crosshair)===null||d===void 0?void 0:d.style)!==null&&c!==void 0?c:{stroke:"#000",interpolate:"linear"});const R=new jt({x:0,y:0,width:i,height:r,stroke:!1,fill:!1});R.name="sparkline-symbol-group",R.setTheme({symbol:{stroke:(p=(f=(g=B.point)===null||g===void 0?void 0:g.style)===null||f===void 0?void 0:f.stroke)!==null&&p!==void 0?p:"#000",lineWidth:(C=(m=(v=B.point)===null||v===void 0?void 0:v.style)===null||m===void 0?void 0:m.strokeWidth)!==null&&C!==void 0?C:1,fill:(y=(_=(b=B.point)===null||b===void 0?void 0:b.style)===null||_===void 0?void 0:_.fill)!==null&&y!==void 0?y:"#000",size:2*((D=(S=(w=B.point)===null||w===void 0?void 0:w.style)===null||S===void 0?void 0:S.size)!==null&&D!==void 0?D:3),symbolType:"circle"}}),F.addChild(R),R.hover=(x=(A=B.point)===null||A===void 0?void 0:A.hover)!==null&&x!==void 0&&x}return F}const J_=ei();class ts extends Di{constructor(t,e){if(super(e),this.type="chart",this.numberType=J_,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const i=new e.ClassType(e.spec,{renderCanvas:e.canvas,mode:this.attribute.mode==="node"?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1});i.renderSync(),e.chartInstance=this.chartInstance=i}}activate(t){var e,i,r,o;this.active=!0;const{col:s,row:a}=this.parent,{x1:l,y1:h,x2:u,y2:d}=this.getViewBox(),c=q3(s,a,t).intersect({x1:l-t.scrollLeft,x2:u-t.scrollLeft,y1:h-t.scrollTop,y2:d-t.scrollTop});this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:l-t.scrollLeft,x2:u-t.scrollLeft,y1:h-t.scrollTop,y2:d-t.scrollTop},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:g=>{const f=g.window.getContext();f.inuse=!0,f.clearMatrix(),f.setTransformForCurrent(!0),f.beginPath(),f.rect(c.x1,c.y1,c.x2-c.x1,c.y2-c.y1),f.clip()},afterRender(g){g.window.getContext().inuse=!1}}),this.activeChartInstance.renderSync(),(i=(e=t.internalProps.layoutMap)===null||e===void 0?void 0:e.updateDataStateToActiveChartInstance)===null||i===void 0||i.call(e,this.activeChartInstance),this.activeChartInstance.on("click",g=>{ts.temp&&t.scenegraph.updateChartState(g==null?void 0:g.datum)}),this.activeChartInstance.on("brushEnd",g=>{var f;t.scenegraph.updateChartState((f=g==null?void 0:g.value)===null||f===void 0?void 0:f.inBrushData),ts.temp=0,setTimeout(()=>{ts.temp=1},0)}),(o=(r=t)._bindChartEvent)===null||o===void 0||o.call(r,this.activeChartInstance)}deactivate(){var t,e;this.active=!1,(t=this.activeChartInstance)===null||t===void 0||t.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),(e=this.activeChartInstance)===null||e===void 0||e.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){const t=this.parent,e=this.attribute.cellPadding,i=this.stage.table;return{x1:Math.ceil(t.globalAABBBounds.x1+e[3]+i.scrollLeft),x2:Math.ceil(t.globalAABBBounds.x1+t.attribute.width-e[1]+i.scrollLeft),y1:Math.ceil(t.globalAABBBounds.y1+e[0]+i.scrollTop),y2:Math.ceil(t.globalAABBBounds.y1+t.attribute.height-e[2]+i.scrollTop)}}}function q3(n,t,e){const{layoutMap:i}=e.internalProps,r=new Ji,o=e.scenegraph.tableGroup.globalAABBBounds;return r.x1=o.x1,r.x2=o.x2,r.y1=o.y1,r.y2=o.y2,i.isFrozenColumn(n,t)||i.isRightFrozenColumn(n,t)?i.isLeftBottomCorner(n,t)||i.isRightTopCorner(n,t)||(i.isFrozenColumn(n,t)||i.isRightFrozenColumn(n,t)?(r.y1=o.y1+e.getFrozenRowsHeight(),r.y2=o.y2-e.getBottomFrozenRowsHeight()):i.isBottomFrozenRow(n,t)&&(r.x1=o.x1+e.getFrozenColsWidth(),r.x2=o.x2-e.getRightFrozenColsWidth())):(r.x1=o.x1+e.getFrozenColsWidth(),r.x2=o.x2-e.getRightFrozenColsWidth(),r.y1=o.y1+e.getFrozenRowsHeight(),r.y2=o.y2-e.getBottomFrozenRowsHeight()),r}ts.temp=1;const Z3={},J3={};function Q3(){return ua(J3,Z3)}function tH(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v){var m,C,b,_,y,w,S,D,A,x,B,F,T;const R=Q3()[u],M=f._getCellStyle(r,o),E=Mu("padding",M,r,o,f);if(N(E)&&(l=E),!n){const I=Jo(r,o,p,f);(n=new jt({x:e,y:i,width:s,height:a,lineWidth:(C=(m=p==null?void 0:p.group)===null||m===void 0?void 0:m.lineWidth)!==null&&C!==void 0?C:void 0,fill:(_=(b=p==null?void 0:p.group)===null||b===void 0?void 0:b.fill)!==null&&_!==void 0?_:void 0,stroke:(w=(y=p==null?void 0:p.group)===null||y===void 0?void 0:y.stroke)!==null&&w!==void 0?w:void 0,strokeArrayWidth:I,strokeArrayColor:(D=(S=p==null?void 0:p.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&D!==void 0?D:void 0,cursor:(x=(A=p==null?void 0:p.group)===null||A===void 0?void 0:A.cursor)!==null&&x!==void 0?x:void 0,lineDash:(F=(B=p==null?void 0:p.group)===null||B===void 0?void 0:B.lineDash)!==null&&F!==void 0?F:void 0,lineCap:"square",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",n.col=r,n.row=o,t==null||t.addCellGroup(n)}n.AABBBounds.width();const P=new ts(v,{stroke:!1,x:l[3],y:l[0],canvas:(T=f.canvas)!==null&&T!==void 0?T:f.scenegraph.stage.window.getContext().canvas,mode:f.options.mode,modeParams:f.options.modeParams,spec:d,ClassType:R,width:s-l[3]-l[1],height:a-l[2]-l[0],chartInstance:c,dataId:g,data:f.getCellValue(r,o),cellPadding:l,dpr:f.internalProps.pixelRatio,axes:f.isPivotChart()?f.internalProps.layoutMap.getChartAxes(r,o):[]});return n.appendChild(P),f.internalProps.layoutMap.setChartInstance(r,o,P.chartInstance),n}class eH extends jt{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new jt({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new jt({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new jt({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._leftGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._rightGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof De&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const s=this._centerGroup.width;this._cellWidth=t+e+s,this.setAttribute("width",this._cellWidth)}else{const s=this._cellWidth-t-e;this.updateCenterLayout(s);const a=this._centerGroup.width;this._cellWidth=t+e+a,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._centerGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren(o=>{o instanceof no&&(e-=o.AABBBounds.width())});const i=this._centerGroup.getChildByName("text");i instanceof An?i.setAttribute("width",e):i instanceof De&&i.setAttribute("maxLineWidth",e);let r=0;this._centerGroup.forEachChildren(o=>{o.setAttribute("x",r),r+=o.AABBBounds.width()})}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),this._align==="left"||this._align==="start"?this.setAttribute("dx",0):this._align==="center"?this.setAttribute("dx",-this.attribute.width/2):this._align!=="right"&&this._align!=="end"||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){this._baseline==="top"?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):this._baseline==="middle"?(this._leftGroup.forEachChildren(t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)}),this._rightGroup.forEachChildren(t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)}),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):this._baseline==="bottom"&&(this._leftGroup.forEachChildren(t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())}),this._rightGroup.forEachChildren(t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())}),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth,this.layout()}}function lr(n,t,e){var i,r,o;let s=0;const a=e.internalProps.layoutMap;if(a.isHeader(n,t)){const l=a.getHeader(n,t);l!=null&&l.hierarchyLevel&&(s=((i=l.hierarchyLevel)!==null&&i!==void 0?i:0)*((r=a.rowHierarchyIndent)!==null&&r!==void 0?r:0))}else{const l=e.getBodyColumnDefine(n,t);if(l!=null&&l.tree){const h=e.dataSource.getIndexKey(e.getRecordShowIndexByCell(n,t));s=Array.isArray(h)&&e.getHierarchyState(n,t)!==Ft.none?(h.length-1)*((o=a.hierarchyIndent)!==null&&o!==void 0?o:0):0}}return s}function iH(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p,v,m;const C=[],b=[],_=[],y=[],w=[],S=[],D=[],A=[];let x,B,F=0,T=0,R=0,M=0,E=0,P=0;if(Array.isArray(t)&&t.length!==0){let H;if(t.forEach(O=>{switch(O.positionType){case Qt.left:C.push(O);break;case Qt.right:b.push(O);break;case Qt.contentLeft:_.push(O);break;case Qt.contentRight:y.push(O);break;case Qt.absoluteRight:A.push(O);break;case Qt.inlineFront:w.push(O);break;case Qt.inlineEnd:S.push(O)}}),C.forEach(O=>{var z,j,U;const W=Tn(O,void 0,n.col,n.row,f,c);W.role="icon-left",W.name=O.name,W.setAttribute("x",F+((z=W.attribute.marginLeft)!==null&&z!==void 0?z:0)),F+=W.AABBBounds.width()+((j=W.attribute.marginLeft)!==null&&j!==void 0?j:0)+((U=W.attribute.marginRight)!==null&&U!==void 0?U:0),T=Math.max(T,W.AABBBounds.height()),n.appendChild(W)}),b.forEach(O=>{var z,j,U;const W=Tn(O,void 0,n.col,n.row,f,c);W.role="icon-right",W.name=O.name,W.setAttribute("x",R+((z=W.attribute.marginLeft)!==null&&z!==void 0?z:0)),R+=W.AABBBounds.width()+((j=W.attribute.marginLeft)!==null&&j!==void 0?j:0)+((U=W.attribute.marginRight)!==null&&U!==void 0?U:0),M=Math.max(M,W.AABBBounds.height()),n.appendChild(W)}),D.forEach(O=>{var z,j,U;const W=Tn(O,void 0,n.col,n.row,f,c);W.role="icon-absolute-left",W.name=O.name,W.setAttribute("x",E+((z=W.attribute.marginLeft)!==null&&z!==void 0?z:0)),E+=W.AABBBounds.width()+((j=W.attribute.marginLeft)!==null&&j!==void 0?j:0)+((U=W.attribute.marginRight)!==null&&U!==void 0?U:0),n.appendChild(W)}),A.forEach(O=>{var z,j,U;const W=Tn(O,void 0,n.col,n.row,f,c);W.role="icon-absolute-right",W.name=O.name,W.setAttribute("x",P+((z=W.attribute.marginLeft)!==null&&z!==void 0?z:0)),P+=W.AABBBounds.width()+((j=W.attribute.marginLeft)!==null&&j!==void 0?j:0)+((U=W.attribute.marginRight)!==null&&U!==void 0?U:0),n.appendChild(W)}),w.length===0&&S.length===0){let O=0;lt(c.theme._contentOffset)&&(u==="left"?O=c.theme._contentOffset:u==="right"&&(O=-c.theme._contentOffset));const z=f?lr(f.start.col,f.start.row,c):lr(n.col,n.row,c),j=Wg(e).replace(/\r?\n/g,`
`).replace(/\r/g,`
`).split(`
`),U={text:j.length===1?j[0]:j,maxLineWidth:r?1/0:l-(i[1]+i[3])-F-R-z,textBaseline:"top",heightLimit:o?-1:h-(i[0]+i[2]),pickable:!1,autoWrapText:s,lineClamp:a,wordBreak:"break-word",whiteSpace:j.length!==1||s?"normal":"no-wrap",dx:O+(_.length||y.length?0:z)},W=new De(g.text?Object.assign({},g.text,U):U);W.name="text",H=W}else{const O=Object.assign({text:e==null?void 0:e.toString()},((m=(v=(p=n.parent)===null||p===void 0?void 0:p.theme)===null||v===void 0?void 0:v.userTheme)===null||m===void 0?void 0:m.text)||{});g.text&&Object.assign(O,g.text),O.textBaseline="middle";const z=[...w.map(U=>Ru(U)),O,...S.map(U=>Ru(U))];z[0].textAlign=u;const j=new An({width:r?0:l-(i[1]+i[3])-F-R,height:o?0:h-(i[0]+i[2]),textConfig:z,verticalDirection:o?"top":d,ellipsis:O.ellipsis});j.name="text",H=j,j.bindIconEvent()}if(_.length!==0||y.length!==0){const O=new eH({x:0,y:0,fill:!1,stroke:!1});O.name="content",O.setCellContentOption({autoWidth:r,autoHeight:o,cellWidth:l-(i[1]+i[3])-F-R,cellHeight:h-(i[0]+i[2]),align:u,baseline:d}),_.forEach(z=>{const j=Tn(z,void 0,n.col,n.row,f,c);j.role="icon-content-left",j.name=z.name,O.addLeftOccupyingIcon(j)}),y.forEach(z=>{const j=Tn(z,void 0,n.col,n.row,f,c);j.role="icon-content-right",j.name=z.name,O.addRightOccupyingIcon(j)}),O.addContent(H),n.appendChild(O),O.layout(),x=O.AABBBounds.width(),B=O.AABBBounds.height()}else n.firstChild?n.insertBefore(H,n.firstChild):n.appendChild(H),x=H.AABBBounds.width(),B=H.AABBBounds.height()}else if(N(e)){const H=Wg(e).replace(/\r?\n/g,`
`).replace(/\r/g,`
`).split(`
`),O=f?lr(f.start.col,f.start.row,c):lr(n.col,n.row,c);let z=0;lt(c.theme._contentOffset)&&(u==="left"?z=c.theme._contentOffset:u==="right"&&(z=-c.theme._contentOffset));const j={text:H.length===1?H[0]:H,maxLineWidth:r?1/0:l-(i[1]+i[3]+O),textBaseline:"top",autoWrapText:s,lineClamp:a,wordBreak:"break-word",heightLimit:o?-1:h-(i[0]+i[2]),pickable:!1,dx:O+z,whiteSpace:H.length!==1||s?"normal":"no-wrap"},U=new De(g.text?Object.assign({},g.text,j):j);U.name="text",U.textBaseline=d,n.appendChild(U),x=U.AABBBounds.width(),B=U.AABBBounds.height()}const I=r?F+x+R:l-(i[1]+i[3]),k=h-(i[0]+i[2]);n.forEachChildren(H=>{H.role==="icon-left"?H.setAttribute("x",H.attribute.x+i[3]):H.role==="icon-right"?H.setAttribute("x",H.attribute.x+I-R+i[3]):H.role==="icon-absolute-right"?H.setAttribute("x",H.attribute.x+I-P+i[3]+i[1]):H.name!=="content"&&H.name!=="text"||(u==="center"&&H.type!=="richtext"?H.setAttribute("x",i[3]+F+(I-F-R)/2):u==="right"&&H.type!=="richtext"?H.setAttribute("x",i[3]+I-R):H.setAttribute("x",i[3]+F))}),n.forEachChildren(H=>{d==="middle"?H.setAttribute("y",i[0]+(k-H.AABBBounds.height())/2):d==="bottom"?H.setAttribute("y",i[0]+k-H.AABBBounds.height()):H.setAttribute("y",i[0])}),n.setAttributes({width:I+i[1]+i[3],height:k+i[0]+i[2]})}function Tn(n,t,e,i,r,o){var s,a,l,h,u,d;const c={};n.type==="image"?c.image=n.src:(n.type==="svg"||"svg"in n)&&(c.image=n.svg),c.width=n.width,c.height=n.height,c.visibleTime=(s=n.visibleTime)!==null&&s!==void 0?s:"always",c.funcType=n.funcType,c.interactive=n.interactive;let g=0;if(lt(e)&&lt(i)&&o&&(n.funcType===ne.collapse||n.funcType===ne.expand)&&(g=r?lr(r.start.col,r.start.row,o):lr(e,i,o)),c.marginLeft=((a=n.marginLeft)!==null&&a!==void 0?a:0)+g,c.marginRight=(l=n.marginRight)!==null&&l!==void 0?l:0,n.interactive&&(c.pickable=!1),n.hover&&(c.backgroundWidth=(h=n.hover.width)!==null&&h!==void 0?h:n.width,c.backgroundHeight=(u=n.hover.width)!==null&&u!==void 0?u:n.width,c.backgroundColor=(d=n.hover.bgColor)!==null&&d!==void 0?d:"rgba(22,44,66,0.2)",c.hoverImage=n.hover.image),n.cursor&&(c.cursor=n.cursor),"shape"in n&&n.shape==="circle"&&(c.shape=n.shape),t)return t.setAttributes(c),t.loadImage(c.image),t;const f=new no(c);return f.tooltip=n.tooltip,f}function Ru(n){var t,e,i,r,o,s;const a={};return n.type==="image"?a.image=n.src:(n.type==="svg"||"svg"in n)&&(a.image=n.svg),a.visibleTime=(t=n.visibleTime)!==null&&t!==void 0?t:"always",a.funcType=n.funcType,a.id=n.name,a.width=n.width,a.height=n.height,(n.marginRight||n.marginLeft)&&(a.margin=[0,(e=n.marginRight)!==null&&e!==void 0?e:0,0,(i=n.marginLeft)!==null&&i!==void 0?i:0]),n.hover&&(a.backgroundWidth=(r=n.hover.width)!==null&&r!==void 0?r:n.width,a.backgroundHeight=(o=n.hover.height)!==null&&o!==void 0?o:n.height,a.backgroundShowMode="hover",a.hoverImage=n.hover.image,a.backgroundStroke=!1,a.backgroundFill=(s=n.hover.bgColor)!==null&&s!==void 0?s:"rgba(22,44,66,0.2)"),n.cursor&&(a.cursor=n.cursor),a.tooltip=n.tooltip,a}function Ef(n,t,e,i,r,o,s,a,l){var h;let u,d=0,c=0,g=0,f=0;n.forEachChildren(b=>{b.role==="icon-left"?(d+=b.AABBBounds.width(),c=Math.max(c,b.AABBBounds.height())):b.role==="icon-right"&&(g+=b.AABBBounds.width(),f=Math.max(f,b.AABBBounds.height()))});const p=n.getChildByName("text"),v=n.getChildByName("content");let m;p instanceof De?(u=p.AABBBounds.height(),p.setAttribute("maxLineWidth",t-d-f-(o[1]+o[3])),m=p.AABBBounds.height()):p instanceof An?(u=p.AABBBounds.height(),p.setAttribute("width",t-d-f-(o[1]+o[3])),m=p.AABBBounds.height()):v&&(u=v.AABBBounds.height(),v.updateWidth(t-d-f-(o[1]+o[3])),m=v.AABBBounds.height());const C=Math.max(c,f,u)+o[0]+o[2];if(n.forEachChildren(b=>{var _;if(b.role!=="icon-left")if(b.role==="icon-right")b.setAttribute("x",b.attribute.x+i);else if(b.role==="icon-absolute-right")b.setAttribute("x",b.attribute.x+i);else if(b.name==="content"||b.name==="text"){const y=(_=b.attribute.textAlign)!==null&&_!==void 0?_:s;y==="center"?b.setAttribute("x",o[3]+d+(t-(o[1]+o[3])-d-g)/2):y==="right"&&b.setAttribute("x",o[3]+t-(o[1]+o[3])-g)}else b.name==="mark"&&b.setAttribute("x",n.attribute.width)}),r){let b=Math.max(c,m,f);if(nH(l,n,b+o[0]+o[2],C))return!0;b=((h=n.contentHeight)!==null&&h!==void 0?h:e)-(o[0]+o[2]),n.forEachChildren(_=>{_.type!=="rect"&&_.type!=="chart"&&(_.name==="mark"?_.setAttribute("y",0):a==="middle"?_.setAttribute("y",o[0]+(b-_.AABBBounds.height())/2):a==="bottom"?_.setAttribute("y",o[0]+b-_.AABBBounds.height()):_.setAttribute("y",o[0]))})}else a!=="middle"&&a!=="bottom"||n.forEachChildren(b=>{b.type!=="rect"&&b.type!=="chart"&&(b.name==="mark"?b.setAttribute("y",0):a==="middle"?b.setAttribute("y",(e-o[2]+o[0]-b.AABBBounds.height())/2):a==="bottom"?b.setAttribute("y",e-b.AABBBounds.height()-o[2]):b.setAttribute("y",o[0]))});return!1}function Pf(n,t,e,i,r,o,s){const a=t-(r[0]+r[2]),l=n.getChildByName("text");l instanceof De&&!i?l.setAttributes({heightLimit:a}):l instanceof An&&!i?l.setAttributes({height:a}):n.getChildByName("content")&&n.getChildByName("content").updateHeight(a),n.forEachChildren(h=>{h.setAttribute("dy",0),h.type==="rect"||h.type==="chart"||(h.name==="mark"?h.setAttribute("y",0):s==="middle"?h.setAttribute("y",r[0]+(a-h.AABBBounds.height())/2):s==="bottom"?h.setAttribute("y",r[0]+a-h.AABBBounds.height()):h.setAttribute("y",r[0]))})}function nH(n,t,e,i){const r=n.table,o=ze(r,t.col,t.row);if(o&&o.end.row-o.start.row){i/=o.end.row-o.start.row+1,e/=o.end.row-o.start.row+1;for(let s=o.start.row;s<=o.end.row;s++){const a=r.getRowHeight(s);if(a===i&&e!==a||e>a)return!0}}else{const s=r.getRowHeight(t.row);if(s===i&&e!==s||e>s)return!0}return!1}function Q_(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m){var C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k,H,O;const z=n._getCellStyle(o,s),j=Mu("padding",z,o,s,n);N(j)&&(u=j),!((C=v==null?void 0:v.text)===null||C===void 0)&&C.textAlign&&(d=(b=v==null?void 0:v.text)===null||b===void 0?void 0:b.textAlign),!((_=v==null?void 0:v.text)===null||_===void 0)&&_.textBaseline&&(c=(y=v==null?void 0:v.text)===null||y===void 0?void 0:y.textBaseline);const U=n.heightMode==="autoHeight",W=a==="auto",V=(w=z.autoWrapText)!==null&&w!==void 0?w:n.internalProps.autoWrapText,L=z.lineClamp,G=Jo(o,s,v,n),K=new jt({x:i,y:r,width:l,height:h,lineWidth:(D=(S=v==null?void 0:v.group)===null||S===void 0?void 0:S.lineWidth)!==null&&D!==void 0?D:void 0,fill:(x=(A=v==null?void 0:v.group)===null||A===void 0?void 0:A.fill)!==null&&x!==void 0?x:void 0,stroke:(F=(B=v==null?void 0:v.group)===null||B===void 0?void 0:B.stroke)!==null&&F!==void 0?F:void 0,strokeArrayWidth:G!=null?G:void 0,strokeArrayColor:(R=(T=v==null?void 0:v.group)===null||T===void 0?void 0:T.strokeArrayColor)!==null&&R!==void 0?R:void 0,cursor:(E=(M=v==null?void 0:v.group)===null||M===void 0?void 0:M.cursor)!==null&&E!==void 0?E:void 0,lineDash:(I=(P=v==null?void 0:v.group)===null||P===void 0?void 0:P.lineDash)!==null&&I!==void 0?I:void 0,lineCap:"square",clip:!0,cornerRadius:v.group.cornerRadius});if(K.role="cell",K.col=o,K.row=s,e==null||e.addCellGroup(K),f&&K.appendChild(f),p){const Y=t;let nt;if(g){let q=o,ot=s;m&&(q=m.start.col,ot=m.start.row),nt=n.getCellIcons(q,ot)}if(iH(K,nt,Y,u,W,U,V,typeof L=="number"?L:void 0,l,h,d,c,n,v,m),(k=v==null?void 0:v._vtable)===null||k===void 0?void 0:k.marked){const q=Kc({x:K.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});q.name="mark",K.appendChild(q)}}return f&&K.setAttributes({width:Math.max(K.attribute.width,(H=f.attribute.width)!==null&&H!==void 0?H:0),height:Math.max(K.attribute.height,(O=f.attribute.height)!==null&&O!==void 0?O:0)}),K}const Hf=ar();function rH(n,t,e,i,r,o,s,a,l,h,u,d,c,g){var f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T;const R=c._getCellStyle(i,r),M=Mu("padding",R,i,r,c);N(M)&&(h=M),!((f=g==null?void 0:g.text)===null||f===void 0)&&f.textAlign&&(u=(p=g==null?void 0:g.text)===null||p===void 0?void 0:p.textAlign),!((v=g==null?void 0:g.text)===null||v===void 0)&&v.textBaseline&&(d=(m=g==null?void 0:g.text)===null||m===void 0?void 0:m.textBaseline);const E=Jo(i,r,g,c),P=new jt({x:t,y:e,width:o,height:s,lineWidth:(b=(C=g==null?void 0:g.group)===null||C===void 0?void 0:C.lineWidth)!==null&&b!==void 0?b:void 0,fill:(y=(_=g==null?void 0:g.group)===null||_===void 0?void 0:_.fill)!==null&&y!==void 0?y:void 0,stroke:(S=(w=g==null?void 0:g.group)===null||w===void 0?void 0:w.stroke)!==null&&S!==void 0?S:void 0,strokeArrayWidth:E,strokeArrayColor:(A=(D=g==null?void 0:g.group)===null||D===void 0?void 0:D.strokeArrayColor)!==null&&A!==void 0?A:void 0,cursor:(B=(x=g==null?void 0:g.group)===null||x===void 0?void 0:x.cursor)!==null&&B!==void 0?B:void 0,lineDash:(T=(F=g==null?void 0:g.group)===null||F===void 0?void 0:F.lineDash)!==null&&T!==void 0?T:void 0,lineCap:"square",clip:!0,cornerRadius:g.group.cornerRadius});P.role="cell",P.col=i,P.row=r,n==null||n.addCellGroup(P);const I=c.getCellValue(i,r),k=document.createElement("video");k.addEventListener("loadeddata",()=>{l&&$_(i,r,k.videoWidth,k.videoHeight,c.scenegraph,h,P);const{width:O,height:z,isMerge:j}=Qo(P,c);if(a){const{width:Y,height:nt}=Tu(k.videoWidth,k.videoHeight,O-h[1]-h[3],z-h[0]-h[2]),q=Ff(0,0,O,z,Y,nt,u,d,h);H.setAttributes({width:Y,height:nt,x:q.x,y:q.y,dx:0})}else H.setAttributes({x:h[3],y:h[0],width:O-h[1]-h[3],height:z-h[2]-h[0],dy:0});j&&Tf(P.mergeStartCol,P.mergeEndCol,P.mergeStartRow,P.mergeEndRow,c);const{width:U,height:W}=Qo(P,c),V=Math.floor(Math.min(U-h[1]-h[3],W-h[2]-h[0])/2),L=0+(U>H.attribute.width?H.attribute.x-0+H.attribute.width/2:U/2),G=0+(W>H.attribute.height?H.attribute.y-0+H.attribute.height/2:W/2),K=new no({x:L-V/2,y:G-V/2,width:V,height:V,image:Hf.play.svg,cursor:Hf.play.cursor});K.name="play-icon",P.appendChild(K),c.scenegraph.updateNextFrame()}),k.onerror=()=>{H.image=Hf.damage_pic.svg},k.src=I,k.setAttribute("preload","auto");const H=yh({x:h[3],y:h[0],width:o-h[1]-h[3],height:s-h[2]-h[0],image:k,cursor:"pointer"});return H.name="image",H.keepAspectRatio=a,H.textAlign=u,H.textBaseline=d,P.appendChild(H),P}function t1(n,t,e){n.then(()=>{e(),t.scenegraph.updateNextFrame()}).catch(i=>{})}function oH(){Dn(),Yr(),Yh(),Fm()}const sH='<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',aH='<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>';oH();class Aa extends Nn{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},Aa.defaultAttributes,t)),this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("click",this.handleClick)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new Kr(gt({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t&&this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new ir(gt({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new ir(gt({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new Uh(gt({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),r=Math.max(t,e,i),o=r/2-t/2,s=r/2-e/2,a=r/2-i/2,l=this.attribute.box.width,h=this.attribute.icon.width,u=Math.max(l,h),d=u/2-l/2,c=u/2-h/2,g=u+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:d,y:o}),this._checkIcon.setAttributes({x:c,y:s}),this._indeterminateIcon.setAttributes({x:c,y:s}),this._text.setAttributes({x:g,y:a})}handleClick(){this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}))}}Aa.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:sH,indeterminateIconImage:aH,width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function lH(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p,v,m,C,b,_,y,w,S,D,A,x;if(!n){const F=Jo(r,o,g,c);(n=new jt({x:e,y:i,width:a,height:l,lineWidth:(v=(p=g==null?void 0:g.group)===null||p===void 0?void 0:p.lineWidth)!==null&&v!==void 0?v:void 0,fill:(C=(m=g==null?void 0:g.group)===null||m===void 0?void 0:m.fill)!==null&&C!==void 0?C:void 0,stroke:(_=(b=g==null?void 0:g.group)===null||b===void 0?void 0:b.stroke)!==null&&_!==void 0?_:void 0,strokeArrayWidth:F,strokeArrayColor:(w=(y=g==null?void 0:g.group)===null||y===void 0?void 0:y.strokeArrayColor)!==null&&w!==void 0?w:void 0,cursor:(D=(S=g==null?void 0:g.group)===null||S===void 0?void 0:S.cursor)!==null&&D!==void 0?D:void 0,lineDash:(x=(A=g==null?void 0:g.group)===null||A===void 0?void 0:A.lineDash)!==null&&x!==void 0?x:void 0,lineCap:"square",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",n.col=r,n.row=o,t==null||t.addCellGroup(n)}const B=hH(r,o,s,a,l,h,g,f,c);return B&&n.appendChild(B),B.render(),a-=h[1]+h[3],l-=h[0]+h[2],u==="center"?B.setAttribute("x",h[3]+(a-B.AABBBounds.width())/2):u==="right"?B.setAttribute("x",h[3]+a-B.AABBBounds.width()):B.setAttribute("x",h[3]),d==="middle"?B.setAttribute("y",h[0]+(l-B.AABBBounds.height())/2):d==="bottom"?B.setAttribute("y",h[0]+l-B.AABBBounds.height()):B.setAttribute("y",h[0]),n}function hH(n,t,e,i,r,o,s,a,l){var h,u,d;const c=l._getCellStyle(n,t),g=Ct("size",c,n,t,l),f=Ct("spaceBetweenTextAndIcon",c,n,t,l),p=Ct("defaultFill",c,n,t,l),v=Ct("defaultStroke",c,n,t,l),m=Ct("disableFill",c,n,t,l),C=Ct("checkedFill",c,n,t,l),b=Ct("checkedStroke",c,n,t,l),_=Ct("disableCheckedFill",c,n,t,l),y=Ct("disableCheckedStroke",c,n,t,l),w=Ct("checkIconImage",c,n,t,l),S=Ct("indeterminateIconImage",c,n,t,l),D=l.getCellValue(n,t),A=l.getCellOriginValue(n,t);let x,B,F=(h=D)!==null&&h!==void 0?h:"";ye(D)?(x=D.checked,B=D.disable,F=D.text):typeof D=="boolean"&&(x=D,F=""),x=l.stateManager.syncCheckedState(n,t,a.field,x);const T=lr(n,t,l),R=l._getCellStyle(n,t),M=(u=R.autoWrapText)!==null&&u!==void 0?u:l.internalProps.autoWrapText,{lineClamp:E}=R,{checked:P,disable:I}=a;if(x==null||typeof x=="function"){const W=Xe(P,{col:n,row:t,table:l,context:null,value:D,dataValue:A});x=l.stateManager.syncCheckedState(n,t,a.field,W)}const k=Xe(I,{col:n,row:t,table:l,context:null,value:D,dataValue:A}),H=e==="auto",O=l.heightMode==="autoHeight",z={text:F.length===1?F[0]:F,maxLineWidth:H?1/0:i-(o[1]+o[3]+T)-g-f,textBaseline:"top",autoWrapText:M,lineClamp:E,wordBreak:"break-word",heightLimit:O?-1:r-(o[0]+o[2]),pickable:!1,dx:T,whiteSpace:F.length!==1||M?"normal":"no-wrap"},j={x:0,y:0,text:s.text?Object.assign({},s.text,z):z,icon:{width:Math.floor(g/1.4),height:Math.floor(g/1.4)},box:{width:g,height:g},spaceBetweenTextAndIcon:f,disabled:(d=B!=null?B:k)!==null&&d!==void 0&&d};x==="indeterminate"?(j.checked=void 0,j.indeterminate=!0):(j.checked=x,j.indeterminate=void 0),p&&(j.box.fill=p),v&&(j.box.stroke=v),m&&(j.box.disableFill=m),C&&(j.box.checkedFill=C),b&&(j.box.checkedStroke=b),_&&(j.box.disableCheckedFill=_),y&&(j.box.disableCheckedStroke=y),w&&(j.icon.checkIconImage=w),S&&(j.icon.indeterminateIconImage=S);const U=new Aa(j);return U.name="checkbox",U}function Lf(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m){var C;let b;if(xr(t)&&(t=i.getCellValue(r,o)),n==="text"||n==="link"){if(n==="link"){const S=t,D=i._getCellStyle(r,o);n==="link"&&("templateLink"in e&&e.templateLink||!("linkDetect"in e)||!e.linkDetect||Xg.test(S))&&(p?(p.text.fill=Ct("linkColor",D,r,o,i),p.group.cursor="pointer"):p={text:{fill:Ct("linkColor",D,r,o,i)},group:{cursor:"pointer"}})}let _,y=!0;if(m)_=m.elementsGroup,y=m.renderDefault;else{let S,D;if(i.getCellLocation(r,o)!=="body"?(S=e==null?void 0:e.headerCustomRender,D=e==null?void 0:e.headerCustomLayout):(S=(e==null?void 0:e.customRender)||i.customRender,D=e==null?void 0:e.customLayout),D||S){const A=Zo(D,S,r,o,a,l,!1,i.heightMode==="autoHeight",d,i);_=A.elementsGroup,y=A.renderDefault}}b=Q_(i,t,h,0,u,r,o,s,a,l,d,c,g,f,_,y,p,v);const w=i.internalProps.layoutMap.getAxisConfigInPivotChart(r,o);if(w){const S=new wf(w,b.attribute.width,b.attribute.height,d,i);b.clear(),b.appendChild(S.component),S.overlap()}else i.internalProps.layoutMap.isEmpty(r,o)?(b.setAttributes({fill:!1,stroke:!1}),b.clear()):i.internalProps.layoutMap.isAxisCell(r,o)&&b.clear()}else if(n==="image")b=Y3(h,0,u,r,o,a,l,e.keepAspectRatio,e.imageAutoSizing,d,c,g,i,p);else if(n==="video")b=rH(h,0,u,r,o,a,l,e.keepAspectRatio,e.imageAutoSizing,d,c,g,i,p);else if(n==="chart"){const _=i.internalProps.layoutMap.getChartInstance(r,o);b=tH(null,h,0,u,r,o,a,l,d,t,e.chartModule,i.internalProps.layoutMap.getChartSpec(r,o),_,(C=i.internalProps.layoutMap.getChartDataId(r,o))!==null&&C!==void 0?C:"data",i,p,i.internalProps.layoutMap.isShareChartSpec(r,o))}else if(n==="progressbar"){const _=i._getCellStyle(r,o),y=i.getCellOriginValue(r,o);b=Q_(i,t,h,0,u,r,o,s,a,l,d,c,g,!1,null,!0,p,v);const w=Mf(e,_,s,t,y,r,o,d,i);b.firstChild?b.insertBefore(w,b.firstChild):b.appendChild(w)}else n==="sparkline"?b=Rf(null,h,0,u,r,o,a,l,d,i,p):n==="checkbox"&&(b=lH(null,h,0,u,r,o,s,a,l,d,c,g,i,p,e));return b}function xa(n,t,e,i){var r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b;const _=e.scenegraph.highPerformanceGetCell(n,t,!0),y=e._getCellStyle(n,t),w=(r=y.autoWrapText)!==null&&r!==void 0?r:e.internalProps.autoWrapText,S=e.getCellLocation(n,t);let D,A,x,B,F,T=e.getCellValue(n,t);if(e.internalProps.customMergeCell){const W=e.getCustomMerge(n,t);if(W){const{range:V,text:L,style:G,customLayout:K,customRender:Y}=W;A=V,D=A.start.col!==A.end.col||A.start.row!==A.end.row,T=L,B=G,B&&(x=io(B,e,A.start.col,A.start.row,Ct).theme,x.group.cornerRadius=Bf(n,t,e)),(K||Y)&&(F=Zo(K,Y,V.start.col,V.start.row,e.getColsWidth(V.start.col,V.end.col),e.getRowsHeight(V.start.row,V.end.row),!1,e.heightMode==="autoHeight",[0,0,0,0],e))}}let R=n,M=t;A&&(R=A.start.col,M=A.start.row);const E=S!=="body"?e.getHeaderDefine(R,M):e.getBodyColumnDefine(R,M);if(A||S==="body"&&!(E!=null&&E.mergeCell)||(A=e.getCellRange(n,t),D=A.start.col!==A.end.col||A.start.row!==A.end.row),x||(x=io(y,e,D?A.start.col:n,D?A.start.row:t,Ct).theme),x.group.cornerRadius=Bf(n,t,e),!i&&!D&&uH(n,t,_,w,e)){const W=e.getColWidth(n),V=e.getRowHeight(t);_.setAttributes({width:W,height:V,lineWidth:(s=(o=x==null?void 0:x.group)===null||o===void 0?void 0:o.lineWidth)!==null&&s!==void 0?s:void 0,fill:(l=(a=x==null?void 0:x.group)===null||a===void 0?void 0:a.fill)!==null&&l!==void 0?l:void 0,stroke:(u=(h=x==null?void 0:x.group)===null||h===void 0?void 0:h.stroke)!==null&&u!==void 0?u:void 0,strokeArrayWidth:(c=(d=x==null?void 0:x.group)===null||d===void 0?void 0:d.strokeArrayWidth)!==null&&c!==void 0?c:void 0,strokeArrayColor:(f=(g=x==null?void 0:x.group)===null||g===void 0?void 0:g.strokeArrayColor)!==null&&f!==void 0?f:void 0,cursor:(v=(p=x==null?void 0:x.group)===null||p===void 0?void 0:p.cursor)!==null&&v!==void 0?v:void 0,cornerRadius:(C=(m=x==null?void 0:x.group)===null||m===void 0?void 0:m.cornerRadius)!==null&&C!==void 0?C:0,y:e.scenegraph.getCellGroupY(t)}),_.forEachChildren(G=>{G.setAttributes({dx:0,dy:0})});const L=_.getChildByName("text");if(L){const G=e.getCellValue(n,t),K=Wg(G).replace(/\r?\n/g,`
`).replace(/\r/g,`
`).split(`
`),Y=lr(n,t,e),nt=y.lineClamp,q=(b=$t(Ct("padding",y,n,t,e)))!==null&&b!==void 0?b:[0,0,0,0],ot=x.text.textAlign;let at=0;at=ot==="center"?q[3]+(W-(q[1]+q[3]))/2:ot==="right"?q[3]+W-(q[1]+q[3]):q[3];const et={text:K.length!==1||w?K:K[0],maxLineWidth:W-(q[1]+q[3]+Y),textBaseline:"top",autoWrapText:w,lineClamp:nt,wordBreak:"break-word",heightLimit:V-(q[0]+q[2]),pickable:!1,dx:Y,x:at};if(L.setAttributes(x.text?Object.assign({},x.text,et):et),L.attribute.text){const ft=x.text.textBaseline,tt=V-(q[0]+q[2]);let dt=0;dt=ft==="middle"?q[0]+(tt-L.AABBBounds.height())/2:ft==="bottom"?q[0]+tt-L.AABBBounds.height():q[0],L.setAttributes({y:dt})}}return _}if(!i&&_.role==="empty")return;const P=e.isHeader(n,t)?e._getHeaderLayoutMap(n,t).headerType:e.getBodyColumnType(n,t),I=S!=="body"||!!(E!=null&&E.icon)||!!(E!=null&&E.tree),k=x._vtable.padding,H=x.text.textAlign,O=x.text.textBaseline;let z,j,U;if(A?(j=e.getColsWidth(A.start.col,A.end.col),U=e.getRowsHeight(A.start.row,A.end.row)):(j=e.getColWidth(n),U=e.getRowHeight(t)),xr(T)?(_.removeAllChild(),t1(T,e,e1.bind(null,P,T,E,e,n,t,j,U,_,k,H,O,I,i,x,A,F))):z=e1(P,T,E,e,n,t,j,U,_,k,H,O,I,i,x,A,F),D){const{width:W}=z.attribute,{height:V}=z.attribute;z.contentWidth=W,z.contentHeight=V,i1(A,j,U,k,H,O,e)}return z}function e1(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v){var m,C;if(xr(t)&&(t=i.getCellValue(r,o)),!g&&(l.row!==o||l.col!==r))return null;const b=Lf(n,t,e,i,r,o,i.getColWidth(r),s,a,g?i.scenegraph.getColGroup(r):l.parent,g?0:i.scenegraph.getCellGroupY(o),h,u,d,c,f,p,v);return!g&&l.parent&&(l.parent.insertAfter(b,l),l.parent.removeChild(l),!((m=i.scenegraph)===null||m===void 0)&&m.proxy.cellCache.get(r)&&((C=i.scenegraph)===null||C===void 0||C.proxy.cellCache.set(r,b))),b}function uH(n,t,e,i,r){var o;const s=r.getBodyColumnDefine(n,t),a=!!(s!=null&&s.icon)||!!(s!=null&&s.tree),l=r.getBodyColumnType(n,t),h=r.heightMode==="autoHeight",u=r.getCellValue(n,t);return!(r.isHeader(n,t)||e.role!=="cell"||l!=="text"||i||h||a||((o=e.firstChild)===null||o===void 0?void 0:o.type)!=="text"||xr(u))}function i1(n,t,e,i,r,o,s){for(let a=n.start.col;a<=n.end.col;a++)for(let l=n.start.row;l<=n.end.row;l++){const h=s.scenegraph.getCell(a,l,!0);h.role==="cell"&&n.start.row!==n.end.row&&h.contentWidth!==t&&Pf(h,e,e,s.heightMode==="autoHeight",i,r,o),h.role==="cell"&&n.start.col!==n.end.col&&h.contentHeight!==e&&Ef(h,t,e,0,s.heightMode==="autoHeight",i,r,o,s.scenegraph),h.contentWidth=t,h.contentHeight=e;const u=s.getRowHeight(l);Eu(h,s.getColWidth(a),u,n,s)}}function Eu(n,t,e,i,r){const{col:o,row:s}=n,a=-r.getColsWidth(i.start.col,o-1),l=-r.getRowsHeight(i.start.row,s-1);n.forEachChildren(f=>{var p,v,m,C,b,_;typeof f._dx=="number"?f.setAttributes({dx:((p=f._dx)!==null&&p!==void 0?p:0)+a}):(f._dx=(v=f.attribute.dx)!==null&&v!==void 0?v:0,f.setAttributes({dx:((m=f.attribute.dx)!==null&&m!==void 0?m:0)+a})),typeof f._dy=="number"?f.setAttributes({dy:((C=f._dy)!==null&&C!==void 0?C:0)+l}):(f._dy=(b=f.attribute.dy)!==null&&b!==void 0?b:0,f.setAttributes({dy:((_=f.attribute.dy)!==null&&_!==void 0?_:0)+l}))});const h=n.attribute.lineWidth,u=rt(h),d=[0,0,0,0];o===i.start.col&&(d[3]=u?h[3]:h),s===i.start.row&&(d[0]=u?h[0]:h),o===i.end.col&&(d[1]=u?h[1]:h),s===i.end.row&&(d[2]=u?h[2]:h);const c=t!==n.attribute.width,g=e!==n.attribute.height;return n.setAttributes({width:t,height:e,strokeArrayWidth:d}),n.mergeStartCol=i.start.col,n.mergeStartRow=i.start.row,n.mergeEndCol=i.end.col,n.mergeEndRow=i.end.row,{widthChange:c,heightChange:g}}function n1(n,t,e,i){if(i.internalProps.customMergeCell){const r=i.getCustomMerge(n,t);if(r){const{range:o,text:s,style:a,customLayout:l,customRender:h}=r;if(l||h){const u=Zo(l,h,o.start.col,o.start.row,i.getColsWidth(o.start.col,o.end.col),i.getRowsHeight(o.start.row,o.end.row),!1,i.heightMode==="autoHeight",[0,0,0,0],i),d=u.elementsGroup;e.childrenCount>0&&d?e.insertBefore(d,e.firstChild):d&&e.appendChild(d);const c=i.getRowHeight(t),g=i.getColWidth(n),{width:f}=e.attribute,{height:p}=e.attribute;return e.contentWidth=f,e.contentHeight=p,Eu(e,g,c,o,i),u}}}}function r1(n){return!!(n.role==="cell"&&lt(n.mergeStartCol)&&lt(n.mergeStartRow)&&lt(n.mergeEndCol)&&lt(n.mergeEndRow))}const U8=5;function o1(n,t,e,i,r,o){var s,a,l,h,u,d,c,g,f;if(e!=null&&e.zero&&(n=Math.min(n,0),t=Math.max(t,0)),e==null?void 0:e.expand){const m=n,C=t;N(e.expand.min)&&(n=m-(C-m)*e.expand.min),N(e.expand.max)&&(t=C+(C-m)*e.expand.max)}let p,v;if(lt(e==null?void 0:e.min)&&(n=e.min),lt(e==null?void 0:e.max)&&(t=e.max),(e==null?void 0:e.type)==="log"?(p=new yu,p.base((s=e==null?void 0:e.base)!==null&&s!==void 0?s:10)):(e==null?void 0:e.type)==="symlog"?(p=new wu,p.constant((a=e==null?void 0:e.constant)!==null&&a!==void 0?a:10)):p=new Xo,p.domain([n,t],!!(e!=null&&e.nice)),e==null?void 0:e.nice){let m=(d=(h=(l=e.tick)===null||l===void 0?void 0:l.forceTickCount)!==null&&h!==void 0?h:(u=e.tick)===null||u===void 0?void 0:u.tickCount)!==null&&d!==void 0?d:10;ge(m)&&(m=m({axisLength:r,labelStyle:(g=(c=e==null?void 0:e.label)===null||c===void 0?void 0:c.style)!==null&&g!==void 0?g:{fontSize:ma.LABEL_FONT_SIZE}})),e.niceType==="accurateFirst"&&(m=Math.max(10,m)),ut(e.min)&&ut(e.max)?p.nice(m):N(e.min)&&ut(e.max)?p.niceMax(m):ut(e.min)&&N(e.max)&&p.niceMin(m)}return delete p._niceType,o||(v=p.ticks(lt(e==null?void 0:e.tickCount)?e==null?void 0:e.tickCount:5,{noDecimals:(f=e==null?void 0:e.tick)===null||f===void 0?void 0:f.noDecimals})),{range:p.domain(),ticks:v}}function s1(n){return n.length===2&&we(n[0])&&we(n[1])&&n[1]>=n[0]}function a1(n){const t=n[1]-n[0],e=n[1]*n[0]<0;let i=n[0]<=0?0-n[0]:0,r=n[1]>0?n[1]-0:0;return t===0?n[0]<0?(i=1,r=0):n[0]>0&&(i=0,r=1):(i/=t,r/=t),{total:t,negative:i,positive:r,includeZero:e,domain:n,extendable_min:!0,extendable_max:!0}}function l1(n,t){const{positive:e,negative:i,extendable_min:r,extendable_max:o,domain:s}=n,{positive:a,negative:l,extendable_min:h,extendable_max:u,domain:d}=t;if(a>0){if(!h)return!1;let c=i/e;o&&(c=i/Math.max(e,a),s[1]=-s[0]/c),d[0]=-d[1]*c}else if(l>0){if(!u)return!1;let c=e/i;r&&(c=e/Math.max(i,i),s[0]=-s[1]/c),d[1]=-d[0]*c}return!0}function h1(n,t){const{extendable_min:e,extendable_max:i,domain:r}=n,{positive:o,negative:s,domain:a}=t;return(o!==0||s!==0)&&!(o>0&&!i)&&!(s>0&&!e)&&(r[0]=a[0],r[1]=a[1],!0)}function u1(n,t){const{positive:e,negative:i,extendable_max:r,domain:o}=n,{positive:s,negative:a,extendable_min:l,domain:h}=t;if(r&&l){const u=Math.max(i,a)/Math.max(e,s);o[1]=-o[0]/u,h[0]=-h[1]*u}else if(l){const u=i/e;h[0]=-h[1]*u}else{if(!r)return!1;{const u=a/s;o[1]=-o[0]/u}}return!0}function d1(n,t){const{extendable_min:e,domain:i}=n,{extendable_max:r,domain:o}=t;return!(!e||!r)&&(i[0]=-i[1],o[1]=-o[0],!0)}function es(n,t){const e=[n.min,n.max],i=[t.min,t.max];if(!s1(e)||!s1(i))return;const r=a1(e),o=a1(i),{positive:s,negative:a,extendable_min:l,extendable_max:h,includeZero:u}=r,{positive:d,negative:c,extendable_min:g,extendable_max:f,includeZero:p}=o;if(s===0&&a===0){if(!h1(r,o))return}else if(d===0&&c===0){if(!h1(o,r))return}else if(u||p)if(u&&!p){if(!l1(r,o))return}else if(p&&!u){if(!l1(o,r))return}else{if(a===c)return;if(a>c){if(!u1(r,o))return}else if(!u1(o,r))return}else{if(a===0&&d===0){if(!d1(r,o))return}else if(c===0&&s===0&&!d1(o,r))return;if(a===0&&c===0)if(e[0]===0&&i[0]>0){if(!g)return;i[0]=0}else{if(!(i[0]===0&&e[0]>0)||!l)return;e[0]=0}if(s===0&&d===0)if(e[1]===0&&i[1]>0){if(!f)return;i[1]=0}else{if(!(i[1]===0&&e[1]>0)||!h)return;e[1]=0}}return{range1:e,range2:i}}function kf(n,t,e){var i,r,o,s;if(e._table.isPivotChart())if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){const a=Rr("top",n,t+1,n,e.columnHeaderLevelCount-1,n,t,1,e);if(!a)return;const{range:l,ticks:h,axisOption:u,isZeroAlign:d,theme:c}=a;if(d){const g=Rr("bottom",n,t+1,n,e.columnHeaderLevelCount-1,n,t,0,e);if(g){const{range:f}=g,p=es(l,f);p&&(l.min=p.range1[0],l.max=p.range1[1])}}return lt(u==null?void 0:u.min)&&(l.min=u.min,l.min>0&&(u.zero=!1)),lt(u==null?void 0:u.max)&&(l.max=u.max,l.max<0&&(u.zero=!1)),gt({range:l},u,{orient:"top",type:(u==null?void 0:u.type)||"linear",label:{flush:!0},__ticksForVTable:h,__vtableChartTheme:c})}if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){const a=e.getIndicatorKeyInChartSpec(n,t);let l=null;a==null||a.forEach(p=>{const v=e.getIndicatorInfo(p);v&&(l=v)});const h=Rr("bottom",n,t-1,n,t,n,t,0,e);if(!h)return;const{range:u,ticks:d,axisOption:c,isZeroAlign:g,theme:f}=h;if(g){const p=Rr("top",n,t-1,n,t,n,t,1,e);if(p){const{range:v}=p,m=es(u,v);m&&(u.min=m.range1[0],u.max=m.range1[1])}}return lt(c==null?void 0:c.min)&&(u.min=c.min,u.min>0&&(c.zero=!1)),lt(c==null?void 0:c.max)&&(u.max=c.max,u.max<0&&(c.zero=!1)),gt({title:{visible:!0,text:l==null?void 0:l.title},range:u},c,{orient:"bottom",type:(c==null?void 0:c.type)||"linear",label:{flush:!0},__ticksForVTable:d,__vtableChartTheme:f})}if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){let a=e.getDimensionKeyInChartSpec(e.rowHeaderLevelCount,t);rt(a)&&(a=a[0]);const l=(i=e.dataset.collectedValues[a])!==null&&i!==void 0?i:[],h=e.getRowKeysPath(n,t),u=(r=l[h!=null?h:""])!==null&&r!==void 0?r:[],{axisOption:d,isPercent:c,theme:g}=is(n+1,t,"left",e);return(d==null?void 0:d.visible)===!1?void 0:gt({domain:Array.from(u).reverse(),title:{autoRotate:!0}},d,{orient:"left",type:"band",__vtableChartTheme:g})}}else{if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){const a=e.getIndicatorKeyInChartSpec(n,t);let l=null;a==null||a.forEach(p=>{const v=e.getIndicatorInfo(p);v&&(l=v)});const h=Rr("left",n+1,t,n,t,n,t,0,e);if(!h)return;const{range:u,ticks:d,axisOption:c,isZeroAlign:g,theme:f}=h;if(g){const p=Rr("right",n+1,t,n,t,n,t,1,e);if(p){const{range:v}=p,m=es(u,v);m&&(u.min=m.range1[0],u.max=m.range1[1])}}return lt(c==null?void 0:c.min)&&(u.min=c.min,u.min>0&&(c.zero=!1)),lt(c==null?void 0:c.max)&&(u.max=c.max,u.max<0&&(c.zero=!1)),gt({title:{visible:!0,text:l==null?void 0:l.title,autoRotate:!0},range:u},c,{orient:"left",type:(c==null?void 0:c.type)||"linear",label:{flush:!0},__ticksForVTable:d,__vtableChartTheme:f})}if(n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){const a=Rr("right",n-1,t,e.rowHeaderLevelCount-1,t,n,t,1,e);if(!a)return;const{range:l,ticks:h,axisOption:u,isZeroAlign:d,theme:c}=a;if(d){const g=Rr("left",n-1,t,e.rowHeaderLevelCount-1,t,n,t,0,e);if(g){const{range:f}=g,p=es(l,f);p&&(l.min=p.range1[0],l.max=p.range1[1])}}return lt(u==null?void 0:u.min)&&(l.min=u.min,l.min>0&&(u.zero=!1)),lt(u==null?void 0:u.max)&&(l.max=u.max,l.max<0&&(u.zero=!1)),gt({range:l,title:{autoRotate:!0}},u,{orient:"right",type:(u==null?void 0:u.type)||"linear",label:{flush:!0},__ticksForVTable:h,__vtableChartTheme:c})}if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){let a=e.getDimensionKeyInChartSpec(n,e.columnHeaderLevelCount);rt(a)&&(a=a[0]);const l=(o=e.dataset.collectedValues[a])!==null&&o!==void 0?o:[],h=e.getColKeysPath(n,t),u=(s=l==null?void 0:l[h!=null?h:""])!==null&&s!==void 0?s:[],{axisOption:d,isPercent:c,theme:g}=is(n,t-1,"bottom",e);return(d==null?void 0:d.visible)===!1?void 0:gt({domain:Array.from(u)},d,{orient:"bottom",type:"band",__vtableChartTheme:g})}}}function is(n,t,e,i){const r=i.getRawChartSpec(n,t);if(r&&rt(r.axes)){const o=r.axes.find(s=>s.orient===e);if(o){const{seriesIndex:s,seriesId:a}=o;let l;return N(a)&&rt(r.series)?l=(rt(a)?a:[a]).map(h=>r.series.findIndex(u=>u.id===h)):N(s)&&rt(r.series)&&(l=s),{axisOption:o,isPercent:r.percent,isZeroAlign:c1(r,e,i),seriesIndice:l,theme:r.theme}}}return{axisOption:i._table.pivotChartAxes.find(o=>o.orient===e),isPercent:!1,isZeroAlign:c1(r,e,i),theme:r.theme}}function c1(n,t,e){const i=[];let r;if(t==="left"||t==="right"?i.push("left","right"):t!=="top"&&t!=="bottom"||i.push("top","bottom"),r=n&&rt(n.axes)?n.axes:e._table.pivotChartAxes,rt(r)){const o=[];r.forEach(s=>{i.includes(s.orient)&&o.push(s)});for(let s=0;s<o.length;s++){const a=o[s];if(a.sync&&a.sync.zeroAlign&&a.sync.axisId&&o.find(l=>l.id===a.sync.axisId))return!0}}return!1}function If(n,t,e,i,r){var o;if(rt(r)){const h={min:1/0,max:-1/0};for(let u=0;u<r.length;u++){const d=If(n,t,e,i,r[u]);d&&(h.min=Math.min(h.min,d.min),h.max=Math.max(h.max,d.max))}return isFinite(h.min)&&isFinite(h.max)?h:null}let s=t==null?void 0:t[r];if(rt(s)&&(s=s[0]),!s)return null;const a=n[s],l=gt({},(o=a==null?void 0:a[i!=null?i:""])!==null&&o!==void 0?o:{min:0,max:1});return l.positiveMax&&l.positiveMax>l.max&&(l.max=l.positiveMax),l.negativeMin&&l.negativeMin<l.min&&(l.min=l.negativeMin),l.min===l.max&&(l.min>0?l.min=0:l.max=0),l}function Rr(n,t,e,i,r,o,s,a,l){const{axisOption:h,isPercent:u,isZeroAlign:d,seriesIndice:c,theme:g}=is(t,e,n,l);if((h==null?void 0:h.visible)===!1)return;const f=l.getIndicatorKeyInChartSpec(i,r);let p;p=n==="top"||n==="bottom"?l.getColKeysPath(o,s):l.getRowKeysPath(o,s);const v=If(l.dataset.collectedValues,f,d,p,c!=null?c:a);if(!v)return;u&&(v.min=v.min<0?-1:0,v.max=v.max>0?1:0);const{range:m,ticks:C}=o1(v.min,v.max,h,d,l._table.getColWidth(o));return v.min=isNaN(m[0])?0:m[0],v.max=isNaN(m[1])?1:m[1],lt(h==null?void 0:h.min)&&(v.min=h.min,v.min>0&&(h.zero=!1)),lt(h==null?void 0:h.max)&&(v.max=h.max,v.max<0&&(h.zero=!1)),{axisOption:h,isZeroAlign:d,range:v,ticks:C,theme:g}}function dH(n,t,e){if(!e._table.isPivotChart())return!1;if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount||t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return!0}else if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return!0;return!1}function cH(n,t,e){if(!e._table.isPivotChart())return!1;if(e.indicatorsAsCol){if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return!0}else if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount||n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return!0;return!1}function gH(n,t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m;const C=gt({},uu,n);let b=0;C.tick.visible!==!1&&(b=(e=C.tick.width)!==null&&e!==void 0?e:4);let _=0;if(C.label.visible){if(C.type==="band")C.domain.forEach(w=>{var S,D,A,x,B,F,T,R,M,E,P,I,k,H,O,z;C.label.formatMethod&&(w=C.label.formatMethod(w));const{width:j,height:U}=t.measureText(w,{fontSize:(A=(D=(S=C.label)===null||S===void 0?void 0:S.style)===null||D===void 0?void 0:D.fontSize)!==null&&A!==void 0?A:Ko,fontWeight:(F=(B=(x=C.label)===null||x===void 0?void 0:x.style)===null||B===void 0?void 0:B.fontWeight)!==null&&F!==void 0?F:"normal",fontFamily:(M=(R=(T=C.label)===null||T===void 0?void 0:T.style)===null||R===void 0?void 0:R.fontFamily)!==null&&M!==void 0?M:Qr}),W=((P=(E=C.label)===null||E===void 0?void 0:E.style)===null||P===void 0?void 0:P.maxLineWidth)||1/0,V=((H=(k=(I=C.label)===null||I===void 0?void 0:I.style)===null||k===void 0?void 0:k.angle)!==null&&H!==void 0?H:0)+(((z=(O=C.label)===null||O===void 0?void 0:O.style)===null||z===void 0?void 0:z.direction)==="vertical"?90:0);_=Math.max(_,ns(Math.min(j,W),U,V).width)});else{let w;if(rt(n.__ticksForVTable))w=n.__ticksForVTable;else{const S=C.range,D=Math.abs(S.min)>1?Math.round(S.min):S.min,A=Math.abs(S.max)>1?Math.round(S.max):S.max;w=[Pu(D),Pu(A)]}w.forEach(S=>{var D,A,x,B,F,T,R,M,E,P,I,k,H,O,z,j;C.label.formatMethod&&(S=C.label.formatMethod(S));const{width:U,height:W}=t.measureText(S,{fontSize:(x=(A=(D=C.label)===null||D===void 0?void 0:D.style)===null||A===void 0?void 0:A.fontSize)!==null&&x!==void 0?x:Ko,fontWeight:(T=(F=(B=C.label)===null||B===void 0?void 0:B.style)===null||F===void 0?void 0:F.fontWeight)!==null&&T!==void 0?T:"normal",fontFamily:(E=(M=(R=C.label)===null||R===void 0?void 0:R.style)===null||M===void 0?void 0:M.fontFamily)!==null&&E!==void 0?E:Qr}),V=((I=(P=C.label)===null||P===void 0?void 0:P.style)===null||I===void 0?void 0:I.maxLineWidth)||1/0,L=((O=(H=(k=C.label)===null||k===void 0?void 0:k.style)===null||H===void 0?void 0:H.angle)!==null&&O!==void 0?O:0)+(((j=(z=C.label)===null||z===void 0?void 0:z.style)===null||j===void 0?void 0:j.direction)==="vertical"?90:0);_=Math.max(_,ns(Math.min(U,V),W,L).width)})}_+=(i=C.label.space)!==null&&i!==void 0?i:4}let y=0;if(C.title.visible&&C.title.text){const{width:w,height:S}=t.measureText(C.title.text,{fontSize:(s=(o=(r=C.title)===null||r===void 0?void 0:r.style)===null||o===void 0?void 0:o.fontSize)!==null&&s!==void 0?s:Ko,fontWeight:(h=(l=(a=C.title)===null||a===void 0?void 0:a.style)===null||l===void 0?void 0:l.fontWeight)!==null&&h!==void 0?h:"normal",fontFamily:(c=(d=(u=C.title)===null||u===void 0?void 0:u.style)===null||d===void 0?void 0:d.fontFamily)!==null&&c!==void 0?c:Qr}),D=((f=(g=C.label)===null||g===void 0?void 0:g.style)===null||f===void 0?void 0:f.maxLineWidth)||1/0,A=ns(Math.min(w,D),S,(v=(p=C.title)===null||p===void 0?void 0:p.style)===null||v===void 0?void 0:v.angle);y=n.orient!=="left"&&n.orient!=="right"||!C.title.autoRotate?A.width:A.height,y+=(m=C.title.space)!==null&&m!==void 0?m:4}return b+_+y+1}function fH(n,t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m;const C=gt({},uu,n);let b=0;C.tick.visible!==!1&&(b=(e=C.tick.width)!==null&&e!==void 0?e:4);let _=0;if(C.label.visible){if(C.type==="band")C.domain.forEach(w=>{var S,D,A,x,B,F,T,R,M,E,P,I,k,H,O,z;C.label.formatMethod&&(w=C.label.formatMethod(w));const{width:j,height:U}=t.measureText(w,{fontSize:(A=(D=(S=C.label)===null||S===void 0?void 0:S.style)===null||D===void 0?void 0:D.fontSize)!==null&&A!==void 0?A:Ko,fontWeight:(F=(B=(x=C.label)===null||x===void 0?void 0:x.style)===null||B===void 0?void 0:B.fontWeight)!==null&&F!==void 0?F:"normal",fontFamily:(M=(R=(T=C.label)===null||T===void 0?void 0:T.style)===null||R===void 0?void 0:R.fontFamily)!==null&&M!==void 0?M:Qr}),W=((P=(E=C.label)===null||E===void 0?void 0:E.style)===null||P===void 0?void 0:P.maxLineWidth)||1/0,V=((H=(k=(I=C.label)===null||I===void 0?void 0:I.style)===null||k===void 0?void 0:k.angle)!==null&&H!==void 0?H:0)+(((z=(O=C.label)===null||O===void 0?void 0:O.style)===null||z===void 0?void 0:z.direction)==="vertical"?90:0);_=Math.max(_,ns(Math.min(j,W),U,V).height)});else{let w;if(rt(n.__ticksForVTable))w=n.__ticksForVTable;else{const S=C.range,D=Math.abs(S.min)>1?Math.round(S.min):S.min,A=Math.abs(S.max)>1?Math.round(S.max):S.max;w=[Pu(D),Pu(A)]}w.forEach(S=>{var D,A,x,B,F,T,R,M,E,P,I,k,H,O,z,j;C.label.formatMethod&&(S=C.label.formatMethod(S));const{width:U,height:W}=t.measureText(S,{fontSize:(x=(A=(D=C.label)===null||D===void 0?void 0:D.style)===null||A===void 0?void 0:A.fontSize)!==null&&x!==void 0?x:Ko,fontWeight:(T=(F=(B=C.label)===null||B===void 0?void 0:B.style)===null||F===void 0?void 0:F.fontWeight)!==null&&T!==void 0?T:"normal",fontFamily:(E=(M=(R=C.label)===null||R===void 0?void 0:R.style)===null||M===void 0?void 0:M.fontFamily)!==null&&E!==void 0?E:Qr}),V=((I=(P=C.label)===null||P===void 0?void 0:P.style)===null||I===void 0?void 0:I.maxLineWidth)||1/0,L=((O=(H=(k=C.label)===null||k===void 0?void 0:k.style)===null||H===void 0?void 0:H.angle)!==null&&O!==void 0?O:0)+(((j=(z=C.label)===null||z===void 0?void 0:z.style)===null||j===void 0?void 0:j.direction)==="vertical"?90:0);_=Math.max(_,ns(Math.min(U,V),W,L).height)})}_+=(i=C.label.space)!==null&&i!==void 0?i:4}let y=0;if(C.title.visible&&C.title.text){const{width:w,height:S}=t.measureText(C.title.text,{fontSize:(s=(o=(r=C.title)===null||r===void 0?void 0:r.style)===null||o===void 0?void 0:o.fontSize)!==null&&s!==void 0?s:Ko,fontWeight:(h=(l=(a=C.title)===null||a===void 0?void 0:a.style)===null||l===void 0?void 0:l.fontWeight)!==null&&h!==void 0?h:"normal",fontFamily:(c=(d=(u=C.title)===null||u===void 0?void 0:u.style)===null||d===void 0?void 0:d.fontFamily)!==null&&c!==void 0?c:Qr}),D=((f=(g=C.label)===null||g===void 0?void 0:g.style)===null||f===void 0?void 0:f.maxLineWidth)||1/0,A=ns(Math.min(w,D),S,(v=(p=C.title)===null||p===void 0?void 0:p.style)===null||v===void 0?void 0:v.angle);y=n.orient!=="bottom"&&n.orient!=="top"||!C.title.autoRotate?A.height:A.width,y+=(m=C.title.space)!==null&&m!==void 0?m:4}return b+_+y+1}function Pu(n){return typeof n!="number"&&(n=Number(n)),Number(n.toPrecision(1)).toString()}function ns(n,t,e=0){const i=e*Math.PI/180,r=-n/2,o=-t/2,s=n/2,a=-t/2,l=n/2,h=t/2,u=-n/2,d=t/2,c={x:r*Math.cos(i)-o*Math.sin(i),y:r*Math.sin(i)+o*Math.cos(i)},g={x:s*Math.cos(i)-a*Math.sin(i),y:s*Math.sin(i)+a*Math.cos(i)},f={x:l*Math.cos(i)-h*Math.sin(i),y:l*Math.sin(i)+h*Math.cos(i)},p={x:u*Math.cos(i)-d*Math.sin(i),y:u*Math.sin(i)+d*Math.cos(i)},v=Math.min(c.x,g.x,f.x,p.x),m=Math.max(c.x,g.x,f.x,p.x),C=Math.min(c.y,g.y,f.y,p.y);return{width:m-v,height:Math.max(c.y,g.y,f.y,p.y)-C}}const Of=new De({ignoreBuf:!0}),g1=new An({width:0,height:0,textConfig:[]}),f1=new Aa({});function hr(n,t,e,i=!0,r){var o,s;typeof window!="undefined"&&window.performance.now();const a=[],l=[];if(r)for(let d=t;d<=e;d++)a[d]=n.getRowHeight(d);n.defaultHeaderRowHeight,n.defaultHeaderColWidth;const h=n.defaultHeaderRowHeight==="auto"||rt(n.defaultHeaderRowHeight)&&n.defaultHeaderRowHeight.some(d=>d==="auto"),u=n.heightMode==="autoHeight"||n.heightMode==="adaptive";if(u||h){t=t!=null?t:0,e=e!=null?e:n.rowCount-1,(t===0&&e===n.rowCount-1||i)&&n._clearRowRangeHeightsMap();for(let d=t;d<n.columnHeaderLevelCount;d++){let c=0,g=n.colCount-1;if((n.isPivotTable()&&!n.isPivotChart()||n.isPivotChart()&&!n.internalProps.layoutMap.indicatorsAsCol)&&mH(n,d)&&!ze(n,n.rowHeaderLevelCount,d)&&(c=0,g=n.rowHeaderLevelCount),u||n.getDefaultRowHeight(d)==="auto"){const f=Ui(d,c,g,n);l[d]=Math.round(f),n._setRowHeight(d,f)}}for(let d=n.rowCount-n.bottomFrozenRowCount;d<=e;d++)if(u||n.getDefaultRowHeight(d)==="auto"){const c=Ui(d,0,n.colCount-1,n);r?l[d]=Math.round(c):n._setRowHeight(d,c)}if(!(e<n.columnHeaderLevelCount||!u))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol||!pH(n))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol)for(let d=Math.max(t,n.columnHeaderLevelCount);d<=e;d++){let c;c=vH(n,d)?Ui(d,0,n.rowHeaderLevelCount,n):Ui(d,0,n.colCount-1,n),r?l[d]=Math.round(c):n._setRowHeight(d,c)}else for(let d=Math.max(t,n.columnHeaderLevelCount);d<=e;d++){const c=Ui(d,0,n.colCount-1,n);r?l[d]=Math.round(c):n._setRowHeight(d,c)}else{CH(Ui(n.columnHeaderLevelCount,0,n.colCount-1,n),n.columnHeaderLevelCount,n.rowCount-1-n.bottomFrozenRowCount,n,r?l:void 0);for(let d=n.rowCount-n.bottomFrozenRowCount;d<=e;d++){const c=Ui(d,0,n.colCount-1,n);r?l[d]=Math.round(c):n._setRowHeight(d,c)}}}else if(n.rowCount!==n.rowHeightsMap.length&&n.clearRowHeightCache(),r)for(let d=t;d<=e;d++)l[d]=n.getRowHeight(d);if((t===0&&e===n.rowCount-1||i)&&n._clearRowRangeHeightsMap(),n.heightMode==="adaptive"){n._clearRowRangeHeightsMap();const d=n.getRowsHeight(0,n.columnHeaderLevelCount-1),c=n.isPivotChart()?n.getBottomFrozenRowsHeight():0,g=n.tableNoFrameHeight-d-c,f=n.columnHeaderLevelCount,p=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount;let v=0;for(let C=f;C<p;C++)v+=r?l[C]:n.getRowHeight(C);const m=g/v;for(let C=f;C<p;C++){let b;b=C===p-1?g-(r?l.reduce((_,y,w)=>w>=f&&w<=p-2?_+y:_,0):n.getRowsHeight(f,p-2)):Math.round((r?l[C]:n.getRowHeight(C))*m),r?l[C]=b:n._setRowHeight(C,b,!1)}}else if(n.autoFillHeight){n._clearRowRangeHeightsMap();const d=n.tableNoFrameHeight;let c=0,g=0;for(let f=0;f<n.rowCount;f++){const p=r&&(o=l[f])!==null&&o!==void 0?o:n.getRowHeight(f);(f<n.columnHeaderLevelCount||n.isPivotChart()&&f>=n.rowCount-n.bottomFrozenRowCount)&&(g+=p),c+=p}if(n.scenegraph._dealAutoFillHeightOriginRowsHeight=c,c<d&&c-g>0){const f=n.columnHeaderLevelCount,p=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount,v=(d-g)/(c-g);for(let m=f;m<p;m++){let C;C=m===p-1?d-g-(r?l.reduce((b,_,y)=>y>=f&&y<=p-2?b+_:b,0):n.getRowsHeight(f,p-2)):Math.round((r?l[m]:n.getRowHeight(m))*v),r?l[m]=C:n._setRowHeight(m,C,!1)}}}if(r){for(let d=t;d<=e;d++){const c=(s=l[d])!==null&&s!==void 0?s:n.getRowHeight(d);c!==a[d]&&n._setRowHeight(d,c)}if(n.heightMode==="adaptive"||n.autoFillHeight&&n.getAllRowsHeight()<=n.tableNoFrameHeight){for(let d=0;d<=n.columnHeaderLevelCount-1;d++){const c=n.getRowHeight(d);c!==a[d]&&n.scenegraph.updateRowHeight(d,c-a[d],!0)}for(let d=n.rowCount-n.bottomFrozenRowCount;d<=n.rowCount-1;d++){const c=n.getRowHeight(d);c!==a[d]&&n.scenegraph.updateRowHeight(d,c-a[d],!0)}}for(let d=n.scenegraph.proxy.rowStart;d<=n.scenegraph.proxy.rowEnd;d++){const c=n.getRowHeight(d);c!==a[d]&&n.scenegraph.updateRowHeight(d,c-a[d],!0)}}}function Ui(n,t,e,i){var r;let o=0;if(i.isPivotChart()&&n>=i.columnHeaderLevelCount&&n<i.rowCount-i.bottomFrozenRowCount)if(i.internalProps.layoutMap.indicatorsAsCol){const s=i.internalProps.layoutMap.getOptimunHeightForChart(n);if(s>0)return s}else{const s=i.getDefaultRowHeight(n);if(lt(s))return s}for(let s=t;s<=e;s++){const a=bH(s,n,i);if(a&&(o=Math.max(a.height,o),!a.renderDefault))continue;if(i.isPivotChart()){const u=i.internalProps.layoutMap,d=kf(s,n,u);if(d){const c=fH(d,i);if(typeof c=="number"){o=Math.max(c,o);continue}}}if(i.isPivotChart()&&(i.isLeftFrozenColumn(s)&&i.isBottomFrozenRow(n)||i.isRightFrozenColumn(s)&&i.isBottomFrozenRow(n)))continue;const l=i.isHeader(s,n)?(r=i._getHeaderLayoutMap(s,n))===null||r===void 0?void 0:r.headerType:i.getBodyColumnType(s,n);if(l!=="text"&&l!=="link"&&l!=="progressbar"&&l!=="checkbox"){const u=i.getDefaultRowHeight(n);o=Math.max(o,lt(u)?u:i.defaultRowHeight);continue}const h=_H(s,n,l,i);o=Math.max(h,o)}return o}function pH(n){var t,e,i;const{layoutMap:r}=n.internalProps,o=n.columnHeaderLevelCount;if((n.internalProps.autoWrapText||n.isPivotChart())&&(n.options.heightMode==="autoHeight"||n.options.heightMode==="adaptive"))return!1;for(let s=0;s<n.colCount;s++){const a=r.getBody(s,o);if(typeof a.style=="function"||typeof a.icon=="function"||!((t=a.define)===null||t===void 0)&&t.customRender||!((e=a.define)===null||e===void 0)&&e.customLayout||typeof((i=a.define)===null||i===void 0?void 0:i.icon)=="function")return!1;const l=n._getCellStyle(s,o);if(typeof l.padding=="function"||typeof l.fontSize=="function"||typeof l.lineHeight=="function"||l.autoWrapText===!0)return!1}return!0}function vH(n,t){var e,i,r;const{layoutMap:o}=n.internalProps;if(n.internalProps.autoWrapText&&(n.options.heightMode==="autoHeight"||n.options.heightMode==="adaptive"))return!1;const s=o.getBody(n.rowHeaderLevelCount,t);if(typeof s.style=="function"||typeof s.icon=="function"||!((e=s.define)===null||e===void 0)&&e.customRender||!((i=s.define)===null||i===void 0)&&i.customLayout||typeof((r=s.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const a=n._getCellStyle(n.rowHeaderLevelCount,t);return typeof a.padding!="function"&&typeof a.fontSize!="function"&&typeof a.lineHeight!="function"&&a.autoWrapText!==!0}function mH(n,t){var e,i,r;const{layoutMap:o}=n.internalProps;if(n.internalProps.autoWrapText&&(n.options.heightMode==="autoHeight"||n.options.heightMode==="adaptive"))return!1;const s=o.getHeader(n.rowHeaderLevelCount,t);if(typeof s.style=="function"||typeof s.icons=="function"||!((e=s.define)===null||e===void 0)&&e.headerCustomRender||!((i=s.define)===null||i===void 0)&&i.headerCustomLayout||typeof((r=s.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const a=n._getCellStyle(n.rowHeaderLevelCount,t);return typeof a.padding!="function"&&typeof a.fontSize!="function"&&typeof a.lineHeight!="function"&&a.autoWrapText!==!0}function CH(n,t,e,i,r){for(let o=t;o<=e;o++)r?r[o]=n:i._setRowHeight(o,n)}function bH(n,t,e){var i,r,o,s;const a=e.getCustomRender(n,t),l=e.getCustomLayout(n,t);if(a||l){let h=1,u=0,d=!1,c=!1;if(e.isHeader(n,t)||!((i=e.getBodyColumnDefine(n,t))===null||i===void 0)&&i.mergeCell||e.hasCustomMerge()){const f=e.getCellRange(n,t);h=f.end.row-f.start.row+1}const g={col:n,row:t,dataValue:e.getCellOriginValue(n,t),value:e.getCellValue(n,t)||"",rect:yH(n,t,e),table:e};if(l){const f=l(g);f.rootContainer instanceof Di?(f.rootContainer=Da(f.rootContainer),Fu(f.rootContainer,e.getColWidth(n),0),f.rootContainer.setStage(e.scenegraph.stage),u=(r=f.rootContainer.AABBBounds.height())!==null&&r!==void 0?r:0,d=f.renderDefault,c=f.enableCellPadding):u=0}else if(typeof a=="function"){const f=a(g);u=(o=f==null?void 0:f.expectedHeight)!==null&&o!==void 0?o:0,d=f==null?void 0:f.renderDefault}else u=(s=a==null?void 0:a.expectedHeight)!==null&&s!==void 0?s:0,d=a==null?void 0:a.renderDefault;if(c){const f=e._getCellStyle(n,t),p=$t(Ct("padding",f,n,t,e));u+=p[0]+p[2]}return{height:u/h,renderDefault:d}}}function _H(n,t,e,i){var r,o;let s=0;const a=i.getCellValue(n,t),l=i._getCellStyle(n,t);let h=0,u=0;const d=[];let c=0;const g=[];let f=0,p=!1;if(i.getCellLocation(n,t)!=="body")p=!0;else{const F=i.getBodyColumnDefine(n,t);p=!!(F!=null&&F.icon)||!!(F!=null&&F.tree)}if(p){const F=i.getCellIcons(n,t);F==null||F.forEach(T=>{var R,M,E,P,I,k,H,O,z,j;T.positionType!==Qt.absoluteRight&&T.positionType!==Qt.inlineFront&&T.positionType!==Qt.inlineEnd?(u+=((R=T.width)!==null&&R!==void 0?R:0)+((M=T.marginLeft)!==null&&M!==void 0?M:0)+((E=T.marginRight)!==null&&E!==void 0?E:0),h=Math.max(h,(P=T.height)!==null&&P!==void 0?P:0)):T.positionType===Qt.inlineFront?(d.push(T),c=Math.max(c,((I=T.height)!==null&&I!==void 0?I:0)+((k=T.marginLeft)!==null&&k!==void 0?k:0)+((H=T.marginRight)!==null&&H!==void 0?H:0))):T.positionType===Qt.inlineEnd&&(g.push(T),f=Math.max(f,((O=T.height)!==null&&O!==void 0?O:0)+((z=T.marginLeft)!==null&&z!==void 0?z:0)+((j=T.marginRight)!==null&&j!==void 0?j:0)))})}let v=1,m=n;if(i.isHeader(n,t)||!((r=i.getBodyColumnDefine(n,t))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const F=i.getCellRange(n,t);v=F.end.row-F.start.row+1,n=F.start.col,m=F.end.col}const C=$t(Ct("padding",l,n,t,i)),b=Ct("fontSize",l,n,t,i),_=Ct("fontStyle",l,n,t,i),y=Ct("fontWeight",l,n,t,i),w=(o=Ct("lineHeight",l,n,t,i))!==null&&o!==void 0?o:b,S=Ct("fontFamily",l,n,t,i),D=Ct("autoWrapText",l,n,t,i);let A;A=e==="checkbox"&&ye(a)?a.text:a;const x=Vg(A).split(`
`)||[],B=i.getColsWidth(n,m);if(e==="checkbox"){const F=Ct("size",l,n,t,i);if(D){const T=Ct("spaceBetweenTextAndIcon",l,n,t,i),R=B-(C[1]+C[3])-u-F-T;f1.setAttributes({text:{maxLineWidth:R,text:x,fontSize:b,fontStyle:_,fontWeight:y,fontFamily:S,lineHeight:w,wordBreak:"break-word"},icon:{width:Math.floor(F/1.4),height:Math.floor(F/1.4)},box:{width:F,height:F},spaceBetweenTextAndIcon:T}),f1.render(),s=Of.AABBBounds.height()}else s=Math.max(F,x.length*w)}else if(d.length||g.length){const F=Object.assign({text:a==null?void 0:a.toString(),fontFamily:S,fontSize:b,fontStyle:_,fontWeight:y,lineHeight:w});F.textBaseline="middle";const T=[...d.map(R=>Ru(R)),F,...g.map(R=>Ru(R))];g1.setAttributes({width:B-(C[1]+C[3])-u,height:0,textConfig:T}),s=g1.AABBBounds.height()}else if(D){const F=B-(C[1]+C[3])-u;Of.setAttributes({maxLineWidth:F,text:x,fontSize:b,fontStyle:_,fontWeight:y,fontFamily:S,lineHeight:w,wordBreak:"break-word",whiteSpace:x.length!==1||D?"normal":"no-wrap"}),s=Of.AABBBounds.height()||(typeof w=="number"?w:b)}else s=x.length*w;return(Math.max(s,h)+C[0]+C[2])/v}function yH(n,t,e){return{left:0,top:0,right:e.getColWidth(n),bottom:e.getRowHeight(t),width:e.getColWidth(n),height:0}}function ro(n,t){if(!t||!t.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:e,mergeEndCol:i,mergeStartRow:r,mergeEndRow:o,col:s,row:a}=n,{colStart:l,colEnd:h,rowStart:u,rowEnd:d,bodyLeftCol:c,bodyRightCol:g,bodyTopRow:f,bodyBottomRow:p}=t.proxy;let v=e,m=i,C=r,b=o;return s>=c&&s<=g&&(v=Math.max(n.mergeStartCol,l),m=Math.min(n.mergeEndCol,h)),a>=f&&a<=p&&(C=Math.max(n.mergeStartRow,u),b=Math.min(n.mergeEndRow,d)),{colStart:v,colEnd:m,rowStart:C,rowEnd:b}}function p1(n,t,e,i){i||n.table._setRowHeight(t,n.table.getRowHeight(t)+e,!0);for(let s=0;s<n.table.colCount;s++){const a=n.getCell(s,t);if(a.role==="empty")continue;const l=ze(n.table,s,t);l&&l.start.col!==s||(v1(n,a,s,t,a.attribute.height+e,e,n.table.isHeader(s,t)),n.updateCellContentWhileResize(s,t))}let r=0,o=0;t<n.table.columnHeaderLevelCount?(r=t+1,o=n.table.columnHeaderLevelCount-1):t>=n.table.rowCount-n.table.bottomFrozenRowCount?(r=t+1,o=n.table.rowCount-1):(r=t+1,o=Math.min(n.proxy.rowEnd,n.table.rowCount-n.table.bottomFrozenRowCount-1));for(let s=r;s<=o;s++)for(let a=0;a<n.table.colCount;a++){const l=n.getCell(a,s);l.role==="cell"&&l.setAttribute("y",l.attribute.y+e)}}function v1(n,t,e,i,r,o,s){t&&m1(n,t,e,i,r,o,s)}function K8(n,t,e,i,r,o,s){m1(n,t,e,i,r,0,s)}function m1(n,t,e,i,r,o,s){var a,l;if(t.attribute.height===r&&!t.needUpdateHeight)return;t.needUpdateHeight=!1,t.setAttribute("height",r);const h=n.table.isHeader(e,i)?n.table._getHeaderLayoutMap(e,i).headerType:n.table.getBodyColumnType(e,i);if(h==="progressbar"){const u=n.table.getBodyColumnDefine(e,i),d=n.table._getCellStyle(e,i),c=n.table.getCellValue(e,i),g=n.table.getCellOriginValue(e,i),f=$t(Ct("padding",d,e,i,n.table)),p=Mf(u,d,t.attribute.width,c,g,e,i,f,n.table),v=t.getChildByName("progress-bar");t.insertBefore(p,v),t.removeChild(v),v.removeAllChild(),v.release()}else if(h==="sparkline"){t.removeAllChild();const u=n.table._getCellStyle(e,i),d=$t(Ct("padding",u,e,i,n.table));Rf(t,t.parent,t.attribute.x,t.attribute.y,e,i,t.attribute.width,t.attribute.height,d,n.table,io(u,n.table,e,i,Ct).theme)}else if(h==="image"||h==="video")Sa(t,e,i,n.table);else if(((a=t.firstChild)===null||a===void 0?void 0:a.name)==="axis")(l=t.firstChild)===null||l===void 0||l.originAxis.resize(t.attribute.width,t.attribute.height);else{let u=!0;const d=t.getChildByName("custom-container");if(d){let c;if(d.removeAllChild(),t.removeChild(d),!n1(e,i,t,n.table)){let g,f;if(n.table.getCellLocation(e,i)!=="body"){const p=n.table.getHeaderDefine(e,i);g=p==null?void 0:p.headerCustomRender,f=p==null?void 0:p.headerCustomLayout}else{const p=n.table.getBodyColumnDefine(e,i);g=(p==null?void 0:p.customRender)||n.table.customRender,f=p==null?void 0:p.customLayout}if(f||g){const p=n.table._getCellStyle(e,i),v=$t(Ct("padding",p,e,i,n.table)),m=Zo(f,g,e,i,t.attribute.width,t.attribute.height,!1,n.table.heightMode==="autoHeight",v,n.table);c=m.elementsGroup,u=m.renderDefault}t.childrenCount>0&&c?t.insertBefore(c,t.firstChild):c&&t.appendChild(c)}}if(u){const c=n.table._getCellStyle(e,i);wH(t,r,o,n.table.heightMode==="autoHeight",$t(c.padding),c.textAlign,c.textBaseline,n.table)}}}function wH(n,t,e,i,r,o,s,a){if(r1(n)){t=0;for(let c=n.mergeStartRow;c<=n.mergeEndRow;c++)t+=a.getRowHeight(c);const{colStart:l,colEnd:h,rowStart:u,rowEnd:d}=ro(n,a.scenegraph);for(let c=l;c<=h;c++)for(let g=u;g<=d;g++){const f=a.scenegraph.getCell(c,g);f.forEachChildren(C=>{C.setAttributes({dx:0,dy:0})}),Pf(f,t,e,i,r,o,s);const p=a.getRowHeight(g),v=a.getColWidth(c);f.contentHeight=t;const{widthChange:m}=Eu(f,v,p,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},a);m&&(f.needUpdateWidth=!0)}}else Pf(n,t,e,i,r,o,s)}function DH(n,t,e,i){i||n.table._setColWidth(t,n.table.getColWidth(t)+e,!0);const r=n.table.heightMode==="autoHeight",o=n.getColGroup(t,!0),s=n.getColGroupInRightTopCorner(t);o&&!s&&rs(o,e,r,"col-corner",n),s&&rs(s,e,r,"right-top",n);const a=n.getColGroup(t);a&&rs(a,e,r,"row-body",n);const l=n.getColGroupInLeftBottomCorner(t);l&&rs(l,e,r,"left-bottom",n);const h=n.getColGroupInBottom(t);h&&rs(h,e,r,"bottom",n);const u=n.getColGroupInRightBottomCorner(t);u&&rs(u,e,r,"right-bottom",n),t<n.frozenColCount?(n.cornerHeaderGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),n.rowHeaderGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)})):(n.colHeaderGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),n.bodyGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)})),l&&n.leftBottomCornerGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),h&&n.bottomFrozenGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),u&&n.rightBottomCornerGroup.forEachChildrenSkipChild((d,c)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)})}function rs(n,t,e,i,r){var o,s,a,l,h,u,d;let c=!1;const g=(o=n==null?void 0:n.attribute.width)!==null&&o!==void 0?o:0;if(n==null||n.setAttribute("width",g+t),n==null||n.forEachChildren((f,p)=>{if(SH(r,f,f.col,f.row,g,g+t,t,i!=="row-body"||f.col<r.table.rowHeaderLevelCount,e,r.table.internalProps.autoWrapText)){const v=ze(r.table,f.col,f.row);if(v&&v.end.row-v.start.row)for(let m=v.start.row;m<=v.end.row;m++)C1(r,m);else C1(r,f.row);c=!0}}),c){let f,p,v,m=0;for(let C=0;C<r.table.colCount;C++){if(i==="col-corner"?(v=0,f=r.getColGroup(C,!0),p=(s=r.colHeaderGroup.attribute.height)!==null&&s!==void 0?s:0):i==="row-body"?(v=r.table.frozenRowCount,f=r.getColGroup(C,!1),p=(a=r.bodyGroup.attribute.height)!==null&&a!==void 0?a:0):i==="bottom"?(v=r.table.rowCount-r.table.bottomFrozenRowCount,f=r.getColGroupInBottom(C),p=(l=r.bottomFrozenGroup.attribute.height)!==null&&l!==void 0?l:0):i==="left-bottom"?(v=r.table.rowCount-r.table.bottomFrozenRowCount,f=r.getColGroupInLeftBottomCorner(C),p=(h=r.leftBottomCornerGroup.attribute.height)!==null&&h!==void 0?h:0):i==="right-top"?(v=0,f=r.getColGroupInRightTopCorner(C),p=(u=r.rightTopCornerGroup.attribute.height)!==null&&u!==void 0?u:0):i==="right-bottom"&&(v=r.table.rowCount-r.table.bottomFrozenRowCount,f=r.getColGroupInRightBottomCorner(C),p=(d=r.rightBottomCornerGroup.attribute.height)!==null&&d!==void 0?d:0),!f)continue;let b=0;f.forEachChildren(_=>{var y;_.setAttribute("y",b),b+=(y=r.table.getRowHeight(_.row))!==null&&y!==void 0?y:0}),m=b}r.updateContainerHeight(v,m-p);for(let C=0;C<r.table.frozenColCount;C++){const b=r.getColGroupInLeftBottomCorner(C);let _=0;b==null||b.forEachChildren(y=>{y.setAttribute("y",_),_+=r.table.getRowHeight(y.row)})}for(let C=r.table.colCount-r.table.rightFrozenColCount;C<r.table.colCount;C++){const b=r.getColGroupInRightBottomCorner(C);let _=0;b==null||b.forEachChildren(y=>{y.setAttribute("y",_),_+=r.table.getRowHeight(y.row)})}for(let C=r.table.frozenColCount;C<r.table.colCount-r.table.rightFrozenColCount;C++){const b=r.getColGroupInBottom(C);let _=0;b==null||b.forEachChildren(y=>{y.setAttribute("y",_),_+=r.table.getRowHeight(y.row)})}}}function SH(n,t,e,i,r,o,s,a,l,h){var u,d,c;if(t.attribute.width===o&&!t.needUpdateWidth)return!1;t.needUpdateWidth=!1,t.setAttribute("width",o);const g=t;if(!g)return!1;const f=n.table.isHeader(e,i)?n.table._getHeaderLayoutMap(e,i).headerType:n.table.getBodyColumnType(e,i);let p=!1;if(f==="progressbar"){const v=n.table.getBodyColumnDefine(e,i),m=n.table._getCellStyle(e,i),C=n.table.getCellValue(e,i),b=n.table.getCellOriginValue(e,i),_=$t(Ct("padding",m,e,i,n.table)),y=Mf(v,m,g.attribute.width,C,b,e,i,_,n.table),w=g.getChildByName("progress-bar");g.insertBefore(y,w),g.removeChild(w),w.removeAllChild(),w.release()}else if(f==="sparkline"){g.removeAllChild();const v=n.table._getCellStyle(e,i),m=$t(Ct("padding",v,e,i,n.table));Rf(g,g.parent,g.attribute.x,g.attribute.y,e,i,g.attribute.width,g.attribute.height,m,n.table,io(v,n.table,e,i,Ct).theme)}else if(f==="image"||f==="video")Sa(g,e,i,n.table);else if(((u=g.firstChild)===null||u===void 0?void 0:u.name)==="axis"){const v=n.table.internalProps.layoutMap.getAxisConfigInPivotChart(e,i),m=n.table._getCellStyle(e,i),C=$t(Ct("padding",m,e,i,n.table));if(v){const b=new wf(v,g.attribute.width,g.attribute.height,C,n.table);g.clear(),g.appendChild(b.component),b.overlap()}}else if(((d=t.firstChild)===null||d===void 0?void 0:d.name)==="axis")(c=t.firstChild)===null||c===void 0||c.originAxis.resize(t.attribute.width,t.attribute.height);else{let v=!0;const m=t.getChildByName("custom-container");if(m){let C;if(m.removeAllChild(),t.removeChild(m),!n1(e,i,t,n.table)){let b,_;if(n.table.getCellLocation(e,i)!=="body"){const y=n.table.getHeaderDefine(e,i);b=y==null?void 0:y.headerCustomRender,_=y==null?void 0:y.headerCustomLayout}else{const y=n.table.getBodyColumnDefine(e,i);b=(y==null?void 0:y.customRender)||n.table.customRender,_=y==null?void 0:y.customLayout}if(_||b){const y=n.table._getCellStyle(e,i),w=$t(Ct("padding",y,e,i,n.table)),S=Zo(_,b,e,i,g.attribute.width,g.attribute.height,!1,n.table.heightMode==="autoHeight",w,n.table);C=S.elementsGroup,v=S.renderDefault,p=!0}t.childrenCount>0&&C?t.insertBefore(C,t.firstChild):C&&t.appendChild(C)}}if(v){const C=n.table._getCellStyle(e,i);p=AH(g,o,s,l,$t(C.padding),C.textAlign,C.textBaseline,n.table)}}return!(!l||!h)&&p}function AH(n,t,e,i,r,o,s,a){if(r1(n)){t=0;let l=!1;for(let f=n.mergeStartCol;f<=n.mergeEndCol;f++)t+=a.getColWidth(f);let h=0;for(let f=n.mergeStartRow;f<=n.mergeEndRow;f++)h+=a.getRowHeight(f);const{colStart:u,colEnd:d,rowStart:c,rowEnd:g}=ro(n,a.scenegraph);for(let f=u;f<=d;f++)for(let p=c;p<=g;p++){const v=a.scenegraph.getCell(f,p);v.forEachChildren(w=>{w.setAttributes({dx:0,dy:0})});const m=Ef(v,t,h,e,i,r,o,s,a.scenegraph),C=lr(v.col,v.row,a);if(C){const w=v.getChildByName("text"),S=v.getChildByName("expand")||v.getChildByName("collapse");(S==null?void 0:S.role)!=="icon-left"&&w&&w.setAttribute("dx",C)}const b=a.getRowHeight(p),_=a.getColWidth(f);v.contentWidth=t;const{heightChange:y}=Eu(v,_,b,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},a);y&&(v.needUpdateHeight=!0),l=l||m}return l}return Ef(n,t,a.getRowHeight(n.row),e,i,r,o,s,a.scenegraph)}function C1(n,t){const e=Math.round(Ui(t,0,n.table.colCount-1,n.table));n.table._setRowHeight(t,e,!0);for(let i=0;i<n.table.colCount;i++){const r=e,o=n.highPerformanceGetCell(i,t);if(o.role==="empty")return;v1(n,o,i,t,r,r-o.attribute.height,n.table.isHeader(i,t))}}let Hu=!1;try{Hu=typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"}catch(n){Hu=!1}function xH(n,t,e){let i,r,o,s,a,l,h=0,u=!1,d=!1,c=!0;const g=!t&&t!==0&&Hu;if(typeof n!="function")throw new TypeError("Expected a function");function f(_){const y=i,w=r;return i=r=void 0,h=_,s=n.apply(w,y),s}function p(_,y){return g?(cancelAnimationFrame(a),requestAnimationFrame(_)):setTimeout(_,y)}function v(_){const y=_-l;return l===void 0||y>=t||y<0||d&&_-h>=o}function m(){const _=Date.now();if(v(_))return C(_);a=p(m,function(y){const w=y-h,S=t-(y-l);return d?Math.min(S,o-w):S}(_))}function C(_){return a=void 0,c&&i?f(_):(i=r=void 0,s)}function b(..._){const y=Date.now(),w=v(y);if(i=_,r=this,l=y,w){if(a===void 0)return function(S){return h=S,a=p(m,t),u?f(S):s}(l);if(d)return a=p(m,t),f(l)}return a===void 0&&(a=p(m,t)),s}return t=+t||0,ye(e)&&(u=!!e.leading,d="maxWait"in e,d&&(o=Math.max(we(e.maxWait)?e.maxWait:0,t)),c="trailing"in e?!!e.trailing:c),b.cancel=function(){a!==void 0&&function(_){if(g)return cancelAnimationFrame(_);clearTimeout(_)}(a),h=0,i=l=r=a=void 0},b.flush=function(){return a===void 0?s:C(Date.now())},b.pending=function(){return a!==void 0},b}Hu=!1;var b1=xH;function BH(n,t,e){let i=!0,r=!0;if(typeof n!="function")throw new TypeError("Expected a function");return ye(e)&&(i="leading"in e?!!e.leading:i,r="trailing"in e?!!e.trailing:r),b1(n,t,{leading:i,trailing:r,maxWait:t})}var FH=BH,oo=(n,t,e)=>{let[i,r]=n;r<i&&(i=n[1],r=n[0]);const o=r-i;return o>=e-t?[t,e]:(i=Math.min(Math.max(i,t),e-o),[i,i+o])};function _1(){Dn(),Yr()}const y1={debounce:b1,throttle:FH};_1();class os extends Nn{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},os.defaultAttributes,t)),this.name="scrollbar",this._onRailPointerDown=i=>{const{viewX:r,viewY:o}=i,{direction:s,width:a,height:l,range:h}=this.attribute,u=this._sliderSize,[d,c]=this._getScrollRange();let g;if(s==="vertical"){const f=o-this._viewPosition.y,p=Xn(f-u/2,d,c);g=f/l,this._slider.setAttribute("y",p,!0)}else{const f=r-this._viewPosition.x,p=Xn(f-u/2,d,c);g=f/a,this._slider.setAttribute("x",p,!0)}this.setScrollRange([g-(h[1]-h[0])/2,g+(h[1]-h[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{i.stopPropagation();const{direction:r}=this.attribute;this._prePos=r==="horizontal"?i.clientX:i.clientY,this._dispatchEvent("scrollDown",{pos:this._prePos,event:i}),Ie.env==="browser"?(Ie.addEventListener("pointermove",this._onSliderPointerMove,{capture:!0}),Ie.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=i=>{const{direction:r}=this.attribute;let o,s,a=0;const{width:l,height:h}=this._getSliderRenderBounds();return r==="vertical"?(s=i.clientY,a=s-this._prePos,o=a/h):(s=i.clientX,a=s-this._prePos,o=a/l),[s,o]},this._onSliderPointerMove=y1[this.attribute.delayType](i=>{i.stopPropagation();const r=this.getScrollRange(),[o,s]=this._computeScrollValue(i);this.setScrollRange([r[0]+s,r[1]+s],!0),this._prePos=o},this.attribute.delayTime),this._onSliderPointerUp=i=>{i.preventDefault();const{realTime:r=!0,range:o,limitRange:s=[0,1]}=this.attribute,a=this.getScrollRange(),[l,h]=this._computeScrollValue(i),u=[a[0]+h,a[1]+h];this._dispatchEvent("scrollUp",{pre:o,value:oo(u,s[0],s[1])}),Ie.env==="browser"?(Ie.removeEventListener("pointermove",this._onSliderPointerMove,{capture:!0}),Ie.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(t,e=!0){const{direction:i="horizontal",limitRange:r=[0,1],range:o,realTime:s=!0}=this.attribute,a=oo(t,r[0],r[1]);if(e){const l=this._getSliderPos(a);if(this._slider){const h=l[1]-l[0];this._sliderSize=h,i==="horizontal"?this._slider.setAttributes({x:l[0],width:h},!0):this._slider.setAttributes({y:l[0],height:h},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=a,s&&this._dispatchEvent("scrollDrag",{pre:o,value:a})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",y1[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:r,limitRange:o=[0,1],railStyle:s,sliderStyle:a,padding:l=2}=this.attribute,h=this.createOrUpdateChild("scrollbar-container",{},"group"),u=h.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},s),"rect");this._rail=u;const d=this._getSliderRenderBounds(),c=this._getSliderPos(oo(r,o[0],o[1])),g=c[1]-c[0];let f;this._sliderSize=g,f=t==="horizontal"?{x:c[0],y:d.y1,width:g,height:d.height}:{x:d.x1,y:c[0],width:d.width,height:g};const p=h.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},f),{cornerRadius:this._getDefaultSliderCornerRadius()}),a),{boundsPadding:Wn(l),pickMode:"imprecise"}),"rect");this._slider=p,this._container=h;const v=this._container.AABBBounds;this._viewPosition={x:v.x1,y:v.y1}}_getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[r,o,s,a]=Wn(i),l={x1:a,y1:r,x2:t-o,y2:e-s,width:Math.max(0,t-(a+o)),height:Math.max(0,e-(r+s))};return this._sliderRenderBounds=l,l}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:i,height:r}=this._getSliderRenderBounds();return t==="horizontal"?r:i}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:r,x1:o,y1:s}=this._getSliderRenderBounds();return e==="horizontal"?[i*t[0]+o,i*t[1]+o]:[r*t[0]+s,r*t[1]+s]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,r]=oo(t,0,1),{width:o,height:s,x1:a,y1:l}=this._getSliderRenderBounds(),h=this._sliderSize;return e==="horizontal"?oo([a+i*o,a+r*o],a,o-h):oo([l+i*s,l+r*s],l,s-h)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}}os.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};var Ki;(function(n){n.dropDown="dropDown",n.contextmenu="contextmenu",n.custom="custom"})(Ki||(Ki={}));const pe={fontSize:12,fontFamily:"Arial,sans-serif",color:"#000",highlightColor:"#2E68CF",hoverBgColor:"#EEE",lineHeight:30,bgColor:"#FFF",cornerRadius:4,borderWidth:.5,borderColor:"#CCC",menuPadding:6,menuItemPadding:9,maxLineWidth:200};class TH{constructor(t){this._table=t,this._menuInstance=new jt({x:0,y:0,fill:pe.bgColor,stroke:pe.borderColor,cornerRadius:pe.cornerRadius,lineWidth:pe.borderWidth}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:Ki.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,r,o,s){if(o===Ki.dropDown&&this.checkDropDownMenuChange(i,r)){const a=this.getMenuInfo(i,r,o);if(!a)return;const{menuInfo:l,highlightIndex:h}=a;this.updateMenuInfo(i,r,o,l,h),this.updateMenuInstance(l,h)}else if(o===Ki.contextmenu&&this.checkContextMenuChange(t,e)){const a=this.getMenuInfo(i,r,o);if(!a)return;const{menuInfo:l,highlightIndex:h}=a;this.updateMenuInfo(i,r,o,l,h),this.updateMenuInstance(l,h)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,r,o){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=r,this._menuInfo.highlightIndex=o}checkDropDownMenuChange(t,e){const{type:i,col:r,row:o}=this._menuInfo;return i!==Ki.dropDown||t!==r||e!==o}checkContextMenuChange(t,e){var i;const{type:r,menuInfo:o}=this._menuInfo;return r!==Ki.contextmenu||o!==((i=this._table.internalProps.menu)===null||i===void 0?void 0:i.contextMenuItems)}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=pe.menuPadding;const r=pe.menuPadding;let o=0;t.forEach((s,a)=>{var l,h;const u=e===a;let d,c;typeof s=="string"?c=s:typeof s=="object"&&(c=s.text,d=u?s.selectedIcon:s.icon);const g=new jt({y:i,x:r,height:pe.lineHeight,fill:pe.bgColor});g.role="menu-item",this._menuInstance.appendChild(g),g.stateProxy=p=>p==="hover"?{fill:pe.hoverBgColor}:{fill:pe.bgColor},g.addEventListener("pointerenter",p=>{g.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()}),g.addEventListener("pointerleave",p=>{g.removeState("hover",!1),this._table.scenegraph.updateNextFrame()});const f=new De({x:pe.menuItemPadding,y:pe.menuItemPadding,fill:u?pe.highlightColor:pe.color,text:c,textBaseline:"top",fontSize:pe.fontSize,fontFamily:pe.fontFamily,pickable:!1,maxLineWidth:pe.maxLineWidth,ellipsis:"\u2026"});if(g.addChild(f),d){f.AABBBounds.height();const p=(l=d.width)!==null&&l!==void 0?l:16,v=(h=d.height)!==null&&h!==void 0?h:16,m=new no({x:pe.menuItemPadding,y:(pe.lineHeight-v)/2,width:p,height:v,image:d.svg,pickable:!1});m.role="menu-icon",g.insertBefore(m,f),f.setAttribute("x",p+pe.menuItemPadding)}o=Math.max(g.AABBBounds.width(),o),i+=pe.lineHeight}),this._menuInstance.setAttributes({width:o+2*pe.menuItemPadding+2*pe.menuPadding,height:i+pe.menuPadding}),this._menuInstance.forEachChildren(s=>{s.setAttribute("width",o+2*pe.menuItemPadding)})}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===Ki.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=Ki.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){var r;if(i===Ki.dropDown){const{dropDownMenu:o=this._table.globalDropDownMenu,pivotInfo:s}=this._table._getHeaderLayoutMap(t,e);let a=-1;if(Array.isArray(o)){for(let l=0;l<o.length;l++)if(this._table._dropDownMenuIsHighlight(t,e,l)){a=l;break}}return{menuInfo:o,highlightIndex:a}}if(i===Ki.contextmenu){const o=(r=this._table.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems;let s;if(Array.isArray(o))s=o;else if(typeof o=="function"){const{field:a}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);s=o(a,e,t)}return{menuInfo:s,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",t=>{const{target:e}=t;if(e&&e.role==="menu-item"){const i=this.getEventInfo(e),r=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),o=Object.assign(i,r);o.event=t.nativeEvent,this._table.fireListeners(Q.DROPDOWN_MENU_CLICK,o)}})}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren((s,a)=>s===t&&(i=a-1,!0));const r=typeof this._menuInfo.menuInfo[i]=="string"?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,o=typeof this._menuInfo.menuInfo[i]=="string"?r:this._menuInfo.menuInfo[i].menuKey||r;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:r,menuKey:o}}get bounds(){return this._menuInstance.globalAABBBounds}}const zf=ar();class MH{constructor(){const t=zf.drillDown;this.icon=new no({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,r,o,s){if(!t||r&&o)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void s.updateNextFrame();const a=zf.drillDown,l=zf.drillUp;this.icon.setAttributes({x:e,y:i,image:r?a.svg:l.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),s.updateNextFrame()}}class RH{constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,r=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=ra({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=Sn({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=Ge({visible:!1,pickable:!1,fill:r,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const r=this.table.getCellLocation(t,e),o=ze(this.table,t,e);o&&(t=o.start.col,e=o.start.row);let s=0,a=0,l=0,h=0,u=0,d=0,c=0,g=0,f=Math.PI;const p=[];r==="columnHeader"?(s=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,a=this.table.getRowsHeight(0,this.table.frozenRowCount-1),h=this.table.tableNoFrameHeight,l=o?this.table.getColsWidth(o.start.col,o.end.col):this.table.getColWidth(t),u=s-i,c=s+l,g=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):r==="rowHeader"&&(a=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,s=this.table.getColsWidth(0,this.table.frozenColCount-1),l=this.table.tableNoFrameWidth,h=o?this.table.getRowsHeight(o.start.row,o.end.row):this.table.getRowHeight(e),d=a-i,c=2,g=a+h,f=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:s-u,y:a-d,width:l,height:h,dx:u,dy:d}),this.columnMoverLine.setAttributes({x:c,y:g,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:c,y:g,angle:f})}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,r){typeof t=="number"&&typeof e=="number"?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):typeof i=="number"&&typeof r=="number"&&(this.columnMoverLabel.setAttribute("y",r),this.columnMoverLine.setAttribute("y",r),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function Wf(n,t,e){if(e)return t.tableNoFrameWidth-t.getColsWidth(n,t.colCount-1);let i=t.getColsWidth(0,n);return n>=t.frozenColCount&&(i-=t.scrollLeft),i}class EH{constructor(t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,v;this.table=t;const m=this.table.theme;this.createScrollBar();const C=(e=m.columnResize)===null||e===void 0?void 0:e.lineColor,b=(i=m.columnResize)===null||i===void 0?void 0:i.lineWidth,_=(r=m.columnResize)===null||r===void 0?void 0:r.bgColor,y=(o=m.columnResize)===null||o===void 0?void 0:o.width,w=(s=m.columnResize)===null||s===void 0?void 0:s.labelColor,S=(a=m.columnResize)===null||a===void 0?void 0:a.labelFontSize,D=(l=m.columnResize)===null||l===void 0?void 0:l.labelFontFamily,A=(h=m.columnResize)===null||h===void 0?void 0:h.labelBackgroundFill,x=(u=m.columnResize)===null||u===void 0?void 0:u.labelBackgroundCornerRadius;this.columnResizeLine=Sn({visible:!1,pickable:!1,stroke:C,lineWidth:b,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=Sn({visible:!1,pickable:!1,stroke:_,lineWidth:y,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const B=IC({visible:!1,pickable:!1,x:0,y:0,fontSize:S,fill:w,fontFamily:D,text:"",textBaseline:"top",dx:16,dy:-S/2}),F=Ge({visible:!1,pickable:!1,fill:A,x:0,y:0,width:5*S*.8,height:S+8,cornerRadius:x,dx:12,dy:-S/2-4});this.columnResizeLabel=sc({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(F),this.columnResizeLabel.appendChild(B),this.cellMover=new RH(this.table);const T=(c=(d=m.frozenColumnLine)===null||d===void 0?void 0:d.shadow)===null||c===void 0?void 0:c.width,R=(f=(g=m.frozenColumnLine)===null||g===void 0?void 0:g.shadow)===null||f===void 0?void 0:f.startColor,M=(v=(p=m.frozenColumnLine)===null||p===void 0?void 0:p.shadow)===null||v===void 0?void 0:v.endColor;this.frozenShadowLine=Ge({visible:!0,pickable:!1,x:0,y:0,width:T,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:R,offset:0},{color:M,offset:1}]}}),this.menu=new TH(this.table),this.drillIcon=new MH}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),this.table.theme.scrollStyle.hoverOn?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){var t,e,i;const r=this.table.theme,o=(t=r.scrollStyle)===null||t===void 0?void 0:t.scrollRailColor,s=(e=r.scrollStyle)===null||e===void 0?void 0:e.scrollSliderColor,a=(i=r.scrollStyle)===null||i===void 0?void 0:i.width;this.hScrollBar=new os({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:a,padding:0,railStyle:{fill:o},sliderStyle:{fill:s},range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new os({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:a,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:0,railStyle:{fill:o},sliderStyle:{fill:s},range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){var t,e;const i=this.table.stateManager.scroll.horizontalBarPos,r=this.table.stateManager.scroll.verticalBarPos,o=this.table.theme,s=(t=o.scrollStyle)===null||t===void 0?void 0:t.width,a=(e=o.scrollStyle)===null||e===void 0?void 0:e.visible,l=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),h=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),u=this.table.getAllRowsHeight(),d=this.table.getAllColsWidth(),c=this.table.getFrozenRowsHeight(),g=this.table.getFrozenColsWidth(),f=this.table.getBottomFrozenRowsHeight(),p=this.table.getRightFrozenColsWidth();if(d>l){const v=Math.min(h,u),m=Math.max(.05,(l-g)/(d-g));this.hScrollBar.setAttributes({x:g+(this.table.theme.scrollStyle.hoverOn?0:this.table.scenegraph.tableGroup.attribute.x),y:v-(this.table.theme.scrollStyle.hoverOn?s:-this.table.scenegraph.tableGroup.attribute.y),width:l-g-p,range:[0,m],visible:a==="always"});const C=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:C.x1,y:C.y1},a==="always"&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(u>h){const v=Math.min(l,d),m=Math.max(.05,(h-c)/(u-c));this.vScrollBar.setAttributes({x:v-(this.table.theme.scrollStyle.hoverOn?s:-this.table.scenegraph.tableGroup.attribute.x),y:c+(this.table.theme.scrollStyle.hoverOn?0:this.table.scenegraph.tableGroup.attribute.y),height:h-c-f,range:[0,m],visible:a==="always"});const C=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:C.x1,y:C.y1},a==="always"&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(i),this.table.stateManager.setScrollTop(r)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const r=Wf(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`)}updateResizeCol(t,e,i){const r=Wf(t,this.table,i);this.columnResizeLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeLabel.setAttributes({x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`)}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,r){this.cellMover.update(t,e,i,r)}setFrozenColumnShadow(t,e){if(t<0)this.frozenShadowLine.setAttributes({visible:!1});else{const i=Wf(t,this.table,e);this.frozenShadowLine.setAttributes({visible:!0,x:i,height:this.table.getRowsHeight(0,this.table.rowCount-1)})}}hideVerticalScrollBar(){const t=this.table.theme.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){const t=this.table.theme.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){const t=this.table.theme.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){const t=this.table.theme.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateStyle(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C;const b=this.table.theme,_=(t=b.scrollStyle)===null||t===void 0?void 0:t.scrollRailColor,y=(e=b.scrollStyle)===null||e===void 0?void 0:e.scrollSliderColor,w=(i=b.scrollStyle)===null||i===void 0?void 0:i.width;this.hScrollBar.setAttributes({height:w,railStyle:{fill:_},sliderStyle:{fill:y}}),this.vScrollBar.setAttributes({width:w,railStyle:{fill:_},sliderStyle:{fill:y}});const S=(r=b.columnResize)===null||r===void 0?void 0:r.lineColor,D=(o=b.columnResize)===null||o===void 0?void 0:o.lineWidth,A=(s=b.columnResize)===null||s===void 0?void 0:s.bgColor,x=(a=b.columnResize)===null||a===void 0?void 0:a.width;this.columnResizeLine.setAttributes({stroke:S,lineWidth:D}),this.columnResizeBgLine=Sn({stroke:A,lineWidth:x});const B=(l=b.columnResize)===null||l===void 0?void 0:l.labelColor,F=(h=b.columnResize)===null||h===void 0?void 0:h.labelFontSize,T=(u=b.columnResize)===null||u===void 0?void 0:u.labelFontFamily,R=(d=b.columnResize)===null||d===void 0?void 0:d.labelBackgroundFill,M=(c=b.columnResize)===null||c===void 0?void 0:c.labelBackgroundCornerRadius;this.columnResizeLabel.lastChild.setAttributes({fontSize:F,fill:B,fontFamily:T,dy:-F/2}),this.columnResizeLabel.firstChild.setAttributes({fill:R,width:5*F*.8,height:F+8,cornerRadius:M,dy:-F/2-4});const E=(f=(g=b.frozenColumnLine)===null||g===void 0?void 0:g.shadow)===null||f===void 0?void 0:f.width,P=(v=(p=b.frozenColumnLine)===null||p===void 0?void 0:p.shadow)===null||v===void 0?void 0:v.startColor,I=(C=(m=b.frozenColumnLine)===null||m===void 0?void 0:m.shadow)===null||C===void 0?void 0:C.endColor;this.frozenShadowLine.setAttributes({width:E,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:P,offset:0},{color:I,offset:1}]}}),this.cellMover.updateStyle()}}function ss(n,t,e,i,r){var o,s,a,l;if(!t)return;const h=e==="table",{shadowBlur:u,shadowOffsetX:d,shadowOffsetY:c,shadowColor:g,cornerRadius:f,borderColor:p,borderLineWidth:v,borderLineDash:m}=t;let C=!1;const b={},_={pickable:!1};u&&h&&(_.shadowBlur=u,_.shadowOffsetX=d,_.shadowOffsetY=c,_.shadowColor=g,_.stroke=!0,_.stroke=g,_.lineWidth=1,C=!0),v&&(_.stroke=!0,_.fill=!1,_.stroke=Nf(p,i),_.lineWidth=v,m&&(_.lineDash=m),_.lineCap="square"),Array.isArray(p)&&(_.strokeArrayColor=$t(p)),Array.isArray(v)&&(_.strokeArrayWidth=$t(v),_.lineWidth=1),f&&(_.cornerRadius=f,b.cornerRadius=f);const y=_.strokeArrayWidth?_.strokeArrayWidth[0]:(o=_.lineWidth)!==null&&o!==void 0?o:0,w=_.strokeArrayWidth?_.strokeArrayWidth[1]:(s=_.lineWidth)!==null&&s!==void 0?s:0,S=_.strokeArrayWidth?_.strokeArrayWidth[2]:(a=_.lineWidth)!==null&&a!==void 0?a:0,D=_.strokeArrayWidth?_.strokeArrayWidth[3]:(l=_.lineWidth)!==null&&l!==void 0?l:0;if(n.setAttributes(b),!r&&_.stroke)if(_.x=D/2,_.y=y/2,_.pickable=!1,h){let A,x;if(t.innerBorder?(_.x=n.attribute.x+D/2,_.y=n.attribute.y+y/2,_.width=n.attribute.width-D/2-w/2,_.height=n.attribute.height-y/2-S/2):(_.x=n.attribute.x-D/2,_.y=n.attribute.y-y/2,_.width=n.attribute.width+D/2+w/2,_.height=n.attribute.height+y/2+S/2),C){_.fill="white",_.notAdjustPos=!0,x=sc(_),x.name="table-border-rect",A=Ge({x:D/2,y:y/2,width:n.attribute.width,height:n.attribute.height,fill:"red",cornerRadius:n.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),x.addChild(A);const B=Ge({width:1,height:1,fill:"transparent",pickable:!1});x.addChild(B)}else x=Ge(_),x.name="table-border-rect";t.innerBorder&&!C?n.parent.insertAfter(x,n):n.parent.insertBefore(x,n),n.border=x}else{_.width=n.attribute.width-D/2-w/2,_.height=n.attribute.height-y/2-S/2;const A=Ge(_);A.name="border-rect",n.addChild(A),n.border=A}}function w1(n,t,e){var i;const{borderColor:r}=t;(i=n.border)===null||i===void 0||i.setAttribute("stroke",Nf(r,e))}function Nf(n,t){let e=!0;return t&&!rt(n)?e=t.map(i=>!!i&&n):t?e=t:t||rt(n)?rt(n)&&(e=!0):e=n,e}function Lu(n){var t,e,i,r;if(!n.border)return;const o=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[0]:(t=n.border.attribute.lineWidth)!==null&&t!==void 0?t:0,s=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[1]:(e=n.border.attribute.lineWidth)!==null&&e!==void 0?e:0,a=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[2]:(i=n.border.attribute.lineWidth)!==null&&i!==void 0?i:0,l=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[3]:(r=n.border.attribute.lineWidth)!==null&&r!==void 0?r:0;n.border.setAttributes({width:n.attribute.width-l/2-s/2,height:n.attribute.height-o/2-a/2}),n.border.type==="group"&&n.border.firstChild.setAttributes({width:n.attribute.width,height:n.attribute.height})}function PH(n){if(!n.theme.frameStyle.cornerRadius)return;const t=n.theme.frameStyle.cornerRadius,{cornerHeaderGroup:e,colHeaderGroup:i,rowHeaderGroup:r,bodyGroup:o,rightTopCornerGroup:s,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:u}=n.scenegraph;e.setAttribute("cornerRadius",0),i.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),u.setAttribute("cornerRadius",0),e.attribute.width>0&&e.attribute.height>0?Ci(e,[t,0,0,0]):i.attribute.height>0?Ci(i,[t,0,0,0]):r.attribute.width>0?Ci(r,[t,0,0,0]):Ci(o,[t,0,0,0]),a.attribute.width>0&&a.attribute.height>0?Ci(a,[0,0,0,t]):u.attribute.height>0?Ci(u,[0,0,0,t]):r.attribute.width>0?Ci(r,[0,0,0,t]):Ci(o,[0,0,0,t]),s.attribute.width>0&&s.attribute.height>0?Ci(s,[0,t,0,0]):i.attribute.height>0?Ci(i,[0,t,0,0]):h.attribute.width>0?Ci(h,[0,t,0,0]):Ci(o,[0,t,0,0]),l.attribute.width>0&&l.attribute.height>0?Ci(l,[0,0,t,0]):h.attribute.width>0?Ci(h,[0,0,t,0]):u.attribute.height>0?Ci(u,[0,0,t,0]):Ci(o,[0,0,t,0])}function Ci(n,t){n.setAttribute("cornerRadius",t),n.border&&n.border.setAttribute("cornerRadius",t)}const $8=null,jf=[],Vf=[];let Gf=5,Uf=!1;function D1(n){N(n)&&(Gf=n)}function HH(){return Uf}function S1(n){var t,e,i,r,o,s;const{axes:a,dataId:l,data:h,spec:u}=n.attribute,{chartInstance:d}=n,c=n.getViewBox();if(c.x2<=c.x1&&(c.x2=c.x1+1),c.y2<=c.y1&&(c.y2=c.y1+1),a==null||a.forEach((g,f)=>{var p,v,m,C;g.type==="band"?d.updateModelSpec({type:"axes",index:f},{domain:g.domain.slice(0)},!0):d.updateModelSpecSync({type:"axes",index:f},{min:(v=(p=g.range)===null||p===void 0?void 0:p.min)!==null&&v!==void 0?v:0,max:(C=(m=g.range)===null||m===void 0?void 0:m.max)!==null&&C!==void 0?C:0},!0)}),d.updateViewBox({x1:c.x1-n.getRootNode().table.scrollLeft,x2:c.x2-n.getRootNode().table.scrollLeft,y1:c.y1-n.getRootNode().table.scrollTop,y2:c.y2-n.getRootNode().table.scrollTop},!1,!1),(e=(t=n.getRootNode().table.internalProps.layoutMap)===null||t===void 0?void 0:t.updateDataStateToActiveChartInstance)===null||e===void 0||e.call(t,d),typeof l=="string")d.updateDataSync(l,h!=null?h:[]);else{const g=[];for(const f in l){const p=l[f],v=u.series.find(m=>{var C;return((C=m==null?void 0:m.data)===null||C===void 0?void 0:C.id)===f});g.push({id:f,values:p?(i=h==null?void 0:h.filter(m=>m.hasOwnProperty(p)))!==null&&i!==void 0?i:[]:h!=null?h:[],fields:(r=v==null?void 0:v.data)===null||r===void 0?void 0:r.fields}),d.updateFullDataSync||d.updateDataSync(f,p?(o=h==null?void 0:h.filter(m=>m.hasOwnProperty(p)))!==null&&o!==void 0?o:[]:h!=null?h:[])}(s=d.updateFullDataSync)===null||s===void 0||s.call(d,g)}LH(d.getStage(),n)}function A1(n){Uf=!0,Vf.length>0?requestAnimationFrame(()=>{const t=Vf.splice(0,Gf);jf.splice(0,Gf),t.forEach(e=>{S1(e),e.addUpdateBoundTag()}),n.render(),A1(n)}):Uf=!1}const jn=2e3;function LH(n,t){var e;const{viewWidth:i,viewHeight:r}=n;if(i<jn&&r<jn)return t.cacheCanvas=n.toCanvas(),void(t.isShareChartSpec||((e=t.chartInstance)===null||e===void 0||e.release(),t.chartInstance=null,t.setAttribute("chartInstance",null)));const o=Math.ceil(r/jn),s=Math.ceil(i/jn),a=[];for(let l=0;l<o;l++)for(let h=0;h<s;h++){const u=h*jn,d=l*jn,c=u+jn>i?i:u+jn,g=d+jn>r?r:d+jn,f=c-u,p=g-d,v=new Ji;v.setValue(u,d,c,g);const m=n.toCanvas(!1,v);a.push({canvas:m,x:u,y:d,width:f,height:p})}t.cacheCanvas=a}var kH=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};const IH=Symbol.for("ChartRender"),X8=Symbol.for("ChartRenderContribution");let Ba=class{constructor(){this.numberType=J_}drawShape(n,t,e,i,r,o,s,a){var l,h,u,d;const c=X(n,o==null?void 0:o.theme).group,{dataId:g,data:f,spec:p}=n.attribute,{width:v=c.width,height:m=c.height}=(n.getViewBox(),n.attribute),{active:C,cacheCanvas:b,activeChartInstance:_}=n;if(!C&&b)rt(b)?b.forEach(y=>{const{x:w,y:S,width:D,height:A,canvas:x}=y;t.drawImage(x,w,S,D,A)}):t.drawImage(b,e,i,v,m);else if(_)if(typeof g=="string")_.updateDataSync(g,f!=null?f:[]);else{const y=[];for(const w in g){const S=g[w],D=p.series.find(A=>{var x;return((x=A==null?void 0:A.data)===null||x===void 0?void 0:x.id)===w});y.push({id:w,values:S?(l=f==null?void 0:f.filter(A=>A.hasOwnProperty(S)))!==null&&l!==void 0?l:[]:f!=null?f:[],fields:(h=D==null?void 0:D.data)===null||h===void 0?void 0:h.fields}),_.updateFullDataSync||_.updateDataSync(w,S?(u=f==null?void 0:f.filter(A=>A.hasOwnProperty(S)))!==null&&u!==void 0?u:[]:f!=null?f:[])}(d=_.updateFullDataSync)===null||d===void 0||d.call(_,y)}else n.getRootNode().table.internalProps.renderChartAsync?(jf.indexOf(`${n.parent.col}+${n.parent.row}`)===-1&&(jf.push(`${n.parent.col}+${n.parent.row}`),Vf.push(n)),HH()||A1(n.getRootNode().table)):S1(n)}draw(n,t,e,i){const{context:r}=e;if(!r)return;const{clip:o}=n.attribute;o?r.save():r.highPerformanceSave(),r.transformFromMatrix(n.transMatrix,!0),r.beginPath(),i.skipDraw?this.drawShape(n,r,0,0,e,i,()=>!1,()=>!1):this.drawShape(n,r,0,0,e),o?r.restore():r.highPerformanceRestore()}};Ba=kH([Z()],Ba);var x1=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let ku=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{shape:g}=n.attribute;if(g==="circle"){const{width:f=l.width,height:p=l.height}=n.attribute;t.beginPath(),t.arc(e+f/2,i+p/2,Math.min(f,p)/2,0,2*Math.PI),t.closePath(),t.save(),t.clip()}}};ku=x1([Z()],ku);let Iu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{shape:g}=n.attribute;g==="circle"&&t.restore()}};Iu=x1([Z()],Iu);function OH(n,t){var e,i,r,o,s,a,l,h,u,d,c;let g,f;if(n.role==="cell"&&N(n.mergeStartCol)&&N(n.mergeStartRow)&&N(n.mergeEndCol)&&N(n.mergeEndRow)){const{colStart:v,colEnd:m,rowStart:C,rowEnd:b}=ro(n,t.scenegraph);for(let _=v;_<=m;_++)for(let y=C;y<=b;y++){const w=B1(t.stateManager,_,y,n);!w||g&&w!=="cellBgColor"||(g=w)}}else n.role==="cell"&&(g=B1(t.stateManager,n.col,n.row,n));if(!g)return;const p=t.internalProps.layoutMap;return p.isCornerHeader(n.col,n.row)?f=((e=t.theme.cornerHeaderStyle)===null||e===void 0?void 0:e.hover)||((i=t.theme.headerStyle)===null||i===void 0?void 0:i.hover):p.isColumnHeader(n.col,n.row)?f=(r=t.theme.headerStyle)===null||r===void 0?void 0:r.hover:p.isRowHeader(n.col,n.row)?f=(o=t.theme.rowHeaderStyle)===null||o===void 0?void 0:o.hover:p.isBottomFrozenRow(n.col,n.row)?f=((s=t.theme.bottomFrozenStyle)===null||s===void 0?void 0:s.hover)||(t.isListTable()?(a=t.theme.bodyStyle)===null||a===void 0?void 0:a.hover:(l=t.theme.headerStyle)===null||l===void 0?void 0:l.hover):p.isRightFrozenColumn(n.col,n.row)?f=((h=t.theme.rightFrozenStyle)===null||h===void 0?void 0:h.hover)||(t.isListTable()?(u=t.theme.bodyStyle)===null||u===void 0?void 0:u.hover:(d=t.theme.rowHeaderStyle)===null||d===void 0?void 0:d.hover):t.isHeader(n.col,n.row)||(f=(c=t.theme.bodyStyle)===null||c===void 0?void 0:c.hover),Ct(g,f,n.col,n.row,t)}function B1(n,t,e,i){var r;const{highlightScope:o,disableHeader:s,cellPos:a}=n.hover,l=n.table,h=l.isHeader(t,e);if(h&&s)return;let u;if(o===de.single&&a.col===t&&a.row===e?u="cellBgColor":o===de.column&&a.col===t?u=a.col===t&&a.row===e?"cellBgColor":"inlineColumnBgColor":o===de.row&&a.row===e?u=a.col===t&&a.row===e?"cellBgColor":"inlineRowBgColor":o===de.cross&&(a.col===t&&a.row===e?u="cellBgColor":a.col===t?u="inlineColumnBgColor":a.row===e&&(u="inlineRowBgColor")),u){let d;if(h){const c=l.getHeaderDefine(t,e);d=c==null?void 0:c.disableHeaderHover,i.firstChild&&i.firstChild.name==="axis"&&(!((r=l.options.hover)===null||r===void 0)&&r.disableAxisHover)&&(d=!0)}else{const c=l.getBodyColumnDefine(t,e);d=c==null?void 0:c.disableHover}d&&(u=void 0)}return u}var Vn=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Ou=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{stroke:g=l.stroke,strokeArrayWidth:f=l.strokeArrayWidth,strokeArrayColor:p=l.strokeArrayColor}=n.attribute;g&&(Array.isArray(f)||Array.isArray(p))&&(c.doStroke=!1)}};Ou=Vn([Z()],Ou);let zu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){const{width:c=l.width,height:g=l.height,stroke:f=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth,lineWidth:m=l.lineWidth,strokeColor:C=l.stroke}=n.attribute;if(!f||!Array.isArray(v)&&m===0)return;let b,_;if(Array.isArray(p)||Array.isArray(v)){if(typeof m=="number"&&1&m||Array.isArray(v)&&v.some(y=>1&y)){const y=n.stage.table;let w=0,S=0;if(y.theme.cellBorderClipDirection==="bottom-right"){if(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"){const x=n.col,B=n.row;y&&x===y.colCount-1&&(w=1),y&&B===y.rowCount-1&&(S=1)}}else e=Math.floor(e)+.5,i=Math.floor(i)+.5;const{width:D,height:A}=Kf(n,Math.ceil(c+w),Math.ceil(g+S));b=D,_=A}else b=Math.ceil(c),_=Math.ceil(g);F1(n,t,e,i,l,f,v||m,p||C,b,_)}}};zu=Vn([Z()],zu);function zH(n){if(!Array.isArray(n))return{isSplitDraw:!1,width:n};let t;for(let e=0;e<n.length;e++){const i=n[e];if(i)if(t){if(i!==t)return{isSplitDraw:!0}}else t=i}return{isSplitDraw:!1,width:t}}function F1(n,t,e,i,r,o,s,a,l,h,u,d){const c=zH(s),g=!Array.isArray(s),f=!Array.isArray(o),p=Array.isArray(d),v=Array.isArray(a)||c.isSplitDraw;t.setStrokeStyle(n,n.attribute,e,i,r);let m=!1;t.getLineDash().length&&(m=!0),t.beginPath(),t.moveTo(e,i),(f||o[0])&&(g||s[0])?(p&&Array.isArray(d[0])?(t.moveTo(e+l*d[0][0],i),t.lineTo(e+l*(d[0][1]-d[0][0]),i),t.moveTo(e+l,i)):(t.moveTo(e,i),t.lineTo(e+l,i)),(v||m)&&(a&&a[0]?t.strokeStyle=a[0]:t.strokeStyle="transparent",g||(t.lineWidth=s[0]),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.stroke(),t.beginPath(),t.moveTo(e+l,i))):t.moveTo(e+l,i),(f||o[1])&&(g||s[1])?(p&&Array.isArray(d[1])?(t.moveTo(e+l,i+h*d[1][0]),t.lineTo(e+l,i+h*(d[1][1]-d[1][0])),t.moveTo(e+l,i+h)):(t.moveTo(e+l,i),t.lineTo(e+l,i+h)),(v||m)&&(a&&a[1]?t.strokeStyle=a[1]:t.strokeStyle="transparent",g||(t.lineWidth=s[1]),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.stroke(),t.beginPath(),t.moveTo(e+l,i+h))):t.moveTo(e+l,i+h),(f||o[2])&&(g||s[2])?(p&&Array.isArray(d[2])?(t.moveTo(e+l*d[2][0],i+h),t.lineTo(e+l*(d[2][1]-d[2][0]),i+h),t.moveTo(e,i+h)):(t.moveTo(e,i+h),t.lineTo(e+l,i+h)),(v||m)&&(a&&a[2]?t.strokeStyle=a[2]:t.strokeStyle="transparent",g||(t.lineWidth=s[2]),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.stroke(),t.beginPath(),t.moveTo(e,i+h))):t.moveTo(e,i+h),(f||o[3])&&(g||s[3])?(p&&Array.isArray(d[3])?(t.moveTo(e,i+h*d[3][0]),t.lineTo(e,i+h*(d[3][1]-d[3][0])),t.moveTo(e,i)):(t.moveTo(e,i),t.lineTo(e,i+h)),(v||m)&&(a&&a[3]?t.strokeStyle=a[3]:t.strokeStyle="transparent",g||(t.lineWidth=s[3]),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.stroke(),t.beginPath(),t.moveTo(e,i))):t.moveTo(e,i),v||m||(!g&&c.width&&(t.lineWidth=c.width),t.stroke()),t.lineDashOffset=0}let Wu=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{lineDash:g=l.lineDash,stroke:f=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth}=n.attribute;f&&Array.isArray(g)&&g.length&&!Array.isArray(p)&&!Array.isArray(v)&&(c.doStroke=!1)}};Wu=Vn([Z()],Wu);let Nu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){const{lineDash:c=l.lineDash,stroke:g=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:p=l.strokeArrayWidth,lineWidth:v=l.lineWidth}=n.attribute;if(!g||!Array.isArray(c)||!c.length||Array.isArray(f)||Array.isArray(p))return;let m,C,{width:b=l.width,height:_=l.height}=n.attribute;if(b=Math.ceil(b),_=Math.ceil(_),1&v){const y=n.stage.table;let w=0,S=0;if(y.theme.cellBorderClipDirection==="bottom-right"){if(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"){const x=n.col,B=n.row;y&&x===y.colCount-1&&(w=1),y&&B===y.rowCount-1&&(S=1)}}else e=Math.floor(e)+.5,i=Math.floor(i)+.5;const{width:D,height:A}=Kf(n,Math.ceil(b+w),Math.ceil(_+S));m=D,C=A}else m=Math.ceil(b),C=Math.ceil(_);t.setStrokeStyle(n,n.attribute,e,i,l),t.beginPath(),t.moveTo(e,i),t.lineTo(e+m,i),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.stroke(),t.beginPath(),t.moveTo(e+m,i),t.lineTo(e+m,i+C),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.stroke(),t.beginPath(),t.moveTo(e,i+C),t.lineTo(e+m,i+C),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.stroke(),t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+C),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.stroke()}};Nu=Vn([Z()],Nu);let ju=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{lineWidth:g=l.lineWidth,stroke:f=l.stroke,lineDash:p=l.lineDash,strokeArrayWidth:v=l.strokeArrayWidth,strokeArrayColor:m=l.strokeArrayColor,notAdjustPos:C}=n.attribute;C!==!0&&f&&Array.isArray(p)&&!p.length&&!Array.isArray(m)&&!Array.isArray(v)&&1&g&&(c.doStroke=!1)}};ju=Vn([Z()],ju);let Vu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){const{lineWidth:c=l.lineWidth,stroke:g=l.stroke,lineDash:f=l.lineDash,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:v=l.strokeArrayColor,notAdjustPos:m,cornerRadius:C=l.cornerRadius}=n.attribute,{width:b=l.width,height:_=l.height}=n.attribute;if(m!==!0&&g&&Array.isArray(f)&&!f.length&&!Array.isArray(v)&&!Array.isArray(p)&&1&c){const{width:y,height:w}=Kf(n,Math.ceil(b),Math.ceil(_));t.beginPath();const S=n.stage.table;let D=0,A=0;if(S.theme.cellBorderClipDirection==="bottom-right"){if(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"){const x=n.col,B=n.row;S&&x===S.colCount-1&&(D=1),S&&B===S.rowCount-1&&(A=1)}}else e=Math.floor(e)+.5,i=Math.floor(i)+.5;C?Qn(t,e,i,y+D,w+A,C):t.rect(e,i,y,w),t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke()}}};Vu=Vn([Z()],Vu);let Gu=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){if(n.role==="cell"){const g=n.stage.table;if(g.stateManager.interactionState!==St.scrolling){const f=OH(n,g);f&&(n.attribute._vtableHoverFill=f)}}}};Gu=Vn([Z()],Gu);let Uu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){if(n.attribute._vtableHoverFill&&!u){if(s){const c=n.attribute.fill;n.attribute.fill=n.attribute._vtableHoverFill,t.setCommonStyle(n,n.attribute,e,i,l),t.fill(),n.attribute.fill=c,n.attribute._vtableHoverFill=void 0}}}};Uu=Vn([Z()],Uu);let Ku=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p,v,m,C;const b=n.stage.table;if(n.role==="body"){const _=-((g=n.attribute.x)!==null&&g!==void 0?g:0)+b.getFrozenColsWidth(),y=-((f=n.attribute.y)!==null&&f!==void 0?f:0)+b.getFrozenRowsHeight(),w=n.parent.attribute.width-b.getFrozenColsWidth()-b.getRightFrozenColsWidth(),S=n.parent.attribute.height-b.getFrozenRowsHeight()-b.getBottomFrozenRowsHeight();t.beginPath(),t.rect(_,y,w,S)}else if(n.role==="row-header"){const y=-((p=n.attribute.y)!==null&&p!==void 0?p:0)+b.getFrozenRowsHeight(),w=b.getFrozenColsWidth(),S=n.parent.attribute.height-b.getFrozenRowsHeight()-b.getBottomFrozenRowsHeight();t.beginPath(),t.rect(0,y,w,S)}else if(n.role==="col-header"){const _=-((v=n.attribute.x)!==null&&v!==void 0?v:0)+b.getFrozenColsWidth(),y=0,w=n.parent.attribute.width-b.getFrozenColsWidth()-b.getRightFrozenColsWidth(),S=b.getFrozenRowsHeight();t.beginPath(),t.rect(_,y,w,S)}else if(n.role==="right-frozen"){const y=-((m=n.attribute.y)!==null&&m!==void 0?m:0)+b.getFrozenRowsHeight(),w=b.getRightFrozenColsWidth(),S=n.parent.attribute.height-b.getFrozenRowsHeight()-b.getBottomFrozenRowsHeight();t.beginPath(),t.rect(0,y,w,S)}else if(n.role==="bottom-frozen"){const _=-((C=n.attribute.x)!==null&&C!==void 0?C:0)+b.getFrozenColsWidth(),y=0,w=n.parent.attribute.width-b.getFrozenColsWidth()-b.getRightFrozenColsWidth(),S=b.getBottomFrozenRowsHeight();t.beginPath(),t.rect(_,y,w,S)}else if(n.role==="corner-header"){const w=b.getFrozenColsWidth(),S=b.getFrozenRowsHeight();t.beginPath(),t.rect(0,0,w,S)}else if(n.role==="corner-right-top-header"){const w=b.getRightFrozenColsWidth(),S=b.getFrozenRowsHeight();t.beginPath(),t.rect(0,0,w,S)}else if(n.role==="corner-right-bottom-header"){const w=b.getRightFrozenColsWidth(),S=b.getBottomFrozenRowsHeight();t.beginPath(),t.rect(0,0,w,S)}else if(n.role==="corner-left-bottom-header"){const w=b.getFrozenColsWidth(),S=b.getBottomFrozenRowsHeight();t.beginPath(),t.rect(0,0,w,S)}}};Ku=Vn([Z()],Ku);let Yu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){n.role}};Yu=Vn([Z()],Yu);function Kf(n,t,e){const i=n.stage.table;if(n.role==="cell"){let r=n.col,o=n.row;const s=ze(i,r,o);s&&(r=s.end.col,o=s.end.row),(i&&r===i.colCount-1||i&&r===i.frozenColCount-1&&i.scrollLeft)&&(t-=1),(i&&o===i.rowCount-1||i&&o===i.frozenRowCount-1&&i.scrollTop)&&(e-=1)}else n.role==="corner-frozen"&&(i.scrollLeft&&(t-=1),i.scrollTop&&(e-=1));return{width:t,height:e}}var T1=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Fa=class{constructor(){this.time=Nt.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{stroke:g=l.stroke,strokeArrayWidth:f=l.strokeArrayWidth,strokeArrayColor:p=l.strokeArrayColor}=n.attribute;g&&(Array.isArray(g)||Array.isArray(f)||Array.isArray(p))&&(c.doStroke=!1)}};Fa=T1([Z()],Fa);let Ta=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){const{width:c=l.width,height:g=l.height,stroke:f=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth,lineWidth:m=l.lineWidth,strokeColor:C=l.stroke}=n.attribute;f&&(Array.isArray(v)||m!==0)&&(Array.isArray(f)||Array.isArray(p)||Array.isArray(v))&&(n.name!=="border-rect"&&n.name!=="table-border-rect"&&(typeof m=="number"&&1&m||Array.isArray(v)&&v.some(y=>1&y))&&(e=Math.floor(e)+.5,i=Math.floor(i)+.5),F1(n,t,e,i,l,f,v||m,p||C,Math.ceil(c+0),Math.ceil(g+0)))}};Ta=T1([Z()],Ta);function q8(n){return n%1==0}var WH=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Ma,$u=class{constructor(){this.order=1,this.interceptors=[new NH]}afterDrawItem(n,t,e,i,r){for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(n,t,e,i,r))return!0;return!1}beforeDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(n,t,e,i,r))return!0;return!1}};$u=WH([Z()],$u);class NH{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.type==="image"&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){const{image:s}=t.attribute;if(!s||!t.resources||t.resources.get(s).state!=="loading")return!1;if(!Ma){const g=ar(),f=g.loading_pic.svg,p=g.loading_pic.width,v=g.loading_pic.height;Ma=yh({width:p,height:v,image:f})}const{image:a}=Ma.attribute;if(!s||!Ma.resources)return!1;const l=Ma.resources.get(a);if(l.state!=="success")return!1;const{context:h}=i;h.highPerformanceSave(),t.parent&&h.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&h.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const u=t.AABBBounds,{width:d,height:c}=Tu(l.data.width,l.data.height,u.width(),u.height());return h.drawImage(l.data,u.x1+(u.width()-d)/2,u.y1+(u.height()-c)/2,d,c),h.highPerformanceRestore(),!0}}let Yf="";const jH=new ht((n,t,e,i)=>{e($n)?i($n).to(M1).inSingletonScope():n($n).to(M1).inSingletonScope()}),VH=new ht((n,t,e,i)=>{e($n)?i($n).to(fo).inSingletonScope():n($n).to(fo).inSingletonScope()});var GH=jH;const Z8=(n,t,e)=>new TextMeasure(Object.assign({defaultFontParams:{fontFamily:DefaultTextStyle.fontFamily,fontSize:DefaultTextStyle.fontSize},getTextBounds:e?void 0:getTextBounds,specialCharSet:`{}()//&-/: .,@%'"~\u2026=${TextMeasure.ALPHABET_CHAR_SET}${TextMeasure.ALPHABET_CHAR_SET.toUpperCase()}0123456789${Yf}`},t!=null?t:{}),n),$f=new Map;function Xu(n,t,e,i="normal"){const r=`${n}-${t}-${e}-${i}`,o=$f.get(r);if(o)return o;const s=(a={fontSize:n,fontFamily:e,fontWeight:t,fontStyle:i},new di(Object.assign({defaultFontParams:{fontFamily:tn.fontFamily,fontSize:tn.fontSize},getTextBounds:h?void 0:wg,specialCharSet:`{}()//&-/: .,@%'"~\u2026=${di.ALPHABET_CHAR_SET}${di.ALPHABET_CHAR_SET.toUpperCase()}0123456789${Yf}`},l!=null?l:{}),a));var a,l,h;return $f.set(r,s),s}class M1 extends fo{measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e;return Xu(i,o,r,s).measure(t).width}measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e;return Xu(i,o,r,s).measure(t)}}class UH{measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e;return Xu(i,o,r,s).measure(t)}measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e;return Xu(i,o,r,s).measure(t).width}clipText(t,e,i){if(t.length===0)return{str:"",width:0};let r=this.measureTextWidth(t,e);return r<=i?{str:t,width:r}:(r=this.measureTextWidth(t[0],e),r>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,r,o){const s=Math.floor((r+o)/2),a=t.substring(0,s+1),l=this.measureTextWidth(a,e);let h;if(l>i){if(a.length<=1)return{str:"",width:0};const u=t.substring(0,s);return h=this.measureTextWidth(u,e),h<=i?{str:u,width:h}:this._clipText(t,e,i,r,s)}if(l<i){if(s>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const u=t.substring(0,s+2);return h=this.measureTextWidth(u,e),h>=i?{str:a,width:l}:this._clipText(t,e,i,s,o)}return{str:a,width:l}}clipTextWithSuffix(t,e,i,r){if(r==="")return this.clipText(t,e,i);if(t.length===0)return{str:"",width:0};const o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};const s=this.measureTextWidth(r,e);if(s>i)return{str:"",width:0};i-=s;const a=this._clipText(t,e,i,0,t.length-1);return a.str+=r,a.width+=s,a}}const R1=new UH;function J8(n){Yf=n,$f.clear()}function Q8(){container.load(VH)}var KH=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let qu=class{constructor(){this.time=Nt.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f;const{text:p,underline:v=l.underline,lineThrough:m=l.lineThrough,direction:C=l.direction,whiteSpace:b=l.whiteSpace,fontSize:_=l.fontSize,verticalMode:y=l.verticalMode,ellipsis:w=l.ellipsis,textAlign:S=l.textAlign,textBaseline:D=l.textBaseline,x:A=l.x,y:x=l.y}=n.attribute;let B=!1;if(Array.isArray(n)){const M=(g=n.cache)===null||g===void 0?void 0:g.layoutData;w&&M&&M.lines.every(E=>E.str==="")&&(B=!0)}else{const{cache:M}=n;w&&M&&M.clipedText===""&&M.clipedWidth===0&&(B=!0)}if(!B)return;const F=ue(w)?w:"...",T=(f=Jn(n.attribute.lineHeight,_))!==null&&f!==void 0?f:_;let R=0;T!==_&&(D==="top"?R=(T-_)/2:D==="middle"||D==="bottom"&&(R=-(T-_)/2)),o&&(d?d(t,n.attribute,l):a&&(t.setStrokeStyle(n,n.attribute,A-e,x-i,l),t.strokeText(F,A,x+R))),r&&(u?u(t,n.attribute,l):s&&(t.setCommonStyle(n,n.attribute,A-e,x-i,l),t.fillText(F,A,x+R),this.drawUnderLine(v,m,n,A,x+R,0,l,t,F)))}drawUnderLine(n,t,e,i,r,o,s,a,l){if(t+n<=0)return;const{textAlign:h=s.textAlign,textBaseline:u=s.textBaseline,fontSize:d=s.fontSize,fontFamily:c=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:f=s.fontStyle,fill:p=s.fill,opacity:v=s.opacity,underlineOffset:m=s.underlineOffset,underlineDash:C=s.underlineDash,fillOpacity:b=s.fillOpacity}=e.attribute;if(!n&&!t)return;const _=R1.measureTextWidth(l,{fontSize:d,fontFamily:c,fontWeight:g,fontStyle:f}),y=Ln(h,_),w=kn(u,d,d),S={lineWidth:0,stroke:p,opacity:v,strokeOpacity:b};if(n){S.lineWidth=n,a.setStrokeStyle(e,S,i,r,s),a.setLineDash(C),a.beginPath();const D=r+w+d+m;a.moveTo(i+y,D,o),a.lineTo(i+y+_,D,o),a.stroke()}if(t){S.lineWidth=t,a.setStrokeStyle(e,S,i,r,s),a.beginPath();const D=r+w+d/2;a.moveTo(i+y,D,o),a.lineTo(i+y+_,D,o),a.stroke()}}};qu=KH([Z()],qu);var YH=new ht((n,t,e,i)=>{e(Io)?i(Io).to(Fa).inSingletonScope():(n(Fa).toSelf().inSingletonScope(),n(jr).toService(Fa)),e(Oo)?i(Oo).to(Ta).inSingletonScope():(n(Ta).toSelf().inSingletonScope(),n(jr).toService(Ta)),n(Ba).toSelf().inSingletonScope(),n(IH).to(Ba),n(We).to(Ba),n(ku).toSelf().inSingletonScope(),n(zs).toService(ku),n(Iu).toSelf().inSingletonScope(),n(zs).toService(Iu),n(Gu).toSelf().inSingletonScope(),n(sn).toService(Gu),n(Uu).toSelf().inSingletonScope(),n(sn).toService(Uu),n(zu).toSelf().inSingletonScope(),n(sn).toService(zu),n(Ou).toSelf().inSingletonScope(),n(sn).toService(Ou),n(Wu).toSelf().inSingletonScope(),n(sn).toService(Wu),n(Nu).toSelf().inSingletonScope(),n(sn).toService(Nu),n(ju).toSelf().inSingletonScope(),n(sn).toService(ju),n(Vu).toSelf().inSingletonScope(),n(sn).toService(Vu),n(Ku).toSelf().inSingletonScope(),n(sn).toService(Ku),n(Yu).toSelf().inSingletonScope(),n(sn).toService(Yu),n($u).toSelf().inSingletonScope(),n(Is).toService($u),n(qu).toSelf().inSingletonScope(),n(ql).toService(qu)});function ur(n,t,e,i){var r,o,s,a,l;typeof window!="undefined"&&window.performance.now(),t=t!=null?t:0,e=e!=null?e:n.colCount-1,t===0&&e===n.colCount-1&&n._clearColRangeWidthsMap();const h=[],u=[];if(i)for(let d=0;d<n.colCount;d++)h[d]=n.getColWidth(d);for(let d=t;d<=e;d++){let c;if(!n.internalProps.transpose&&((o=(r=n.internalProps.layoutMap.columnWidths)===null||r===void 0?void 0:r[d])===null||o===void 0?void 0:o.columnWidthComputeMode)==="only-header"&&"showHeader"in n.internalProps.layoutMap){const g=n.internalProps.layoutMap.showHeader;n.internalProps.layoutMap.showHeader=!0,c=Er(d,0,n.internalProps.layoutMap.headerLevelCount-1,n),n.internalProps.layoutMap.showHeader=g}else c=n.internalProps.transpose||((a=(s=n.internalProps.layoutMap.columnWidths)===null||s===void 0?void 0:s[d])===null||a===void 0?void 0:a.columnWidthComputeMode)!=="only-body"?Er(d,0,n.rowCount-1,n):Er(d,n.internalProps.layoutMap.getBodyRange().start.row,n.internalProps.layoutMap.getBodyRange().end.row,n);n._setColContentWidth(d,c),n.getColWidth(d)!==c&&n._clearColRangeWidthsMap(d),i?u[d]=Math.round(n._adjustColWidth(d,c)):n._setColWidth(d,n._adjustColWidth(d,c),!1,!0)}if(n.widthMode==="adaptive"){n._clearColRangeWidthsMap();const d=n.tableNoFrameWidth;let c=0;for(let g=0;g<n.colCount;g++){const f=i?u[g]:n.getColWidth(g);(g<n.rowHeaderLevelCount||n.isPivotChart()&&g>=n.colCount-n.rightFrozenColCount)&&(c+=f)}Zu(d-c,n.rowHeaderLevelCount,n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount,i,u,n)}else if(n.autoFillWidth){n._clearColRangeWidthsMap();const d=n.tableNoFrameWidth;let c=0,g=0;for(let f=0;f<n.colCount;f++){const p=i?u[f]:n.getColWidth(f);(f<n.rowHeaderLevelCount||n.isPivotChart()&&f>=n.colCount-n.rightFrozenColCount)&&(c+=p),g+=p}g<d&&g>c&&Zu(d-c,n.rowHeaderLevelCount,n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount,i,u,n)}if(i){for(let d=0;d<n.colCount;d++){const c=(l=u[d])!==null&&l!==void 0?l:n.getColWidth(d);c!==h[d]&&n._setColWidth(d,c,!1,!0)}n.stateManager.checkFrozen();for(let d=0;d<n.colCount;d++){const c=n.getColWidth(d);c!==h[d]&&n.scenegraph.updateColWidth(d,c-h[d],!0,!0)}n.scenegraph.updateContainer(!0)}}function Er(n,t,e,i,r=!1){const o=ZH(n,i);return r&&!i.internalProps.transpose?E1(o,n,t,e,r,i):typeof o=="number"?o:o!=="auto"&&typeof o=="string"?i._adjustColWidth(n,i._colWidthDefineToPxWidth(o)):E1(o,n,t,e,r,i)}function E1(n,t,e,i,r,o){var s,a,l,h,u;let d=0,c=1,g=1;if(i-e>5e3&&(g=Math.ceil((i-e)/5e3)),o.isPivotChart()&&t>=o.rowHeaderLevelCount&&t<o.colCount-o.rightFrozenColCount){if(o.internalProps.layoutMap.indicatorsAsCol)return o.defaultColWidth;{const v=o.internalProps.layoutMap.getOptimunWidthForChart(t);if(v>0)return v}}for(let v=e;v<=i;v+=c){if(o.isPivotChart()){const S=o.internalProps.layoutMap,D=kf(t,v,S);if(D){const A=gH(D,o);if(typeof A=="number"){d=Math.max(A,d);continue}}else if(S.isLeftBottomCorner(t,v)||S.isRightTopCorner(t,v)||S.isRightBottomCorner(t,v))continue}const m=$H(t,v,o);if(m&&(d=Math.max(m.width,d),!m.renderDefault))continue;const C=n;if(typeof C=="number"&&o.widthMode==="standard"&&!r){d=Math.max(C,d);continue}const b=o.isHeader(t,v)?(s=o._getHeaderLayoutMap(t,v))===null||s===void 0?void 0:s.headerType:o.getBodyColumnType(t,v);if(b!=="text"&&b!=="link"&&b!=="progressbar"&&b!=="checkbox"){d=Math.max(d,o.getColWidthDefinedNumber(t)||0);continue}let _=0;const y=o.internalProps.layoutMap;if(y.isHeader(t,v)){const S=y.getHeader(t,v);if(((a=S==null?void 0:S.define)===null||a===void 0?void 0:a.columnWidthComputeMode)==="only-body")continue;S!=null&&S.hierarchyLevel&&(_=((l=S.hierarchyLevel)!==null&&l!==void 0?l:0)*((h=y.rowHierarchyIndent)!==null&&h!==void 0?h:0))}else{c=g;const S=o.getBodyColumnDefine(t,v);if(S!=null&&S.tree){const D=o.dataSource.getIndexKey(o.getRecordShowIndexByCell(t,v));_=Array.isArray(D)&&o.getHierarchyState(t,v)!==Ft.none?(D.length-1)*((u=y.hierarchyIndent)!==null&&u!==void 0?u:0):0}}const w=XH(t,v,b,o);d=Math.max(w+_,d),c>1&&o.bottomFrozenRowCount>0&&v<o.rowCount-o.bottomFrozenRowCount&&v+c>=o.rowCount-o.bottomFrozenRowCount&&(v=o.rowCount-o.bottomFrozenRowCount-c,c=1,g=1)}const f=o.getMinColWidth(t),p=o.getMaxColWidth(t);return d<f?f:d>p?p:d}function $H(n,t,e){var i,r,o,s;const a=e.getCustomRender(n,t),l=e.getCustomLayout(n,t);if(a||l){let h=1,u=0,d=!1,c=!1;if(e.isHeader(n,t)||!((i=e.getBodyColumnDefine(n,t))===null||i===void 0)&&i.mergeCell||e.hasCustomMerge()){const f=e.getCellRange(n,t);h=f.end.col-f.start.col+1}const g={col:n,row:t,dataValue:e.getCellOriginValue(n,t),value:e.getCellValue(n,t)||"",rect:qH(n,t,e),table:e};if(l){const f=l(g);f.rootContainer instanceof Di?(f.rootContainer=Da(f.rootContainer),Fu(f.rootContainer,0,e.getRowHeight(t)),f.rootContainer.setStage(e.scenegraph.stage),u=(r=f.rootContainer.AABBBounds.width())!==null&&r!==void 0?r:0,d=f.renderDefault,c=f.enableCellPadding):u=0}else if(typeof a=="function"){const f=a(g);u=(o=f==null?void 0:f.expectedWidth)!==null&&o!==void 0?o:0,d=f==null?void 0:f.renderDefault}else u=(s=a==null?void 0:a.expectedWidth)!==null&&s!==void 0?s:0,d=a==null?void 0:a.renderDefault;if(c){const f=e._getCellStyle(n,t),p=$t(Ct("padding",f,n,t,e));u+=p[1]+p[3]}return{width:u/h,renderDefault:d}}}function t5(n,t,e,i){const{layoutMap:r}=i.internalProps;if(i.isPivotTable()&&r.isColumnIndicatorHeader(n,t)){const o=r.getBody(n,t);if(o&&o.width&&o.width!=="auto"&&!e)return Math.round(calc.toPx(o.width,i.internalProps.calcWidthContext))}}function XH(n,t,e,i){var r;let o=0;const s=i.getCellValue(n,t),a=i._getCellStyle(n,t);let l=0,h=!1;if(i.getCellLocation(n,t)!=="body")h=!0;else{const C=i.getBodyColumnDefine(n,t);h=!!(C!=null&&C.icon)||!!(C!=null&&C.tree)}if(h){const C=i.getCellIcons(n,t);C==null||C.forEach(b=>{var _,y,w;b.positionType!==Qt.absoluteRight&&(l+=((_=b.width)!==null&&_!==void 0?_:0)+((y=b.marginLeft)!==null&&y!==void 0?y:0)+((w=b.marginRight)!==null&&w!==void 0?w:0))})}let u=1;if(i.isHeader(n,t)||!((r=i.getBodyColumnDefine(n,t))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const C=i.getCellRange(n,t);u=C.end.col-C.start.col+1}const d=$t(Ct("padding",a,n,t,i)),c=d[1]+d[3],g=Ct("fontSize",a,n,t,i),f=Ct("fontFamily",a,n,t,i),p=Ct("fontWeight",a,n,t,i);let v;v=e==="checkbox"&&ye(s)?s.text:s;const m=Vg(v).split(`
`)||[];if(m.length>=1?m.forEach(C=>{const b=i.measureText(C.slice(0,i.options.maxCharactersNumber||200),{fontSize:g,fontFamily:f,fontWeight:p}).width;o=Math.max((b+c+4+l)/u,o)}):o=Math.max((c+4+l)/u,o),i.internalProps.limitMaxAutoWidth!==!1&&(o=Math.min(typeof i.internalProps.limitMaxAutoWidth=="number"?i.internalProps.limitMaxAutoWidth:450,o)),e==="checkbox"){const C=Ct("size",a,n,t,i);if(o+=C,v){const b=Ct("spaceBetweenTextAndIcon",a,n,t,i);o+=b}}return o}function qH(n,t,e){return{left:0,top:0,right:e.getColWidth(n),bottom:e.getRowHeight(t),width:null,height:null}}function ZH(n,t){const e=t.getColWidthDefined(n);return t.internalProps._widthResizedColMap.has(n)?t.getColWidth(n):e}function Zu(n,t,e,i,r,o,s){let a=0;const l=[];for(let u=t;u<e;u++){const d=i?r[u]:o.getColWidth(u),c=o.getMaxColWidth(u),g=o.getMinColWidth(u);d!==c&&d!==g?(a+=d,l.push(u)):n-=d}const h=n/a;for(let u=0;u<l.length;u++){const d=l[u];let c;c=u===l.length-1?n-l.reduce((g,f,p)=>f!==d?g+(i?r[f]:o.getColWidth(f)):g,0):Math.round((i?r[d]:o.getColWidth(d))*h),i?r[d]=o._adjustColWidth(d,c):s?o.scenegraph.setColWidth(d,o._adjustColWidth(d,c)):o._setColWidth(d,o._adjustColWidth(d,c),!1,!0)}}const Ju=new jt({});Ju.role="empty";function Qu(n,t,e,i,r,o,s,a,l,h){let u,d,c,g=0;n.lastChild&&n.lastChild.row===i-1?g=n.lastChild.attribute.y+n.lastChild.attribute.height:n.colHeight&&(g=n.colHeight);for(let f=i;f<=r;f++){const p=f;let v,m,C,b,_=a.getCellValue(t,p),y=e,w=a.getRowHeight(p);if(a.internalProps.customMergeCell){const R=a.getCustomMerge(t,p);if(R){const{range:M,text:E,style:P,customLayout:I,customRender:k}=R;if(v=M,m=v.start.col!==v.end.col||v.start.row!==v.end.row,m){const H=P1(v,o,a,i>v.start.row);y=H.cellWidth,w=H.cellHeight}_=E,C=P,(I||k)&&(b=Zo(I,k,M.start.col,M.start.row,a.getColsWidth(M.start.col,M.end.col),a.getRowsHeight(M.start.row,M.end.row),!1,a.heightMode==="autoHeight",[0,0,0,0],a))}}let S=t,D=p;v&&(S=v.start.col,D=v.start.row);const A=l!=="body"?a.getHeaderDefine(S,D):a.getBodyColumnDefine(S,D),x=l!=="body"||!!(A!=null&&A.icon)||!!(A!=null&&A.tree);if(!v&&(l!=="body"||A!=null&&A.mergeCell)&&(v=a.getCellRange(t,p),m=v.start.col!==v.end.col||v.start.row!==v.end.row,m)){const R=P1(v,o,a,i>v.start.row);y=R.cellWidth,w=R.cellHeight}const B=C||a._getCellStyle(t,p),F=io(B,a,v?v.start.col:t,v?v.start.row:p,Ct).theme;F.group.cornerRadius=Bf(t,p,a),F.group.width=e,F.group.height=Array.isArray(s)?s[p]:s,F._vtable.padding&&(u=F._vtable.padding),F.text.textAlign&&(d=F.text.textAlign),F.text.textBaseline&&(c=F.text.textBaseline),l==="body"||F.group.fill||(F.group.fill="#fff");const T=(a.isHeader(t,p)?a._getHeaderLayoutMap(t,p).headerType:a.getBodyColumnType(t,p))||"text";if(xr(_)){t1(_,a,Lf.bind(null,T,_,A,a,t,p,e,y,w,n,g,u,d,c,x,F,v,b)),n.updateColumnRowNumber(p);const R=a.getRowHeight(p);n.updateColumnHeight(R),g+=R}else{const R=Lf(T,_,A,a,t,p,e,y,w,n,g,u,d,c,x,F,v,b);if(n.updateColumnRowNumber(p),m){const M=a.getRowHeight(p),{width:E}=(a.getColWidth(t),R.attribute),{height:P}=R.attribute;R.contentWidth=E,R.contentHeight=P,i1(v,E,P,u,d,c,a),n.updateColumnHeight(M),g+=M}else n.updateColumnHeight(R.attribute.height),g+=R.attribute.height}if(h&&p>h)break}return n.setAttribute("width",e),{width:e,height:g}}function e5(n,t,e){const i=e._getCellStyle(n,e.columnHeaderLevelCount),{theme:r,hasFunctionPros:o}=getStyleTheme(i,e,n,e.columnHeaderLevelCount,getRawProp);return r.group.width=t,r.group.height=0,{theme:r,hasFunctionPros:o}}function P1(n,t,e,i){let r=0,o=0;const s=t.get(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`);if(!s||i){for(let a=n.start.col;a<=n.end.col;a++)r+=e.getColWidth(a);for(let a=n.start.row;a<=n.end.row;a++)o+=e.getRowHeight(a);t.set(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`,{cellWidth:r,cellHeight:o})}else r=s.cellWidth,o=s.cellHeight;return{cellWidth:r,cellHeight:o}}function xi(n,t,e,i,r,o,s,a,l,h){if(i>r||o>s)return;const{layoutMap:u,defaultRowHeight:d,defaultHeaderRowHeight:c,defaultColWidth:g}=l.internalProps;let f=0,p=0;for(let v=i;v<=r;v++){const m=v,C=l.getColWidth(m),b=new jt({x:t+f,y:e,width:C,height:0,clip:!1,pickable:!1});b.role="column",b.col=v,n.addChild(b);const{width:_,height:y}=Qu(b,m,C,o,s,l.scenegraph.mergeMap,a==="columnHeader"&&lt(c)?c:d,l,a,h);f+=_,p=Math.max(p,y)}n.setAttribute("width",f),n.setAttribute("height",p)}function JH(n,t,e,i,r,o,s,a,l){var h,u,d,c,g,f;const{table:p}=l,{leftBottomCornerGroup:v,rightTopCornerGroup:m,rightBottomCornerGroup:C}=p.scenegraph;let b,_;l.setParamsForRow(),l.setParamsForColumn(),b=p.widthMode==="adaptive"?p.colCount-1:Math.min(l.firstScreenColLimit,p.colCount-1),_=p.heightMode==="adaptive"?p.rowCount-1:Math.min(l.firstScreenRowLimit,p.rowCount-1),p.internalProps._widthResizedColMap.size===0&&ur(p,0,b),hr(p,0,_),b<p.colCount-p.rightFrozenColCount&&ur(p,p.colCount-p.rightFrozenColCount,p.colCount-1),_<p.rowCount-p.bottomFrozenRowCount&&hr(p,p.rowCount-p.bottomFrozenRowCount,p.rowCount-1),p.scenegraph.colHeaderGroup.setAttribute("x",p.getFrozenColsWidth()),p.scenegraph.rowHeaderGroup.setAttribute("y",p.getFrozenRowsHeight()),p.scenegraph.bottomFrozenGroup.setAttribute("x",p.getFrozenColsWidth()),p.scenegraph.rightFrozenGroup.setAttribute("y",p.getFrozenRowsHeight()),p.scenegraph.bodyGroup.setAttributes({x:p.getFrozenColsWidth(),y:p.getFrozenRowsHeight()}),xi(n,s,a,0,p.frozenColCount-1,0,p.columnHeaderLevelCount-1,p.isListTable()?"columnHeader":"cornerHeader",p),b-p.rightFrozenColCount>=p.frozenColCount&&xi(t,s,a,p.frozenColCount,b-p.rightFrozenColCount,0,p.columnHeaderLevelCount-1,"columnHeader",p),xi(e,s,a,0,p.frozenColCount-1,p.columnHeaderLevelCount,_-p.bottomFrozenRowCount,p.isListTable()&&!p.internalProps.transpose?"body":"rowHeader",p),p.bottomFrozenRowCount>0&&(xi(v,s,a,0,p.frozenColCount-1,p.rowCount-1-p.bottomFrozenRowCount+1,p.rowCount-1,p.isListTable()?p.transpose?"rowHeader":"body":"rowHeader",p),b-p.rightFrozenColCount>=p.frozenColCount&&xi(r,s,a,p.frozenColCount,b-p.rightFrozenColCount,p.rowCount-1-p.bottomFrozenRowCount+1,p.rowCount-1,p.isPivotChart()?"rowHeader":"body",p)),p.rightFrozenColCount>0&&(xi(m,s,a,p.colCount-1-p.rightFrozenColCount+1,p.colCount-1,0,p.columnHeaderLevelCount-1,"columnHeader",p),xi(i,s,a,p.colCount-1-p.rightFrozenColCount+1,p.colCount-1,p.columnHeaderLevelCount,_-p.bottomFrozenRowCount,p.isPivotChart()?"rowHeader":"body",p)),p.bottomFrozenRowCount>0&&p.rightFrozenColCount>0&&xi(C,s,a,p.colCount-1-p.rightFrozenColCount+1,p.colCount-1,p.rowCount-1-p.bottomFrozenRowCount+1,p.rowCount-1,"body",p),b-p.rightFrozenColCount>=p.frozenColCount&&xi(o,s,a,p.frozenColCount,b-p.rightFrozenColCount,p.columnHeaderLevelCount,_-p.bottomFrozenRowCount,"body",p),o.firstChild||t.firstChild?(l.currentRow=(u=(h=o.firstChild)===null||h===void 0?void 0:h.rowNumber)!==null&&u!==void 0?u:l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=(f=(c=(d=o.lastChild)===null||d===void 0?void 0:d.col)!==null&&c!==void 0?c:(g=t.lastChild)===null||g===void 0?void 0:g.col)!==null&&f!==void 0?f:l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}function i5(n,t){for(let e=0;e<t.table.colCount;e++){if(e>=t.table.rowHeaderLevelCount&&e<t.colStart||e>t.colEnd&&e<t.table.colCount-t.table.rightFrozenColCount)continue;const i=getCellMergeInfo(t.table,e,n);if(i&&QH(i.start.row,i.end.row,e,t),i&&i.start.row!==n&&t.highPerformanceGetCell(i.start.col,i.start.row,!0).role!=="cell"){const r=t.highPerformanceGetCell(e,n,!0),o=updateCell(i.start.col,i.start.row,t.table,!0);o.col=e,o.row=n,o.setAttribute("y",t.table.getRowsHeight(t.table.columnHeaderLevelCount,i.start.row-1)),r.parent.insertAfter(o,r),r.parent.removeChild(r),r.needUpdate=!1,o.needUpdate=!1,t.cellCache.get(e)&&t.cellCache.set(e,o)}}}function n5(n,t){for(let e=0;e<t.table.rowCount;e++){if(e>=t.table.columnHeaderLevelCount&&e<t.rowStart||e>t.rowEnd&&e<t.table.rowCount-t.table.bottomFrozenRowCount)continue;const i=getCellMergeInfo(t.table,n,e);if(i&&tL(i.start.col,i.end.col,e,t),i&&i.start.col!==n&&t.highPerformanceGetCell(i.start.col,i.start.row,!0).role!=="cell"){const r=t.highPerformanceGetCell(n,e,!0),o=updateCell(i.start.col,i.start.row,t.table,!0);o.col=n,o.row=e,o.setAttribute("x",t.table.getColsWidth(t.table.rowHeaderLevelCount,i.start.col-1)-r.parent.attribute.x),o.setAttributes({x:t.table.getColsWidth(t.table.rowHeaderLevelCount,i.start.col-1)-r.parent.attribute.x,y:t.table.getRowsHeight(0,i.start.row-1)-r.parent.attribute.y}),r.parent.insertAfter(o,r),r.parent.removeChild(r),r.needUpdate=!1,o.needUpdate=!1,t.cellCache.get(n)&&t.cellCache.set(n,o)}}}function QH(n,t,e,i){for(let r=n;r<=t;r++){const o=i.highPerformanceGetCell(e,r,!0);o.role!=="shadow-cell"&&o.role!=="empty"&&o.row!==n&&(o.role="shadow-cell",o.setAttributes({width:0,height:i.table.getRowHeight(o.row),y:i.table.getRowsHeight(i.table.columnHeaderLevelCount,o.row-1),x:0}),o.clear())}}function tL(n,t,e,i){for(let r=n;r<=t;r++){const o=i.highPerformanceGetCell(r,e,!0);o.role!=="shadow-cell"&&o.role!=="empty"&&o.col!==n&&(o.role="shadow-cell",o.setAttributes({width:0,height:i.table.getRowHeight(o.row),y:i.table.getRowsHeight(0,o.row-1),x:0}),o.clear())}}function r5(n,t,e,i){for(let r=n;r<=t;r++)if(i.highPerformanceGetCell(r,e,!0).role!=="shadow-cell"&&i.highPerformanceGetCell(r,e,!0).role!=="empty")return!0;return!1}function H1(n){let t=n.firstChild;for(;t.type!=="group";)t=t._next;return t}function L1(n){let t=n.lastChild;for(;t.type!=="group";)t=t._prev;return t}function eL(n){let t=n._prev;for(;t&&t.type!=="group";)t=t._prev;return t}function iL(n){let t=n._next;for(;t&&t.type!=="group";)t=t._next;return t}function Xf(n,t,e,i="left"){for(let a=n;a<=t;a++){const l=e.scenegraph.getColGroup(a);l&&qf(l,e,i);const h=e.scenegraph.getColGroup(a,!0);h&&qf(h,e,i);const u=e.scenegraph.getColGroupInBottom(a);u&&qf(u,e,i)}const r=Math.min(e.scenegraph.proxy.colLimit,e.scenegraph.proxy.bodyRightCol-e.scenegraph.proxy.bodyLeftCol+1),o=e.getColsWidth(e.frozenColCount,e.frozenColCount+r),s=e.getColsWidth(e.frozenColCount,e.colCount-1);e.scenegraph.proxy.xLimitLeft=o/2,e.scenegraph.proxy.xLimitRight=s-o/2}function qf(n,t,e="left"){if(e==="left"){let i;const r=eL(n);i=r?r.attribute.x+t.getColWidth(n._prev.col):t.getColsWidth(t.frozenColCount,n.col-1),n.setAttribute("x",i)}else{let i;const r=iL(n);i=r?r.attribute.x-t.getColWidth(n.col):t.getColsWidth(t.frozenColCount,n.col-1),n.setAttribute("x",i)}}var k1=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};function nL(n,t,e){return k1(this,void 0,void 0,function*(){const i=e.table.getTargetColAt(n+e.table.scenegraph.rowHeaderGroup.attribute.width);if(!i)return;const r=i.col,o=i.left;let s;if(e.screenLeftCol=r,s=t?e.bodyRightCol-e.colEnd:e.screenLeftCol-e.referenceCol,rL(s,r,o,n,e),t){const a=e.table.scenegraph.getColGroup(e.colEnd);if(a){const l=a.attribute.x+a.attribute.width-(e.table.tableNoFrameWidth-e.table.getFrozenColsWidth()-e.table.getRightFrozenColsWidth())-n;e.deltaX=-l,e.table.scenegraph.setBodyAndColHeaderX(-n+e.deltaX)}}e.table.scenegraph.updateNextFrame()})}function rL(n,t,e,i,r){n>0?(I1(n,"left",r.screenLeftCol,e,i,r),r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):n<0?(I1(-n,"right",r.screenLeftCol,e,i,r),r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):(r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX))}function I1(n,t,e,i,r,o){return k1(this,void 0,void 0,function*(){if(t==="left"&&o.colEnd+n>o.bodyRightCol?n=o.bodyRightCol-o.colEnd:t==="right"&&o.colStart-n<o.bodyLeftCol&&(n=o.colStart-o.bodyLeftCol),n!==0)if(n<0&&(t=t==="left"?"right":"left",n=-n),n<o.colEnd-o.colStart){const s=t==="left"?o.colStart:o.colEnd-n+1,a=t==="left"?o.colStart+n-1:o.colEnd,l=t==="left"?o.colEnd+1:o.colStart-n,h=t==="left"?o.colEnd+n:o.colStart-1;ur(o.table,l,h),oL(s,a,t,o);const u=l,d=h;o.colStart=t==="left"?o.colStart+n:o.colStart-n,o.colEnd=t==="left"?o.colEnd+n:o.colEnd-n,Pa(u,d,o),Xf(u,d,o.table,t);const c=o.table.scenegraph.getColGroup(e)||o.table.scenegraph.getColGroup(e,!0),g=i-(c.attribute.x+o.table.getFrozenColsWidth()+o.table.scenegraph.proxy.deltaX);o.table.scenegraph.proxy.deltaX+=g,o.currentCol=t==="left"?o.currentCol+n:o.currentCol-n,o.totalCol=Math.max(0,Math.min(o.table.colCount-1,t==="left"?o.totalCol+n:o.totalCol-n)),o.referenceCol=o.colStart+Math.floor((o.colEnd-o.colStart)/2),o.colUpdatePos=l,o.colUpdateDirection=t,o.table.scenegraph.updateNextFrame()}else{const s=t==="left"?o.colStart+n:o.colStart-n,a=t==="left"?o.colEnd+n:o.colEnd-n;ur(o.table,s,a),sL(o.table.getColsWidth(o.bodyLeftCol,s-1),n,t,o);const l=s,h=a;o.colStart=s,o.colEnd=a,Pa(l,h,o),Xf(l,h,o.table,a>o.bodyRightCol-(o.colEnd-o.colStart+1)?"right":"left"),o.currentCol=t==="left"?o.currentCol+n:o.currentCol-n,o.totalCol=Math.max(0,Math.min(o.table.colCount-1,t==="left"?o.totalCol+n:o.totalCol-n)),o.referenceCol=o.colStart+Math.floor((o.colEnd-o.colStart)/2),o.colUpdatePos=o.colStart,o.colUpdateDirection=a>o.bodyRightCol-(o.colEnd-o.colStart+1)?"right":"left",o.table.scenegraph.updateNextFrame()}})}function Ra(n,t,e){n.col=t,n.forEachChildren(i=>{i.col=t,i.needUpdate=!0}),n.setAttribute("x",e),n.needUpdate=!0}function Ea(n,t){if(!n)return;let e=n.firstChild;for(;e;)e=t.updateCellGroupContent(e)._next;n.needUpdate=!1,n.setAttribute("width",t.table.getColWidth(n.col))}function oL(n,t,e,i){for(let r=n;r<=t;r++)i.table.scenegraph.bodyGroup.childrenCount>0&&i.table.scenegraph.bodyGroup.firstChild.type==="group"&&Zf(i.table.scenegraph.bodyGroup,e,i),i.table.scenegraph.colHeaderGroup.childrenCount>0&&i.table.scenegraph.colHeaderGroup.firstChild.type==="group"&&Zf(i.table.scenegraph.colHeaderGroup,e,i),i.table.scenegraph.bottomFrozenGroup.childrenCount>0&&i.table.scenegraph.bottomFrozenGroup.firstChild.type==="group"&&Zf(i.table.scenegraph.bottomFrozenGroup,e,i)}function Zf(n,t,e){if(t==="left"){const i=H1(n),r=L1(n);Ra(i,r.col+1,r.attribute.x+e.table.getColWidth(r.col)),n.appendChild(i),n.border&&n.appendChild(n.border)}else{const i=L1(n),r=H1(n);Ra(i,r.col-1,r.attribute.x-e.table.getColWidth(r.col-1)),n.insertBefore(i,n.firstChild)}}function Pa(n,t,e){for(let i=n;i<=t;i++){const r=e.table.scenegraph.getColGroup(i);r&&Ea(r,e);const o=e.table.scenegraph.getColGroup(i,!0);o&&Ea(o,e);const s=e.table.scenegraph.getColGroupInBottom(i);s&&Ea(s,e);const a=e.table.scenegraph.getColGroupInRightTopCorner(i);a&&Ea(a,e);const l=e.table.scenegraph.getColGroupInRightBottomCorner(i);l&&Ea(l,e)}}function sL(n,t,e,i){i.table.scenegraph.colHeaderGroup.forEachChildren((r,o)=>{r.type==="group"&&Ra(r,e==="left"?r.col+t:r.col-t,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}),i.table.scenegraph.bottomFrozenGroup.forEachChildren((r,o)=>{r.type==="group"&&Ra(r,e==="left"?r.col+t:r.col-t,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}),i.table.scenegraph.bodyGroup.forEachChildren((r,o)=>{r.type==="group"&&Ra(r,e==="left"?r.col+t:r.col-t,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))})}function Yi(n,t,e,i,r,o="up",s){var a,l;if(o==="up")for(let c=n;c<=t;c++)for(let g=e;g<=i;g++){const f=r.scenegraph.highPerformanceGetCell(c,g,!0);if(!f.row)continue;let p;if(f._prev)p=((a=f._prev)===null||a===void 0?void 0:a.attribute.y)+r.getRowHeight(f._prev.row);else if(s){p=r.scenegraph.highPerformanceGetCell(c,i+1,!0).attribute.y;for(let v=e;v<=i;v++)p-=r.getRowHeight(v)}else p=r.getRowsHeight(r.columnHeaderLevelCount,f.row-1);f.setAttribute("y",p)}else for(let c=n;c<=t;c++)for(let g=i;g>=e;g--){const f=r.scenegraph.highPerformanceGetCell(c,g,!0);if(!f.row)continue;let p;if(f._next)p=((l=f._next)===null||l===void 0?void 0:l.attribute.y)-r.getRowHeight(f.row);else if(s){p=r.scenegraph.highPerformanceGetCell(c,e-1,!0).attribute.y;for(let v=e-1;v<i;v++)p+=r.getRowHeight(v)}else p=r.getRowsHeight(r.columnHeaderLevelCount,f.row-1);f.setAttribute("y",p)}const h=Math.min(r.scenegraph.proxy.rowLimit,r.scenegraph.proxy.bodyBottomRow-r.scenegraph.proxy.bodyTopRow+1),u=r.getRowsHeight(r.columnHeaderLevelCount,r.columnHeaderLevelCount+h),d=r.getRowsHeight(r.columnHeaderLevelCount,r.rowCount-1);r.scenegraph.proxy.yLimitTop=u/2,r.scenegraph.proxy.yLimitBottom=d-u/2}var O1=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};function aL(n,t,e){return O1(this,void 0,void 0,function*(){const i=e.table.getTargetRowAt(n+e.table.scenegraph.colHeaderGroup.attribute.height);if(!i)return;const r=i.row,o=i.top;let s;if(e.screenTopRow=r,s=t?e.bodyBottomRow-e.rowEnd:r-e.referenceRow,lL(s,r,o,n,e),t){const a=e.table.scenegraph.highPerformanceGetCell(e.colStart,e.rowEnd,!0);if(a.role==="cell"){const l=a.attribute.y+a.attribute.height-(e.table.tableNoFrameHeight-e.table.getFrozenRowsHeight()-e.table.getBottomFrozenRowsHeight())-n;e.deltaY=-l,e.updateBody(n-e.deltaY)}}})}function lL(n,t,e,i,r){n>0?(z1(n,"up",t,e,i,r),r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY)):n<0?(z1(-n,"down",t,e,i,r),r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY)):(r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY))}function z1(n,t,e,i,r,o){return O1(this,void 0,void 0,function*(){if(t==="up"&&o.rowEnd+n>o.bodyBottomRow?n=o.bodyBottomRow-o.rowEnd:t==="down"&&o.rowStart-n<o.bodyTopRow&&(n=o.rowStart-o.bodyTopRow),n!==0)if(n<0&&(t=t==="up"?"down":"up",n=-n),n<o.rowEnd-o.rowStart){const s=t==="up"?o.rowStart:o.rowEnd-n+1,a=t==="up"?o.rowStart+n-1:o.rowEnd,l=t==="up"?o.rowEnd+1:o.rowStart-n,h=t==="up"?o.rowEnd+n:o.rowStart-1;let u,d;o.table.heightMode==="autoHeight"?(u=l,d=h):(u=Math.max(o.bodyTopRow,e-1*o.screenRowCount),d=Math.min(o.bodyBottomRow,e+2*o.screenRowCount)),hr(o.table,u,d,!1),hL(s,a,t,o),o.rowStart=t==="up"?o.rowStart+n:o.rowStart-n,o.rowEnd=t==="up"?o.rowEnd+n:o.rowEnd-n,Ha(u,d,o),o.table.heightMode==="autoHeight"&&(Yi(o.bodyLeftCol,o.bodyRightCol,u,d,o.table,h>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0),Yi(0,o.table.frozenColCount-1,u,d,o.table,h>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0),Yi(o.table.colCount-o.table.rightFrozenColCount,o.table.colCount-1,u,d,o.table,h>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0)),o.currentRow=t==="up"?o.currentRow+n:o.currentRow-n,o.totalRow=Math.max(0,Math.min(o.bodyBottomRow,t==="up"?o.totalRow+n:o.totalRow-n)),o.referenceRow=o.rowStart+Math.floor((o.rowEnd-o.rowStart)/2),o.table.heightMode==="autoHeight"?o.rowUpdatePos=Math.min(o.rowUpdatePos,o.rowEnd+1):o.rowUpdatePos=Math.min(o.rowUpdatePos,l),o.rowUpdateDirection=t,o.table.scenegraph.updateNextFrame(),o.table.heightMode!=="autoHeight"&&(yield o.progress())}else{const s=t==="up"?o.rowStart+n:o.rowStart-n,a=t==="up"?o.rowEnd+n:o.rowEnd-n,l=o.table.getRowsHeight(o.bodyTopRow,s-1);let h,u;o.table.heightMode==="autoHeight"?(h=s,u=a):(h=Math.max(o.bodyTopRow,e-1*o.screenRowCount),u=Math.min(o.bodyBottomRow,e+2*o.screenRowCount)),hr(o.table,h,u,!1),uL(l,n,t,o),o.rowStart=s,o.rowEnd=a,Ha(h,u,o),o.table.heightMode==="autoHeight"&&(Yi(o.bodyLeftCol,o.bodyRightCol,h,u,o.table,a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up"),Yi(0,o.table.frozenColCount-1,h,u,o.table,a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up"),Yi(o.table.colCount-o.table.rightFrozenColCount,o.table.colCount-1,h,u,o.table,a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up")),o.currentRow=t==="up"?o.currentRow+n:o.currentRow-n,o.totalRow=Math.max(0,Math.min(o.bodyBottomRow,t==="up"?o.totalRow+n:o.totalRow-n)),o.referenceRow=o.rowStart+Math.floor((o.rowEnd-o.rowStart)/2),o.table.heightMode==="autoHeight"?o.rowUpdatePos=o.rowEnd+1:o.rowUpdatePos=o.rowStart,o.rowUpdateDirection=a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",o.table.scenegraph.updateNextFrame(),o.table.heightMode!=="autoHeight"&&(yield o.progress())}})}function hL(n,t,e,i){for(let r=0;r<i.table.frozenColCount;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=t;s++)Jf(o,e,i)}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=t;s++)Jf(o,e,i)}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=t;s++)Jf(o,e,i)}}function Jf(n,t,e){if(n.childrenCount>=1)if(t==="up"){const i=n.firstChild;e.updateCellGroupPosition(i,n.lastChild.row+1,n.lastChild.attribute.y+e.table.getRowHeight(n.lastChild.row)),n.appendChild(i)}else{const i=n.lastChild;e.updateCellGroupPosition(i,n.firstChild.row-1,n.firstChild.attribute.y-e.table.getRowHeight(i.row)),n.insertBefore(i,n.firstChild)}}function uL(n,t,e,i){for(let r=0;r<i.table.frozenColCount;r++){const o=i.table.scenegraph.getColGroup(r);o==null||o.forEachChildren((s,a)=>{i.updateCellGroupPosition(s,e==="up"?s.row+t:s.row-t,a===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))})}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const o=i.table.scenegraph.getColGroup(r);o==null||o.forEachChildren((s,a)=>{i.updateCellGroupPosition(s,e==="up"?s.row+t:s.row-t,a===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))})}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const o=i.table.scenegraph.getColGroup(r);o==null||o.forEachChildren((s,a)=>{i.updateCellGroupPosition(s,e==="up"?s.row+t:s.row-t,a===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))})}}function Ha(n,t,e){for(let i=0;i<e.table.frozenColCount;i++)for(let r=n;r<=t;r++){const o=e.highPerformanceGetCell(i,r,!0);e.updateCellGroupContent(o)}for(let i=e.table.colCount-e.table.rightFrozenColCount;i<e.table.colCount;i++)for(let r=n;r<=t;r++){const o=e.highPerformanceGetCell(i,r);e.updateCellGroupContent(o)}for(let i=e.bodyLeftCol;i<=e.bodyRightCol;i++)for(let r=n;r<=t;r++){const o=e.highPerformanceGetCell(i,r);e.updateCellGroupContent(o)}e.table.scenegraph.updateNextFrame()}var dL=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};function cL(n){var t;return dL(this,void 0,void 0,function*(){n.table.scenegraph.bodyGroup.forEachChildren((s,a)=>{s.type==="group"&&(s.needUpdate=!0,s==null||s.forEachChildren(l=>{l.needUpdate=!0}))});for(let s=0;(t=s<n.table.frozenColCount)!==null&&t!==void 0&&t;s++){const a=n.table.scenegraph.getColGroup(s);a==null||a.setAttribute("chartInstance",void 0);for(let l=n.rowStart;l<=n.rowEnd;l++)n.table.scenegraph.updateCellContent(s,l);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(s,l)}for(let s=n.colStart;s<=n.colEnd;s++){const a=n.table.scenegraph.getColGroup(s);a==null||a.setAttribute("chartInstance",void 0);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(s,l)}for(let s=n.table.colCount-n.table.rightFrozenColCount;s<n.table.colCount;s++){const a=n.table.scenegraph.getColGroup(s);a==null||a.setAttribute("chartInstance",void 0);for(let l=n.rowStart;l<=n.rowEnd;l++)n.table.scenegraph.updateCellContent(s,l);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(s,l)}let e,i;n.table.heightMode==="autoHeight"?(e=n.rowStart,i=n.rowEnd):(e=Math.max(n.bodyTopRow,n.screenTopRow-1*n.screenRowCount),i=Math.min(n.bodyBottomRow,n.screenTopRow+2*n.screenRowCount));const r=n.table.getAllRowsHeight();hr(n.table,e,i);const o=n.table.getAllRowsHeight();r!==o&&n.table.scenegraph.updateContainerHeight(n.table.frozenRowCount,o-r),Ha(e,i,n),n.table.heightMode==="autoHeight"&&Yi(n.bodyLeftCol,n.bodyRightCol,e,i,n.table,n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),n.rowUpdatePos=n.rowStart,n.rowUpdateDirection=n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",n.table.scenegraph.updateNextFrame(),n.table.heightMode!=="autoHeight"&&(yield n.progress())})}var gL=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};function fL(n){return gL(this,void 0,void 0,function*(){n.table.scenegraph.bodyGroup.forEachChildren((i,r)=>{i.type==="group"&&(i.needUpdate=!0,i==null||i.forEachChildren(o=>{o.needUpdate=!0}))});for(let i=n.colStart;i<=n.colEnd;i++){const r=n.table.scenegraph.getColGroup(i);r==null||r.setAttribute("chartInstance",void 0);for(let o=n.table.rowCount-n.table.bottomFrozenRowCount;o<n.table.rowCount;o++)n.table.scenegraph.updateCellContent(i,o)}for(let i=n.table.colCount-n.table.rightFrozenColCount;i<n.table.colCount;i++){const r=n.table.scenegraph.getColGroup(i);r==null||r.setAttribute("chartInstance",void 0);for(let o=n.rowStart;o<=n.rowEnd;o++)n.table.scenegraph.updateCellContent(i,o);for(let o=n.table.rowCount-n.table.bottomFrozenRowCount;o<n.table.rowCount;o++)n.table.scenegraph.updateCellContent(i,o)}const t=Math.max(n.bodyLeftCol,n.screenLeftCol-1*n.screenColCount),e=Math.min(n.bodyRightCol,n.screenLeftCol+2*n.screenColCount);ur(n.table,t,e),Pa(t,e,n),n.colUpdatePos=n.colStart,n.colUpdateDirection=n.colEnd>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left",n.table.scenegraph.updateNextFrame(),yield n.progress()})}var gn=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((i=i.apply(n,t||[])).next())})};class pL{constructor(t){this.isRelease=!1,this.mode="column",this.rowLimit=200,this.currentRow=0,this.rowStart=0,this.rowEnd=0,this.referenceRow=0,this.screenTopRow=0,this.deltaY=0,this.deltaHeight=0,this.colLimit=100,this.screenLeftCol=0,this.deltaX=0,this.deltaWidth=0,this.cellCache=new Map,this.table=t,this.table.isPivotChart()?(this.rowLimit=100,this.colLimit=100):this.table.heightMode==="autoHeight"?this.rowLimit=100:this.table.widthMode==="autoWidth"&&(this.colLimit=100),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount)}get bodyLeftCol(){return this.table.frozenColCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,r=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=r-i/2;const o=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(o/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyTopRow=this.table.columnHeaderLevelCount,this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,r=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=r-i/2;const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/e))),this.rowUpdatePos=this.bodyBottomRow}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const r=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(r/i))}createGroupForFirstScreen(t,e,i,r,o,s,a,l){JH(t,e,i,r,o,s,a,l,this)}progress(){return gn(this,void 0,void 0,function*(){if(!this.isProgressing)return this.isProgressing=!0,new Promise((t,e)=>{setTimeout(()=>gn(this,void 0,void 0,function*(){this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(yield this.updateColCellGroupsAsync(),yield this.progress()):this.rowUpdatePos<=this.rowEnd?(yield this.updateRowCellGroupsAsync(),yield this.progress()):this.currentCol<this.totalCol?(yield this.createCol(),yield this.progress()):this.currentRow<this.totalRow&&(yield this.createRow(),yield this.progress()),t())}),16)})})}createRow(){return gn(this,void 0,void 0,function*(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)})}createCol(){return gn(this,void 0,void 0,function*(){this.taskColCount&&this.createColGroup(this.taskRowCount)})}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if(hr(this.table,this.currentRow+1,e,!1),this.table.frozenColCount){let r=0;for(let o=0;o<this.table.frozenColCount;o++){const s=this.table.scenegraph.getColGroup(o),a=this.table.isListTable()?"body":"rowHeader",{height:l}=Qu(s,o,s.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.internalProps.defaultRowHeight,this.table,a);r=Math.max(r,l),this.table.scenegraph.rowHeaderGroup.setAttribute("height",r)}}if(this.table.rightFrozenColCount){let r=0;for(let o=this.table.colCount-this.table.rightFrozenColCount;o<this.table.colCount;o++){const s=this.table.scenegraph.getColGroup(o),a=this.table.isPivotChart()?"rowHeader":"body",{height:l}=Qu(s,o,s.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.internalProps.defaultRowHeight,this.table,a);r=Math.max(r,l),this.table.scenegraph.rightFrozenGroup.setAttribute("height",r)}}let i=0;for(let r=this.bodyLeftCol;r<=this.bodyRightCol;r++){const o=this.table.scenegraph.getColGroup(r);if(!o)continue;const s=r<this.table.rowHeaderLevelCount?"rowHeader":"body",{height:a}=Qu(o,r,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.internalProps.defaultRowHeight,this.table,s);i=Math.max(i,a)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowEnd=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);ur(this.table,this.currentCol+1,e);for(let s=0;s<this.table.rowCount;s++){const a=this.highPerformanceGetCell(this.currentCol,s);a.role==="cell"&&lt(a.mergeStartCol)&&a.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(a.col,a.row)}if(this.table.columnHeaderLevelCount){const s=this.table.scenegraph.colHeaderGroup.lastChild instanceof jt?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,a=s.attribute.x+s.attribute.width,l=s.attribute.y;xi(this.table.scenegraph.colHeaderGroup,a,l,this.currentCol+1,e,0,this.table.columnHeaderLevelCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const s=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof jt?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,a=s.attribute.x+s.attribute.width,l=s.attribute.y;xi(this.table.scenegraph.bottomFrozenGroup,a,l,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof jt?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof jt?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const r=i.attribute.x+i.attribute.width,o=i.attribute.y;xi(this.table.scenegraph.bodyGroup,r,o,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colEnd=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}setY(t,e=!1){return gn(this,void 0,void 0,function*(){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,r=this.table.getAllRowsHeight()-i;t<i&&this.rowStart===this.bodyTopRow||t>r&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.childrenCount!==0?this.dynamicSetY(t,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))})}setX(t,e=!1){return gn(this,void 0,void 0,function*(){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,r=this.table.getAllColsWidth()-i;t<i&&this.colStart===this.bodyLeftCol||t>r&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.childrenCount===0?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,e)})}dynamicSetY(t,e=!1){return gn(this,void 0,void 0,function*(){aL(t,e,this)})}dynamicSetX(t,e=!1){return gn(this,void 0,void 0,function*(){nL(t,e,this)})}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}updateRowCellGroupsAsync(){return gn(this,void 0,void 0,function*(){this.updateCellGroups(this.taskRowCount)})}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);this.table.heightMode==="autoHeight"&&hr(this.table,this.rowUpdatePos,e,!1),Ha(this.rowUpdatePos,e,this),this.table.heightMode==="autoHeight"&&(Yi(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),Yi(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),Yi(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;this.table.heightMode==="autoHeight"&&hr(this.table,t,e,!1),Ha(t,e,this),this.table.heightMode==="autoHeight"&&(Yi(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),Yi(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),Yi(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;this.table.widthMode==="autoWidth"&&ur(this.table,t,e,!1),Pa(t,e,this),this.table.heightMode==="autoHeight"&&Xf(t,e,this.table,this.colUpdateDirection)}updateColCellGroupsAsync(){return gn(this,void 0,void 0,function*(){this.updateColGroups(this.taskRowCount)})}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);ur(this.table,this.colUpdatePos,e),Pa(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||t.role!=="cell")return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}sortCellVertical(){return gn(this,void 0,void 0,function*(){yield cL(this)})}sortCellHorizontal(){return gn(this,void 0,void 0,function*(){yield fL(this)})}highPerformanceGetCell(t,e,i){if(e>=this.table.columnHeaderLevelCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd)||t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return Ju;if(this.cellCache.get(t)){const o=this.cellCache.get(t);if((o._next||o._prev)&&Math.abs(o.row-e)<e){let a=Qf(o,e);return a&&(i||a.role!=="shadow-cell")||(a=this.table.scenegraph.getCell(t,e,i)),a.row&&this.cellCache.set(t,a),a}const s=this.table.scenegraph.getCell(t,e,i);return s.col===t&&s.row&&this.cellCache.set(t,s),s}const r=this.table.scenegraph.getCell(t,e,i);return r.col===t&&r.row&&this.cellCache.set(t,r),r}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if(r.role==="cell"){const o=r.attribute.y;this.deltaY=-o}}else if(this.rowEnd===this.bodyBottomRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if(r.role==="cell"){const o=r.attribute.y+r.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-o}}else if(N(e)&&N(i)){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0),o=t-this.deltaY,s=e-o,a=r.attribute.y-o+this.table.getFrozenRowsHeight();this.deltaY=s-a}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const r=this.table.scenegraph.getColGroup(this.colStart);if(r){const o=r.attribute.x;this.deltaX=-o}}else if(this.colEnd===this.bodyRightCol){const r=this.table.scenegraph.getColGroup(this.colEnd);if(r){const o=r.attribute.x+r.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-o}}else if(N(e)&&N(i)){const r=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),o=t-this.deltaX,s=e-o,a=r.attribute.x-o+this.table.getFrozenColsWidth();this.deltaX=s-a}}release(){this.isRelease=!0}}function Qf(n,t){if(!n)return null;if(n.row===t)return n;const e=n._prev,i=n._next;return n.row>t&&e&&e.row===t-1?Qf(e,t):n.row<t&&i&&i.row===t+1?Qf(i,t):null}function vL(n,t,e,i,r,o){const s=o.scenegraph;for(let a=n;a<=t;a++){const l=o.getColWidth(a),h=o.scenegraph.getColGroup(a,!0),u=o.scenegraph.getColGroup(a),d=o.scenegraph.getColGroupInBottom(a),c=o.scenegraph.getColGroupInLeftBottomCorner(a),g=o.scenegraph.getColGroupInRightBottomCorner(a);h&&(h.setAttribute("width",l),h.forEachChildren(f=>{f.setAttribute("width",l)})),u&&(u.setAttribute("width",l),u.forEachChildren(f=>{f.setAttribute("width",l)})),d&&(d.setAttribute("width",l),d.forEachChildren(f=>{f.setAttribute("width",l)})),g&&(g.setAttribute("width",l),g.forEachChildren(f=>{f.setAttribute("width",l)})),c&&(c.setAttribute("width",l),c.forEachChildren(f=>{f.setAttribute("width",l)}))}if(s.updateContainer(),r==="column")for(let a=n;a<=t;a++){const l=o.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=0;h<=o.frozenRowCount-1;h++)s.updateCellContent(a,h);for(let h=s.bodyRowStart;h<=s.bodyRowEnd;h++)s.updateCellContent(a,h);for(let h=o.rowCount-o.bottomFrozenRowCount;h<=o.rowCount-1;h++)s.updateCellContent(a,h)}else{for(let a=0;a<=o.frozenColCount-1;a++){const l=o.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)s.updateCellContent(a,h)}for(let a=s.bodyColStart;a<=s.bodyColEnd;a++){const l=o.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)s.updateCellContent(a,h)}for(let a=o.colCount-o.rightFrozenColCount;a<=o.colCount-1;a++){const l=o.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)s.updateCellContent(a,h)}}}function mL(n){n.selectingRangeComponents.forEach((t,e)=>{W1(t,e,n)}),n.selectedRangeComponents.forEach((t,e)=>{W1(t,e,n)})}function W1(n,t,e){var i,r,o,s;const[a,l,h,u]=t.split("-"),d=parseInt(a,10),c=parseInt(l,10),g=parseInt(h,10),f=parseInt(u,10);let p,v=d,m=c,C=g,b=f;switch(n.role){case"rowHeader":p=e.table.getBodyVisibleRowRange(),p&&(m=Math.max(c,p.rowStart-1),b=Math.min(f,p.rowEnd+1));break;case"columnHeader":case"bottomFrozen":p=e.table.getBodyVisibleCellRange(),p&&(v=Math.max(d,p.colStart-1),C=Math.min(g,p.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":p=e.table.getBodyVisibleCellRange(),p&&(m=Math.max(c,p.rowStart-1),b=Math.min(f,p.rowEnd+1));break;default:p=e.table.getBodyVisibleCellRange(),p&&(m=Math.max(c,p.rowStart-1),b=Math.min(f,p.rowEnd+1),v=Math.max(d,p.colStart-1),C=Math.min(g,p.colEnd+1))}const _=e.table.getColsWidth(v,C),y=e.table.getRowsHeight(m,b),w=e.highPerformanceGetCell(v,m).globalAABBBounds;n.rect.setAttributes({x:w.x1-e.tableGroup.attribute.x,y:w.y1-e.tableGroup.attribute.y,width:_,height:y,visible:!0});const S=!!e.table.frozenColCount&&d===e.table.frozenColCount,D=!!e.table.rightFrozenColCount&&e.table.rightFrozenColCount>0&&g===e.table.colCount-e.table.rightFrozenColCount-1,A=!e.table.frozenRowCount||c===e.table.frozenRowCount,x=!!e.table.bottomFrozenRowCount&&f===e.table.rowCount-e.table.bottomFrozenRowCount-1;if(S&&n.rect.attribute.stroke[3]||D&&n.rect.attribute.stroke[1]||A&&n.rect.attribute.stroke[0]||x&&n.rect.attribute.stroke[2]){if(S&&n.rect.attribute.stroke[3]&&e.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?e.cornerHeaderGroup:n.role==="bottomFrozen"?e.leftBottomCornerGroup:e.rowHeaderGroup),x&&n.rect.attribute.stroke[2]&&e.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?e.leftBottomCornerGroup:n.role==="rightFrozen"?e.rightBottomCornerGroup:e.bottomFrozenGroup),A&&n.rect.attribute.stroke[0]&&e.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?e.cornerHeaderGroup:n.role==="rightFrozen"?e.rightTopCornerGroup:e.colHeaderGroup),D&&n.rect.attribute.stroke[1]&&e.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?e.rightTopCornerGroup:n.role==="bottomFrozen"?e.rightBottomCornerGroup:e.rightFrozenGroup),n.rect.attribute.x<e.table.getFrozenColsWidth()&&e.table.scrollLeft>0&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const F=n.rect.attribute.width-(e.table.getFrozenColsWidth()-n.rect.attribute.x);n.rect.setAttributes({x:n.rect.attribute.x+(e.table.getFrozenColsWidth()-n.rect.attribute.x),width:F>0?F:0})}if(e.table.getRightFrozenColsWidth()>0&&e.rightFrozenGroup.attribute.height>0&&n.rect.attribute.x+n.rect.attribute.width>e.rightFrozenGroup.attribute.x&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const F=e.rightFrozenGroup.attribute.x-n.rect.attribute.x;n.rect.setAttributes({x:n.rect.attribute.x,width:F>0?F:0})}if(n.rect.attribute.y<e.colHeaderGroup.attribute.height&&e.table.scrollTop>0&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const F=n.rect.attribute.height-(e.colHeaderGroup.attribute.height-n.rect.attribute.y);n.rect.setAttributes({y:n.rect.attribute.y+(e.colHeaderGroup.attribute.height-n.rect.attribute.y),height:F>0?F:0})}if(e.bottomFrozenGroup.attribute.width>0&&e.bottomFrozenGroup.attribute.height>0&&n.rect.attribute.y+n.rect.attribute.height>e.bottomFrozenGroup.attribute.y&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const F=e.bottomFrozenGroup.attribute.y-n.rect.attribute.y;n.rect.setAttributes({y:n.rect.attribute.y,height:F>0?F:0})}}else e.tableGroup.insertAfter(n.rect,n.role==="body"?e.bodyGroup:n.role==="columnHeader"?e.colHeaderGroup:n.role==="rowHeader"?e.rowHeaderGroup:n.role==="cornerHeader"?e.cornerHeaderGroup:n.role==="rightTopCorner"?e.rightTopCornerGroup:n.role==="rightFrozen"?e.rightFrozenGroup:n.role==="leftBottomCorner"?e.leftBottomCornerGroup:n.role==="bottomFrozen"?e.bottomFrozenGroup:e.rightBottomCornerGroup);let B=0;typeof n.rect.attribute.lineWidth=="number"&&(B=Math.ceil(n.rect.attribute.lineWidth/2)),g===e.table.colCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(B=Math.ceil(((i=n.rect.attribute.lineWidth[1])!==null&&i!==void 0?i:0)/2)),n.rect.setAttributes({width:n.rect.attribute.width-B})),d===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(B=Math.ceil(((r=n.rect.attribute.lineWidth[3])!==null&&r!==void 0?r:0)/2)),n.rect.setAttributes({x:n.rect.attribute.x+B,width:n.rect.attribute.width-B})),f===e.table.rowCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(B=Math.ceil(((o=n.rect.attribute.lineWidth[2])!==null&&o!==void 0?o:0)/2)),n.rect.setAttributes({height:n.rect.attribute.height-B})),c===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(B=Math.ceil(((s=n.rect.attribute.lineWidth[0])!==null&&s!==void 0?s:0)/2)),n.rect.setAttributes({y:n.rect.attribute.y+B,height:n.rect.attribute.height-B}))}function N1(n,t,e,i,r){let o=Math.max(Math.min(i,t),0),s=Math.max(Math.min(r,e),0),a=Math.min(Math.max(i,t),n.table.colCount-1),l=Math.min(Math.max(r,e),n.table.rowCount-1);const h=()=>{let b=!1;for(let _=o;_<=a;_++){if(_===o)for(let y=s;y<=l;y++){const w=ze(n.table,_,y);if(w&&w.start.col<o){o=w.start.col,b=!0;break}}if(!b&&_===a)for(let y=s;y<=l;y++){const w=ze(n.table,_,y);if(w&&Math.min(w.end.col,n.table.colCount-1)>a){a=w.end.col,b=!0;break}}if(b)break}if(!b)for(let _=s;_<=l;_++){if(_===s)for(let y=o;y<=a;y++){const w=ze(n.table,y,_);if(w&&w.start.row<s){s=w.start.row,b=!0;break}}if(!b&&_===l)for(let y=o;y<=a;y++){const w=ze(n.table,y,_);if(w&&Math.min(w.end.row,n.table.rowCount-1)>l){l=w.end.row,b=!0;break}}if(b)break}b&&h()};h(),n.selectingRangeComponents.forEach((b,_)=>{b.rect.delete()}),n.selectingRangeComponents=new Map;let u=!1,d=!1,c=!1,g=!1,f=!1,p=!1,v=!1,m=!1,C=!1;if(o<=n.table.frozenColCount-1&&s<=n.table.frozenRowCount-1&&(p=!0),a>=n.table.colCount-n.table.rightFrozenColCount&&s<=n.table.frozenRowCount-1&&(v=!0),o<=n.table.frozenColCount-1&&l>=n.table.rowCount-n.table.bottomFrozenRowCount&&(C=!0),a>=n.table.colCount-n.table.rightFrozenColCount&&l>=n.table.rowCount-n.table.bottomFrozenRowCount&&(m=!0),o<=n.table.frozenColCount-1&&l>=n.table.frozenRowCount&&s<=n.table.rowCount-n.table.bottomFrozenRowCount-1&&(u=!0),a>=n.table.colCount-n.table.rightFrozenColCount&&l>=n.table.frozenRowCount&&s<=n.table.rowCount-n.table.bottomFrozenRowCount-1&&(d=!0),s<=n.table.frozenRowCount-1&&a>=n.table.frozenColCount&&o<=n.table.colCount-n.table.rightFrozenColCount-1&&(c=!0),l>=n.table.rowCount-n.table.bottomFrozenRowCount&&a>=n.table.frozenColCount&&o<=n.table.colCount-n.table.rightFrozenColCount-1&&(g=!0),o<=n.table.colCount-n.table.rightFrozenColCount-1&&a>=n.table.frozenColCount&&s<=n.table.rowCount-n.table.bottomFrozenRowCount-1&&l>=n.table.frozenRowCount&&(f=!0),p){const b=Math.min(a,n.table.frozenColCount-1),_=Math.min(l,n.table.frozenRowCount-1),y=[!0,!c,!u,!0];n.createCellSelectBorder(o,s,b,_,"cornerHeader",`${o}${s}${a}${l}`,y)}if(v){const b=Math.max(o,n.table.colCount-n.table.rightFrozenColCount),_=Math.min(l,n.table.frozenRowCount-1),y=[!0,!0,!d,!c];n.createCellSelectBorder(b,s,a,_,"rightTopCorner",`${o}${s}${a}${l}`,y)}if(C){const b=Math.min(a,n.table.frozenColCount-1),_=Math.max(s,n.table.rowCount-n.table.bottomFrozenRowCount),y=[!u,!g,!0,!0];n.createCellSelectBorder(o,_,b,l,"leftBottomCorner",`${o}${s}${a}${l}`,y)}if(m){const b=Math.max(o,n.table.colCount-n.table.rightFrozenColCount),_=Math.max(s,n.table.rowCount-n.table.bottomFrozenRowCount),y=[!d,!0,!0,!g];n.createCellSelectBorder(b,_,a,l,"rightBottomCorner",`${o}${s}${a}${l}`,y)}if(c){const b=Math.max(o,n.table.frozenColCount),_=Math.min(a,n.table.colCount-n.table.rightFrozenColCount-1),y=Math.min(l,n.table.frozenRowCount-1),w=[!0,!v,!f,!p];n.createCellSelectBorder(b,s,_,y,"columnHeader",`${o}${s}${a}${l}`,w)}if(g){const b=Math.max(o,n.table.frozenColCount),_=Math.min(a,n.table.colCount-n.table.rightFrozenColCount-1),y=Math.max(s,n.table.rowCount-n.table.bottomFrozenRowCount),w=[!f,!m,!0,!C];n.createCellSelectBorder(b,y,_,l,"bottomFrozen",`${o}${s}${a}${l}`,w)}if(u){const b=Math.max(s,n.table.frozenRowCount),_=Math.min(l,n.table.rowCount-n.table.bottomFrozenRowCount-1),y=Math.min(a,n.table.frozenColCount-1),w=[!p,!f,!C,!0];n.createCellSelectBorder(o,b,y,_,"rowHeader",`${o}${s}${a}${l}`,w)}if(d){const b=Math.max(s,n.table.frozenRowCount),_=Math.min(l,n.table.rowCount-n.table.bottomFrozenRowCount-1),y=Math.max(o,n.table.colCount-n.table.rightFrozenColCount),w=[!v,!0,!m,!f];n.createCellSelectBorder(y,b,a,_,"rightFrozen",`${o}${s}${a}${l}`,w)}if(f){const b=Math.max(o,n.table.frozenColCount),_=Math.max(s,n.table.frozenRowCount),y=Math.min(a,n.table.colCount-n.table.rightFrozenColCount-1),w=Math.min(l,n.table.rowCount-n.table.bottomFrozenRowCount-1),S=[!c,!d,!g,!u];n.createCellSelectBorder(b,_,y,w,"body",`${o}${s}${a}${l}`,S)}}function CL(n){n.selectingRangeComponents.forEach((t,e)=>{t.rect.setAttribute("visible",!1)}),n.selectedRangeComponents.forEach((t,e)=>{t.rect.setAttribute("visible",!1)})}function bL(n){n.selectingRangeComponents.forEach((t,e)=>{t.rect.setAttribute("visible",!1)}),n.selectedRangeComponents.forEach((t,e)=>{t.rect.setAttribute("visible",!1)})}function _L(n,t,e,i,r,o,s,a){var l,h,u,d;const c=Math.min(t,i),g=Math.min(e,r),f=Math.max(t,i),p=Math.max(e,r),v=n.highPerformanceGetCell(c,g).globalAABBBounds,m=n.table.theme,C=(l=m.selectionStyle)===null||l===void 0?void 0:l.cellBorderColor,b=(h=m.selectionStyle)===null||h===void 0?void 0:h.cellBorderLineWidth,_=Ge({pickable:!1,fill:(d=(u=m.selectionStyle)===null||u===void 0?void 0:u.cellBgColor)!==null&&d!==void 0?d:"rgba(0, 0, 255,0.1)",lineWidth:b,stroke:a.map(y=>!!y&&C),x:v.x1-n.tableGroup.attribute.x,y:v.y1-n.tableGroup.attribute.y,width:0,height:0,visible:!0});n.lastSelectId=s,n.selectingRangeComponents.set(`${c}-${g}-${f}-${p}-${s}`,{rect:_,role:o}),n.tableGroup.insertAfter(_,o==="body"?n.bodyGroup:o==="columnHeader"?n.colHeaderGroup:o==="rowHeader"?n.rowHeaderGroup:o==="cornerHeader"?n.cornerHeaderGroup:o==="rightTopCorner"?n.rightTopCornerGroup:o==="rightFrozen"?n.rightFrozenGroup:o==="leftBottomCorner"?n.leftBottomCornerGroup:o==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup)}function j1(n){n.selectingRangeComponents.forEach((t,e)=>{n.selectedRangeComponents.get(e)&&n.selectedRangeComponents.get(e).rect.delete(),n.selectedRangeComponents.set(e,t)}),n.selectingRangeComponents=new Map,n.updateNextFrame()}function yL(n){n.selectedRangeComponents.forEach((t,e)=>{e.split("-")[4]===n.lastSelectId&&(t.rect.delete(),n.selectedRangeComponents.delete(e))})}function V1(n){n.selectedRangeComponents.forEach((t,e)=>{t.rect.delete()}),n.selectedRangeComponents=new Map}function wL(n,t,e,i){const r=i.scenegraph,o=ha(n.map(c=>c.row)).sort((c,g)=>g-c),s=ha(t.map(c=>c.row)).sort((c,g)=>c-g),a=ha(e.map(c=>c.row)).sort((c,g)=>c-g);o.forEach(c=>{DL(c,r)});const l=i.rowHeightsMap;if(o.forEach(c=>{l.delete(c)}),o.length){AL(r);const c=t0(o[o.length-1]-1,o[0]-o.length+1,r);lt(c)&&(r.proxy.rowUpdatePos=Math.min(r.proxy.rowUpdatePos,c))}let h;if(r.table._clearRowRangeHeightsMap(),s.forEach(c=>{const g=SL(c,r);h=h!=null?h:g,l.insert(c)}),xL(r),s.length){const c=t0(s[0]-1,s[s.length-1]+1,r);lt(c)&&(r.proxy.rowUpdatePos=Math.min(r.proxy.rowUpdatePos,c))}for(let c=0;c<i.colCount;c++)a.forEach(g=>{const f=ze(r.table,c,g);if(f)for(let p=f.start.col;p<=f.end.col;p++)for(let v=f.start.row;v<=f.end.row;v++)xa(p,v,r.table,!1);else xa(c,g,r.table,!1)});if(a.length){const c=t0(a[0]-1,a[a.length-1]+1,r);lt(c)&&(r.proxy.rowUpdatePos=Math.min(r.proxy.rowUpdatePos,c))}if(lt(h)){for(let c=0;c<i.colCount;c++)for(let g=h;g<i.rowCount;g++){const f=r.highPerformanceGetCell(c,g,!0);f&&(f.needUpdate=!0)}r.proxy.rowUpdatePos=Math.min(r.proxy.rowUpdatePos,h)}if(s.length){if(!lt(h)){const c=Math.min(...s);r.proxy.rowUpdatePos=Math.min(c,r.proxy.rowUpdatePos)}r.proxy.rowUpdateDirection="up",r.proxy.updateCellGroups(2*r.proxy.screenRowCount),d()}else o.length&&(r.proxy.updateCellGroups(2*r.proxy.screenRowCount),d(),r.proxy.progress());r.proxy.progress();const u=i.getRowsHeight(i.frozenRowCount,i.rowCount-1-i.bottomFrozenRowCount);function d(){if((s==null?void 0:s[(s==null?void 0:s.length)-1])>=i.rowCount-i.bottomFrozenRowCount||(a==null?void 0:a[(a==null?void 0:a.length)-1])>=i.rowCount-i.bottomFrozenRowCount||(o==null?void 0:o[0])>=i.rowCount-i.bottomFrozenRowCount){for(let c=0;c<i.colCount;c++)for(let g=i.rowCount-i.bottomFrozenRowCount;g<i.rowCount;g++){const f=r.highPerformanceGetCell(c,g,!0);f&&(f.needUpdate=!0)}r.proxy.updateBottomFrozenCellGroups()}}r.updateContainerHeight(r.table.frozenRowCount,u-r.bodyGroup.attribute.height)}function DL(n,t){BL(n,t);const e=t.proxy;n>=e.rowStart&&n<=e.rowEnd&&(e.rowEnd--,e.currentRow--),e.bodyBottomRow--;const i=Math.min(e.rowLimit,e.bodyBottomRow-e.bodyTopRow+1);e.totalActualBodyRowCount=i,e.totalRow=e.rowStart+i-1}function SL(n,t){const e=t.proxy;e.bodyBottomRow++;const i=Math.min(e.rowLimit,e.bodyBottomRow-e.bodyTopRow+1);if(e.totalActualBodyRowCount=i,e.totalRow=e.rowStart+i-1,!(n<e.rowStart))return n>e.rowEnd?e.rowEnd-e.rowStart+1<e.rowLimit?(e.rowEnd++,e.currentRow++,G1(n,t),n):void 0:(e.rowEnd-e.rowStart+1<e.rowLimit&&(e.rowEnd++,e.currentRow++,G1(n,t)),n)}function AL(n){function t(e,i){e.row=i;const r=ze(n.table,e.col,e.row);r?(e.mergeStartCol=r.start.col,e.mergeEndCol=r.end.col,e.mergeStartRow=r.start.row,e.mergeEndRow=r.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}n.bodyGroup.forEachChildren(e=>{let i=n.bodyRowStart;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.rowHeaderGroup.forEachChildren(e=>{let i=n.bodyRowStart;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.rightFrozenGroup.forEachChildren(e=>{let i=n.bodyRowStart;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.bottomFrozenGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.leftBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.rightBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e==null||e.forEachChildren(r=>{t(r,i),i++})})}function xL(n){function t(e,i,r){e.row=i,e.setAttribute("y",r);const o=ze(n.table,e.col,e.row);o?(e.mergeStartCol=o.start.col,e.mergeEndCol=o.end.col,e.mergeStartRow=o.start.row,e.mergeEndRow=o.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}n.bodyGroup.forEachChildren(e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e==null||e.forEachChildren(o=>{t(o,i,r),i++,r+=o.attribute.height})}),n.rowHeaderGroup.forEachChildren(e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e==null||e.forEachChildren(o=>{t(o,i,r),i++,r+=o.attribute.height})}),n.rightFrozenGroup.forEachChildren(e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e==null||e.forEachChildren(o=>{t(o,i,r),i++,r+=o.attribute.height})}),n.bottomFrozenGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e==null||e.forEachChildren(o=>{t(o,i,r),i++,r+=o.attribute.height})}),n.leftBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e==null||e.forEachChildren(o=>{t(o,i,r),i++,r+=o.attribute.height})}),n.rightBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e==null||e.forEachChildren(o=>{t(o,i,r),i++,r+=o.attribute.height})})}function G1(n,t){for(let e=0;e<t.table.colCount;e++){const i=new jt({x:0,y:0,width:t.table.getColWidth(e),height:t.table.getRowHeight(n)});if(i.role="cell",i.col=e,i.row=n,i.needUpdate=!0,!i)continue;const r=t.getColGroup(e);if(r)if(r.firstChild&&n<r.firstChild.row)r.insertBefore(i,r.firstChild),r.firstChild.row=r.firstChild.row+1;else if(r.lastChild&&n>r.lastChild.row)r.appendChild(i);else{const o=t.highPerformanceGetCell(e,n,!0);o!==i&&(r.insertBefore(i,o),o&&(o.row=o.row+1),o!==r.lastChild&&r.lastChild&&(r.lastChild.row=r.lastChild.row+1))}}}function BL(n,t){for(let e=0;e<t.table.colCount;e++){const i=t.getColGroup(e,!1);if(!i)continue;let r;i.forEachChildren(o=>o.row===n&&(r=o,!0)),r&&(i.updateColumnHeight(-r.attribute.height),i.removeChild(r))}}function t0(n,t,e){let i;for(let r=0;r<e.table.colCount;r++){const o=e.table.getCellRange(r,n);o.start.row<=n+1&&o.end.row>=n+1&&(U1(o,e),i=o.start.row);const s=e.table.getCellRange(r,t);s.start.row<=t-1&&s.end.row>=t-1&&(U1(s,e),i=o.start.row)}return i}function U1(n,t){const{start:e,end:i}=n;for(let r=e.col;r<=i.col;r++)for(let o=e.row;o<=i.row;o++){const s=t.highPerformanceGetCell(r,o,!0);s&&(s.needUpdate=!0)}}function e0(n){const{changedCells:t}=n.internalProps.stick;t.forEach(f=>{n.scenegraph.getCell(f.col,f.row).forEachChildren(p=>{p.setAttributes({dx:f.dx,dy:f.dy})})}),t.clear();const{scrollTop:e,scrollLeft:i,frozenRowCount:r,frozenColCount:o}=n,s=n.getFrozenRowsHeight(),a=n.getFrozenColsWidth(),{row:l}=n.getRowAt(e+s+1),{col:h}=n.getColAt(i+a+1),u=Math.max(l,n.frozenRowCount),d=Math.max(h,n.frozenColCount),c=n.getAllRowsHeight()>n.tableNoFrameHeight?n.getRowAt(e+n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()-1).row:n.rowCount-n.bottomFrozenRowCount-1,g=n.getAllColsWidth()>n.tableNoFrameWidth?n.getColAt(i+n.tableNoFrameWidth-n.getRightFrozenColsWidth()-1).col:n.colCount-n.rightFrozenColCount-1;if(!(g<0||c<0)){for(let f=0;f<r&&!(g<d);f++)[d,g].forEach(p=>{const v=n._getCellStyle(p,f);v!=null&&v.textStick&&$1(n.scenegraph.getCell(p,f),a+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,t,v==null?void 0:v.textStickBaseOnAlign,n)});for(let f=0;f<o&&!(c<u);f++)[u,c].forEach(p=>{const v=n._getCellStyle(f,p);v!=null&&v.textStick&&n.internalProps.layoutMap.rowHierarchyType!=="tree"&&K1(n.scenegraph.getCell(f,p),s+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,t,v==null?void 0:v.textStickBaseOnAlign,n)});for(let f=d;f<=g&&!(c<u);f++)[u,c].forEach(p=>{const v=n._getCellStyle(f,p);v!=null&&v.textStick&&K1(n.scenegraph.getCell(f,p),s+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,t,v==null?void 0:v.textStickBaseOnAlign,n)});for(let f=u;f<c&&!(g<d);f++)[d,g].forEach(p=>{var v;const m=n._getCellStyle(p,f);!((v=n._getCellStyle(p,f))===null||v===void 0)&&v.textStick&&$1(n.scenegraph.getCell(p,f),a+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,t,m==null?void 0:m.textStickBaseOnAlign,n)})}}function K1(n,t,e,i,r,o){if(lt(n.mergeStartCol)&&lt(n.mergeStartRow)&&lt(n.mergeEndCol)&&lt(n.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ro(n,o.scenegraph);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++)Y1(o.scenegraph.getCell(u,d),t,e,i,r)}else Y1(n,t,e,i,r)}function Y1(n,t,e,i,r){var o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y;const w=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!w)return;if(w.type==="image"){const{image:x}=w.attribute;if(!x||!w.resources||w.resources.get(x).state!=="success")return}const S=(o=w.textBaseline)!==null&&o!==void 0?o:"top";w.AABBBounds.width();const D=w.globalAABBBounds.y1,A=w.globalAABBBounds.y2;if(S==="middle"&&r){const x=n.globalAABBBounds.y1+((a=(s=n.firstChild)===null||s===void 0?void 0:s.attribute.dy)!==null&&a!==void 0?a:0),B=x+((h=(l=n.contentHeight)!==null&&l!==void 0?l:n.attribute.height)!==null&&h!==void 0?h:0);if(x<t||B>e){const F=Math.max(x,t),T=Math.min(B,e),R=w.globalTransMatrix.f-(T+F)/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(d=(u=n.firstChild)===null||u===void 0?void 0:u.attribute.dx)!==null&&d!==void 0?d:0,dy:(g=(c=n.firstChild)===null||c===void 0?void 0:c.attribute.dy)!==null&&g!==void 0?g:0}),n.forEachChildren(M=>{var E;M.setAttribute("dy",((E=M.attribute.dy)!==null&&E!==void 0?E:0)-R+2)})}}else if(D<t){const x=D-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(p=(f=n.firstChild)===null||f===void 0?void 0:f.attribute.dx)!==null&&p!==void 0?p:0,dy:(m=(v=n.firstChild)===null||v===void 0?void 0:v.attribute.dy)!==null&&m!==void 0?m:0}),n.forEachChildren(B=>{var F;B.setAttribute("dy",((F=B.attribute.dy)!==null&&F!==void 0?F:0)-x+2)})}else if(A>e){const x=A-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(b=(C=n.firstChild)===null||C===void 0?void 0:C.attribute.dx)!==null&&b!==void 0?b:0,dy:(y=(_=n.firstChild)===null||_===void 0?void 0:_.attribute.dy)!==null&&y!==void 0?y:0}),n.forEachChildren(B=>{var F;B.setAttribute("dy",((F=B.attribute.dy)!==null&&F!==void 0?F:0)-x)})}}function $1(n,t,e,i,r,o){if(lt(n.mergeStartCol)&&lt(n.mergeStartRow)&&lt(n.mergeEndCol)&&lt(n.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ro(n,o.scenegraph);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++)X1(o.scenegraph.getCell(u,d),t,e,i,r)}else X1(n,t,e,i,r)}function X1(n,t,e,i,r){var o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w;const S=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!S)return;if(S.type==="image"){const{image:B}=S.attribute;if(!B||!S.resources||S.resources.get(B).state!=="success")return}const D=(s=(o=S.attribute.textAlign)!==null&&o!==void 0?o:S.textAlign)!==null&&s!==void 0?s:"left";S.AABBBounds.width();const A=S.globalAABBBounds.x1,x=S.globalAABBBounds.x2;if(D==="center"&&r){const B=n.globalAABBBounds.x1+((l=(a=n.firstChild)===null||a===void 0?void 0:a.attribute.dx)!==null&&l!==void 0?l:0),F=B+((u=(h=n.contentWidth)!==null&&h!==void 0?h:n.attribute.width)!==null&&u!==void 0?u:0);if(B<t||F>e){const T=Math.max(B,t),R=Math.min(F,e),M=S.globalTransMatrix.e-(R+T)/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(c=(d=n.firstChild)===null||d===void 0?void 0:d.attribute.dx)!==null&&c!==void 0?c:0,dy:(f=(g=n.firstChild)===null||g===void 0?void 0:g.attribute.dy)!==null&&f!==void 0?f:0}),n.forEachChildren(E=>{var P;E.setAttribute("dx",((P=E.attribute.dx)!==null&&P!==void 0?P:0)-M+2)})}}else if(A<t){const B=A-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(v=(p=n.firstChild)===null||p===void 0?void 0:p.attribute.dx)!==null&&v!==void 0?v:0,dy:(C=(m=n.firstChild)===null||m===void 0?void 0:m.attribute.dy)!==null&&C!==void 0?C:0}),n.forEachChildren(F=>{var T;F.setAttribute("dx",((T=F.attribute.dx)!==null&&T!==void 0?T:0)-B+2)})}else if(x>e){const B=x-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(_=(b=n.firstChild)===null||b===void 0?void 0:b.attribute.dx)!==null&&_!==void 0?_:0,dy:(w=(y=n.firstChild)===null||y===void 0?void 0:y.attribute.dy)!==null&&w!==void 0?w:0}),n.forEachChildren(F=>{var T;F.setAttribute("dx",((T=F.attribute.dx)!==null&&T!==void 0?T:0)-B)})}}function i0(n){var t,e;const i=n.internalProps.layoutMap.headerObjects,r=n.internalProps.layoutMap.columnObjects;for(let o=0;o<i.length;o++){const s=i[o];if(s&&(!((t=s.style)===null||t===void 0)&&t.textStick))return!0}for(let o=0;o<r.length;o++){const s=r[o];if(s&&(!((e=s.style)===null||e===void 0)&&e.textStick))return!0}return!1}function FL(n){var t,e;if(n.table.frozenColCount>n.table.rowHeaderLevelCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let i=0;i<n.table.frozenColCount-n.table.rowHeaderLevelCount;i++)q1(n),Z1(n),ty(n)}else if(n.table.frozenColCount<n.table.rowHeaderLevelCount)for(let i=0;i<n.table.rowHeaderLevelCount-n.table.frozenColCount;i++)J1(n),Q1(n),ey(n);n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose||n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.hasFrozen=!0,n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(e=(t=n.colHeaderGroup.firstChild)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:0}function TL(n){var t,e;if(n.frozenColCount>n.table.frozenColCount)for(let i=0;i<n.frozenColCount-n.table.frozenColCount;i++)J1(n),Q1(n),ey(n);else if(n.frozenColCount<n.table.frozenColCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let i=0;i<n.table.frozenColCount-n.frozenColCount;i++)q1(n),Z1(n),ty(n)}n.deleteAllSelectBorder(),n.table.stateManager.select.ranges.forEach(i=>{n.updateCellSelectBorder(i.start.col,i.start.row,i.end.col,i.end.row)}),n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(e=(t=n.colHeaderGroup.firstChild)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:0,n.proxy.colStart=n.table.frozenColCount,n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose||n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.hasFrozen=!0}function q1(n){const t=n.bodyGroup.firstChild instanceof jt?n.bodyGroup.firstChild:null;t&&(n.rowHeaderGroup.appendChild(t),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width+t.attribute.width),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width-t.attribute.width))}function Z1(n){const t=n.colHeaderGroup.firstChild instanceof jt?n.colHeaderGroup.firstChild:null;t&&(n.cornerHeaderGroup.appendChild(t),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width+t.attribute.width),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width-t.attribute.width))}function J1(n){var t;const e=n.rowHeaderGroup.lastChild instanceof jt?n.rowHeaderGroup.lastChild:(t=n.rowHeaderGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(dr(n.bodyGroup,e,n.bodyGroup.firstChild),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width+e.attribute.width),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width-e.attribute.width))}function Q1(n){var t;const e=n.cornerHeaderGroup.lastChild instanceof jt?n.cornerHeaderGroup.lastChild:(t=n.cornerHeaderGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(dr(n.colHeaderGroup,e,n.colHeaderGroup.firstChild),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width+e.attribute.width),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width-e.attribute.width))}function ty(n){const t=n.bottomFrozenGroup.firstChild instanceof jt?n.bottomFrozenGroup.firstChild:null;t&&(n.leftBottomCornerGroup.appendChild(t),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width+t.attribute.width),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width-t.attribute.width),n.table.isPivotChart()&&t.forEachChildren(e=>{e.setAttributes({stroke:!1,fill:!1})}))}function ey(n){var t;const e=n.leftBottomCornerGroup.lastChild instanceof jt?n.leftBottomCornerGroup.lastChild:(t=n.leftBottomCornerGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(dr(n.bottomFrozenGroup,e,n.bottomFrozenGroup.firstChild),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width+e.attribute.width),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width-e.attribute.width),n.table.isPivotChart()&&e.forEachChildren(i=>{var r,o,s,a;const l=n.table._getCellStyle(i.col,i.row),h=n.table.getCellRange(i.col,i.row),u=io(l,n.table,h?h.start.col:i.col,h?h.start.row:i.row,Ct).theme;i.setAttributes({fill:(o=(r=u==null?void 0:u.group)===null||r===void 0?void 0:r.fill)!==null&&o!==void 0?o:void 0,stroke:(a=(s=u==null?void 0:u.group)===null||s===void 0?void 0:s.stroke)!==null&&a!==void 0?a:void 0})}))}function ML(n,t){const{table:e,proxy:i,rightTopCornerGroup:r,rightFrozenGroup:o,rightBottomCornerGroup:s,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=t,u=t.table.rightFrozenColCount;if(n>u){for(let c=e.colCount-u-1;c>=e.colCount-n;c--)dr(o,t.getColGroup(c),o.firstChild),dr(r,t.getColGroup(c,!0),r.firstChild),dr(s,t.getColGroupInBottom(c),s.firstChild);let d=0;o.forEachChildren(c=>{c.setAttribute("x",d),d+=c.attribute.width}),d=0,r.forEachChildren(c=>{c.setAttribute("x",d),d+=c.attribute.width}),d=0,s.forEachChildren(c=>{c.setAttribute("x",d),d+=c.attribute.width})}else if(n<u){for(let c=e.colCount-u;c<e.colCount-n;c++){const g=t.getColGroup(c);g.setAttribute("x",l.lastChild.attribute.x+e.getColWidth(l.lastChild.col)),l.appendChild(g);const f=t.getColGroupInRightTopCorner(c);f.setAttribute("x",h.lastChild.attribute.x+e.getColWidth(h.lastChild.col)),h.appendChild(f);const p=t.getColGroupInRightBottomCorner(c);p.setAttribute("x",a.lastChild.attribute.x+e.getColWidth(a.lastChild.col)),a.appendChild(p)}let d=0;o.forEachChildren(c=>{c.setAttribute("x",d),d+=c.attribute.width}),d=0,r.forEachChildren(c=>{c.setAttribute("x",d),d+=c.attribute.width}),d=0,s.forEachChildren(c=>{c.setAttribute("x",d),d+=c.attribute.width})}o.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),r.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),s.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),e.internalProps.rightFrozenColCount=n,t.updateContainer(),t.component.updateScrollBar(),t.updateNextFrame()}function RL(n,t){const{table:e,proxy:i,bottomFrozenGroup:r,leftBottomCornerGroup:o,rightBottomCornerGroup:s}=t;r.childrenCount||(i.table.isPivotChart()||(xi(o,0,0,0,e.frozenColCount-1,0,-1,"rowHeader",e),xi(s,0,0,e.colCount-e.rightFrozenColCount,e.colCount-1,0,-1,"body",e)),xi(r,0,0,i.colStart,i.colEnd,0,-1,"body",e));const a=t.table.bottomFrozenRowCount;if(n>a){for(let l=0;l<e.frozenColCount;l++){const h=t.getColGroupInLeftBottomCorner(l);for(let d=e.rowCount-a-1;d>=e.rowCount-n;d--)dr(h,t.getCell(l,d,!0),h.firstChild);let u=0;h.forEachChildren(d=>{d.setAttribute("y",u),u+=e.getRowHeight(d.row)})}for(let l=i.colStart;l<=i.colEnd;l++){const h=t.getColGroupInBottom(l);for(let d=e.rowCount-a-1;d>=e.rowCount-n;d--)dr(h,t.getCell(l,d,!0),h.firstChild);let u=0;h.forEachChildren(d=>{d.setAttribute("y",u),u+=e.getRowHeight(d.row)})}if(e.rightFrozenColCount>0)for(let l=e.colCount-e.rightFrozenColCount;l<e.colCount;l++){const h=t.getColGroupInRightBottomCorner(l);for(let d=e.rowCount-a-1;d>=e.rowCount-n;d--)dr(h,t.getCell(l,d,!0),h.firstChild);let u=0;h.forEachChildren(d=>{d.setAttribute("y",u),u+=e.getRowHeight(d.row)})}}else if(n<a){for(let l=0;l<e.rowHeaderLevelCount;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const u=t.getColGroupInLeftBottomCorner(l);let d=0;u.forEachChildren(c=>{c.setAttribute("y",d),d+=e.getRowHeight(c.row)})}for(let l=i.colStart;l<=i.colEnd;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const u=t.getColGroupInBottom(l);let d=0;u.forEachChildren(c=>{c.setAttribute("y",d),d+=e.getRowHeight(c.row)})}if(e.rightFrozenColCount>0)for(let l=e.colCount-e.rightFrozenColCount;l<e.colCount;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const u=t.getColGroupInRightBottomCorner(l);let d=0;u.forEachChildren(c=>{c.setAttribute("y",d),d+=e.getRowHeight(c.row)})}}r.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),o.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),s.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),e.internalProps.bottomFrozenRowCount=n,t.updateContainer(),t.component.updateScrollBar(),t.updateNextFrame()}function dr(n,t,e){t&&n&&(e?n.insertBefore(t,e):n.appendChild(t))}function iy(n){return Object.prototype.toString.call(n)}function ny(n){return Object.keys(n)}function cr(n,t,e){if(n===t)return!0;if(typeof n!=typeof t||n==null||t==null)return!1;if(Number.isNaN(n)&&Number.isNaN(t))return!0;if(iy(n)!==iy(t))return!1;if(ge(n))return!!(e!=null&&e.skipFunction);if(typeof n!="object")return!1;if(rt(n)){if(n.length!==t.length)return!1;for(let o=n.length-1;o>=0;o--)if(!cr(n[o],t[o],e))return!1;return!0}if(!No(n))return!1;const i=ny(n),r=ny(t);if(i.length!==r.length)return!1;i.sort(),r.sort();for(let o=i.length-1;o>=0;o--)if(i[o]!=r[o])return!1;for(let o=i.length-1;o>=0;o--){const s=i[o];if(!cr(n[s],t[s],e))return!1}return!0}function EL(n,t){var e,i;for(let r=t;r<=n.proxy.colEnd;r++){const o=n.getColGroup(r);(e=o==null?void 0:o.getChildren())===null||e===void 0||e.forEach(s=>{const a=n.table.getColWidth(s.col),l=n.table.getRowHeight(s.row);s.children.forEach(h=>{h.type==="chart"&&(h.cacheCanvas=null,h.setAttribute("width",Math.ceil(a-h.attribute.cellPadding[3]-h.attribute.cellPadding[1])),h.setAttribute("height",Math.ceil(l-h.attribute.cellPadding[0]-h.attribute.cellPadding[2])))})})}if(!n.table.isPivotChart()&&n.table.rightFrozenColCount>=1)for(let r=n.table.colCount-n.table.rightFrozenColCount;r<=n.table.colCount-1;r++){const o=n.getColGroup(r);(i=o==null?void 0:o.getChildren())===null||i===void 0||i.forEach(s=>{const a=n.table.getColWidth(s.col),l=n.table.getRowHeight(s.row);s.children.forEach(h=>{h.type==="chart"&&(h.cacheCanvas=null,h.setAttribute("width",Math.ceil(a-h.attribute.cellPadding[3]-h.attribute.cellPadding[1])),h.setAttribute("height",Math.ceil(l-h.attribute.cellPadding[0]-h.attribute.cellPadding[2])))})})}}function td(n){var t;for(let e=n.proxy.colStart;e<=n.proxy.colEnd;e++){const i=n.getColGroup(e);(t=i==null?void 0:i.getChildren())===null||t===void 0||t.forEach(r=>{r.children.forEach(o=>{o.type==="chart"&&(o.cacheCanvas=null,o.addUpdateBoundTag())})})}}function PL(n){var t;const e=n.table;for(let i=n.proxy.colStart;i<=n.proxy.colEnd;i++){const r=n.getColGroup(i);(t=r==null?void 0:r.getChildren())===null||t===void 0||t.forEach(o=>{const s=o.col,a=o.row;o.children.forEach(l=>{if(l.type==="chart"){l.updateData(e.getCellValue(s,a));const h=e.internalProps.layoutMap.getChartAxes(s,a);l.setAttribute("axes",h);const u=l.attribute.spec;u.axes=h,l.setAttribute("spec",u)}})})}ed(n.rowHeaderGroup,n.table),ed(n.colHeaderGroup,n.table),ed(n.rightFrozenGroup,n.table),ed(n.bottomFrozenGroup,n.table)}function HL(n,t){const e=n.table;if(e.isPivotChart()){const i=e._selectedDataItemsInChart.length;if((t===null||(t==null?void 0:t.length)===0||Object.keys(t).length===0)&&i===0)return;const r=[];if(Array.isArray(t))t.forEach(o=>{if(o&&o.key!==0&&Object.keys(o).length>0){const s={};for(const a in o)a.startsWith("VGRAMMAR_")||a.startsWith("__VCHART")||(s[a]=o[a]);r.push(s)}});else if(t&&t.key!==0&&Object.keys(t).length>0){const o={};for(const s in t)s.startsWith("VGRAMMAR_")||s.startsWith("__VCHART")||(o[s]=t[s]);r.push(o)}cr(e._selectedDataItemsInChart,r)||(e._selectedDataItemsInChart=r,e.internalProps.layoutMap.updateDataStateToChartInstance(),td(n),e.scenegraph.updateNextFrame())}}function ed(n,t){n.forEachChildren(e=>{e.role==="column"&&e.forEachChildren(i=>{if(i.role==="cell"){let r=!1;if(i.forEachChildren(o=>o.name==="axis"&&(r=!0,!0)),r){const o=t.internalProps.layoutMap.getAxisConfigInPivotChart(i.col,i.row),s=t._getCellStyle(i.col,i.row),a=$t(Ct("padding",s,i.col,i.row,t)),l=new wf(o,i.attribute.width,i.attribute.height,a,t);i.clear(),i.appendChild(l.component),l.overlap()}}})})}function LL(n){const t=n.table.tableNoFrameWidth,e=n.table.tableNoFrameHeight;n.tableGroup=new jt({x:0,y:0,width:t,height:e,clip:!0,pickable:!1}),n.tableGroup.role="table";const i=Gn(0,0,!0);i.role="col-header",n.colHeaderGroup=i;const r=Gn(0,0,!0);r.role="corner-header",n.cornerHeaderGroup=r;const o=Gn(0,0,!0);o.role="row-header",n.rowHeaderGroup=o;const s=Gn(t,0,!0);s.role="body",n.bodyGroup=s;const a=Gn(0,0,!0);a.role="right-frozen",n.rightFrozenGroup=a;const l=Gn(0,0,!0);l.role="bottom-frozen",n.bottomFrozenGroup=l;const h=Gn(0,0);h.role="component",n.componentGroup=h;const u=Gn(0,0,!0);u.role="corner-right-top-header",n.rightTopCornerGroup=u;const d=Gn(0,0,!0);d.role="corner-right-bottom-header",n.rightBottomCornerGroup=d;const c=Gn(0,0,!0);c.role="corner-left-bottom-header",n.leftBottomCornerGroup=c,n.tableGroup.addChild(s),n.tableGroup.addChild(o),n.tableGroup.addChild(l),n.tableGroup.addChild(i),n.tableGroup.addChild(a),n.tableGroup.addChild(d),n.tableGroup.addChild(u),n.tableGroup.addChild(c),n.tableGroup.addChild(r),n.tableGroup.addChild(h)}function Gn(n,t,e){return new jt({x:0,y:0,width:n,height:t,clip:e!=null&&e,pickable:!1})}function gr(n,t){return n.forEachChildrenSkipChild((e,i)=>{e.setAttribute("x",t),t+=e.attribute.width}),t}const ry={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},oy={poptip:gt({},ry)};function kL(){Dn(),Yh(),zo(),Yr()}function IL(n){gt(oy.poptip,ry,n)}var OL=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const sy=new me;kL();class La extends Nn{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},La.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,r,o,s,a,l;const{titleStyle:h={},position:u,contentStyle:d={},panel:c={},space:g=4,minWidth:f=0,maxWidth:p=1/0,padding:v=4,maxWidthPercent:m,visible:C,state:b,dx:_=0,dy:y=0}=this.attribute;let{title:w="",content:S=""}=this.attribute;w=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(w):w,S=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(S):S;const D=Wn(v),A=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group"),x=p-D[1]-D[3],B=N(w)&&C!==!1,F=Object.assign(Object.assign({text:rt(w)?w:[w],visible:B},h),{x:D[3],y:D[0],maxLineWidth:x,textAlign:"left",textBaseline:"top"}),T=A.createOrUpdateChild("poptip-title",F,"wrapText");Bt(b==null?void 0:b.title)||(T.states=b.title);const R=T.AABBBounds,M=R.height(),E=R.width();let P=M+g;B||(P=0);const I=N(S)&&C!==!1,k=Object.assign(Object.assign({text:rt(S)?S:[S],visible:I},d),{x:D[3],y:D[0]+P,maxLineWidth:x,textAlign:"left",textBaseline:"top"}),H=A.createOrUpdateChild("poptip-content",k,"wrapText");Bt(b==null?void 0:b.content)||(H.states=b.content);const O=H.AABBBounds,z=O.height(),j=O.width();I&&(P+=z);let U=Cn(E+D[1]+D[3],j+D[1]+D[3]);U>p?U=p:U<f&&(U=f);let W=D[0]+D[2]+P;const{visible:V}=c,L=OL(c,["visible"]),G=(t=L.size)!==null&&t!==void 0?t:12,K=rt(G)?[G[0]+((e=L.space)!==null&&e!==void 0?e:0),G[1]+((i=L.space)!==null&&i!==void 0?i:0)]:G+((r=L.space)!==null&&r!==void 0?r:0),Y=(o=L.lineWidth)!==null&&o!==void 0?o:1,nt=this.stage?[(s=this.stage.viewWidth)!==null&&s!==void 0?s:this.stage.width,(a=this.stage.viewHeight)!==null&&a!==void 0?a:this.stage.height]:void 0;if(nt){const et=this.AABBBounds,ft=(l=this.attribute.x)!==null&&l!==void 0?l:et.x1,tt=nt[0]-et.x1;let dt=Math.max(ft,tt);const J=(rt(G)?G[0]:12)+3;if(dt=Math.min(dt-J,dt*m),dt<U){U=dt;const it=D[1]+D[3];T.setAttribute("maxLineWidth",dt-it),H.setAttribute("maxLineWidth",dt-it),W=D[0]+D[2],B&&(W+=T.AABBBounds.height()+g),W+=H.AABBBounds.height()}}const q=u==="auto";let ot,at=-1/0;for(let et=0;et<this.positionList.length+1;et++){const ft=q?this.positionList[et===this.positionList.length?ot:et]:u,{angle:tt,offset:dt,rectOffset:J}=this.getAngleAndOffset(ft,U,W,rt(K)?K:[K,K-Y]);if(Li(V)){const it=(rt(G)?G[0]:G)/4,_t=A.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},L),{visible:V&&(I||B),x:it,y:0,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:"arrow2Left",angle:tt,dx:dt[0],dy:dt[1],size:G,zIndex:-9}),"symbol");Bt(b==null?void 0:b.panel)||(_t.states=b.panel);const Xt=A.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},L),{visible:V&&(I||B),x:0,y:0,width:U,height:W,zIndex:-8}),"rect");Bt(b==null?void 0:b.panel)||(Xt.states=b.panel)}if(A.setAttributes({x:-dt[0]+_,y:-dt[1]+y}),!q||!nt)break;{sy.setValue(0,0,U,W).transformWithMatrix(A.globalTransMatrix);const it=sy,_t=new Ji().setValue(0,0,nt[0],nt[1]);if(oA(it,_t,!1))break;{const Xt=Cv(it,_t,!1),ae=(Xt.x2-Xt.x1)*(Xt.y2-Xt.y1);ae>at&&(at=ae,ot=et)}}}}getAngleAndOffset(t,e,i,r){const o=r[1]/2;switch(t){case"tl":return{angle:Kt/2*3,offset:[e/4,i+o],rectOffset:[-e/4,-i-r[1]]};case"top":return{angle:Kt/2*3,offset:[e/2,i+o],rectOffset:[0,-i-r[1]]};case"tr":return{angle:Kt/2*3,offset:[e/4*3,i+o],rectOffset:[e/4*3,-i-r[1]]};case"rt":return{angle:0,offset:[-o,i/5],rectOffset:[e/4*3,-i-r[1]]};case"right":return{angle:0,offset:[-o,i/2],rectOffset:[e/4*3,-i-r[1]]};case"rb":return{angle:0,offset:[-o,i/5*4],rectOffset:[e/4*3,-i-r[1]]};case"bl":return{angle:Kt/2,offset:[e/4,-o],rectOffset:[-e/4,-i-r[1]]};case"bottom":return{angle:Kt/2,offset:[e/2,-o],rectOffset:[0,-i-r[1]]};case"br":return{angle:Kt/2,offset:[e/4*3,-o],rectOffset:[e/4*3,-i-r[1]]};case"lt":return{angle:Kt,offset:[e+o,i/5],rectOffset:[-e/4,-i-r[1]]};case"left":return{angle:Kt,offset:[e+o,i/2],rectOffset:[0,-i-r[1]]};case"lb":return{angle:Kt,offset:[e+o,i/5*4],rectOffset:[e/4*3,-i-r[1]]}}}}La.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},maxWidthPercent:.8,space:8,padding:10};var zL=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};function WL(n,t){return gt(n,oy.poptip,t),n}let ka=class{render(n,t,e,i,r,o,s,a,l,h,u,d,c){var g;if(n._showPoptip===1){const{visible:f,visibleCb:p}=n.attribute.poptip||{};if(f===!1||p&&p(n)===!1)return;const v={};gt(v,La.defaultAttributes,n.attribute.poptip?n.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(v):this.poptipComponent=new La(v);let m=n.attribute.poptip||{};if(n.type==="text"&&m.title==null&&m.content==null){const _={};WL(_,m),m=_,m.content=(g=m.content)!==null&&g!==void 0?g:n.attribute.text}const C=n.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1},m),{x:C.e,y:C.f})),h.stage.tryInitInteractiveLayer();const b=h.stage.getLayer("_builtin_interactive");b&&b.add(this.poptipComponent)}else n._showPoptip===2&&(n._showPoptip=0,this.poptipComponent&&this.poptipComponent.setAttributes({visibleAll:!1}))}};ka=zL([Z()],ka);var ay=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Ia=class{constructor(){this.name="poptip",this.activeEvent="onRegister",this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid,this.poptip=n=>{const t=n.target;if(t.isContainer||!t.attribute)return void this.unpoptip(n);if(t===this.activeGraphic)return;const{poptip:e}=t.attribute;e&&(t.setAttributes({}),t._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(t,!0)},this.unpoptip=n=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(n){this.pluginService=n;const{stage:t}=this.pluginService;t.addEventListener("pointerover",this.poptip)}setActiveGraphic(n,t){this.activeGraphic=n,this.pluginService.stage.renderNextFrame()}deactivate(n){const{stage:t}=this.pluginService;t.removeEventListener("pointerover",this.poptip)}};Ia=ay([Z()],Ia);let Oa=class{constructor(){this.name="poptipForText",this.activeEvent="onRegister",this._uid=Gt.GenAutoIncrementId(),this.key=this.name+this._uid,this.pointerlave=n=>{const{stage:t}=this.pluginService;n.target===t&&this.unpoptip(n)},this.poptip=n=>{const t=n.target;if(t.type!=="text"||!t.cliped||t.isContainer||!t.attribute||t.attribute.disableAutoClipedPoptip)return void this.unpoptip(n);if(t===this.activeGraphic)return;const{poptip:e={}}=t.attribute;e&&(t.setAttributes({}),t._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(t,!0)},this.unpoptip=n=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(n){this.pluginService=n;const{stage:t}=this.pluginService;t.addEventListener("pointerover",this.poptip),t.addEventListener("pointerleave",this.pointerlave)}setActiveGraphic(n,t){this.activeGraphic=n,this.pluginService.stage.renderNextFrame()}deactivate(n){const{stage:t}=this.pluginService;t.removeEventListener("pointerover",this.poptip),t.removeEventListener("pointerleave",this.pointerlave)}};Oa=ay([Z()],Oa);const NL=new ht((n,t,e,i)=>{e(ka)||(n(ka).toSelf().inSingletonScope(),n(Ic).toService(ka)),e(Ia)||(n(Ia).toSelf(),n(Ls).toService(Ia)),e(Oa)||(n(Oa).toSelf(),n(Ls).toService(Oa))});function jL(){pt.load(NL)}function VL(n,t,e){n!==-1&&t!==-1&&(Mn(n,t,i=>i.attribute.visibleTime==="mouseenter_cell",i=>{i.setAttribute("opacity",0)},e),e.updateNextFrame())}function GL(n,t,e){n!==-1&&t!==-1&&(Mn(n,t,i=>i.attribute.visibleTime==="mouseenter_cell",i=>{i.setAttribute("opacity",1)},e),e.updateNextFrame())}function UL(n,t,e){n!==-1&&t!==-1&&(Mn(n,t,i=>i.attribute.visibleTime==="click_cell",i=>{i.setAttribute("opacity",0)},e),e.updateNextFrame())}function KL(n,t,e){n!==-1&&t!==-1&&(Mn(n,t,i=>i.attribute.visibleTime==="click_cell",i=>{i.setAttribute("opacity",1)},e),e.updateNextFrame())}function YL(n,t,e,i,r){let o;return r.getCell(n,t).forEachChildren(s=>{s.role&&s.role.startsWith("icon")&&s.containsPoint(e,i,ps.GLOBAL)&&(o=s)}),o}function $L(n,t,e,i,r){var o,s;if((n.attribute.backgroundColor||n.attribute.hoverImage)&&Mn(t,e,a=>a.name===n.name,a=>{var l,h,u,d,c,g,f,p,v,m;if(a.attribute.backgroundColor){let C=a.parent.getChildByName("icon-back");C?C.setAttributes({x:((l=a.attribute.x)!==null&&l!==void 0?l:0)+((h=a.attribute.dx)!==null&&h!==void 0?h:0)+(a.AABBBounds.width()-a.backgroundWidth)/2,y:((u=a.attribute.y)!==null&&u!==void 0?u:0)+(a.AABBBounds.height()-a.backgroundHeight)/2,dx:(d=a.attribute.dx)!==null&&d!==void 0?d:0,dy:(c=a.attribute.dy)!==null&&c!==void 0?c:0,width:a.backgroundWidth,height:a.backgroundHeight,fill:a.attribute.backgroundColor,cornerRadius:5,visible:!0}):(C=Ge({x:((g=a.attribute.x)!==null&&g!==void 0?g:0)+((f=a.attribute.dx)!==null&&f!==void 0?f:0)+(a.AABBBounds.width()-a.backgroundWidth)/2,y:((p=a.attribute.y)!==null&&p!==void 0?p:0)+(a.AABBBounds.height()-a.backgroundHeight)/2,dx:(v=a.attribute.dx)!==null&&v!==void 0?v:0,dy:(m=a.attribute.dy)!==null&&m!==void 0?m:0,width:a.backgroundWidth,height:a.backgroundHeight,fill:a.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),C.name="icon-back"),a.parent.insertBefore(C,a)}a.attribute.hoverImage&&a.attribute.image!==a.attribute.hoverImage&&(a.image=a.attribute.hoverImage)},r),n.tooltip){const{x1:a,x2:l,y1:h,y2:u}=n.globalAABBBounds,d={content:n.tooltip.title,referencePosition:{rect:{left:a,right:l,top:h,bottom:u,width:n.globalAABBBounds.width(),height:n.globalAABBBounds.height()},placement:n.tooltip.placement},style:Object.assign({},(o=r.table.internalProps.theme)===null||o===void 0?void 0:o.tooltipStyle,(s=n.tooltip)===null||s===void 0?void 0:s.style)};r.table.internalProps.tooltipHandler.isBinded(d)||r.table.showTooltip(t,e,d)}}function XL(n,t,e,i){(n.attribute.backgroundColor||n.attribute.hoverImage)&&Mn(t,e,r=>r.name===n.name,r=>{const o=r.parent.getChildByName("icon-back");o&&o.setAttribute("visible",!1),r.attribute.hoverImage&&r.attribute.image!==r.attribute.originImage&&(r.image=r.attribute.originImage)},i)}function ly(n,t,e,i,r){const o=n.name;Mn(e,i,s=>s.name===o,s=>{Tn(t,s),s.name=t.name},r),r.updateNextFrame()}function qL(n,t,e,i){const r=i.getCell(n,t);if(N(r.mergeStartCol)&&N(r.mergeStartRow)&&N(r.mergeEndCol)&&N(r.mergeEndRow))for(let o=r.mergeStartCol;o<=r.mergeEndCol;o++)for(let s=r.mergeStartRow;s<=r.mergeEndRow;s++){let a;i.getCell(o,s).forEachChildren(l=>l.attribute.funcType==="sort"&&(a=l,!0)),a&&(Tn(e,a),a.name=e.name)}else{let o;r.forEachChildren(s=>s.attribute.funcType==="sort"&&(o=s,!0)),o&&(Tn(e,o),o.name=e.name)}}function ZL(n,t,e,i,r){const o=r.getCellRange(n,t),s=r.getCellRange(e,i);return o.start.col===s.start.col&&o.start.row===s.start.row&&o.end.col===s.end.col&&o.end.row===s.end.row}function JL(n,t,e,i,r,o,s,a){const l=a.table.internalProps.headerHelper.getSortIcon(i,a.table,n,t);if(e&&ly(e,l,n,t,a),!ZL(n,t,r,o,a.table)){const h=a.table.internalProps.headerHelper.getSortIcon("normal",a.table,r,o);s?ly(s,h,r,o,a):qL(r,o,h,a)}}function QL(n){for(let t=0;t<n.table.colCount;t++)for(let e=0;e<n.table.columnHeaderLevelCount;e++)Mn(t,e,i=>i.attribute.funcType==="frozen",i=>{const r=n.table.internalProps.headerHelper.getFrozenIcon(t,e);Tn(r,i),i.name=r.name},n)}function tk(n,t,e){let i;i=e.table.isHeader(n,t)?e.table.internalProps.headerHelper.getHierarchyIcon(n,t):e.table.internalProps.bodyHelper.getHierarchyIcon(n,t),Mn(n,t,r=>r.attribute.funcType===ne.collapse||r.attribute.funcType===ne.expand,r=>{Tn(i,r),r.name=i.name},e)}function n0(n,t,e){n.forEachChildren(i=>{i.type==="group"?n0(i,t,e):t(i)&&e(i)})}function Mn(n,t,e,i,r){const o=r.getCell(n,t);if(o.role==="cell"&&N(o.mergeStartCol)&&N(o.mergeStartRow)&&N(o.mergeEndCol)&&N(o.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ro(o,r);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++)n0(r.highPerformanceGetCell(u,d),e,i)}else n0(o,e,i)}function ek(n,t,e){Mn(n,t,i=>i.attribute.funcType===ne.dropDown,i=>{i.oldVisibleTime=i.attribute.visibleTime,i.setAttribute("visibleTime","always"),i.setAttribute("opacity",1)},e)}function ik(n,t,e){Mn(n,t,i=>i.attribute.funcType===ne.dropDown,i=>{i.oldVisibleTime&&i.setAttribute("visibleTime",i.oldVisibleTime),i.setAttribute("opacity",i.attribute.visibleTime==="always"?1:0)},e)}function r0(n,t){const{bgColor:e,borderColor:i,borderLineWidth:r,borderLineDash:o}=t,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:e};return s.stroke=Nf(i,void 0),s.lineWidth=r,o&&(s.lineDash=o),s.lineCap="square",Array.isArray(i)&&(s.strokeArrayColor=$t(i)),Array.isArray(r)&&(s.strokeArrayWidth=$t(r),s.lineWidth=1),n.setAttributes(s),n.role="corner-frozen",n}function nk(n,t,e,i){const r=i.scenegraph,o=o0(n.map(c=>c.col)).sort((c,g)=>g-c),s=o0(t.map(c=>c.col)).sort((c,g)=>c-g),a=o0(e.map(c=>c.col)).sort((c,g)=>c-g);o.forEach(c=>{rk(c,r)});const l=i.colWidthsMap;let h;if(o.forEach(c=>{l.delAndReorder(c)}),o.length&&hy(r),r.table._clearColRangeWidthsMap(),s.forEach(c=>{const g=ok(c,r);hy(r),h=h!=null?h:g,l.addAndReorder(c)}),sk(r),a.forEach(c=>{for(let g=0;g<i.rowCount;g++){const f=ze(r.table,c,g);if(f)for(let p=f.start.col;p<=f.end.col;p++)for(let v=f.start.col;v<=f.end.col;v++)xa(v,g,r.table,!1);else xa(c,g,r.table,!1)}}),lt(h)){for(let c=h;c<i.colCount;c++)for(let g=0;g<i.rowCount;g++){const f=r.highPerformanceGetCell(c,g,!0);f&&(f.needUpdate=!0)}r.proxy.colUpdatePos=h}if(s.length){if(!lt(h)){const c=Math.min(...s);r.proxy.colUpdatePos=c}r.proxy.colUpdateDirection="left",r.proxy.updateColGroups(2*r.proxy.screenColCount),d(),r.proxy.progress()}else o.length&&(r.proxy.updateColGroups(2*r.proxy.screenColCount),d(),r.proxy.progress());const u=i.getColsWidth(i.frozenColCount,i.colCount-1);function d(){if((s==null?void 0:s[(s==null?void 0:s.length)-1])>=i.colCount-i.rightFrozenColCount||(a==null?void 0:a[(a==null?void 0:a.length)-1])>=i.colCount-i.rightFrozenColCount||(o==null?void 0:o[0])>=i.colCount-i.rightFrozenColCount){for(let c=i.colCount-i.rightFrozenColCount;c<i.colCount;c++)for(let g=0;g<i.rowCount;g++){const f=r.highPerformanceGetCell(c,g,!0);f&&(f.needUpdate=!0)}r.proxy.updateRightFrozenCellGroups()}}r.updateContainerWidth(r.table.frozenColCount,u-r.bodyGroup.attribute.width)}function rk(n,t){const e=t.proxy;if(n>=t.table.rowHeaderLevelCount&&!(n>=t.table.colCount-t.table.rightFrozenColCount)){const r=t.getColGroup(n,!1);r&&r.parent===t.bodyGroup&&t.bodyGroup.removeChild(r);const o=t.getColGroupInBottom(n);o&&o.parent===t.bottomFrozenGroup&&t.bottomFrozenGroup.removeChild(o)}n>=e.colStart&&n<=e.colEnd&&(e.colEnd--,e.currentCol--),e.bodyRightCol--;const i=Math.min(e.colLimit,e.bodyRightCol-e.bodyLeftCol+1);e.totalActualBodyColCount=i,e.totalCol=e.colStart+i-1}function ok(n,t){const e=t.proxy;e.bodyRightCol++;const i=Math.min(e.colLimit,e.bodyRightCol-e.bodyLeftCol+1);if(e.totalActualBodyColCount=i,e.totalCol=e.colStart+i-1,!(n<e.colStart))return n>e.colEnd?e.colEnd-e.colStart+1<e.colLimit?(e.colEnd++,e.currentCol++,uy(n,t),n):void 0:(e.colEnd-e.colStart+1<e.colLimit&&(e.colEnd++,e.currentCol++,uy(n,t)),n)}function o0(n){const t=[];for(let e=0;e<n.length;e++)t.indexOf(n[e])===-1&&t.push(n[e]);return t}function hy(n){let t=n.bodyColStart;function e(i){i.col=t;const r=ze(n.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}n.bodyGroup.forEachChildren(i=>{i.col=t,i==null||i.forEachChildren(r=>{e(r)}),t++}),t=n.bodyColStart,n.colHeaderGroup.forEachChildren(i=>{i.col=t,i==null||i.forEachChildren(r=>{e(r)}),t++}),t=n.bodyColStart,n.bottomFrozenGroup.forEachChildren(i=>{i.col=t,i==null||i.forEachChildren(r=>{e(r)}),t++})}function sk(n){let t=n.bodyColStart,e=n.getCellGroupX(t);function i(r){r.col=t;const o=ze(n.table,r.col,r.row);o&&(r.mergeStartCol=o.start.col,r.mergeStartCol=o.start.col,r.mergeEndCol=o.end.col,r.mergeEndCol=o.end.col),r.role}n.bodyGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.bodyColStart,e=n.getCellGroupX(t),n.colHeaderGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.bodyColStart,e=n.getCellGroupX(t),n.bottomFrozenGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightFrozenGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightTopCornerGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightBottomCornerGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",e),e+=r.attribute.width,t++})}function uy(n,t){if(t.colHeaderGroup&&t.table.columnHeaderLevelCount>0){const i=new jt({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroup(n,!0);r?t.colHeaderGroup.insertBefore(i,r):t.colHeaderGroup.appendChild(i),e(i,n,0,t.table.columnHeaderLevelCount-1)}if(t.bodyGroup){const i=new jt({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroup(n,!1);r?t.bodyGroup.insertBefore(i,r):t.bodyGroup.appendChild(i),e(i,n,t.bodyRowStart,t.bodyRowEnd)}if(t.bottomFrozenGroup&&t.table.bottomFrozenRowCount>0){const i=new jt({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroupInBottom(n);r?t.bottomFrozenGroup.insertBefore(i,r):t.bottomFrozenGroup.appendChild(i),e(i,n,t.table.rowCount-t.table.bottomFrozenRowCount,t.table.rowCount-1)}function e(i,r,o,s){for(let a=o;a<=s;a++){const l=new jt({x:0,y:0,width:t.table.getColWidth(r),height:t.table.getRowHeight(a)});l.role="cell",l.col=r,l.row=a,l.needUpdate=!0,i.appendChild(l)}}}qC(),jL(),pt.load(YH),pt.load(GH);class ak{constructor(t){let e,i;this._needUpdateContainer=!1,this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,IL(this.table.theme.textPopTipStyle),Pt.mode==="node"?(Ie.setEnv("node",t.options.modeParams),e=t.canvasWidth,i=t.canvasHeight):(Ie.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=iR({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,afterRender:()=>{this.table.fireListeners("after_render",null)}}),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:0}get height(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.height)!==null&&e!==void 0?e:0}get x(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:0}get y(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.y)!==null&&e!==void 0?e:0}get bodyRowStart(){var t;return(t=this.proxy.rowStart)!==null&&t!==void 0?t:0}get bodyRowEnd(){var t;return(t=this.proxy.rowEnd)!==null&&t!==void 0?t:this.table.rowCount-1}get bodyColStart(){var t;return(t=this.proxy.colStart)!==null&&t!==void 0?t:0}get bodyColEnd(){var t;return(t=this.proxy.colEnd)!==null&&t!==void 0?t:this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),LL(this)}clearCells(){var t;(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach(e=>{e.deactivate(this.stage.pluginService)}),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),this.rowHeaderGroup.clear(),this.cornerHeaderGroup.clear(),this.bodyGroup.clear(),this.bottomFrozenGroup.clear(),this.rightFrozenGroup.clear(),this.rightTopCornerGroup.clear(),this.rightBottomCornerGroup.clear(),this.leftBottomCornerGroup.clear(),this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),(t=this.proxy)===null||t===void 0||t.release()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new EH(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(){this.table.rowHeightsMap.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach(t=>{t.name==="poptipForText"&&this.stage.pluginService.register(t)}),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.columnHeaderLevelCount,this.proxy=new pL(this.table),ss(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(r0(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),r0(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),r0(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){var r,o,s,a,l,h;let u;if(u=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?(r=this.rightTopCornerGroup.getColGroup(t))===null||r===void 0?void 0:r.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?(o=this.leftBottomCornerGroup.getColGroup(t))===null||o===void 0?void 0:o.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?(s=this.rightBottomCornerGroup.getColGroup(t))===null||s===void 0?void 0:s.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?(a=this.rightFrozenGroup.getColGroup(t))===null||a===void 0?void 0:a.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?(l=this.bottomFrozenGroup.getColGroup(t))===null||l===void 0?void 0:l.getRowGroup(e):(h=this.getColGroup(t,e<this.frozenRowCount))===null||h===void 0?void 0:h.getRowGroup(e),u&&u.role==="shadow-cell"&&!i){const d=this.table.getCellRange(t,e);d.start.col===t&&d.start.row===e||(u=this.getCell(d.start.col,d.start.row))}return u||Ju}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t,e=!1){let i;return i=t<this.frozenColCount&&e?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):e?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),i||void 0}getColGroupInBottom(t){if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),r=ze(this.table,t,e);let o=i.attribute.width,s=i.attribute.height;return r&&(o/=r.end.col-r.start.col+1,s/=r.end.row-r.start.row+1),{width:o,height:s}}updateNextFrame(){this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var t,e;((e=(t=this.table.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||e===void 0?void 0:e.length)>0&&mL(this)}hideHoverIcon(t,e){VL(t,e,this)}showHoverIcon(t,e){GL(t,e,this)}hideClickIcon(t,e){UL(t,e,this)}showClickIcon(t,e){KL(t,e,this)}getIcon(t,e,i,r){return YL(t,e,i,r,this)}setIconHoverStyle(t,e,i,r){$L(t,e,i,r,this)}updateSortIcon(t,e,i,r,o,s,a){JL(t,e,i,r,o,s,a,this)}updateFrozenIcon(t,e){QL(this)}updateHierarchyIcon(t,e){tk(t,e,this)}setIconNormalStyle(t,e,i){XL(t,e,i,this)}residentHoverIcon(t,e){ek(t,e,this)}resetResidentHoverIcon(t,e){ik(t,e,this)}deactivateChart(t,e){var i,r;if(t===-1||e===-1)return;const o=this.getCell(t,e);(r=(i=o==null?void 0:o.firstChild)===null||i===void 0?void 0:i.deactivate)===null||r===void 0||r.call(i)}activateChart(t,e){var i,r;if(t===-1||e===-1)return;const o=this.getCell(t,e);(r=(i=o==null?void 0:o.firstChild)===null||i===void 0?void 0:i.activate)===null||r===void 0||r.call(i,this.table)}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,r,o,s,a){_L(this,t,e,i,r,o,s,a)}moveSelectingRangeComponentsToSelectedRangeComponents(){j1(this)}deleteLastSelectedRangeComponents(){yL(this)}deleteAllSelectBorder(){V1(this)}updateCellSelectBorder(t,e,i,r){N1(this,t,e,i,r)}recreateAllSelectRangeComponents(){V1(this),this.table.stateManager.select.ranges.forEach(t=>{N1(this,t.start.col,t.start.row,t.end.col,t.end.row)}),j1(this)}updateColWidth(t,e,i,r){DH(this,t,Math.round(e),r),i||this.updateContainer(!0)}updateChartSize(t){EL(this,t)}updateChartState(t){this.table.isPivotChart()&&HL(this,t)}updateCheckboxCellState(t,e,i){var r,o;this.table.transpose?(r=this.bodyGroup.children)===null||r===void 0||r.forEach(s=>{s.getChildAt(e).getChildren().forEach(a=>{a.name==="checkbox"&&a.setAttribute("checked",i)})}):(o=this.getColGroup(t).children)===null||o===void 0||o.forEach(s=>{s.getChildren().find(a=>{a.name==="checkbox"&&a.setAttribute("checked",i)})})}updateHeaderCheckboxCellState(t,e,i){var r,o;this.table.transpose?(r=this.rowHeaderGroup.children)===null||r===void 0||r.forEach(s=>{s.getChildAt(e).getChildren().forEach(a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))})}):(o=this.getColGroup(t,!0).children)===null||o===void 0||o.forEach(s=>{s.getChildren().find(a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))})})}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=Er(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){ur(this.table,0,this.table.colCount-1,!0)}recalculateRowHeights(){hr(this.table,0,this.table.rowCount-1,!0,!0)}resize(){this.proxy.resize(),(this.table.widthMode==="adaptive"||this.table.autoFillWidth)&&(this.table.internalProps._widthResizedColMap.size===0?this.recalculateColWidths():this.dealWidthMode()),this.table.heightMode==="adaptive"?this.recalculateRowHeights():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),(this.table.widthMode==="adaptive"||this.table.heightMode==="adaptive"||this.table.autoFillWidth||this.table.autoFillHeight)&&this.updateChartSize(this.table.rowHeaderLevelCount),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){var t,e,i,r;this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:Math.min(this.table.tableNoFrameWidth,Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0)),height:Math.min(this.table.tableNoFrameHeight,Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0))}),this.tableGroup.border&&this.tableGroup.border.type==="rect"?!((t=this.table.theme.frameStyle)===null||t===void 0)&&t.innerBorder?this.tableGroup.border.setAttributes({x:this.table.tableX+this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY+this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width-this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height-this.tableGroup.border.attribute.lineWidth}):this.tableGroup.border.setAttributes({x:this.table.tableX-this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY-this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width+this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height+this.tableGroup.border.attribute.lineWidth}):this.tableGroup.border&&this.tableGroup.border.type==="group"&&(!((e=this.table.theme.frameStyle)===null||e===void 0)&&e.innerBorder?(this.tableGroup.border.setAttributes({x:this.table.tableX+this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY+this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width-this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height-this.tableGroup.border.attribute.lineWidth}),(i=this.tableGroup.border.firstChild)===null||i===void 0||i.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height-this.tableGroup.border.attribute.lineWidth})):(this.tableGroup.border.setAttributes({x:this.table.tableX-this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY-this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width+this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height+this.tableGroup.border.attribute.lineWidth}),(r=this.tableGroup.border.firstChild)===null||r===void 0||r.setAttributes({x:this.tableGroup.border.attribute.lineWidth/2,y:this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height}))),this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()}))}updateRowHeight(t,e,i){e=Math.round(e),p1(this,t,e,i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let r=0;r<t.length;r++){const o=t[r];if(o>=this.proxy.rowStart&&o<=this.proxy.rowEnd){const s=e[r];p1(this,o,Math.round(s),i),this._updateContainerHeight(o,s)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t,e=!1){this.table.scenegraph.proxy.setX(-t,e)}setY(t,e=!1){this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){var e,i;const r=(e=this.bodyGroup.firstChild)===null||e===void 0?void 0:e.firstChild,o=(i=this.bodyGroup.firstChild)===null||i===void 0?void 0:i.lastChild;t===0&&r&&r.row===this.table.frozenRowCount&&r.attribute.y+t<0?t=-r.attribute.y:o&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&o.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&o.attribute.y+o.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-o.attribute.y-o.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;t===0&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose||this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),e0(this.table),this.updateNextFrame()}dealWidthMode(){const t=this.table;if(t.widthMode==="adaptive"){t._clearColRangeWidthsMap();const s=t.tableNoFrameWidth;let a=0;for(let u=0;u<t.colCount;u++)(u<t.rowHeaderLevelCount||t.isPivotChart()&&u>=t.colCount-t.rightFrozenColCount)&&(a+=t.getColWidth(u));const l=t.rowHeaderLevelCount,h=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount;Zu(s-a,l,h,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const s=t.tableNoFrameWidth;let a=0,l=0;for(let h=0;h<t.colCount;h++){const u=t.getColWidth(h);(h<t.rowHeaderLevelCount||t.isPivotChart()&&h>=t.colCount-t.rightFrozenColCount)&&(a+=u),l+=u}if(l<s&&l>a){const h=t.rowHeaderLevelCount,u=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount;Zu(s-a,h,u,!1,[],t,!0)}}let e=0;this.bodyGroup.forEachChildrenSkipChild(s=>{e+=s.attribute.width}),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild(s=>{i+=s.attribute.width}),this.colHeaderGroup.setAttribute("width",i);let r=0;this.rowHeaderGroup.forEachChildrenSkipChild(s=>{r+=s.attribute.width}),this.rowHeaderGroup.setAttribute("width",r);let o=0;this.cornerHeaderGroup.forEachChildrenSkipChild(s=>{o+=s.attribute.width}),this.cornerHeaderGroup.setAttribute("width",o),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){var t;const e=this.table;if(e.heightMode==="adaptive"){e._clearRowRangeHeightsMap();const i=e.getRowsHeight(0,e.columnHeaderLevelCount-1),r=e.isPivotChart()?e.getBottomFrozenRowsHeight():0,o=e.tableNoFrameHeight-i-r,s=e.columnHeaderLevelCount,a=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount;let l=0;for(let u=s;u<a;u++)l+=e.getRowHeight(u);const h=o/l;for(let u=s;u<a;u++){let d;d=u===a-1?o-e.getRowsHeight(s,a-2):Math.round(e.getRowHeight(u)*h),this.setRowHeight(u,d)}}else if(e.autoFillHeight){e._clearRowRangeHeightsMap();const i=e.tableNoFrameHeight;let r=0,o=0;for(let s=0;s<e.rowCount;s++){const a=e.getRowHeight(s);(s<e.columnHeaderLevelCount||e.isPivotChart()&&s>=e.rowCount-e.bottomFrozenRowCount)&&(o+=a),r+=a}if(((t=this._dealAutoFillHeightOriginRowsHeight)!==null&&t!==void 0?t:r)<i&&r-o>0){const s=e.columnHeaderLevelCount,a=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount,l=(i-o)/(r-o);for(let h=s;h<a;h++){let u;u=h===a-1?i-o-e.getRowsHeight(s,a-2):Math.round(e.getRowHeight(h)*l),this.setRowHeight(h,u)}}}}dealFrozen(){FL(this)}resetFrozen(){TL(this)}updateCellLayoutWidthCertainWidth(t,e,i){const r=t.attribute.width;let o=!1;return t.forEachChildren((s,a)=>{a+=e;const l=ze(this.table,i,a);l?s=this.getCell(l.start.col,l.start.row):s.setAttribute("width",r);const h=this.table._getCellStyle(i,a),u=$t(Ct("padding",h,i,a,this.table)),d=s.getChildByName("text");let c=0,g=0;if(d)c=d.AABBBounds.height()+(u[0]+u[2]),d.setAttribute("maxLineWidth",r-(u[1]+u[3])),g=d.AABBBounds.height()+(u[0]+u[2]);else{const p=s.getChildAt(1);c=p.AABBBounds.height()+(u[0]+u[2]),p._cellWidth=r-(u[1]+u[3]),p.layout(),g=p.AABBBounds.height()+(u[0]+u[2])}const f=this.table.getRowHeight(a);s.attribute.height!==g&&(s.setAttribute("height",g),(f===c||g>f)&&(o=!0))}),o}updateHeaderPosition(t,e,i,r,o){vL(t,e,i,r,o,this.table)}updateContainerAttrWidthAndX(){var t,e,i;const r=gr(this.cornerHeaderGroup,0),o=gr(this.rowHeaderGroup,0),s=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?gr(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth((t=this.table.frozenColCount)!==null&&t!==void 0?t:0,this.colHeaderGroup.firstChild.col-1):0):0,a=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?gr(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth((e=this.table.frozenColCount)!==null&&e!==void 0?e:0,this.bodyGroup.firstChild.col-1):0):0,l=gr(this.rightFrozenGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&gr(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth((i=this.table.frozenColCount)!==null&&i!==void 0?i:0,this.bottomFrozenGroup.firstChild.col-1):0),gr(this.leftBottomCornerGroup,0),gr(this.rightTopCornerGroup,0),gr(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(r-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(r-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(s-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(o-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(s-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(l-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(l-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(l-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(a-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(t=!1){t?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout(()=>{this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame(),this._needUpdateContainer=!1},0)):(this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame(),this._needUpdateContainer=!1)}updateCellContentWhileResize(t,e){const i=this.table.getBodyColumnType(t,e),r=this.getCell(t,e);i!=="image"&&i!=="video"||Sa(r,t,e,this.table)}createFrameBorder(){this.updateTableSize();const t=!this.isPivot;ss(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,t?[!0,!0,!0,!1]:void 0),ss(this.rowHeaderGroup,this.isPivot?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,t?[!0,!1,!0,!0]:void 0),ss(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,t?[!0,!0,!0,!1]:void 0),ss(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,t?[!0,!1,!0,!0]:void 0),ss(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i,r=YR/2){if(i){let o;if(t<i.globalAABBBounds.x1+r?o={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-r<t&&(o={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),o&&this.table.rightFrozenColCount>0&&o.col===this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(o.col=o.col+1,o.rightFrozen=!0),o)return o}return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:ML(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:RL(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),Lu(this.bodyGroup),this.rowHeaderGroup.attribute.width,w1(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),Lu(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,w1(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),Lu(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),Lu(this.cornerHeaderGroup)),PH(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){var i,r;const o=this.getCell(t,e).getChildByName("text",!0);if(o&&o.type==="text"){const s=rt(o.attribute.text)?o.attribute.text.join(""):o.attribute.text;let a="";if(ue(o.cache.clipedText)?a=o.cache.clipedText:(r=(i=o.cache.layoutData)===null||i===void 0?void 0:i.lines)===null||r===void 0||r.forEach(l=>{a+=l.str}),a!==s)return s}else if(o&&o.type==="richtext"){const s=o;if(s.attribute.ellipsis&&s._frameCache&&s.attribute.height<s._frameCache.actualHeight)return s.attribute.textConfig.find(a=>a.text).text}return null}updateDrill(t,e,i,r,o){this.component.drillIcon.update(t,e,i,r,o,this)}updateCellContent(t,e){if(!this.clear)return xa(t,e,this.table)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e,i=[]){const r=ha(e.map(a=>a.row)).sort((a,l)=>a-l),o=ha(i.map(a=>a.row)).sort((a,l)=>a-l),s=this.table.getAllRowsHeight()-[...r,...o].reduce((a,l)=>a+this.table.getRowHeight(l),0)<=this.table.tableNoFrameHeight;if(wL(t,e,i,this.table),this.recalculateColWidths(),this.table.heightMode==="adaptive"||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||s))this.table.scenegraph.recalculateRowHeights();else if(this.table.heightMode==="autoHeight")for(let a=0;a<o.length;a++){const l=o[a],h=this.table.getRowHeight(l),u=Ui(l,0,this.table.colCount-1,this.table);(l>=this.proxy.rowStart&&l<=this.proxy.rowEnd||l>=this.table.rowCount-this.table.bottomFrozenRowCount&&l<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(l,u-h)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose||this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e,i=[]){nk(t,e,i,this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose||this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.updateScrollBar(),this.updateNextFrame()}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.columnHeaderLevelCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.columnHeaderLevelCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}}function o5(n,t){for(let e=0;e<t.length;e++){const i=Math.min(t[e].start.col,t[e].end.col),r=Math.max(t[e].start.col,t[e].end.col);if(n>=i&&n<=r)return!0}return!1}function s5(n,t){for(let e=0;e<t.length;e++){const i=Math.min(t[e].start.row,t[e].end.row),r=Math.max(t[e].start.row,t[e].end.row);if(n>=i&&n<=r)return!0}return!1}function lk(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];if(Bn(r,n,t))return!0}return!1}function hk(n,t,e,i){for(let r=0;r<e.length;r++){const o=e[r];if(BR(o,{start:n,end:t}))return!0}return!1}function a5(n,t){for(let e=0;e<t.length;e++){const i=t[e],r=Math.min(i.start.row,i.end.row),o=Math.max(i.start.row,i.end.row);if(n>=r&&n<=o)return!0}return!1}function l5(n,t){for(let e=0;e<t.length;e++){const i=t[e],r=Math.min(i.start.col,i.end.col),o=Math.max(i.start.col,i.end.col);if(n>=r&&n<=o)return!0}return!1}function as(n,t,e){const i=n.highPerformanceGetCell(t,e);if(i.role==="cell"&&N(i.mergeStartCol)&&N(i.mergeStartRow)&&N(i.mergeEndCol)&&N(i.mergeEndRow)){const{colStart:r,colEnd:o,rowStart:s,rowEnd:a}=ro(i,n);for(let l=r;l<=o;l++)for(let h=s;h<=a;h++)n.highPerformanceGetCell(l,h).addUpdateBoundTag()}else i.addUpdateBoundTag()}function dy(n,t,e,i,r){const o=n.table;for(let a=0;a<o.columnHeaderLevelCount;a++)as(n,t,a);const s=n.getColGroup(t);return s==null||s.addUpdateBoundTag(),!0}function cy(n,t,e,i,r,o){const s=n.table;for(let l=0;l<s.columnHeaderLevelCount;l++)as(n,t,l);const a=n.getColGroup(t);return a==null||a.addUpdateBoundTag(),!0}function gy(n,t,e,i,r){const o=n.table;for(let s=0;s<o.colCount;s++)as(n,s,e);return!0}function fy(n,t,e,i,r,o){const s=n.table;for(let a=0;a<s.colCount;a++)as(n,a,e);return!0}function uk(n,t,e,i,r){return as(n,t,e),!0}function dk(n,t,e,i,r){return as(n,t,e),!0}function ck(n,t,e){const{table:i}=n,{scenegraph:r}=i,{highlightScope:o,singleStyle:s,disableHeader:a,cellPos:l,cellPosContainHeader:h}=n.hover,u=l.col,d=l.row;if(o===de.none||a&&(h.col!==t||h.row!==e)){const p=h.col,v=h.row;r.hideHoverIcon(p,v),r.showHoverIcon(t,e),h.col=t,h.row=e}if((a&&i.isHeader(t,e)||o===de.none)&&(t=-1,e=-1),u===t&&d===e)return;r.deactivateChart(u,d),r.activateChart(t,e);let c=!1;const{ranges:g,highlightScope:f}=n.select;if(u!==-1&&d!==-1&&(c=gk(r,u,d,g,s,o,f),a||r.hideHoverIcon(u,d)),t===-1||e===-1)return l.col=-1,l.row=-1,void(!c||u===t&&d===e||n.table.scenegraph.updateNextFrame());o===de.single?c=!!dk(r,t,e,g,f)||c:o===de.row?c=!!fy(r,t,e,g,f,s)||c:o===de.column?c=!!cy(r,t,e,g,f,s)||c:o===de.cross&&(c=!!fy(r,t,e,g,f,s)||c,c=!!cy(r,t,e,g,f,s)||c),o===de.none||a||r.showHoverIcon(t,e),l.col=t,l.row=e,c&&n.table.scenegraph.updateNextFrame()}function gk(n,t,e,i,r,o,s){let a=!1;return o===de.single?a=!!uk(n,t,e,i,s)||a:o===de.row?a=!!gy(n,t,e,i,s)||a:o===de.column?a=!!dy(n,t,e,i,s)||a:o===de.cross&&(a=!!gy(n,t,e,i,s)||a,a=!!dy(n,t,e,i,s)||a),a}function fk(n,t,e){e.frozenColCount>0?n!==e.frozenColCount-1?e.setFrozenColCount(n+1):e.setFrozenColCount(0):e.setFrozenColCount(n+1)}function pk(n,t,e,i){let r,o=null,s=!1;if(Array.isArray(e.sortState))for(let l=0;l<e.sortState.length&&(r=e.sortState[l],r&&(o=e._getHeaderCellBySortState(r)),o&&(s=py(n,t,o.col,o.row,e)),!s);l++);else r=e.sortState,r&&(o=e._getHeaderCellBySortState(r)),o&&(s=py(n,t,o.col,o.row,e));const a=e.getHeaderDefine(n,t);r&&s&&(a!=null&&a.sort)?r.order=r.order==="asc"?"desc":r.order==="desc"?"normal":"asc":a!=null&&a.sort?r={field:e.getHeaderField(n,t),order:"asc"}:s&&(a!=null&&a.showSort)||(r={field:e.getHeaderField(n,t),order:"normal"}),r.event=i,e.fireListeners(Q.SORT_CLICK,r).includes(!1)||(e.internalProps.sortState=r,e.stateManager.setSortState(r),a!=null&&a.sort&&vk(r,e,a),e.internalProps.layoutMap.clearCellRangeMap(),e.scenegraph.sortCell(),e.stateManager.updateSelectPos(-1,-1))}function vk(n,t,e){const i=t.internalProps.layoutMap.headerObjects.find(o=>o&&o.field===n.field);if(!i)return;const{field:r}=i;r!==null&&(typeof e.sort=="function"?t.dataSource.sort(r,n.order||"asc",e.sort):t.dataSource.sort(r,n.order||"asc",Ug))}function py(n,t,e,i,r){return r._getLayoutCellId(n,t)===r._getLayoutCellId(e,i)}function mk(n,t,e,i,r,o){var s;const{table:a,interactionState:l}=n,{scenegraph:h}=a,{highlightScope:u,disableHeader:d,cellPos:c}=n.select;if((d&&a.isHeader(t,e)||u==="none")&&(t=-1,e=-1),t!==-1&&e!==-1)if(l===St.grabing&&n.select.ranges.length>0){const g=n.select.ranges[n.select.ranges.length-1];t>g.start.col&&t>g.end.col&&a._makeVisibleCell(t+1,e),e>g.start.row&&e>g.end.row&&a._makeVisibleCell(t,e+1),t<g.start.col&&t<g.end.col&&a._makeVisibleCell(t-1,e),e<g.start.row&&e<g.end.row&&a._makeVisibleCell(t,e-1)}else a._makeVisibleCell(t,e);if(o){n.select.ranges=[],h.deleteAllSelectBorder(),n.select.ranges.push({start:{col:0,row:0},end:{col:a.colCount-1,row:a.rowCount-1}});const g=n.select.ranges[n.select.ranges.length-1];h.updateCellSelectBorder(g.start.col,g.start.row,g.end.col,g.end.row)}else if(c.col===-1||c.row===-1||t!==-1&&e!==-1)if(l!==St.default||a.stateManager.isResizeCol()){if(l===St.grabing&&!a.stateManager.isResizeCol()){c.col===-1&&(c.col=t),c.row===-1&&(c.row=e);const g=n.select.ranges[n.select.ranges.length-1];g&&(g.end={col:t,row:e}),c.col=t,c.row=e,g&&h.updateCellSelectBorder(g.start.col,g.start.row,t,e)}}else{const g=n.select.ranges[n.select.ranges.length-1];if(i&&g){if(n.select.headerSelectMode!=="cell"&&a.isColumnHeader(t,e)){const f=Math.min(g.start.col,g.end.col,t),p=Math.max(g.start.col,g.end.col,t),v=Math.min(g.start.row,g.end.row,e),m=a.rowCount-1;g.start={col:f,row:v},g.end={col:p,row:m}}else if(n.select.headerSelectMode!=="cell"&&a.isRowHeader(t,e)){const f=Math.min(g.start.col,g.end.col,t),p=a.colCount-1,v=Math.min(g.start.row,g.end.row,e),m=Math.max(g.start.row,g.end.row,e);g.start={col:f,row:v},g.end={col:p,row:m}}else g.end={col:t,row:e};h.deleteLastSelectedRangeComponents(),h.updateCellSelectBorder(g.start.col,g.start.row,g.end.col,g.end.row)}else{if(c.col===-1||c.row===-1||r||(n.select.ranges=[],h.deleteAllSelectBorder()),n.select.headerSelectMode!=="cell"&&a.isColumnHeader(t,e)){const p=a.getCellRange(t,e);n.select.ranges.push({start:{col:p.start.col,row:e},end:{col:p.end.col,row:a.rowCount-1}})}else if(n.select.headerSelectMode!=="cell"&&a.isRowHeader(t,e)){const p=a.getCellRange(t,e);n.select.ranges.push({start:{col:t,row:p.start.row},end:{col:a.colCount-1,row:p.end.row}})}else if(t>=0&&e>=0){const p=a.getCellRange(t,e);n.select.ranges.push({start:{col:p.start.col,row:p.start.row},end:{col:p.end.col,row:p.end.row}})}c.col=t,c.row=e;const f=(s=n.select.ranges)===null||s===void 0?void 0:s[n.select.ranges.length-1];f&&h.updateCellSelectBorder(f.start.col,f.start.row,f.end.col,f.end.row)}}else c.col=-1,c.row=-1,n.select.ranges=[],h.deleteAllSelectBorder();h.updateNextFrame()}function Ck(n){n.moveSelectingRangeComponentsToSelectedRangeComponents()}const za=ua(Q,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"}),s0=ua(Q,{VCHART_EVENT_TYPE:"vchart_event_type"});function bk(n,t,e,i,r){const o=r.getCellLocation(n,t);let s=0,a=0,l=!1;o==="columnHeader"?(s=r.getColsWidth(0,r.rowHeaderLevelCount-1)-(r.frozenColCount===0?r.scrollLeft:0),a=r.getRowsHeight(0,t-1)+r.getRowHeight(t)/2,l=!0):o==="rowHeader"&&(a=r.getRowsHeight(0,r.columnHeaderLevelCount-1),s=r.getColsWidth(0,n-1)+r.getColWidth(n)/2,l=!0),r.scenegraph.updateDrill(l,s,a,e,i)}function _k(n,t,e){const i=e.scenegraph.getCell(n,t).getChildByName("sparkline"),r=i==null?void 0:i.getChildByName("highlight-line"),o=i==null?void 0:i.getChildByName("highlight-symbol");r&&r.setAttributes({visible:!1,pickable:!1}),o&&o.setAttributes({visible:!1,pickable:!1}),e.scenegraph.updateNextFrame()}function yk(n,t,e,i,r){var o,s;const a=r.scenegraph.getCell(n,t).getChildByName("sparkline"),l=a==null?void 0:a.getChildByName("sparkline-line"),h=a==null?void 0:a.getChildByName("sparkline-symbol-group");if(!l)return!1;const u=l.bandwidth,d=l.min,c=l.max,g=l.attribute.points;let f;e-=a.globalAABBBounds.x1,a.globalAABBBounds.y1;for(let p=0;p<g.length;p++){const{x:v,y:m,defined:C,rawData:b}=g[p];if(Math.abs(e-v)<u/2&&(f={point:g[p],points:g,pointsBandWidth:u,pointData:b},C)){const _=a.getChildByName("highlight-line");if(_)_.setAttributes({points:[{x:v,y:c},{x:v,y:d}],visible:!0,pickable:!0});else{const w=Sn({points:[{x:v,y:c},{x:v,y:d}],lineWidth:(o=l.hover)===null||o===void 0?void 0:o.strokeWidth,stroke:(s=l.hover)===null||s===void 0?void 0:s.stroke});w.name="highlight-line",a.addChild(w)}const y=a.getChildByName("highlight-symbol");if(y)y.setAttributes({x:v,y:m,visible:!0,pickable:!0});else{const w=ra({x:v,y:m,stroke:h.hover.stroke,lineWidth:h.hover.strokeWidth,fill:h.hover.fill,size:2*h.hover.size,symbolType:"circle"});w.name="highlight-symbol",a.addChild(w)}break}}if(r.scenegraph.updateNextFrame(),f){const p={col:n,row:t,field:r.getHeaderField(n,t),value:r.getCellValue(n,t),dataValue:r.getCellOriginValue(n,t),cellHeaderPaths:r.internalProps.layoutMap.getCellHeaderPaths(n,t),title:r.getBodyColumnDefine(n,t).title,cellRange:r.getCellRelativeRect(n,t),sparkline:{pointData:f.pointData},scaleRatio:r.canvas.getBoundingClientRect().width/r.canvas.offsetWidth};r.fireListeners(Q.MOUSEOVER_CHART_SYMBOL,p)}return!0}function wk(n,t,e){const i=e.getCellRange(n.col,n.row);if(e.isColumnHeader(n.col,n.row)){const r=e.getCellRange(t.col,i.start.row);t.row>=e.columnHeaderLevelCount&&(t.row=e.columnHeaderLevelCount-1),t.col>=n.col?t.col=r.end.col:t.col=r.start.col}else if(e.isRowHeader(n.col,n.row)){const r=e.getCellRange(i.start.col,t.row);t.col>=e.rowHeaderLevelCount&&(t.col=e.rowHeaderLevelCount-1);const o=e.internalProps.layoutMap;if(o.rowHierarchyType==="tree"){const s=o.getCellHeaderPathsWidthTreeNode(n.col,n.row).rowHeaderPaths,a=o.getCellHeaderPathsWidthTreeNode(t.col,t.row).rowHeaderPaths;if(s.length<=a.length){const l=a[s.length-1];l&&(t.row>=n.row?t.row=l.startInTotal+l.size-1+e.columnHeaderLevelCount:t.row=l.startInTotal+e.columnHeaderLevelCount)}}else t.row>=n.row?t.row=r.end.row:t.row=r.start.row}return t}function Dk(n,t,e,i,r){if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;r.columnMove.moving=!0,r.columnMove.colSource=n,r.columnMove.rowSource=t,r.columnMove.x=e-r.table.tableX,r.columnMove.y=i-r.table.tableY;const o=r.table.getCellLocation(n,t),s=o==="columnHeader"?r.columnMove.x:o==="rowHeader"?r.columnMove.y:0;r.table.scenegraph.component.showMoveCol(n,t,s),r.table.stateManager.updateSelectPos(-1,-1),r.table.scenegraph.updateNextFrame()}function Sk(n,t,e,i,r){if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;const o=wk({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:n,row:t},r.table);r.columnMove.x=e-r.table.tableX,r.columnMove.y=i-r.table.tableY,r.columnMove.colTarget=o.col,r.columnMove.rowTarget=o.row;let s,a,l,h;r.table.internalProps.layoutMap.canMoveHeaderPosition({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:r.columnMove.colTarget,row:r.columnMove.rowTarget})?r.updateCursor("grabbing"):r.updateCursor("not-allowed");const u=r.table.getCellLocation(r.columnMove.colSource,r.columnMove.rowSource);u==="columnHeader"?(a=r.columnMove.x,s=r.table.isFrozenColumn(n)?r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1):r.table.isRightFrozenColumn(n)?r.table.tableNoFrameWidth-r.table.getColsWidth(o.col+1,r.table.colCount-1):(r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1))-r.table.stateManager.scroll.horizontalBarPos):u==="rowHeader"&&(h=r.columnMove.y,l=r.table.isFrozenRow(t)?r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1):r.table.isBottomFrozenRow(t)?r.table.tableNoFrameHeight-r.table.getRowsHeight(o.row+1,r.table.rowCount-1):(r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1))-r.table.stateManager.scroll.verticalBarPos),r.table.scenegraph.component.updateMoveCol(a,s,h,l),r.table.scenegraph.updateNextFrame()}function Ak(n){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v;if("canMoveHeaderPosition"in n.table.internalProps.layoutMap&&n.columnMove.moving&&n.columnMove.colSource>=0&&n.columnMove.rowSource>=0&&n.columnMove.colTarget>=0&&n.columnMove.rowTarget>=0){const m=ze(n.table,n.columnMove.colSource,n.columnMove.rowSource),C=ze(n.table,n.columnMove.colTarget,n.columnMove.rowTarget),b=n.table._moveHeaderPosition({col:n.columnMove.colSource,row:n.columnMove.rowSource},{col:n.columnMove.colTarget,row:n.columnMove.rowTarget});b&&(b.moveType==="column"?vy(Math.min((e=(t=m==null?void 0:m.start)===null||t===void 0?void 0:t.col)!==null&&e!==void 0?e:n.columnMove.colSource,(r=(i=C==null?void 0:C.start)===null||i===void 0?void 0:i.col)!==null&&r!==void 0?r:n.columnMove.colTarget),Math.max((s=(o=m==null?void 0:m.end)===null||o===void 0?void 0:o.col)!==null&&s!==void 0?s:n.columnMove.colSource,(l=(a=C==null?void 0:C.end)===null||a===void 0?void 0:a.col)!==null&&l!==void 0?l:n.columnMove.colTarget),0,-1,n.table):vy(0,-1,Math.min((u=(h=m==null?void 0:m.start)===null||h===void 0?void 0:h.row)!==null&&u!==void 0?u:n.columnMove.rowSource,(c=(d=C==null?void 0:C.start)===null||d===void 0?void 0:d.row)!==null&&c!==void 0?c:n.columnMove.rowTarget),Math.max((f=(g=m==null?void 0:m.end)===null||g===void 0?void 0:g.row)!==null&&f!==void 0?f:n.columnMove.rowSource,(v=(p=C==null?void 0:C.end)===null||p===void 0?void 0:p.row)!==null&&v!==void 0?v:n.columnMove.rowTarget),n.table),n.table.clearCellStyleCache(),b.moveType==="column"?n.table.scenegraph.updateHeaderPosition(Math.min(b.sourceIndex,b.targetIndex),Math.min(b.targetIndex>b.sourceIndex?b.targetIndex+b.sourceSize-1:b.sourceIndex+b.sourceSize-1,n.table.colCount-1),0,-1,b.moveType):n.table.scenegraph.updateHeaderPosition(0,-1,Math.min(b.sourceIndex,b.targetIndex),Math.min(b.targetIndex>b.sourceIndex?b.targetIndex+b.sourceSize-1:b.sourceIndex+b.sourceSize-1,n.table.rowCount-1),b.moveType),n.table.internalProps.frozenColDragHeaderMode==="adjustFrozenCount"&&n.table.isListTable()&&(n.table.isFrozenColumn(n.columnMove.colTarget)&&!n.table.isFrozenColumn(n.columnMove.colSource)?n.table.frozenColCount+=m.end.col-m.start.col+1:n.table.isFrozenColumn(n.columnMove.colSource)&&!n.table.isFrozenColumn(n.columnMove.colTarget)&&(n.table.frozenColCount-=m.end.col-m.start.col+1),n.table.isRightFrozenColumn(n.columnMove.colTarget)&&!n.table.isRightFrozenColumn(n.columnMove.colSource)?n.table.rightFrozenColCount+=m.end.col-m.start.col+1:n.table.isRightFrozenColumn(n.columnMove.colSource)&&!n.table.isRightFrozenColumn(n.columnMove.colTarget)&&(n.table.rightFrozenColCount-=m.end.col-m.start.col+1))),n.updateCursor()}setTimeout(()=>{n.columnMove.moving=!1,delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget},0),n.table.scenegraph.component.hideMoveCol(),n.columnResize.col<n.table.frozenColCount&&!n.table.isPivotTable()&&!n.table.transpose&&n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1,n.columnResize.isRightFrozen),n.table.scenegraph.updateNextFrame()}function vy(n,t,e,i,r){for(let o=n;o<=t;o++)r._clearColRangeWidthsMap(o);for(let o=e;o<=i;o++)r._clearRowRangeHeightsMap(o)}function Wa(n){var t;if(!n)return;const e=!((t=n.role)===null||t===void 0)&&t.startsWith("icon")?n:n.type==="richtext"?n._currentHoverIcon:void 0;return e?n.type==="richtext"?{icon:e,position:{left:n.globalAABBBounds.x1+e.globalAABBBounds.x1,right:n.globalAABBBounds.x1+e.globalAABBBounds.x2,top:n.globalAABBBounds.y1+e.globalAABBBounds.y1,bottom:n.globalAABBBounds.y1+e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"richtext-icon"}:{icon:e,position:{left:e.globalAABBBounds.x1,right:e.globalAABBBounds.x2,top:e.globalAABBBounds.y1,bottom:e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"icon"}:void 0}function xk(n,t,e){n=Math.ceil(n),t=Math.ceil(t);let i=e.columnResize.isRightFrozen?e.columnResize.x-n:n-e.columnResize.x;if(Math.abs(i)<1)return;const r=e.table.getColWidth(e.columnResize.col);let o=r;o+=i;const s=e.table.getMinColWidth(e.columnResize.col),a=e.table.getMaxColWidth(e.columnResize.col);if(o<s||o>a){if(r===s||r===a)return;i=r-s>a-r?a-r:s-r}let l=e.table.getColWidth(e.columnResize.col)+i;if(l<e.table.internalProps.limitMinWidth&&(l=e.table.internalProps.limitMinWidth,i=l-e.table.getColWidth(e.columnResize.col)),e.table.widthMode==="adaptive"&&e.columnResize.col<e.table.colCount-1){const h=e.table.getColWidth(e.columnResize.col+1),u=e.table.getMinColWidth(e.columnResize.col+1),d=e.table.getMaxColWidth(e.columnResize.col+1);let c=h;if(c-=i,c<u||c>d){if(h===u||h===d)return;i=h-u>d-h?d-h:u-h}c-i<e.table.internalProps.limitMinWidth&&(i=c-e.table.internalProps.limitMinWidth)}i=Math.ceil(i),e.columnResize.col<e.table.rowHeaderLevelCount||e.columnResize.col>=e.table.colCount-e.table.rightFrozenColCount?my(i,e):e.table.internalProps.columnResizeType==="indicator"?Fk(i,e):e.table.internalProps.columnResizeType==="indicatorGroup"?Tk(i,e):e.table.internalProps.columnResizeType==="all"?Bk(i,e):my(i,e),e.columnResize.x=n,e.table.scenegraph.component.updateResizeCol(e.columnResize.col,t,e.columnResize.isRightFrozen),e.columnResize.col<e.table.frozenColCount&&!e.table.isPivotTable()&&!e.table.transpose&&e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1,e.columnResize.isRightFrozen),e.table.scenegraph.updateNextFrame()}function my(n,t){t.table.widthMode==="adaptive"&&t.columnResize.col<t.table.colCount-1?(t.table.scenegraph.updateColWidth(t.columnResize.col,n),t.table.scenegraph.updateColWidth(t.columnResize.col+1,-n),t.table.internalProps._widthResizedColMap.add(t.columnResize.col),t.table.internalProps._widthResizedColMap.add(t.columnResize.col+1)):(t.table.scenegraph.updateColWidth(t.columnResize.col,n),t.table.internalProps._widthResizedColMap.add(t.columnResize.col))}function Bk(n,t){const e=t.table.internalProps.layoutMap;for(let i=t.table.frozenColCount;i<t.table.colCount-t.table.rightFrozenColCount;i++){if(!(t.table.internalProps.transpose||t.table.isPivotTable()&&!e.indicatorsAsCol)){const r=e.getBody(i,t.table.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)continue}t.table.scenegraph.updateColWidth(i,n),t.table.internalProps._widthResizedColMap.add(i)}}function Fk(n,t){const e=t.table.internalProps.layoutMap;let i,r,o;if(e.indicatorsAsCol)i=e.getIndicatorKey(t.columnResize.col,t.table.columnHeaderLevelCount);else{const s=e.getCellHeaderPaths(t.columnResize.col,t.table.columnHeaderLevelCount-1),a=s.colHeaderPaths[s.colHeaderPaths.length-1];r=a.dimensionKey,o=a.value}for(let s=t.table.rowHeaderLevelCount;s<t.table.colCount-t.table.rightFrozenColCount;s++){const a=e.getIndicatorKey(s,t.table.columnHeaderLevelCount);if(e.indicatorsAsCol&&a===i)t.table.scenegraph.updateColWidth(s,n),t.table.internalProps._widthResizedColMap.add(s);else if(!e.indicatorsAsCol){const l=e.getCellHeaderPaths(s,t.table.columnHeaderLevelCount-1),h=l==null?void 0:l.colHeaderPaths[l.colHeaderPaths.length-1];h&&r===h.dimensionKey&&o===h.value&&(t.table.scenegraph.updateColWidth(s,n),t.table.internalProps._widthResizedColMap.add(s))}}}function Tk(n,t){const e=t.table.internalProps.layoutMap,i=e.getCellHeaderPaths(t.columnResize.col,t.table.columnHeaderLevelCount),r=e.getHeadNode(i.colHeaderPaths.slice(0,i.colHeaderPaths.length-1)),o=r.startInTotal+t.table.frozenColCount,s=r.startInTotal+t.table.frozenColCount+r.size-1,a=t.table.getColsWidth(o,s),l=n;for(let h=o;h<=s;h++){if(!(t.table.internalProps.transpose||t.table.isPivotTable()&&!e.indicatorsAsCol)){const d=e.getBody(h,t.table.columnHeaderLevelCount);if(d!=null&&d.disableColumnResize)continue}const u=t.table.getColWidth(h);t.table.scenegraph.updateColWidth(h,u/a*l),t.table.internalProps._widthResizedColMap.add(h)}}class Mk{constructor(t){this.fastScrolling=!1,this.checkedState=[],this.headerCheckedState={},this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.resetInteractionState=fb(()=>{this.updateInteractionState(St.default)},100),this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=St.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Ji,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort={col:-1,row:-1,order:"normal"},this.frozen={col:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=St.default,this.select={highlightScope:de.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.hover={highlightScope:de.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Ji,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort={col:-1,row:-1,order:"normal"},this.frozen={col:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){var t;const{highlightMode:e,disableHover:i,disableHeaderHover:r}=(t=this.table.options.hover)!==null&&t!==void 0?t:{highlightMode:"cell"};i?this.hover.highlightScope=de.none:e==="cross"?this.hover.highlightScope=de.cross:e==="row"?this.hover.highlightScope=de.row:e==="column"?this.hover.highlightScope=de.column:e==="cell"&&(this.hover.highlightScope=de.single),this.hover.singleStyle=!i,this.hover.disableHeader=r,(this.hover.highlightScope===de.none||r)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){const{headerSelectMode:t,disableSelect:e,disableHeaderSelect:i}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1},this.table.options.select);this.select.highlightScope=e?de.none:de.single,this.select.singleStyle=!e,this.select.disableHeader=i,this.select.headerSelectMode=t}isSelected(t,e){let i=!1;return this.select.ranges.forEach(r=>{Bn(r,t,e)&&(i=!0)}),i}setSortState(t){this.sort.field=t==null?void 0:t.field,this.sort.order=t==null?void 0:t.order}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;const e=this.interactionState;this.interactionState=t,e===St.scrolling&&St.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){ck(this,t,e)}updateSelectPos(t,e,i=!1,r=!1,o=!1){e!==-1&&e!==-1&&(this.select.selecting=!0),mk(this,t,e,i,r,o)}checkCellRangeInSelect(t,e){return hk(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,r,o){var s,a,l,h,u,d;if(i===((s=this.residentHoverIcon)===null||s===void 0?void 0:s.icon))return;const c=Wa(i);if(c)if(c.type==="richtext-icon"){const g=c.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==((l=this.residentHoverIcon)===null||l===void 0?void 0:l.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),g.attribute.tooltip){const f={content:g.attribute.tooltip.title,referencePosition:{rect:c.position,placement:g.attribute.tooltip.placement},style:Object.assign({},(h=this.table.internalProps.theme)===null||h===void 0?void 0:h.tooltipStyle,(u=g.tooltip)===null||u===void 0?void 0:u.style)};this.table.internalProps.tooltipHandler.isBinded(f)||this.table.showTooltip(t,e,f)}}else{const g=c.icon;g!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==((d=this.residentHoverIcon)===null||d===void 0?void 0:d.icon)&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=g,this.table.scenegraph.setIconHoverStyle(g,t,e,r),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==((a=this.residentHoverIcon)===null||a===void 0?void 0:a.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isSelecting(){return this.select.selecting}endSelectCells(t=!0){if(this.select.selecting=!1,this.select.ranges.length===0)return;Ck(this.table.scenegraph);const e=this.select.ranges[this.select.ranges.length-1].end.col,i=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(Q.SELECTED_CELL,{ranges:this.select.ranges,col:e,row:i})}endResizeCol(){setTimeout(()=>{this.columnResize.resizing=!1},0),this.table.scenegraph.updateChartSize(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,r){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=r,this.table.scenegraph.component.showResizeCol(t,i,r),this.table.stateManager.updateSelectPos(-1,-1),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){xk(t,e,this)}startMoveCol(t,e,i,r){Dk(t,e,i,r,this)}updateMoveCol(t,e,i,r){Sk(t,e,i,r,this)}isMoveCol(){return this.columnMove.moving}endMoveCol(){Ak(this)}checkFrozen(){const t=this.table.isListTable()&&!this.table.internalProps.transpose?this.table.options.frozenColCount:this.table.rowHeaderLevelCount;if(t){if(this.table.tableNoFrameWidth-this.table.getColsWidth(0,t-1)<=120)return this.table._setFrozenColCount(0),this.setFrozenCol(-1),!1;if(this.table.frozenColCount!==t)return this.table._setFrozenColCount(t),this.setFrozenCol(t),!1}return!0}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}updateVerticalScrollBar(t){var e,i;const r=this.table.getAllRowsHeight();this.scroll.verticalBarPos=Math.ceil(t*(r-this.table.scenegraph.height)),this.table.scenegraph.setY(-this.scroll.verticalBarPos,t===1),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.table.stateManager.updateHoverPos(-1,-1),this.table.fireListeners(Q.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t})}updateHorizontalScrollBar(t){var e,i;const r=this.table.getAllColsWidth();this.scroll.horizontalBarPos=Math.ceil(t*(r-this.table.scenegraph.width)),this.table.scenegraph.setX(-this.scroll.horizontalBarPos,t===1),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.table.stateManager.updateHoverPos(-1,-1),this.table.fireListeners(Q.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t})}setScrollTop(t){var e,i;const r=this.table.getAllRowsHeight();t=Math.max(0,Math.min(t,r-this.table.scenegraph.height)),((t=Math.ceil(t))!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.table.stateManager.updateHoverPos(-1,-1),this.scroll.verticalBarPos=t,this.table.scenegraph.setY(-t);const o=t/(r-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(o),this.table.fireListeners(Q.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:o})}setScrollLeft(t){var e,i;const r=this.table.getAllColsWidth();this.table.getFrozenColsWidth(),t=Math.max(0,Math.min(t,r-this.table.scenegraph.width)),(t=Math.ceil(t))!==this.scroll.horizontalBarPos&&this.table.stateManager.updateHoverPos(-1,-1),this.scroll.horizontalBarPos=t,this.table.scenegraph.setX(-t);const o=t/(r-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(o),this.table.fireListeners(Q.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:o})}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout(()=>{this.table.scenegraph.component.hideVerticalScrollBar()},1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){this.table.scenegraph.component.showHorizontalScrollBar(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout(()=>{this.table.scenegraph.component.hideHorizontalScrollBar()},1e3))}triggerContextMenu(t,e,i,r){this.menu.isShow&&this.menu.x===i&&this.menu.y===r?this.hideMenu():this.showContextMenu(t,e,i,r)}showContextMenu(t,e,i,r){var o;!((o=this.table.internalProps.menu)===null||o===void 0)&&o.contextMenuItems&&(this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=r,this.table.scenegraph.component.menu.attach(i,r,t,e,Ki.contextmenu)),this.table.fireListeners(Q.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,r,o){this.table.fireListeners(Q.DROPDOWN_ICON_CLICK,{col:t,row:e,event:o}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,r)}showDropDownMenu(t,e,i,r){this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,r,t,e,Ki.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(Q.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const o=this.table.scenegraph.getCell(t,e);let s;o.forEachChildren(a=>a.attribute.funcType===ne.dropDown&&(s=a,!0)),s&&(this.residentHoverIcon={col:t,row:e,icon:s},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,o),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(Q.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(Q.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:r}=t[e],o=this.table.getCellRange(i,r);if(o)for(let s=o.start.col;s<=o.end.col;s++)for(let a=o.start.row;a<=o.end.row;a++)this.table.scenegraph.updateCellContent(s,a)}}dropDownMenuIsHighlight(t,e,i){const r=this.menu.dropDownMenuHighlight;if(Array.isArray(r))for(let o=0;o<r.length;o++){const s=r[o];let{col:a,row:l}=s;const{field:h,menuKey:u}=s;if(typeof a!="number"||typeof l!="number")if(this.table.isPivotTable()&&(Array.isArray(h),1)){const d=this.table.internalProps.layoutMap.getPivotCellAdress(h);if(!d)continue;a=d.col,l=d.row}else{const d=this.table.internalProps.layoutMap.getHeaderCellAddressByField(h);if(!d)continue;a=d.col,l=d.row}if(N(a)&&N(l)&&this.table.isCellRangeEqual(t,e,a,l)){const d=this.table._getHeaderLayoutMap(a!=null?a:t,l!=null?l:e).dropDownMenu||this.table.globalDropDownMenu;if(d)for(let c=0;c<d.length;c++){const g=d[c];if(ye(g)&&(g.menuKey||g.text)===(u||"")&&c===i||ue(g)&&g===u&&c===i)return!0}}}return!1}triggerSort(t,e,i,r){if(this.table.isPivotTable()){const a=this.table.getPivotSortState(t,e);return void this.table.fireListeners(za.PIVOT_SORT_CLICK,{col:t,row:e,order:a||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:r})}const o=this.sort.col,s=this.sort.row;pk(t,e,this.table,r),this.sort.col=t,this.sort.row=e,this.table.scenegraph.updateSortIcon(this.sort.col,this.sort.row,i,this.sort.order,o,s,this.sort.icon),this.sort.icon=i}updateSortState(t){if(t.field===this.sort.field&&t.order===this.sort.order)return;const e=this.sort.col,i=this.sort.row,r=this.sort.order==="asc"?"sort_downward":this.sort.order==="desc"?"sort_upward":"sort_normal";this.setSortState(t);const o=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t.field);this.sort.col=o.col,this.sort.row=o.row;const s=this.table.scenegraph.getCell(this.sort.col,this.sort.row).getChildByName(r,!0);this.table.scenegraph.updateSortIcon(this.sort.col,this.sort.row,s,this.sort.order,e,i,this.sort.icon)}triggerFreeze(t,e,i){this.table.isPivotTable()||this.table.transpose||(fk(t,e,this.table),this.frozen.icon=i)}updateCursor(t="default"){this.table.getElement().style.cursor=t}updateDrillState(t,e,i,r,o,s){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=r,this.drill.col=o,this.drill.row=s,bk(o,s,i,r,this.table)}updateSparklineHoverPose(t,e,i,r){this.sparkLine.col!==-1&&this.sparkLine.row!==-1&&_k(this.sparkLine.col,this.sparkLine.row,this.table);let o=!1;t!==-1&&e!==-1&&(o=yk(t,e,i,r,this.table)),o?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,r){const o=this.table.getRecordShowIndexByCell(t,e);if(o>=0){const s=this.table.dataSource.getIndexKey(o);this.checkedState[s]||(this.checkedState[s]={}),this.checkedState[s][i]=r}}setHeaderCheckedState(t,e){var i;this.headerCheckedState[t]=e,(i=this.checkedState)===null||i===void 0||i.forEach(r=>{r[t]=e})}syncCheckedState(t,e,i,r){var o,s;if(this.table.isHeader(t,e)){if(N(this.headerCheckedState[i]))return this.headerCheckedState[i];if(typeof r=="function")return;if(N(r))this.headerCheckedState[i]=r;else if(((o=this.checkedState)===null||o===void 0?void 0:o.length)>0)return this.updateHeaderCheckedState(i);return this.headerCheckedState[i]}const a=this.table.getRecordShowIndexByCell(t,e);if(a>=0){const l=this.table.dataSource.getIndexKey(a);if(N((s=this.checkedState[l])===null||s===void 0?void 0:s[i]))return this.checkedState[l][i];this.checkedState[l]||(this.checkedState[l]={}),this.checkedState[l][i]=r}return r}initCheckedState(t){let e=!1;this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.table.internalProps.layoutMap.headerObjects.forEach((i,r)=>{if(i.headerType==="checkbox"){const o=i.define.checked;o==null||typeof o=="function"?(e=!0,typeof o=="function"&&(this._headerCheckFuncs[i.field]=o)):this.headerCheckedState[i.field]=o,i.define.cellType!=="checkbox"||i.fieldFormat||this._checkboxCellTypeFields.push(i.field)}}),e&&t.forEach((i,r)=>{this._checkboxCellTypeFields.forEach(o=>{const s=i[o];let a;if(ye(s)?a=s.checked:typeof s=="boolean"&&(a=s),a==null){const l=this._headerCheckFuncs[o];if(l){const h=this.table.getCellAddrByFieldRecord(o,r);a=Xe(l,{col:h.col,row:h.row,table:this.table,context:null,value:s})}}this.checkedState[r]||(this.checkedState[r]={}),this.checkedState[r][o]=a})})}updateHeaderCheckedState(t){const e=this.checkedState.every(i=>i[t]===!0);return e?(this.headerCheckedState[t]=!0,e):this.checkedState.every(i=>i[t]===!1)?(this.headerCheckedState[t]=!1,!1):!!this.checkedState.find(i=>i[t]===!0)&&(this.headerCheckedState[t]="indeterminate","indeterminate")}initLeftRecordsCheckState(t){for(let e=this.checkedState.length;e<t.length;e++){const i=t[e];this._checkboxCellTypeFields.forEach(r=>{const o=i[r];let s;ye(o)?s=o.checked:typeof o=="boolean"&&(s=o),this.checkedState[e]||(this.checkedState[e]={}),this.checkedState[e][r]=s})}}}function Rk(n){Pt.mode==="browser"&&n.on(Q.CLICK_CELL,t=>{const{col:e,row:i}=t;let r;r=n.internalProps.layoutMap.isHeader(e,i)?n.isPivotTable()?n._getHeaderLayoutMap(e,i).headerType:n.getHeaderDefine(e,i).headerType:n.getBodyColumnType(e,i);const o=n.isHeader(e,i)?n.getHeaderDefine(e,i):n.getBodyColumnDefine(e,i),s=n.getCellValue(e,i),a=n.getCellOriginValue(e,i);if(r==="link"){if(o.linkJump===!1)return;const l=o.templateLink,h=o.linkDetect!==!1;let u;if(l){const d=n.getCellOriginRecord(e,i),c=Object.assign({__value:s,__dataValue:a},d),g=/\{\s*(\S+?)\s*\}/g;u=l.replace(g,(f,p)=>c[p])}else if(h){if(!Xg.test(s))return;u=s}else u=s;window.open(u)}else if(r==="image"){const{clickToPreview:l}=o;if(l===!1)return;const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.backgroundColor="rgba(30, 30, 30, 0.4)",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.zIndex="9999",h.addEventListener("click",d=>{d.target===h&&document.body.removeChild(h)});const u=new Image;u.src=s,u.style.maxWidth="80%",u.style.maxHeight="80%",h.appendChild(u),document.body.appendChild(h)}else if(r==="video"){const{clickToPreview:l}=o;if(l===!1)return;const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.backgroundColor="rgba(30, 30, 30, 0.4)",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.zIndex="9999",h.addEventListener("click",d=>{d.target===h&&document.body.removeChild(h)});const u=document.createElement("video");u.src=s,u.style.maxWidth="80%",u.style.maxHeight="80%",u.setAttribute("preload","auto"),u.setAttribute("controls","true"),h.appendChild(u),document.body.appendChild(h)}})}function Ek(n){n.on(Q.MOUSEENTER_CELL,t=>{const{col:e,row:i}=t;if(e===-1||i===-1)return;const r=n.internalProps.layoutMap.getHeaderDimension(e,i);r!=null&&r.drillDown||r!=null&&r.drillUp?n.stateManager.updateDrillState(r.dimensionKey,r.title,r.drillDown,r.drillUp,e,i):n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}),n.on(Q.MOUSELEAVE_TABLE,t=>{n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})}function Pk(n){n.fireListeners(za.DRILLMENU_CLICK,n.stateManager.drill)}function Hk(n){const t=n.internalProps.layoutMap.rowsDefine,e=n.internalProps.layoutMap.columnsDefine;for(let i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}for(let i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}return!1}function Lk(n){let t=!1;n.isPivotTable()?t=n.internalProps.layoutMap.indicatorsDefine.some(e=>typeof e!="string"&&e.cellType==="sparkline"):t=n.internalProps.layoutMap.columnObjects.some(e=>e.cellType==="sparkline"||typeof e.cellType=="function"),t&&(n.on(Q.MOUSEMOVE_CELL,e=>{const{col:i,row:r,x:o,y:s}=e;n.getBodyColumnType(i,r)!=="sparkline"&&n.stateManager.updateSparklineHoverPose(-1,-1,0,0),n.stateManager.updateSparklineHoverPose(i,r,o,s)}),n.on(Q.MOUSELEAVE_TABLE,e=>{n.stateManager.updateSparklineHoverPose(-1,-1,0,0)}))}function Je(n){const t={abstractPos:{x:n.x,y:n.y}},e=kk(n.target);return e&&(t.eventArgs={col:e.col,row:e.row,event:n,targetCell:e,target:n.target}),t}function kk(n){for(;n&&n.parent;){if(n.role==="cell")return n;n=n.parent}return null}function Ik(n){const t=n.table,e=t.stateManager;t.scenegraph.tableGroup.addEventListener("pointermove",i=>{var r,o,s,a,l,h,u,d,c,g,f;const p=(o=(r=t.eventManager.LastPointerXY)===null||r===void 0?void 0:r.x)!==null&&o!==void 0?o:i.x,v=(a=(s=t.eventManager.LastPointerXY)===null||s===void 0?void 0:s.y)!==null&&a!==void 0?a:i.y;t.eventManager.LastPointerXY={x:i.x,y:i.y},n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.touchSetTimeout=void 0);const m=Je(i);if(e.interactionState===St.scrolling)return;if(e.interactionState===St.grabing)return void(Math.abs(p-i.x)+Math.abs(v-i.y)>=1&&(e.isResizeCol()||(e.isMoveCol()?n.dealColumnMover(m):n.dealTableSelect(m,!0))));e.isResizeCol()||n.checkColumnResize(m)?e.updateCursor("col-resize"):e.updateCursor();const C=i.path.find(b=>b.role==="cell");if(t.hasListeners(Q.MOUSELEAVE_CELL)&&(t.stateManager.hover.cellPos.col===-1||t.stateManager.hover.cellPos.row===-1||(C==null?void 0:C.col)===t.stateManager.hover.cellPos.col&&(C==null?void 0:C.row)===t.stateManager.hover.cellPos.row||t.fireListeners(Q.MOUSELEAVE_CELL,{col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row,cellRange:t.getCellRangeRelativeRect({col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(l=m==null?void 0:m.eventArgs)===null||l===void 0?void 0:l.target})),t.hasListeners(Q.MOUSEENTER_CELL)&&((C==null?void 0:C.role)!=="cell"||!N(C.col)||!N(C.row)||C.col===t.stateManager.hover.cellPos.col&&C.row===t.stateManager.hover.cellPos.row||C.col===((h=t.stateManager.hover.cellPosContainHeader)===null||h===void 0?void 0:h.col)&&C.row===((u=t.stateManager.hover.cellPosContainHeader)===null||u===void 0?void 0:u.row)||t.fireListeners(Q.MOUSEENTER_CELL,{col:C.col,row:C.row,cellRange:t.getCellRangeRelativeRect({col:C.col,row:C.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(d=m==null?void 0:m.eventArgs)===null||d===void 0?void 0:d.target})),n.dealIconHover(m),n.dealTableHover(m),m.eventArgs&&t.hasListeners(Q.MOUSEMOVE_CELL)){let b,_;if(!((c=m.eventArgs)===null||c===void 0)&&c.target){const y=Wa((g=m.eventArgs)===null||g===void 0?void 0:g.target);y&&(b=y.icon,_=y.position)}t.fireListeners(Q.MOUSEMOVE_CELL,{col:m.eventArgs.col,row:m.eventArgs.row,x:m.abstractPos.x,y:m.abstractPos.y,event:i.nativeEvent,targetIcon:b?{name:b.name,position:_,funcType:b.attribute.funcType}:void 0,target:(f=m==null?void 0:m.eventArgs)===null||f===void 0?void 0:f.target})}}),t.scenegraph.tableGroup.addEventListener("pointerout",i=>{var r;const o=Je(i),s=(r=o==null?void 0:o.eventArgs)===null||r===void 0?void 0:r.target;(s==null?void 0:s.role)==="table"&&n.dealTableHover()}),t.scenegraph.tableGroup.addEventListener("pointerover",i=>{var r,o;const s=Je(i),a=(r=s==null?void 0:s.eventArgs)===null||r===void 0?void 0:r.target;if(a&&t.hasListeners(Q.MOUSEOVER_CHART_SYMBOL)&&a.type==="symbol"){const l=i.composedPath().find(h=>h.roll==="cell");if(l){const{col:h,row:u}=l,d={col:h,row:u,field:t.getHeaderField(h,u),value:t.getCellValue(h,u),dataValue:t.getCellOriginValue(h,u),cellHeaderPaths:t.internalProps.layoutMap.getCellHeaderPaths(h,u),title:t.getBodyColumnDefine(h,u).title,cellRange:t.getCellRelativeRect(h,u),event:i.nativeEvent,sparkline:{pointData:void 0},scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:(o=s==null?void 0:s.eventArgs)===null||o===void 0?void 0:o.target};t.fireListeners(Q.MOUSEOVER_CHART_SYMBOL,d)}}}),t.scenegraph.tableGroup.addEventListener("pointerleave",i=>{e.isResizeCol()||e.isMoveCol()||e.isSelecting()||(e.updateInteractionState(St.default),e.updateCursor()),t.hasListeners(Q.MOUSELEAVE_CELL)&&t.stateManager.hover.cellPos.col!==-1&&t.stateManager.hover.cellPos.row!==-1&&t.fireListeners(Q.MOUSELEAVE_CELL,{col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row,cellRange:t.getCellRangeRelativeRect({col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:void 0}),n.dealTableHover();const r=i.target;r&&!r.isDescendantsOf(t.scenegraph.tableGroup)&&t.fireListeners(Q.MOUSELEAVE_TABLE,{col:-1,row:-1,event:i.nativeEvent,target:void 0})}),t.scenegraph.tableGroup.addEventListener("pointerupoutside",i=>{var r,o,s,a,l,h,u,d,c;const g=Je(i);if(e.menu.isShow&&((r=g.eventArgs)===null||r===void 0?void 0:r.target)!==((o=e.residentHoverIcon)===null||o===void 0?void 0:o.icon)&&setTimeout(()=>{t.internalProps.menuHandler.pointInMenuElement(i.page.x,i.page.y)||e.menu.isShow&&e.hideMenu()},0),e.isResizeCol())Cy(t);else if(e.isMoveCol())t.stateManager.endMoveCol(),((s=t.stateManager.columnMove)===null||s===void 0?void 0:s.colSource)!==-1&&((a=t.stateManager.columnMove)===null||a===void 0?void 0:a.rowSource)!==-1&&((l=t.stateManager.columnMove)===null||l===void 0?void 0:l.colTarget)!==-1&&((h=t.stateManager.columnMove)===null||h===void 0?void 0:h.rowTarget)!==-1&&t.hasListeners(Q.CHANGE_HEADER_POSITION)&&t.fireListeners(Q.CHANGE_HEADER_POSITION,{target:{col:t.stateManager.columnMove.colTarget,row:t.stateManager.columnMove.rowTarget},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.rowSource}});else if(e.isSelecting()&&(!((d=(u=t.stateManager.select)===null||u===void 0?void 0:u.ranges)===null||d===void 0)&&d.length)){const f=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end.col,p=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end.row;if(t.stateManager.endSelectCells(),t.hasListeners(Q.DRAG_SELECT_END)){const v={event:i.nativeEvent,cells:[],col:f,row:p,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:void 0};v.cells=t.getSelectedCellInfos(),t.fireListeners(Q.DRAG_SELECT_END,v)}}(c=t.editorManager)===null||c===void 0||c.completeEdit(i.nativeEvent),e.updateInteractionState(St.default),n.dealTableHover()}),t.scenegraph.tableGroup.addEventListener("pointerdown",i=>{var r,o,s,a,l,h,u,d;if(t.eventManager.isDown=!0,t.eventManager.LastBodyPointerXY={x:i.x,y:i.y},t.eventManager.LastPointerXY={x:i.x,y:i.y},i.button!==0)return;const c=Je(i);if(e.interactionState!==St.default)return;t.isPivotChart()&&((r=c==null?void 0:c.eventArgs)===null||r===void 0?void 0:r.target.type)!=="chart"&&t.scenegraph.updateChartState(null),((o=c.eventArgs)===null||o===void 0?void 0:o.target)!==((s=e.residentHoverIcon)===null||s===void 0?void 0:s.icon)&&e.hideMenu(),(a=t.editorManager)===null||a===void 0||a.completeEdit(i.nativeEvent);const g=!((u=(h=(l=c==null?void 0:c.eventArgs)===null||l===void 0?void 0:l.target)===null||h===void 0?void 0:h.role)===null||u===void 0)&&u.startsWith("icon")?c.eventArgs.target:void 0;if(!g||g.attribute.interactive===!1)if(i.pointerType==="touch")n.touchEnd=!1,n.touchSetTimeout=setTimeout(()=>{n.isTouchdown=!1,n.touchMove=!0,(n.touchEnd||!n.checkColumnResize(c,!0))&&(n.touchEnd||!n.chechColumnMover(c))?n.dealTableSelect(c)&&!n.touchEnd&&e.updateInteractionState(St.grabing):e.updateInteractionState(St.grabing)},500),n.dealTableHover(c);else{if(n.checkColumnResize(c,!0))return t.scenegraph.updateChartState(null),void e.updateInteractionState(St.grabing);if(n.chechColumnMover(c))return void e.updateInteractionState(St.grabing);n.dealTableSelect(c)&&e.updateInteractionState(St.grabing)}if(t.hasListeners(Q.MOUSEDOWN_CELL)){const f=Je(i);f.eventArgs&&t.fireListeners(Q.MOUSEDOWN_CELL,{col:f.eventArgs.col,row:f.eventArgs.row,event:i.nativeEvent,target:(d=f==null?void 0:f.eventArgs)===null||d===void 0?void 0:d.target})}}),t.scenegraph.tableGroup.addEventListener("pointerup",i=>{var r,o;if(i.button===0){if(e.interactionState==="grabing"){if(e.updateInteractionState(St.default),e.isResizeCol())Cy(t);else if(e.isMoveCol()){const s=Je(i);t.stateManager.endMoveCol(),s.eventArgs&&t.hasListeners(Q.CHANGE_HEADER_POSITION)&&t.fireListeners(Q.CHANGE_HEADER_POSITION,{target:{col:s.eventArgs.col,row:s.eventArgs.row},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.colSource}})}else if(e.isSelecting()){t.stateManager.endSelectCells();const s=Je(i);if(s.eventArgs&&t.hasListeners(Q.DRAG_SELECT_END)){const a={event:i.nativeEvent,cells:[],col:s.eventArgs.target.col,row:s.eventArgs.target.row,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:(r=s==null?void 0:s.eventArgs)===null||r===void 0?void 0:r.target};a.cells=t.getSelectedCellInfos(),t.fireListeners(Q.DRAG_SELECT_END,a)}}}else e.interactionState===St.scrolling&&e.updateInteractionState(St.default);if(t.hasListeners(Q.MOUSEUP_CELL)){const s=Je(i);s.eventArgs&&t.fireListeners(Q.MOUSEUP_CELL,{col:s.eventArgs.col,row:s.eventArgs.row,event:i.nativeEvent,target:(o=s==null?void 0:s.eventArgs)===null||o===void 0?void 0:o.target})}}}),t.scenegraph.tableGroup.addEventListener("rightdown",i=>{var r,o,s;const a=Je(i);if(a.eventArgs){e.triggerContextMenu(a.eventArgs.col,a.eventArgs.row,a.abstractPos.x,a.abstractPos.y);const{col:l,row:h}=a.eventArgs;if(t.hasListeners(Q.CONTEXTMENU_CELL)){const u=t.getCellInfo(l,h);let d,c;if(!((r=a.eventArgs)===null||r===void 0)&&r.target){const f=Wa((o=a.eventArgs)===null||o===void 0?void 0:o.target);f&&(d=f.icon,c=f.position)}const g=Object.assign(Object.assign({},u),{event:i.nativeEvent,cells:[],targetIcon:d?{name:d.name,position:c,funcType:d.attribute.funcType}:void 0,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target});xR(t.stateManager.select.ranges,l,h)?g.cells=t.getSelectedCellInfos():g.cells=[[u]],t.fireListeners(Q.CONTEXTMENU_CELL,g)}}}),t.scenegraph.tableGroup.addEventListener("pointertap",i=>{var r,o,s;if(t.stateManager.columnResize.resizing||t.stateManager.columnMove.moving)return;const a=Je(i);if(n.dealIconClick(i,a),a==null?void 0:a.eventArgs){if(n.touchSetTimeout&&i.pointerType==="touch"){const l=Je(i);n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.dealTableSelect(l),e.endSelectCells(),n.touchSetTimeout=void 0)}if(!n.touchMove&&t.hasListeners(Q.CLICK_CELL)){const{col:l,row:h}=a.eventArgs,u=t.getCellInfo(l,h);let d,c;if(!((r=a.eventArgs)===null||r===void 0)&&r.target){const f=Wa((o=a.eventArgs)===null||o===void 0?void 0:o.target);f&&(d=f.icon,c=f.position)}const g=Object.assign(Object.assign({},u),{event:i.nativeEvent,federatedEvent:i,cells:[],targetIcon:d?{name:d.name,position:c,funcType:d.attribute.funcType}:void 0,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target});t.fireListeners(Q.CLICK_CELL,g)}}}),t.scenegraph.stage.addEventListener("pointerdown",i=>{var r,o,s;((r=Je(i).eventArgs)===null||r===void 0?void 0:r.target)!==((o=e.residentHoverIcon)===null||o===void 0?void 0:o.icon)&&e.hideMenu(),(s=t.editorManager)===null||s===void 0||s.completeEdit(i.nativeEvent)}),t.scenegraph.stage.addEventListener("pointertap",i=>{const r=i.target;t.eventManager.isDraging||!r||!r.isDescendantsOf(t.scenegraph.stage)&&r.stage!==r||r.isDescendantsOf(t.scenegraph.tableGroup)?t.eventManager.isDraging&&e.endSelectCells():(e.updateInteractionState(St.default),n.dealTableHover(),n.dealTableSelect(),e.updateCursor(),t.scenegraph.updateChartState(null))}),t.scenegraph.tableGroup.addEventListener("checkbox_state_change",i=>{var r;const o=Je(i),{col:s,row:a}=o.eventArgs,l=t.getCellInfo(s,a),h=ze(t,s,a);if(h)for(let d=h.start.col;d<=h.end.col;d++)for(let c=h.start.row;c<=h.end.row;c++)t.scenegraph.getCell(d,c).forEachChildren(g=>{g.name==="checkbox"&&g.setAttributes({checked:i.target.attribute.checked,indeterminate:i.target.attribute.indeterminate})});const u=Object.assign(Object.assign({},l),{event:i.nativeEvent,target:(r=o==null?void 0:o.eventArgs)===null||r===void 0?void 0:r.target,checked:i.detail.checked});if(t.isHeader(s,a))t.stateManager.setHeaderCheckedState(l.field,i.detail.checked),t.getCellType(s,a)==="checkbox"&&t.scenegraph.updateCheckboxCellState(s,a,i.detail.checked);else if(t.stateManager.setCheckedState(s,a,l.field,i.detail.checked),t.getCellType(s,a)==="checkbox"){const d=t.stateManager.headerCheckedState[l.field],c=t.stateManager.updateHeaderCheckedState(l.field);d!==c&&t.scenegraph.updateHeaderCheckboxCellState(s,a,c)}t.fireListeners(Q.CHECKBOX_STATE_CHANGE,u),t.scenegraph.updateNextFrame()})}function Ok(n){const t=n.table;n.gesture=new rR(t.scenegraph.tableGroup,{tap:{interval:300}}),n.gesture.on("doubletap",e=>{zk(e,t)})}function Cy(n){if(n.stateManager.endResizeCol(),n.hasListeners(Q.RESIZE_COLUMN_END)){const t=[];for(let e=0;e<n.colCount;e++)t.push(n.getColWidth(e));n.fireListeners(Q.RESIZE_COLUMN_END,{col:n.stateManager.columnResize.col,colWidths:t})}}function zk(n,t){var e,i,r,o,s;const a=Je(n);let l=-1,h=-1;a.eventArgs&&(l=a.eventArgs.col,h=a.eventArgs.row);const u=t.getCellValue(l,h),d=(i=(e=a.eventArgs)===null||e===void 0?void 0:e.targetCell)===null||i===void 0?void 0:i.globalAABBBounds;if(d&&t.internalProps.focusControl.setFocusRect(new On(d.x1+t.scrollLeft,d.y1+t.scrollTop,d.x2-d.x1,d.y2-d.y1),u),t.hasListeners(Q.DBLCLICK_CELL)){const c=t.getCellInfo(l,h);let g,f;if(!((r=a.eventArgs)===null||r===void 0)&&r.target){const v=Wa((o=a.eventArgs)===null||o===void 0?void 0:o.target);v&&(g=v.icon,f=v.position)}const p=Object.assign(Object.assign({},c),{event:n.nativeEvent,federatedEvent:n,cells:[],targetIcon:g?{name:g.name,position:f,funcType:g.attribute.funcType}:void 0,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target});t.fireListeners(Q.DBLCLICK_CELL,p)}}function Wk(n){const t=n.table,e=t.stateManager,i=t.scenegraph;i.component.vScrollBar.addEventListener("pointerover",s=>{e.showVerticalScrollBar()}),i.component.hScrollBar.addEventListener("pointerover",s=>{e.showHorizontalScrollBar()}),i.component.vScrollBar.addEventListener("pointerout",s=>{e.interactionState!==St.scrolling&&e.hideVerticalScrollBar()}),i.component.hScrollBar.addEventListener("pointerout",s=>{e.interactionState!==St.scrolling&&e.hideHorizontalScrollBar()}),i.component.vScrollBar.addEventListener("scrollDown",s=>{var a;i.table.eventManager.LastBodyPointerXY={x:s.x,y:s.y},i.table.eventManager.isDown=!0,e.interactionState!==St.scrolling&&e.updateInteractionState(St.scrolling),i.table.stateManager.hideMenu(),(a=i.table.editorManager)===null||a===void 0||a.completeEdit()}),i.component.vScrollBar.addEventListener("pointerup",()=>{e.fastScrolling=!1,i.table.eventManager.isDraging=!1,e.interactionState===St.scrolling&&e.updateInteractionState(St.default)}),i.component.vScrollBar.addEventListener("pointerupoutside",()=>{e.fastScrolling=!1,e.interactionState===St.scrolling&&e.updateInteractionState(St.default)}),i.component.vScrollBar.addEventListener("scrollUp",s=>{i.table.eventManager.isDraging=!1}),i.component.hScrollBar.addEventListener("scrollDown",s=>{var a;i.table.eventManager.LastBodyPointerXY={x:s.x,y:s.y},i.table.eventManager.isDown=!0,e.interactionState!==St.scrolling&&e.updateInteractionState(St.scrolling),i.table.stateManager.hideMenu(),(a=i.table.editorManager)===null||a===void 0||a.completeEdit()}),i.component.hScrollBar.addEventListener("pointerup",()=>{e.fastScrolling=!1,i.table.eventManager.isDraging=!1,e.interactionState===St.scrolling&&e.updateInteractionState(St.default)}),i.component.hScrollBar.addEventListener("pointerupoutside",()=>{e.fastScrolling=!1,e.interactionState===St.scrolling&&e.updateInteractionState(St.default)}),i.component.hScrollBar.addEventListener("scrollUp",s=>{i.table.eventManager.isDraging=!1});const r=ab(e.updateVerticalScrollBar,20),o=ab(e.updateHorizontalScrollBar,20);i.component.vScrollBar.addEventListener("scrollDrag",s=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==St.scrolling&&e.updateInteractionState(St.scrolling);const a=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);r(a,s)}),i.component.hScrollBar.addEventListener("scrollDrag",s=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==St.scrolling&&e.updateInteractionState(St.scrolling);const a=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);o(a)})}function a0(n,t){let{deltaX:e,deltaY:i}=n;n.shiftKey&&n.deltaY&&(e=i,i=0);const[r,o]=Nk(e,i,{horizontal:1,vertical:1});(r||o)&&t.interactionState!==St.scrolling&&t.updateInteractionState(St.scrolling),r&&(t.setScrollLeft(t.scroll.horizontalBarPos+r),t.showHorizontalScrollBar(!0)),o&&(t.setScrollTop(t.scroll.verticalBarPos+o),t.showVerticalScrollBar(!0)),t.resetInteractionState(),n.cancelable&&(t.table.internalProps.overscrollBehavior==="none"||Math.abs(i)>=Math.abs(e)&&i!==0&&by(i,t)||Math.abs(i)<=Math.abs(e)&&e!==0&&_y(e,t))&&n.preventDefault()}function Nk(n,t,e){var i,r;const o=Math.abs(n/t),s=o<=.5?0:n,a=o>2?0:t;return[Math.ceil(s*((i=e.horizontal)!==null&&i!==void 0?i:0)),Math.ceil(a*((r=e.vertical)!==null&&r!==void 0?r:0))]}function by(n,t){return t.table.getAllRowsHeight()-t.table.scenegraph.height!=0&&!jk(n,t)&&!Vk(n,t)}function _y(n,t){return t.table.getAllColsWidth()-t.table.scenegraph.width!=0&&!Gk(n,t)&&!Uk(n,t)}function jk(n,t){return t.table.getAllRowsHeight()-t.table.scenegraph.height!==0&&n<=0&&t.scroll.verticalBarPos<1}function Vk(n,t){const e=t.table.getAllRowsHeight()-t.table.scenegraph.height;return e!==0&&n>=0&&Math.abs(t.scroll.verticalBarPos-e)<1}function Gk(n,t){return t.table.getAllColsWidth()-t.table.scenegraph.width!==0&&n<=0&&t.scroll.horizontalBarPos<1}function Uk(n,t){const e=t.table.getAllColsWidth()-t.table.scenegraph.width;return e!==0&&n>=0&&Math.abs(t.scroll.horizontalBarPos-e)<1}function Kk(n){const t=n.table,e=t.stateManager,i=t.internalProps.handler;i.on(t.getElement(),"blur",a=>{n.dealTableHover()}),i.on(t.getElement(),"wheel",a=>{a0(a,e)}),i.on(t.getElement(),"keydown",a=>{var l,h,u,d,c,g,f,p,v,m,C,b;if(a.key==="a"&&(a.ctrlKey||a.metaKey))!((l=t.keyboardOptions)===null||l===void 0)&&l.selectAllOnCtrlA&&(a.preventDefault(),n.deelTableSelectAll());else if(e.select.cellPos.col>=0&&e.select.cellPos.row>=0&&(a.key==="ArrowUp"||a.key==="ArrowDown"||a.key==="ArrowLeft"||a.key==="ArrowRight")){if(((u=(h=t.options.keyboardOptions)===null||h===void 0?void 0:h.moveEditCellOnArrowKeys)===null||u===void 0||!u)&&t.editorManager.editingEditor)return;let _,y;a.preventDefault(),a.stopPropagation(),a.key==="ArrowUp"?(_=e.select.cellPos.col,y=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row-1))):a.key==="ArrowDown"?(_=e.select.cellPos.col,y=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1))):a.key==="ArrowLeft"?(y=e.select.cellPos.row,_=Math.min(t.colCount-1,Math.max(0,e.select.cellPos.col-1))):a.key==="ArrowRight"&&(y=e.select.cellPos.row,_=Math.min(t.colCount-1,Math.max(0,e.select.cellPos.col+1))),t.selectCell(_,y),(c=(d=t.options.keyboardOptions)===null||d===void 0?void 0:d.moveEditCellOnArrowKeys)!==null&&c!==void 0&&c&&t.editorManager.editingEditor&&(t.editorManager.completeEdit(),t.getElement().focus(),t.getEditor(_,y)&&t.editorManager.startEditCell(_,y))}else if(a.key==="Escape")t.editorManager.cancelEdit();else if(a.key==="Enter"){if(t.editorManager.editingEditor)t.editorManager.completeEdit(),t.getElement().focus();else if(((f=(g=t.options.keyboardOptions)===null||g===void 0?void 0:g.editCellOnEnter)===null||f===void 0||f)&&((v=(p=t.stateManager.select.ranges)===null||p===void 0?void 0:p.length)!==null&&v!==void 0?v:0)===1){const _=t.stateManager.select.ranges[0].start.col,y=t.stateManager.select.ranges[0].start.row,w=t.stateManager.select.ranges[0].end.col,S=t.stateManager.select.ranges[0].end.row;_===w&&y===S&&t.getEditor(_,y)&&t.editorManager.startEditCell(_,y)}}else if(a.key==="Tab"&&((C=(m=t.options.keyboardOptions)===null||m===void 0?void 0:m.moveFocusCellOnTab)===null||C===void 0||C)&&(a.preventDefault(),e.select.cellPos.col>=0&&e.select.cellPos.row>=0)){let _,y;e.select.cellPos.col===t.colCount-1?(y=Math.min(t.rowCount-1,e.select.cellPos.row+1),_=t.rowHeaderLevelCount):e.select.cellPos.row===t.rowCount-1?(y=t.rowCount-1,_=t.rowHeaderLevelCount):(y=e.select.cellPos.row,_=e.select.cellPos.col+1),t.selectCell(_,y),t.editorManager.editingEditor&&(t.editorManager.completeEdit(),t.getElement().focus(),t.getEditor(_,y)&&t.editorManager.startEditCell(_,y))}if(t.hasListeners(Q.KEYDOWN)){const _={keyCode:(b=a.keyCode)!==null&&b!==void 0?b:a.which,code:a.code,event:a,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth};t.fireListeners(Q.KEYDOWN,_)}}),i.on(t.getElement(),"copy",a=>{var l;if(!((l=t.keyboardOptions)===null||l===void 0)&&l.copySelected){const h=t.getCopyValue();if(N(h)){a.preventDefault();const u=c=>{const g=["<table>"],f=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join("");return c.split(`\r
`).forEach(function(p,v){const m=p.split("	"),C=[];v===0&&g.push("<tbody>"),m.forEach(function(b,_){const y=b?b.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,`<br>\r
`).replace(/\x20{2,}/gi,w=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(w.length-1)} </span>`).replace(/\t/gi,"&#9;"):"";C.push(`<td>${y}</td>`)}),g.push("<tr>",...C,"</tr>"),v===p.length-1&&g.push("</tbody>")}),g.push("</table>"),[f,g.join("")].join("")},d=u(h);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([d],{type:"text/html"}),"text/plain":new Blob([h],{type:"text/plain"})})]),t.fireListeners(Q.COPY_DATA,{cellRange:t.stateManager.select.ranges,copyData:h})}}}),i.on(t.getElement(),"paste",a=>{var l,h,u;if(!((l=t.keyboardOptions)===null||l===void 0)&&l.pasteValueToCell&&t.changeCellValues){if(!((h=t.editorManager)===null||h===void 0)&&h.editingEditor)return;if(((u=t.stateManager.select.ranges)===null||u===void 0?void 0:u.length)>0){const d=t.stateManager.select.ranges,c=Math.min(d[0].start.col,d[0].end.col),g=Math.min(d[0].start.row,d[0].end.row),f=[];navigator.clipboard.read().then(p=>{for(const v of p)v.types.includes("text/html")?v.getType("text/html").then(m=>{m.text().then(C=>{if(C&&/(<table)|(<TABLE)/g.test(C)){const b=new RegExp("<tr[^>]*>(.*?)<\\/tr>","gs"),_=Array.from(C.matchAll(b));for(const y of _){const w=y[1],S=new RegExp("<td[^>]*>(.*?)<\\/td>","gs"),D=Array.from(w.matchAll(S)).map(A=>A[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,`
`).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"	").replace(/&nbsp;/g," "));f.push(D)}t.changeCellValues(c,g,f,!0)}else navigator.clipboard.read().then(b=>{for(const _ of b)_.types.includes("text/plain")&&_.getType("text/plain").then(y=>{y.text().then(w=>{w.split(`
`).forEach(function(S,D){const A=S.split("	"),x=[];f.push(x),A.forEach(function(B,F){F===A.length-1&&(B=B.trim()),x.push(B)})}),t.changeCellValues(c,g,f,!0)})})})})}):v.types.length===1&&v.types[0]==="text/plain"&&(v.getType("text/plain").then(m=>{m.text().then(C=>{const b=C.replace(/\r(?!\n)/g,`\r
`).split(`\r
`),_=[];b.length>1&&b[b.length-1]===""&&b.pop(),b.forEach(function(y,w){const S=y.split("	"),D=[];_.push(D),S.forEach(function(A,x){A.includes(`
`)&&(A=A.replace(/^"(.*)"$/,"$1").replace(/["]*/g,B=>new Array(Math.floor(B.length/2)).fill('"').join(""))),D.push(A)})})})}),t.changeCellValues(c,g,f,!0))})}}}),i.on(t.getElement(),"contextmenu",a=>{var l;((l=t.eventOptions)===null||l===void 0?void 0:l.preventDefaultContextMenu)!==!1&&a.preventDefault()}),i.on(t.getContainer(),"resize",a=>{a.width===0&&a.height===0||t.resize()});const r=a=>{t.eventManager.LastBodyPointerXY={x:a.x,y:a.y},t.eventManager.isDown=!0};n.globalEventListeners.push({name:"pointerdown",env:"body",callback:r}),document.body.addEventListener("pointerdown",r);const o=a=>{t.eventManager.LastBodyPointerXY=null,t.eventManager.isDown=!1,t.eventManager.isDraging=!1};n.globalEventListeners.push({name:"pointerup",env:"document",callback:o}),document.addEventListener("pointerup",o);const s=a=>{var l,h,u,d;if(t.eventManager.isDown&&t.eventManager.LastBodyPointerXY){const f=(h=(l=t.eventManager.LastBodyPointerXY)===null||l===void 0?void 0:l.x)!==null&&h!==void 0?h:a.x,p=(d=(u=t.eventManager.LastBodyPointerXY)===null||u===void 0?void 0:u.y)!==null&&d!==void 0?d:a.y;(Math.abs(f-a.x)>1||Math.abs(p-a.y)>1)&&(t.eventManager.isDraging=!0)}const{x:c,y:g}=t._getMouseAbstractPoint(a,!1);e.interactionState!==St.scrolling&&e.interactionState===St.grabing&&e.isResizeCol()&&(n.dealColumnResize(c,g),t.hasListeners(Q.RESIZE_COLUMN)&&t.fireListeners(Q.RESIZE_COLUMN,{col:t.stateManager.columnResize.col,colWidth:t.getColWidth(t.stateManager.columnResize.col)}))};n.globalEventListeners.push({name:"pointermove",env:"body",callback:s}),document.body.addEventListener("pointermove",s)}function Yk(n){const t=n.table,e=t.stateManager,i=t.scenegraph;n.touchMovePoints=[],t.scenegraph.tableGroup.addEventListener("touchstart",a=>{a.target.isChildOf(i.component.vScrollBar)||a.target.isChildOf(i.component.vScrollBar)||(n.isTouchdown=!0,n.touchMovePoints.push({x:a.page.x,y:a.page.y,timestamp:Date.now()}))});const r=a=>{if(n.touchMove&&a.preventDefault(),!n.isTouchdown||!yy(a))return;n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,timestamp:Date.now()});const l=-n.touchMovePoints[n.touchMovePoints.length-1].x+n.touchMovePoints[n.touchMovePoints.length-2].x,h=-n.touchMovePoints[n.touchMovePoints.length-1].y+n.touchMovePoints[n.touchMovePoints.length-2].y;a0({deltaX:l,deltaY:h},e),a.cancelable&&(t.internalProps.overscrollBehavior==="none"||Math.abs(h)>=Math.abs(l)&&h!==0&&by(h,e)||Math.abs(h)<=Math.abs(l)&&l!==0&&_y(l,e))&&a.preventDefault()};window.addEventListener("touchmove",r,{passive:!1}),n.globalEventListeners.push({name:"touchmove",env:"window",callback:r});const o=a=>{var l,h;if(n.touchEnd=!0,n.touchMove=!1,n.isTouchdown&&yy(a)){if(!((l=n.touchMovePoints)===null||l===void 0)&&l.length){n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,timestamp:Date.now()});const u=n.touchMovePoints[0],d=n.touchMovePoints[((h=n.touchMovePoints)===null||h===void 0?void 0:h.length)-1];$k((d.x-u.x)/(d.timestamp-u.timestamp),(d.y-u.y)/(d.timestamp-u.timestamp),e)}n.isTouchdown=!1,n.touchMovePoints=[]}};window.addEventListener("touchend",o),n.globalEventListeners.push({name:"touchend",env:"window",callback:o});const s=a=>{n.touchEnd=!0,n.touchMove=!1,n.isTouchdown&&(n.isTouchdown=!1,n.touchMovePoints=[])};window.addEventListener("touchcancel",s),n.globalEventListeners.push({name:"touchcancel",env:"window",callback:s})}function yy(n){return!!n.changedTouches}function $k(n,t,e){let i=Date.now();const r=()=>{const o=Date.now(),s=o-i;let a=!0;const l=Math.pow(.95,s/16),h=l*n,u=l*t;let d=0,c=0;Math.abs(h)>.05&&(a=!1,d=(n+h)/2*s),Math.abs(u)>.05&&(a=!1,c=(t+u)/2*s),a0({deltaX:-d,deltaY:-c},e),a||(i=o,n=h,t=u,requestAnimationFrame(r))};requestAnimationFrame(r)}function Xk(n){n.isPivotChart()&&n.scenegraph.tableGroup.addEventListener("click",t=>{var e;if(!n.stateManager.columnMove.moving&&!n.stateManager.columnResize.resizing)if(t.target.name==="axis-label"){const i=Je(t),{col:r,row:o}=i.eventArgs,s=n.internalProps.layoutMap;let a,l;s.indicatorsAsCol?(a=s.getDimensionKeyInChartSpec(s.rowHeaderLevelCount,o),l=s.getCellHeaderPaths(s.rowHeaderLevelCount-2,o).rowHeaderPaths):(a=s.getDimensionKeyInChartSpec(r,s.columnHeaderLevelCount),l=s.getCellHeaderPaths(r,s.columnHeaderLevelCount-1).colHeaderPaths);const h=l.map(u=>({key:u.dimensionKey,value:u.value})).filter(u=>u.key);if(h.push({key:a,value:t.target.attribute.text}),n._selectedDimensionInChart.length&&qk(n._selectedDimensionInChart,h))return;n._selectedDimensionInChart=h,s.updateDataStateToChartInstance(),td(n.scenegraph),n.scenegraph.updateNextFrame()}else!((e=n._selectedDimensionInChart)===null||e===void 0)&&e.length&&(n._selectedDimensionInChart.length=0,n.internalProps.layoutMap.updateDataStateToChartInstance(),td(n.scenegraph),n.scenegraph.updateNextFrame())})}function qk(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e].key!==t[e].key||n[e].value!==t[e].value)return!1;return!0}function Zk(n){n.isPivotChart()&&(n.on(Q.MOUSEENTER_CELL,t=>{n.scenegraph.getCell(t.col,t.row).forEachChildren(e=>{if(e.name==="axis"){const i=wy(t.col,t.row,n.internalProps.layoutMap);t.axisPosition=i,n.fireListeners(Q.MOUSEENTER_AXIS,t)}})}),n.on(Q.MOUSELEAVE_CELL,t=>{n.scenegraph.getCell(t.col,t.row).forEachChildren(e=>{if(e.name==="axis"){const i=wy(t.col,t.row,n.internalProps.layoutMap);t.axisPosition=i,n.fireListeners(Q.MOUSELEAVE_AXIS,t)}})}))}function wy(n,t,e){if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"top";if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"bottom";if(n===e.rowHeaderLevelCount-1&&t>=e.rowHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"left"}else{if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"left";if(n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"right";if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"bottom"}return"bottom"}class Jk{constructor(t){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this.table=t,Pt.mode!=="node"&&(this.bindOuterEvent(),setTimeout(()=>{this.bindSelfEvent()},0))}bindOuterEvent(){Ik(this),Kk(this),Wk(this),Yk(this),Ok(this)}updateEventBinder(){setTimeout(()=>{i0(this.table)&&!this.handleTextStickBindId?this.handleTextStickBindId=this.table.on(Q.SCROLL,t=>{e0(this.table)}):!i0(this.table)&&this.handleTextStickBindId&&(this.table.off(this.handleTextStickBindId),this.handleTextStickBindId=void 0)},0)}bindSelfEvent(){if(this.table.isReleased)return;const t=this.table.stateManager;this.table.on(Q.ICON_CLICK,e=>{const{col:i,row:r,x:o,y:s,funcType:a,icon:l,event:h}=e;a===ne.dropDown?t.triggerDropDownMenu(i,r,o,s,h):a===ne.sort?t.triggerSort(i,r,l,h):a===ne.frozen?t.triggerFreeze(i,r,l):a===ne.drillDown?Pk(this.table):a!==ne.collapse&&a!==ne.expand||(this.table.stateManager.updateSelectPos(-1,-1),this.table.toggleHierarchyState(i,r))}),this.table.on(Q.DROPDOWN_MENU_CLICK,()=>{t.hideMenu()}),i0(this.table)&&(this.handleTextStickBindId=this.table.on(Q.SCROLL,e=>{e0(this.table)})),Rk(this.table),this.table.on(Q.DBLCLICK_CELL,e=>{var i;if(e.federatedEvent){const r=Je(e.federatedEvent),o=this.table.scenegraph.getResizeColAt(r.abstractPos.x,r.abstractPos.y,(i=r.eventArgs)===null||i===void 0?void 0:i.targetCell);if(this.table._canResizeColumn(o.col,o.row)&&o.col>=0){this.table.scenegraph.updateAutoColWidth(o.col),this.table.scenegraph.updateChartSize(o.col);const s=this.table.stateManager;s.columnResize.col<s.table.frozenColCount&&!s.table.isPivotTable()&&!s.table.transpose&&s.table.scenegraph.component.setFrozenColumnShadow(s.table.frozenColCount-1,s.columnResize.isRightFrozen)}}}),this.table.isPivotTable()&&Hk(this.table)&&Ek(this.table),Lk(this.table),Xk(this.table),Zk(this.table)}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell,e.event):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){var i,r,o;if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:s}=t;if(s){if(s.target.name==="checkbox")return!1;const a=this.table.getBodyColumnDefine(s.col,s.row);return this.table.isHeader(s.col,s.row)&&(a!=null&&a.disableHeaderSelect||!((i=this.table.stateManager.select)===null||i===void 0)&&i.disableHeader)||!this.table.isHeader(s.col,s.row)&&(a!=null&&a.disableSelect)?(e||this.table.stateManager.updateSelectPos(-1,-1),!1):!this.table.isPivotChart()||((r=t==null?void 0:t.eventArgs)===null||r===void 0?void 0:r.target.name)!=="axis-label"&&((o=t==null?void 0:t.eventArgs)===null||o===void 0?void 0:o.target.type)!=="chart"?(this.table.stateManager.updateSelectPos(s.col,s.row,s.event.shiftKey,s.event.ctrlKey||s.event.metaKey),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0)}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t;if(i){const r=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeColumn(r.col,r.row)&&r.col>=0)return e&&this.table.stateManager.startResizeCol(r.col,t.abstractPos.x,t.abstractPos.y,r.rightFrozen),!0}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}chechColumnMover(t){const{eventArgs:e}=t;return!!(e&&this.table.isHeader(e.col,e.row)&&lk(e.col,e.row,this.table.stateManager.select.ranges)&&this.table._canDragHeaderPosition(e.col,e.row))&&(this.table.stateManager.startMoveCol(e.col,e.row,t.abstractPos.x,t.abstractPos.y),!0)}dealColumnMover(t){const{eventArgs:e}=t;N(e.col)&&N(e.row)&&this.table.stateManager.updateMoveCol(e.col,e.row,t.abstractPos.x,t.abstractPos.y)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:r,event:o,col:s,row:a}=i||{target:t.target,event:t,col:-1,row:-1},l=r;if(l.role&&l.role.startsWith("icon-"))return this.table.fireListeners(Q.ICON_CLICK,{name:l.name,x:(l.globalAABBBounds.x1+l.globalAABBBounds.x2)/2,y:l.globalAABBBounds.y2,col:s,row:a,funcType:l.attribute.funcType,icon:l,event:o}),!0;if(r instanceof An){const h=r.pickIcon(o.global);if(h)return this.table.fireListeners(Q.ICON_CLICK,{name:h.attribute.id,x:h.globalX+h.globalAABBBounds.width()/2,y:h.globalY+h.AABBBounds.height(),col:s,row:a,funcType:h.attribute.funcType,icon:h,event:o}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach(t=>{t.env==="document"?document.removeEventListener(t.name,t.callback):t.env==="body"?document.body.removeEventListener(t.name,t.callback):t.env==="window"&&window.removeEventListener(t.name,t.callback)}),this.globalEventListeners=[]}}let Dy;const Qk=n=>{const t=n.value;return Number(t)>80?"#20a8d8":Number(t)>50?"#4dbd74":Number(t)>20?"#ffc107":"#f86c6b"};class id extends xn{static get DEFAULT(){return Dy||(Dy=new id)}constructor(t={},e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m;super(t,e),this._showBar=(i=t.showBar)===null||i===void 0||i,this._barColor=(r=t.barColor)!==null&&r!==void 0?r:Qk,this._barPositiveColor=(o=t.barPositiveColor)!==null&&o!==void 0?o:"#4dbd74",this._barNegativeColor=(s=t.barNegativeColor)!==null&&s!==void 0?s:"#f86c6b",this._barAxisColor=(a=t.barAxisColor)!==null&&a!==void 0?a:"black",this._barBgColor=t.barBgColor,this._barHeight=(l=t.barHeight)!==null&&l!==void 0?l:3,this._barHeight=(h=t.barHeight)!==null&&h!==void 0?h:3,this._barBottom=(u=t.barBottom)!==null&&u!==void 0?u:0,this._barPadding=(d=t.barPadding)!==null&&d!==void 0?d:[0,0,0,0],this._showBarMark=(c=t.showBarMark)!==null&&c!==void 0&&c,this._barMarkPositiveColor=(g=t.barMarkPositiveColor)!==null&&g!==void 0?g:"#4dbd74",this._barMarkNegativeColor=(f=t.barMarkNegativeColor)!==null&&f!==void 0?f:"#f86c6b",this._barMarkWidth=(p=t.barMarkWidth)!==null&&p!==void 0?p:2,this._barMarkPosition=(v=t.barMarkPosition)!==null&&v!==void 0?v:"right",this._barRightToLeft=(m=t.barRightToLeft)!==null&&m!==void 0&&m}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}clone(){return new id(this,null)}}const tI=["type","content","font","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive"];class eI{constructor(t){this._table=t;const e=ar();this.expandIcon=e[Wi.expandIconName],this.collapseIcon=e[Wi.collapseIconName]}getIcons(t,e,i,r,o){const s=[],{icon:a}=this._table.getBodyColumnDefine(t,e);if(a){let h;typeof a=="function"?h=a({col:t,row:e,value:i,dataValue:r,table:this._table}):h=a;const u=ar(),d=c=>{let g;g=typeof c=="string"?u[c]:c,g&&s.push(g)};Array.isArray(h)?h.forEach((c,g)=>{d(c)}):d(h)}const l=this.getHierarchyIcon(t,e);return l&&s.push(l),o&&s.forEach((h,u)=>{(h.content||h.src)&&(s[u]=this.getCellIconFromRecordValue(h,t,e))}),s}getStyleClass(t){switch(t){case"text":case"link":return la;case"image":case"video":return Jh;case"chart":case"sparkline":return xn;case"progressbar":return id;case"checkbox":return Xr}return la}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map(s=>this.getCellIconFromRecordValue(s,e,i));if(!gb.isObject(t)||typeof t=="function")return this._table.getFieldData(t,e,i);const r={},o=t;return tI.forEach(s=>{var a,l;if(o[s]!==void 0){const h=this._table.getFieldData(o[s],e,i);h!=null?r[s]=h:!((l=(a=this._table)._hasField)===null||l===void 0)&&l.call(a,o[s],e,i)||(r[s]=o[s])}}),r}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===Ft.expand?this.expandIcon:i===Ft.collapse?this.collapseIcon:void 0}}function Un(n,t){const e=document.createElement(n);return t&&e.classList.add(...t),e}function iI(){if(Pt.mode==="node")return;const n=document.createElement("style");n.id="vtable-menu-styleSheet",n.textContent=`
@keyframes vtable__menu-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__menu-element {
	position: absolute;
	box-sizing: border-box;
	border-radius: 4px;
	background-color: #fff;
	padding: 6px 0;
	/* pointer-events: none; */
	user-select: none;
	color: #000;
	max-width: 300px;
	z-index: 99999;
	border: #CCC 0.5px solid;
	cursor: default;
	width: max-content;
	box-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);
}
.vtable__menu-element--hidden {
	opacity: 0;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
	z-index: -9999;
}
.vtable__menu-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__menu-element--shown-animation 150ms ease-out;
}
.vtable__menu-element__content {
	font-family: Roboto;
	font-size: 12px;
	overflow: hidden;
	display: inline-block;
	/* height: 100%; */
	line-height: 30px;
}
.vtable__menu-element__item {
	height: 32px;
	padding: 0px 12px;
	cursor: pointer;
	position: relative;
	display: flex;
	align-items: center;
	justify-content: flex-start;
}
.vtable__menu-element__item:hover {
	background-color: rgba(27, 31, 35, 0.06);
}
.vtable__menu-element__icon{
	/* vertical-align: top; */
	display: flex;
	/* line-height: 30px; */
	margin-right: 6px;
}
.vtable__menu-element__no-event {
	pointer-events: none;
}
.vtable__menu-element--select {
	color: #2E68CF;
}.vtable__menu-element--normal {
	color: rgba(20, 20, 20, 0.9);;
}
.vtable__menu-element__split {
	height: 0px;
	border: 1px solid rgb(209, 213, 218);
	margin: 5px 0;
}
.vtable__menu-element__title {
	color: rgb(149, 149, 149);
}
.vtable__menu-element__arrow {
	position: absolute;
	right: 3px;
	font-weight: bold;
	margin-top: 1px;
}
.vtable__menu-element__item-text {
	margin-right: 15px;
}
`,document.head.appendChild(n)}iI();const $i="vtable__menu-element",nI=`${$i}__item`,l0=`${$i}__content`,Pi=`${$i}--hidden`,fr=`${$i}--shown`,rI=`${$i}--normal`,oI=`${$i}--select`,sI=`${$i}__icon`,aI=`${$i}__split`,lI=`${$i}__title`,hI=`${$i}__arrow`,Na=`${$i}__no-event`,Sy=`${$i}__item-text`;function Ay(){return Un("div",[$i,Pi])}function ja(n,t,e,i,r,o){const s=n.getCellRange(i,r);for(let a=0;a<t.length;a++){const l=t[a];let{col:h,row:u}=l;const{field:d,menuKey:c}=l;if(typeof h!="number"||typeof u!="number")if(n.isPivotTable()&&(Array.isArray(d),1)){const g=n.internalProps.layoutMap.getPivotCellAdress(d);if(!g)continue;h=g.col,u=g.row}else{const g=n.internalProps.layoutMap.getHeaderCellAddressByField(d);if(!g)continue;h=g.col,u=g.row}if(N(h)&&N(u)&&Bn(s,h,u)&&e===c)return!0}return!1}class uI{constructor(t){var e,i,r,o,s,a,l,h,u,d;this._handler=new ou,this._rootElement=Ay(),this._secondElement=Ay(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",c=>{c.stopPropagation()}),(e=this._rootElement)===null||e===void 0||e.addEventListener("mousedown",c=>{c.stopPropagation(),c.preventDefault()}),(i=this._rootElement)===null||i===void 0||i.addEventListener("touchend",c=>{if(c.stopPropagation(),c.preventDefault(),this._rootElement.classList.contains(Pi))return;const{col:g,row:f,dropDownIndex:p,menuKey:v,text:m,hasChildren:C}=c.target;if(typeof p!="number"||C)return void c.stopPropagation();const b=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(g,f):t.getHeaderField(g,f),_=t._dropDownMenuIsHighlight(g,f,p);t.fireListeners(Q.DROPDOWN_MENU_CLICK,{col:g,row:f,field:b,menuKey:v,text:m,highlight:_,cellLocation:t.getCellLocation(g,f),event:c}),t.fireListeners(Q.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Q.HIDE_MENU,null),c.stopPropagation()}),(r=this._rootElement)===null||r===void 0||r.addEventListener("click",c=>{if(c.stopPropagation(),c.preventDefault(),this._rootElement.classList.contains(Pi))return;const{col:g,row:f,dropDownIndex:p,menuKey:v,text:m,hasChildren:C}=c.target;if(typeof p!="number"||C)return void c.stopPropagation();const b=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(g,f):t.getHeaderField(g,f),_=t._dropDownMenuIsHighlight(g,f,p);t.fireListeners(Q.DROPDOWN_MENU_CLICK,{col:g,row:f,field:b,menuKey:v,text:m,highlight:_,cellLocation:t.getCellLocation(g,f),event:c}),t.fireListeners(Q.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Q.HIDE_MENU,null),c.stopPropagation()}),(o=this._rootElement)===null||o===void 0||o.addEventListener("mousemove",c=>{var g,f;if(this._rootElement.classList.contains(Pi))return;c.stopPropagation();const{hasChildren:p,dropDownIndex:v,col:m,row:C,sub:b}=c.target;if(p){this._showChildrenIndex=v;const _=this._secondElement;_==null||_.classList.remove(Pi),_==null||_.classList.add(fr),_.innerHTML="";const y=(g=this._menuInstanceInfo.content[v])===null||g===void 0?void 0:g.children;for(let S=0;S<y.length;S++){const D=y[S],A=xy(D,!!t.stateManager.menu.dropDownMenuHighlight&&ja(t,t.stateManager.menu.dropDownMenuHighlight,typeof D=="object"?(D==null?void 0:D.menuKey)||(D==null?void 0:D.text):D,m,C,S));A.col=m,A.row=C,A.dropDownIndex=S,typeof D=="string"?(A.text=D,A.menuKey=D):typeof D=="object"&&(A.text=D.text,A.menuKey=D.menuKey||D.text),A.sub=!0,A.sub=!0,_.appendChild(A)}const w=c.target.getBoundingClientRect();this._bindSecondElement(t,m,C,w.right,w.top)}else if(p&&this._showChildrenIndex===v){const _=this._secondElement;_==null||_.classList.remove(Pi),_==null||_.classList.add(fr)}else!b&&(!((f=this._secondElement)===null||f===void 0)&&f.classList.contains(fr))&&setTimeout(()=>{if(this._mouseEnterSecondElement!==!0){this._showChildrenIndex=-1;const _=this._secondElement;_==null||_.classList.remove(fr),_==null||_.classList.add(Pi)}},300)}),(s=this._secondElement)===null||s===void 0||s.addEventListener("wheel",c=>{c.stopPropagation()}),(a=this._secondElement)===null||a===void 0||a.addEventListener("mousemove",c=>{this._rootElement.classList.contains(Pi)||c.stopPropagation()}),(l=this._secondElement)===null||l===void 0||l.addEventListener("mouseenter",c=>{this._mouseEnterSecondElement=!0}),(h=this._secondElement)===null||h===void 0||h.addEventListener("mouseleave",c=>{this._mouseEnterSecondElement=!1}),(u=this._secondElement)===null||u===void 0||u.addEventListener("mousedown",c=>{c.stopPropagation(),c.preventDefault()}),(d=this._secondElement)===null||d===void 0||d.addEventListener("click",c=>{if(c.stopPropagation(),c.preventDefault(),this._secondElement.classList.contains(Pi))return;const{col:g,row:f,dropDownIndex:p,menuKey:v,text:m,hasChildren:C}=c.target;if(typeof p!="number"||C)return void c.stopPropagation();const b=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(g,f):t.getHeaderField(g,f);let _=!1;this._menuInstanceInfo.content.forEach((y,w)=>{if(typeof y=="object"&&y.children&&y.children.length)for(let S=0;S<y.children.length;S++){const D=y.children[S];if(ja(t,t.stateManager.menu.dropDownMenuHighlight,typeof D=="object"?D==null?void 0:D.menuKey:D,g,f,-1)&&v===(typeof D=="object"?D==null?void 0:D.menuKey:D))return void(_=!0)}}),t.fireListeners(Q.DROPDOWN_MENU_CLICK,{col:g,row:f,field:b,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(g,f):void 0,menuKey:v,text:m,highlight:_,cellLocation:t.getCellLocation(g,f),event:c}),t.fireListeners(Q.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Q.HIDE_MENU,null),c.stopPropagation()})}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t!=null&&t.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){var o,s;const a=this._rootElement,l=this._secondElement;if(this._menuInstanceInfo=r,a==null||a.classList.remove(fr),a==null||a.classList.add(Pi),l==null||l.classList.remove(fr),l==null||l.classList.add(Pi),this._canBindToCell(t,e,i)){if(a.innerHTML="",Array.isArray(r.content)){const h=r.content;for(let u=0;(o=u<(h==null?void 0:h.length))!==null&&o!==void 0&&o;u++){const d=h[u];let c=!!t.stateManager.menu.dropDownMenuHighlight&&ja(t,t.stateManager.menu.dropDownMenuHighlight,typeof d=="object"?(d==null?void 0:d.menuKey)||(d==null?void 0:d.text):d,e,i,u);if(t.stateManager.menu.dropDownMenuHighlight&&typeof d=="object"&&Array.isArray(d.children)&&d.children.length)for(let f=0;f<d.children.length;f++){const p=d.children[f];if(ja(t,t.stateManager.menu.dropDownMenuHighlight,typeof p=="object"?(p==null?void 0:p.menuKey)||(p==null?void 0:p.text):p,e,i,f)){c=!0;break}}const g=xy(d,c);g.col=e,g.row=i,g.dropDownIndex=u,typeof d=="string"?(g.text=d,g.menuKey=d):typeof d=="object"&&(g.text=d.text,g.menuKey=d.menuKey||d.text,!((s=d.children)===null||s===void 0)&&s.length&&(g.hasChildren=!0)),a.appendChild(g)}}if(this._bindToCell(t,e,i,r.position,r.referencePosition))return a==null||a.classList.add(fr),a==null||a.classList.remove(Pi),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,t!=null&&t.parentElement&&(t.classList.remove(fr),t.classList.add(Pi)),e!=null&&e.parentElement&&(e.classList.remove(fr),e.classList.add(Pi))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{top:s,bottom:a,left:l,right:h}=r;if(t.isFrozenCell(e,i))return!0;if(a<t.getFrozenRowsHeight()||h<t.getFrozenColsWidth()||l>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||s>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:d}=o;return!(u<s)&&!(d<l)}_bindToCell(t,e,i,r,o){const s=this._rootElement,a=t.getElement(),{width:l,height:h}=t.internalProps.element.getBoundingClientRect();if(s){s.parentElement!==a&&a.appendChild(s),s.style.left="0px";const u=.8*l;s.style.maxWidth=`${u}px`;const d=s.clientWidth,c=s.clientHeight;let g,f;return r?(g=r.x,f=r.y):o&&(g=o.rect.right-d,f=o.rect.bottom),f+c>h&&(f=h-c),f<0&&(f/=2),s.style.top=`${f}px`,g<0?g=0:g+d>l&&(g=l-d),s.style.left=`${g}px`,!0}return!1}_bindSecondElement(t,e,i,r,o){const s=this._secondElement,a=this._rootElement,l=t.getElement(),{width:h,left:u,top:d}=t.internalProps.element.getBoundingClientRect(),{x:c,y:g,width:f}=a.getBoundingClientRect();if(s){s.parentElement!==l&&l.appendChild(s),s.style.left="0px";const p=.8*h;s.style.maxWidth=`${p}px`;const v=s.clientWidth,m=o-4-d,C=r-u;s.style.top=`${m}px`;let b=C;return b+v>h?b=b-v-f:b+=4,s.style.left=`${b}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:s,height:a}=i.getBoundingClientRect();if(t>r-5&&t<r+s+5&&e>o-5&&e<o+a+5)return!0;if(this._secondElement){const{x:l,y:h,width:u,height:d}=i.getBoundingClientRect();if(t>l-5&&t<l+u+5&&e>h-5&&e<h+d+5)return!0}return!1}}function xy(n,t){var e,i,r;const o=Un("div",[nI,t?oI:rI]);if(typeof n=="string"){const s=Un("span",[l0,Na,Sy]);s.innerHTML=n,o.appendChild(s)}else if(typeof n=="object"){const s=(e=n.type)!==null&&e!==void 0?e:"item";if(s==="split")return o==null||o.classList.add(aI),o;if(!((i=n==null?void 0:n.icon)===null||i===void 0)&&i.svg)if(Xg.test(n.icon.svg)){const l=new Image;n.icon.width?l.style.width=n.icon.width.toString()+"px":l.style.width="16px",n.icon.height?l.style.height=n.icon.height.toString()+"px":l.style.height="16px",l.src=n.icon.svg,o.appendChild(l)}else{const l=Un("span",[sI,Na]);l.innerHTML=t&&n.selectedIcon&&n.selectedIcon.svg?n.selectedIcon.svg:n.icon.svg,n.icon.width&&l.children[0].setAttribute("width",n.icon.width.toString()),n.icon.height&&l.children[0].setAttribute("height",n.icon.height.toString()),o.appendChild(l)}const a=Un("span",[l0,Na,Sy]);if(a.innerHTML=n.text,o.appendChild(a),s==="title")o==null||o.classList.add(Na,lI);else if(!((r=n==null?void 0:n.children)===null||r===void 0)&&r.length){const l=Un("span",[l0,Na,hI]);l.innerHTML=t?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',o.appendChild(l)}}return o}let By;class nd extends qr{static get DEFAULT(){return By||(By=new nd)}constructor(t={},e={}){var i;super(t,e),this.textAlign=((i=t.textAlign)!==null&&i!==void 0?i:e==null?void 0:e.textAlign)||"center"}clone(){return new nd(this)}}class dI{constructor(t){this._table=t;const e=ar();this.freezeIcon=e[Wi.freezeIconName],this.frozenIcon=e[Wi.frozenIconName],this.frozenCurrentIcon=e[Wi.frozenCurrentIconName],this.normalIcon=e[Wi.normalIconName],this.upIcon=e[Wi.upwardIconName],this.downIcon=e[Wi.downwardIconName],this.dropDownAbsoluteIcon=e[Wi.dropdownIconName],this.expandIcon=e[Wi.expandIconName],this.collapseIcon=e[Wi.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:a}=this._table.internalProps.layoutMap.getHeader(t,e);if(a){const l=this._table.getPivotSortState(t,e),h=l==="asc"?this.downIcon:l==="desc"?this.upIcon:this.normalIcon;h&&i.push(h)}}else{const a=this._table.sortState;let l;l=void 0;const h=this._table.getCellRange(t,e);if(a)if(Array.isArray(a))for(let d=0;d<a.length;d++){const c=a[d],g=this._table._getHeaderCellBySortState(c);if(g&&Bn(h,g.col,g.row)){({order:l}=c);break}}else{const d=this._table._getHeaderCellBySortState(a);d&&Bn(h,d.col,d.row)&&({order:l}=a)}const u=this.getSortIcon(l,this._table,t,e);u&&i.push(u)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const a=this.getFrozenIcon(t,e);a&&i.push(a)}if(this.checkDropDownIcon(this._table,t,e)){const a=this.dropDownAbsoluteIcon;i.push(a)}const r=this.getDropDownStateIcons(this._table,t,e);r.length&&i.push(...r);const{headerIcon:o}=this._table._getHeaderLayoutMap(t,e),s=this.getHierarchyIcon(t,e);if(s&&i.push(s),o){let a;typeof o=="function"?a=o({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table}):a=o;const l=ar(),h=u=>{let d;d=typeof u=="string"?l[u]:u,d&&i.push(d)};Array.isArray(a)?a.forEach((u,d)=>{h(u)}):h(a)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose||this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let r=this.freezeIcon;return this._table.options.frozenColCount-1>t?r=this.frozenIcon:this._table.options.frozenColCount-1===t&&(r=this.frozenCurrentIcon),r}getSortIcon(t,e,i,r){const o=t==="asc"?this.downIcon:t==="desc"?this.upIcon:this.normalIcon,s=e.getHeaderDefine(i,r);return!s||s.showSort===!1||!N(s.showSort)&&!s.sort||s.columns&&s.columns.length>0?null:o}getDropDownStateIcons(t,e,i){var r,o,s;const a=t.getHeaderDefine(e,i),l=t._getHeaderLayoutMap(e,i),{dropDownMenu:h}=l,u=[];if(Array.isArray(h)&&h.length||Array.isArray(t.globalDropDownMenu)&&t.globalDropDownMenu.length&&!(!((r=a==null?void 0:a.columns)===null||r===void 0)&&r.length)){const d=h||t.globalDropDownMenu;let c=-1,g=-1;for(let f=0;f<d.length;f++){const p=d[f];if(typeof p=="object"&&p.children&&p.children.length)for(let v=0;v<p.children.length;v++){const m=p.children[v];if(!((o=t.stateManager.menu)===null||o===void 0)&&o.dropDownMenuHighlight&&ja(t,(s=t.stateManager.menu)===null||s===void 0?void 0:s.dropDownMenuHighlight,typeof m=="object"?m==null?void 0:m.menuKey:m,e,i,f)){c=f,g=v;break}}if(t._dropDownMenuIsHighlight(e,i,f)){c=f;break}}if(c!==-1){let f;f=g!==-1?(h||t.globalDropDownMenu)[c].children[g]:(h||t.globalDropDownMenu)[c],f.stateIcon&&(f.stateIcon.svg?u.push({type:"svg",name:f.stateIcon.src||f.stateIcon.svg,width:f.stateIcon.width||22,height:f.stateIcon.height||22,svg:f.stateIcon.svg,positionType:Qt.right,marginRight:0,funcType:ne.dropDownState,interactive:!1}):f.stateIcon.src&&u.push({type:"image",name:f.stateIcon.src||f.stateIcon.svg,width:f.stateIcon.width||22,height:f.stateIcon.height||22,src:f.stateIcon.src,positionType:Qt.right,marginRight:0,funcType:ne.dropDownState,interactive:!1}))}}return u}getDropDownIconRect(t,e,i){var r,o,s,a,l,h,u,d;const c=(a=(o=(r=this.downIcon.hover)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:(s=this.downIcon)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:0,g=(d=(h=(l=this.downIcon.hover)===null||l===void 0?void 0:l.height)!==null&&h!==void 0?h:(u=this.downIcon)===null||u===void 0?void 0:u.height)!==null&&d!==void 0?d:0,f=t.right-2-c,p=t.right-2;let v;return v=i==="middle"?t.top+t.height/2-c/2:i==="top"?t.top+e/2:i==="bottom"?t.bottom-2*e:t.top,{left:f,right:p,top:v,bottom:g+v,width:c,height:g}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===Ft.expand)return this.expandIcon;if(i===Ft.collapse)return this.collapseIcon}}checkDropDownIcon(t,e,i){var r;if(t.isPivotTable()){const o=t._getHeaderLayoutMap(e,i);if(Array.isArray(o.dropDownMenu)&&o.dropDownMenu.length)return!0}else{const o=t.getHeaderDefine(e,i);if(Array.isArray(o.dropDownMenu)&&o.dropDownMenu.length||(!Array.isArray(o.dropDownMenu)||o.dropDownMenu.length!==0)&&Array.isArray(t.globalDropDownMenu)&&t.globalDropDownMenu.length&&!(!((r=o==null?void 0:o.columns)===null||r===void 0)&&r.length))return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return Qh;case"image":case"video":return nd;case"checkbox":return Zr}}}class cI{constructor(t){this._table=t}release(){var t,e;this.unbindTooltipElement(),this._tooltipElement&&((e=(t=this._tooltipElement).release)===null||e===void 0||e.call(t)),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,r){return this._getTooltipElement().bindToCell(this._table,t,e,i,r)}moveTooltipElement(t,e,i,r){this._getTooltipElement().move(this._table,t,e,i,r)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,r,o){this._getTooltipElement()._locate(this._table,t,e,i,r,o)}}function gI(){if(Pt.mode==="node")return;const n=document.createElement("style");n.id="vtable-tooltip-styleSheet",n.textContent=`
@keyframes vtable__bubble-tooltip-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__bubble-tooltip-element {
	position: absolute;
	
	pointer-events: none;
	user-select: none;
	max-width: 300px;
	z-index: 99999;

	background: #FFFFFF;
    border: 1px solid #E6E8ED;
    box-sizing: border-box;
    border-radius: 4px;
    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);
    color: #141414;
    font-size: 13px;
}
.vtable__bubble-tooltip-element--hidden {
	opacity: 0;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
}
.vtable__bubble-tooltip-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;
}
.vtable__bubble-tooltip-element__content {
	/* font-size: .75rem; */
	padding: 6px 8px;
	min-height: 1em;
	line-height: 1.5;
	width: 100%;
	display: block;
	white-space: pre-wrap;
	margin: 0;
	box-sizing: border-box;
	overflow: hidden;
	word-wrap: break-word;
	position: relative;
	background-color: #FFF;
	z-index: 2;
	border-radius: 4px
}
.vtable__bubble-tooltip-element__triangle {
	/* font-size: .75rem; */
	position: absolute;
	width: 10px;
	height: 10px;
	display: block;
	transform: rotate(45deg);
    transform-origin: 50% 50% 0;
	z-index: 1;
	background-color: #FFF;
	border: 1px solid #E6E8ED;
}
`,document.head.appendChild(n)}gI();const Va="vtable__bubble-tooltip-element",Fy=`${Va}__content`,Ty=`${Va}__triangle`,Ga=`${Va}--hidden`,rd=`${Va}--shown`;class fI{constructor(){this._handler=new ou;const t=this._rootElement=Un("div",[Va,Ga]),e=Un("span",[Fy]),i=Un("span",[Ty]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${Fy}`)||void 0,this._triangleElement=t.querySelector(`.${Ty}`)||void 0}bindToCell(t,e,i,r,o){var s,a,l,h,u,d,c,g,f,p,v,m,C,b,_;const y=this._rootElement,w=this._messageElement,S=this._triangleElement;if(y==null||y.classList.remove(rd),y==null||y.classList.add(Ga),this._canBindToCell(t,e,i)){if(w.setAttribute("style",""),S.setAttribute("style",""),r!=null&&r.className&&y.classList.add(r.className),!((s=r==null?void 0:r.style)===null||s===void 0)&&s.bgColor&&(w.style.backgroundColor=(a=r==null?void 0:r.style)===null||a===void 0?void 0:a.bgColor),!((l=r==null?void 0:r.style)===null||l===void 0)&&l.bgColor&&(S.style.backgroundColor=(h=r==null?void 0:r.style)===null||h===void 0?void 0:h.bgColor),S.style.display=((u=r==null?void 0:r.style)===null||u===void 0?void 0:u.arrowMark)===!0?"block":"none",!((d=r==null?void 0:r.style)===null||d===void 0)&&d.fontSize&&(w.style.fontSize=((g=(c=r==null?void 0:r.style)===null||c===void 0?void 0:c.fontSize)!==null&&g!==void 0?g:12)+"px"),!((f=r==null?void 0:r.style)===null||f===void 0)&&f.fontFamily&&(w.style.fontFamily=(p=r==null?void 0:r.style)===null||p===void 0?void 0:p.fontFamily),!((v=r==null?void 0:r.style)===null||v===void 0)&&v.color&&(w.style.color=(m=r==null?void 0:r.style)===null||m===void 0?void 0:m.color),!((C=r==null?void 0:r.style)===null||C===void 0)&&C.padding&&(w.style.padding=`${(b=r==null?void 0:r.style)===null||b===void 0?void 0:b.padding.join("px ")}px`),w&&(w.textContent=r==null?void 0:r.content),this._bindToCell(t,e,i,r==null?void 0:r.position,r==null?void 0:r.referencePosition,o,(_=r==null?void 0:r.style)===null||_===void 0?void 0:_.arrowMark))return y==null||y.classList.add(rd),y==null||y.classList.remove(Ga),!0}else this.unbindFromCell();return!1}release(){var t,e;this.unbindFromCell();const i=this._rootElement;i!=null&&i.parentElement&&i.parentElement.removeChild(i),(e=(t=this._handler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),delete this._rootElement,delete this._messageElement}move(t,e,i,r,o){const s=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,r==null?void 0:r.position,r==null?void 0:r.referencePosition,o),s==null||s.classList.add(rd),s==null||s.classList.remove(Ga)):this.unbindFromCell()}unbindFromCell(){const t=this._rootElement;t!=null&&t.parentElement&&(t.classList.remove(rd),t.classList.add(Ga))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{bottom:s,left:a,right:l,top:h}=r;if(t.isFrozenCell(e,i))return!0;if(s<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||h>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:d}=o;return!(h>u)&&!(a>d)}_bindToCell(t,e,i,r,o,s,a){const l=this._rootElement,h=t.getCellRangeRelativeRect({col:e,row:i}),u=t.getElement(),d=t.internalProps.element.offsetWidth,{width:c}=h;if(l){let g,f;l.parentElement!==u&&u.appendChild(l),l.style.left="0px";const p=Math.min(.8*d,4*c);l.style.maxWidth=`${p}px`;const v=l.clientWidth,m=l.clientHeight;if(!r&&!o)return!1;{const x=this.getComputedPosition(t,e,i,r,o,s,a);f=x.x,g=x.y}l.style.left=`${f}px`,l.style.top=`${g}px`,Gg()&&(l.style.fontSize="11px");const{x1:C,x2:b,y1:_,y2:y}=t.stateManager.menu.bounds,w=f,S=w+v,D=g,A=w+m;return!(t.stateManager.menu.isShow&&C<S&&b>w&&y>D&&_<A)}return!1}getComputedPosition(t,e,i,r,o,s,a){var l;const h=this._rootElement,u=t.getCellRangeRelativeRect({col:e,row:i}),{width:d,height:c}=t.internalProps.element.getBoundingClientRect(),{width:g}=u;let f,p;const v=Math.min(.8*d,4*g);h.style.maxWidth=`${v}px`;const m=h.clientWidth,C=h.clientHeight,b=a?6:0;if(r)p=r.x,f=r.y+b,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(o){let _=(l=o.placement)!==null&&l!==void 0?l:zi.bottom;const y=o.rect.left+o.rect.width/2,w=o.rect.top+o.rect.height/2,S=o.rect.top,D=o.rect.bottom,A=o.rect.left,x=o.rect.right;let B=0;const F=()=>{B++,B>=4||(this.removeStyleFromTriangle(),_===zi.top?(p=y-m/2,f=S-C-b,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",s&&f<0&&(_=zi.right,F())):_===zi.bottom?(p=y-m/2,f=D+b,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",s&&f+C>c&&(_=zi.left,F())):_===zi.left?(f=w-C/2,p=A-m-b,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",s&&p<0&&(_=zi.top,F())):_===zi.right&&(f=w-C/2,p=x+b,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",s&&p+m>d&&(_=zi.bottom,F())))};F()}return s&&(p<0?p=0:p+h.offsetWidth>d&&(p=d-h.offsetWidth)),{x:p,y:f}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,r,o,s){const a=this.getComputedPosition(t,e,i,r,o,s),l=a.x,h=a.y;this._rootElement.style.left=`${l}px`,this._rootElement.style.top=`${h}px`}}class pI extends cI{createTooltipElementInternal(){return new fI}}const vI={"bubble-tooltip":function(n){return new pI(n)}};class My{constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){var t,e;const i=this._tooltipInstances;for(const r in i)(e=(t=i[r])===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t);delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){var r;const o=this._attachInfo,s=this._getTooltipInstanceInfo(t,e);if(!o||s&&o.instance===s||((r=o.instance)===null||r===void 0||r.unbindTooltipElement(),this._attachInfo=null),!!s&&s&&s.bindTooltipElement(t,e,i,this.confine)){const a=this._table.getCellRange(t,e);this._attachInfo={range:a,instance:s,tooltipOptions:i}}}_move(t,e,i){const r=this._attachInfo;if(!r||!Bn(r.range,t,e))return;const{instance:o}=r;o==null||o.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,r){const o=this._attachInfo;if(!o||!Bn(o.range,t,e))return;const{instance:s}=o;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=r,s==null||s.locateTooltipElement(t,e,i,r,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e==null||e.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&Bn(i.range,t,e)}_bindTableEvent(t){t.on(Q.MOUSEENTER_CELL,e=>{var i;if(Gg())return;const{x1:r,x2:o,y1:s,y2:a}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&typeof e.x=="number"&&typeof e.y=="number"&&e.x>r&&e.x<o&&e.y>s&&e.y<a)return;const{col:l,row:h}=e;let u;const d=t.getHeaderDescription(l,h);if(d){const c=t.getCellRangeRelativeRect({col:l,row:h});u={content:d,referencePosition:{placement:zi.bottom,rect:c},style:{arrowMark:!1}}}else if(!((i=t.internalProps.tooltip)===null||i===void 0)&&i.isShowOverflowTextTooltip){const c=t.getCellOverflowText(l,h),g=t.getCellRangeRelativeRect({col:l,row:h});c&&(u={content:d?`${d}
    ${c}`:c,referencePosition:{placement:zi.bottom,rect:g},style:t.theme.tooltipStyle})}u&&this._bindToCell(e.col,e.row,u)}),t.on(Q.MOUSEMOVE_CELL,e=>{var i,r;if(!Gg()){if(!((r=(i=this._attachInfo)===null||i===void 0?void 0:i.tooltipOptions)===null||r===void 0)&&r.referencePosition){const o=this._attachInfo.tooltipOptions.referencePosition,{event:s}=e,{left:a,right:l,top:h,bottom:u}=o.rect,d=t._getMouseAbstractPoint(s,!1);d.inTable&&d.x>=a-5&&d.x<=l+5&&d.y>=h-5&&d.y<=u+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}}),t.on(Q.MOUSELEAVE_CELL,e=>{this._unbindFromCell()}),t.on(Q.SELECTED_CELL,e=>{this._isBindCell(e.col,e.row)&&this._unbindFromCell()}),t.on(Q.MOUSELEAVE_TABLE,e=>{this._unbindFromCell()}),t.on(Q.SCROLL,e=>{this._unbindFromCell()})}_getTooltipInstanceInfo(t,e){const i=this._table,r=this._tooltipInstances;return r&&r["bubble-tooltip"]||r&&(r["bubble-tooltip"]=vI["bubble-tooltip"](i))}isBinded(t){var e;return JSON.stringify(t)===JSON.stringify((e=this._attachInfo)===null||e===void 0?void 0:e.tooltipOptions)}}class Ry{constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}}const h0="vtable__menu-element",ls=`${h0}--hidden`,u0=`${h0}--shown`;function mI(){return Un("div",[h0,ls])}class CI{constructor(t){var e,i,r;this._handler=new ou,this._rootElement=mI(),this._rootElement.addEventListener("wheel",o=>{o.stopPropagation()}),(e=this._rootElement)===null||e===void 0||e.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault()}),(i=this._rootElement)===null||i===void 0||i.addEventListener("click",o=>{if(o.stopPropagation(),o.preventDefault(),this._rootElement.classList.contains(ls))return;const{col:s,row:a,dropDownIndex:l,menuKey:h,text:u,hasChildren:d}=o.target;if(typeof l!="number"||d)return void o.stopPropagation();const c=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(s,a):t.getHeaderField(s,a),g=t._dropDownMenuIsHighlight(s,a,l);t.fireListeners(Q.DROPDOWN_MENU_CLICK,{col:s,row:a,field:c,menuKey:h,text:u,highlight:g,cellLocation:t.getCellLocation(s,a),event:o}),t.fireListeners(Q.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Q.HIDE_MENU,null),o.stopPropagation()}),(r=this._rootElement)===null||r===void 0||r.addEventListener("mousemove",o=>{this._rootElement.classList.contains(ls)||o.stopPropagation()})}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t!=null&&t.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const o=this._rootElement;if(this._menuInstanceInfo=r,o==null||o.classList.remove(u0),o==null||o.classList.add(ls),this._canBindToCell(t,e,i)){if(o.innerHTML="",o.appendChild(r.content),this._bindCell(t,e,i,r.position,r.referencePosition))return o==null||o.classList.add(u0),o==null||o.classList.remove(ls),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,t!=null&&t.parentElement&&(t.classList.remove(u0),t.classList.add(ls))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{top:s,bottom:a,left:l,right:h}=r;if(t.isFrozenCell(e,i))return!0;if(a<t.getFrozenRowsHeight()||h<t.getFrozenColsWidth()||l>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||s>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:d}=o;return!(u<s)&&!(d<l)}_bindCell(t,e,i,r,o){const s=this._rootElement,a=t.getElement(),{width:l,height:h}=t.internalProps.element.getBoundingClientRect();if(s){s.parentElement!==a&&a.appendChild(s),s.style.left="0px";const u=.8*l;s.style.maxWidth=`${u}px`;const d=s.clientWidth,c=s.clientHeight;let g,f;return r&&(g=r.x,f=r.y),o&&(g=o.rect.right-d,f=o.rect.bottom),f+c>h&&(f=h-c,g+=d-2),f<0&&(f/=2),s.style.top=`${f}px`,g<0?g=0:g+d>l&&(g=l-d),s.style.left=`${g}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:s,height:a}=i.getBoundingClientRect();return t>r-5&&t<r+s+5&&e>o-5&&e<o+a+5}}class Ey extends Ry{createMenuElementInternal(){return new uI(this._table)}}class bI extends Ry{createMenuElementInternal(){return new CI(this._table)}}const _I={"dropdown-menu":function(n){return new Ey(n)},"context-menu":function(n){return new Ey(n)},container:n=>new bI(n)};function yI(n,t,e,i,r){var o;const{lineHeight:s,textBaseline:a,textStick:l}=n._getCellStyle(t,e);let h=n.getCellRangeRelativeRect(n.getCellRange(t,e));l&&(h=n.getVisibleCellRangeRelativeRect({col:t,row:e}));let{left:u,right:d,bottom:c,top:g,width:f,height:p}=h;if(n.isHeader(t,e)&&({left:u,right:d,bottom:c,top:g,width:f,height:p}=n.internalProps.headerHelper.getDropDownIconRect(h,s,a||"middle")),r==null?void 0:r.content)return{type:i,position:r.position,referencePosition:(o=r.referencePosition)!==null&&o!==void 0?o:{rect:{left:u,right:d,top:g,bottom:c,width:f,height:p}},content:r.content};if(i==="dropdown-menu"){const{dropDownMenu:v=n.globalDropDownMenu,pivotInfo:m}=n._getHeaderLayoutMap(t,e);return{type:i,referencePosition:{rect:{left:u,right:d,top:g,bottom:c,width:f,height:p}},content:v,pivotInfo:m}}return null}class Py{constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,r){var o;const s=this._attachInfo,a=this._getMenuInstanceInfo(t,e,i,r);if(!s||a&&s.instance===a.instance||((o=s.instance)===null||o===void 0||o.unbindMenuElement(),this._attachInfo=null),!a)return;const{instance:l,info:h}=a;if(l&&l.bindMenuElement(t,e,h)){const u=this._table.getCellRange(t,e);this._attachInfo={range:u,instance:l}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e==null||e.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&Bn(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:r}=i;return r.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(Q.DROPDOWN_ICON_CLICK,e=>{this._attachInfo&&this._isBindToCell(e.col,e.row)?this._unbindFromCell():this._bindToCell(e.col,e.row,"dropdown-menu")}),t.on(Q.DROPDOWN_MENU_CLEAR,e=>{this._unbindFromCell()}),t.on(Q.CONTEXTMENU_CELL,e=>{var i,r,o,s;if(((i=t.internalProps.menu)===null||i===void 0?void 0:i.renderMode)==="html"){const a=t._getMouseAbstractPoint(e.event,!1);let l=null;a.inTable&&typeof((r=t.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems)=="function"?l=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col):a.inTable&&Array.isArray((o=t.internalProps.menu)===null||o===void 0?void 0:o.contextMenuItems)&&(l=(s=t.internalProps.menu)===null||s===void 0?void 0:s.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:l,position:{x:a.x,y:a.y}})}})}_getMenuInstanceInfo(t,e,i,r){const o=this._table,s=this._menuInstances,a=yI(o,t,e,i,r);return a?{instance:s&&s[i]||s&&(s[i]=_I[i](o)),type:i,info:a}:null}}class wI extends EventTarget{constructor(t,e){if(super(),this._table=t,Pt.mode==="node")return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const r=this._input=document.createElement("input");i.appendChild(r),r.classList.add("table-focus-control"),r.dataset.vtable="vtable",r.readOnly=!0,e.appendChild(i)}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const r=t.top-this._table.scrollTop,o=t.left-this._table.scrollLeft;i.style.top=`${r.toFixed()}px`,i.style.left=`${o.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){}}let hs=1;function DI(){lb?hs=1:(hs=Math.ceil(window.devicePixelRatio||1),hs>1&&hs%2!=0&&(hs+=1))}DI();const od=10,Hy=8,Ly=8,SI=8,d0=16,c0=8,Ua=12,ky=12;var vt;(function(n){n.selected="selected",n.unSelected="unSelected",n.selectedHover="selectedHover",n.unSelectedHover="unSelectedHover",n.focus="focus"})(vt||(vt={}));var fn;(function(n){n.legendItemHover="legendItemHover",n.legendItemUnHover="legendItemUnHover",n.legendItemClick="legendItemClick",n.legendItemAttributeUpdate="legendItemAttributeUpdate"})(fn||(fn={}));var ai;(function(n){n.innerView="innerView",n.title="legendTitle",n.item="legendItem",n.itemShape="legendItemShape",n.itemLabel="legendItemLabel",n.itemValue="legendItemValue",n.focus="legendItemFocus"})(ai||(ai={}));class g0 extends Nn{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute,r=Wn(i),o=ct.group({x:r[3],y:r[0],pickable:t,childrenPickable:t});o.name=ai.innerView,this.add(o),this._innerView=o,e!=null&&e.visible&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const s=this._innerView.AABBBounds;this.attribute.width=s.width()+r[1]+r[3],this.attribute.height=s.height()+r[0]+r[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:r=0,background:o,minWidth:s,maxWidth:a,shape:l}=t,h={x:0,y:0,text:e,textStyle:i,padding:Wn(r),minWidth:s,maxWidth:a};l&&l.visible&&(h.shape=Object.assign({visible:!0},l.style),N(l.space)&&(h.space=l.space)),o&&o.visible&&(h.panel=Object.assign({visible:!0},o.style));const u=new pa(h);u.name=ai.title,this._title=u,this._innerView.add(u)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=(t=this.attribute.title)===null||t===void 0?void 0:t.align;r==="center"?this._title.setAttribute("x",(e-i)/2):r==="end"&&this._title.setAttribute("x",e-i)}}}function Iy(){Dn(),zo(),oa()}const Oy={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};Iy();class sd extends Nn{getCurrent(){return this._current}constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},sd.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=i=>{const r=i.target;r.hasState("disable")||r.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{const r=i.target;if(r.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(r.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e;this._reset();const{layout:i="horizontal",handler:r=Oy,total:o,defaultCurrent:s=1,textStyle:a,padding:l=0}=this.attribute;this._current=s;const h=Wn(l),u=i==="horizontal",d=ct.group({x:0,y:0}),c=r.style||{},g=c.size||15,f=(t=r.space)!==null&&t!==void 0?t:8,p=r.state||{};let{preShape:v,nextShape:m}=r;v||(v=u?"triangleLeft":"triangleUp"),m||(m=u?"triangleRight":"triangleDown");const C=ct.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},c),{x:0,y:0,symbolType:v,size:g}));C.states=p,C.name="preHandler",this.preHandler=C,d.add(C);const{width:b,height:_}=Zg(this._getPageText(o),Object.assign({textAlign:"center",textBaseline:"middle"},a),(e=this.stage)===null||e===void 0?void 0:e.getTheme().text.fontFamily),y=lt(g)?g:g[0],w=lt(g)?g:g[1],S=ct.text(Object.assign({x:u?y/2+f+b/2:0,y:u?0:w/2+f+_/2,text:this._getPageText(s),textAlign:"center",textBaseline:"middle",lineHeight:a==null?void 0:a.fontSize},a));this.text=S,d.add(S);const D=ct.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},c),{x:u?y+2*f+b:0,y:u?0:w+2*f+_,symbolType:m,size:g}));D.name="nextHandler",D.states=p,this.nextHandler=D,d.add(D),this._total===1?(C.addState("disable"),D.addState("disable")):this._current===1?C.addState("disable"):this._current===o&&D.addState("disable");const A=d.AABBBounds,x=A.width(),B=A.height();d.translateTo(0-A.x1+h[3],0-A.y1+h[0]),this.add(d),this.attribute.width=x+h[1]+h[3],this.attribute.height=B+h[0]+h[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?ge(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,this._current!==1&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}sd.defaultAttributes={handler:Oy,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};function f0(){Dn(),oa(),Yr(),zo()}function p0(){Dn(),Lb()}function AI(){p0(),Iy(),_1()}function xI(){p0(),f0()}function BI(){p0(),f0(),Om()}var FI=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const TI={[vt.focus]:{},[vt.selected]:{},[vt.selectedHover]:{},[vt.unSelected]:{},[vt.unSelectedHover]:{}};AI();class ad extends g0{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},ad.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._onHover=i=>{const r=i.target;if(r&&r.name&&r.name.startsWith(ai.item)){const o=r.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===o.id)return;this._unHover(this._lastActiveItem,i)}this._hover(o,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var r,o,s,a;const l=i.target;if(l&&l.name&&l.name.startsWith(ai.item)){const h=l.delegate;if(l.name===ai.focus){const u=h.hasState(vt.focus);h.toggleState(vt.focus),u?(r=this._itemsContainer)===null||r===void 0||r.getChildren().forEach(d=>{this._removeLegendItemState(d,[vt.unSelected,vt.unSelectedHover,vt.focus],i),this._setLegendItemState(d,vt.selected,i)}):(this._setLegendItemState(h,vt.selected,i),this._removeLegendItemState(h,[vt.unSelected,vt.unSelectedHover],i),(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(d=>{h!==d&&(this._removeLegendItemState(d,[vt.selected,vt.selectedHover,vt.focus],i),this._setLegendItemState(d,vt.unSelected,i))}))}else{(s=this._itemsContainer)===null||s===void 0||s.getChildren().forEach(f=>{f.removeState(vt.focus)});const{selectMode:u="multiple",allowAllCanceled:d=!0}=this.attribute,c=h.hasState(vt.selected),g=this._getSelectedLegends();if(u==="multiple"){if(d===!1&&c&&g.length===1)return void this._dispatchLegendEvent(fn.legendItemClick,h,i);c?(this._removeLegendItemState(h,[vt.selected,vt.selectedHover],i),this._setLegendItemState(h,vt.unSelected,i)):(this._setLegendItemState(h,vt.selected,i),this._removeLegendItemState(h,[vt.unSelected,vt.unSelectedHover],i))}else this._setLegendItemState(h,vt.selected,i),this._removeLegendItemState(h,[vt.unSelected,vt.unSelectedHover],i),(a=this._itemsContainer)===null||a===void 0||a.getChildren().forEach(f=>{h!==f&&(this._removeLegendItemState(f,[vt.selected,vt.selectedHover],i),this._setLegendItemState(f,vt.unSelected,i))})}this._dispatchLegendEvent(fn.legendItemClick,h,i)}}}setSelected(t){var e;((e=this._itemsContainer)===null||e===void 0?void 0:e.getChildren()).forEach(i=>{const r=i.data;t.includes(r.label)?(this._setLegendItemState(i,vt.selected),this._removeLegendItemState(i,[vt.unSelected,vt.unSelectedHover])):(this._removeLegendItemState(i,[vt.selected,vt.selectedHover]),this._setLegendItemState(i,vt.unSelected))})}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:r,maxHeight:o,defaultSelected:s=[],lazyload:a}=this.attribute,{spaceCol:l=d0,spaceRow:h=c0}=t,u=this._itemsContainer,{items:d,isHorizontal:c,startIndex:g}=this._itemContext,f=c?i:e;let p,{doWrap:v,maxWidthInCol:m,startX:C,startY:b,pages:_}=this._itemContext;for(let y=g,w=d.length;y<w;y++){if(a&&_>this._itemContext.currentPage*f){this._itemContext.startIndex=y;break}p=d[y],p.id||(p.id=p.label),p.index=y;const S=this._renderEachItem(p,!!Bt(s)||(s==null?void 0:s.includes(p.label)),y,d),D=S.attribute.width,A=S.attribute.height;this._itemHeight=Math.max(this._itemHeight,A),m=Math.max(D,m),this._itemMaxWidth=Math.max(D,this._itemMaxWidth),c?(N(r)&&(D>=r?(v=!0,y>0&&(C=0,b+=A+h,_+=1)):r<C+D&&(v=!0,C=0,b+=A+h,_+=1)),y>0&&S.setAttributes({x:C,y:b}),C+=l+D):(N(o)&&o<b+A&&(v=!0,b=0,C+=m+l,m=0,_+=1),y>0&&S.setAttributes({x:C,y:b}),b+=h+A),u.add(S)}return this._itemContext.doWrap=v,this._itemContext.startX=C,this._itemContext.startY=b,this._itemContext.maxWidthInCol=m,this._itemContext.pages=_,this._itemContext.maxPages=f,a||(this._itemContext.startIndex=d.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:r}=this.attribute;if(t.visible===!1||Bt(e))return;let o=e;i&&(o=e==null?void 0:e.reverse());const s=ct.group({x:0,y:0});this._itemsContainer=s;const{layout:a,autoPage:l}=this.attribute,h=a==="horizontal",{maxWidth:u,width:d,height:c}=t,g=[];N(u)&&g.push(u),N(d)&&g.push(d),g.length&&(N(r)&&g.push(r),this._itemWidthByUser=yv(g)),N(c)&&(this._itemHeightByUser=c),this._itemContext={currentPage:this.attribute.pager&&this.attribute.pager.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:o,isHorizontal:h,totalPage:1/0},this._itemContext=this._renderItems();let f=!1;this._itemContext.doWrap&&l&&this._itemContext.pages>this._itemContext.maxPages&&(f=this._renderPagerComponent(h)),f||(s.setAttribute("y",this._title?this._title.AABBBounds.height()+qe(this.attribute,"title.space",8):0),this._innerView.add(s))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;t&&(this._itemsContainer.addEventListener("pointermove",this._onHover),this._itemsContainer.addEventListener("pointerleave",this._onUnHover)),e&&this._itemsContainer.addEventListener("pointerdown",this._onClick)}_autoEllipsis(t,e,i,r){var o,s;const{label:a,value:l}=this.attribute.item,h=r.AABBBounds,u=i.AABBBounds,d=h.width(),c=u.width();let g=!1;t==="labelFirst"?c>e?g=!0:r.setAttribute("maxLineWidth",e-c):t==="valueFirst"?d>e?g=!0:i.setAttribute("maxLineWidth",e-d):d+c>e&&(g=!0),g&&(r.setAttribute("maxLineWidth",Math.max(e*((o=a.widthRatio)!==null&&o!==void 0?o:.5),e-c)),i.setAttribute("maxLineWidth",Math.max(e*((s=l.widthRatio)!==null&&s!==void 0?s:.5),e-d)))}_renderEachItem(t,e,i,r){var o,s;const{id:a,label:l,value:h,shape:u}=t,{padding:d=0,focus:c,focusIconStyle:g,align:f,autoEllipsisStrategy:p}=this.attribute.item,{shape:v,label:m,value:C,background:b}=this.attribute.item,_=this._handleStyle(v,t,e,i,r),y=this._handleStyle(m,t,e,i,r),w=this._handleStyle(C,t,e,i,r),S=this._handleStyle(b,t,e,i,r),D=Wn(d);let A;b.visible===!1?(A=ct.group({x:0,y:0,cursor:(o=S.style)===null||o===void 0?void 0:o.cursor}),this._appendDataToShape(A,ai.item,t,A)):(A=ct.group(Object.assign({x:0,y:0},S.style)),this._appendDataToShape(A,ai.item,t,A,S.state)),A.id=`${a!=null?a:l}-${i}`,A.addState(e?vt.selected:vt.unSelected);const x=ct.group({x:0,y:0,pickable:!1});A.add(x);let B,F=0,T=0,R=0;if(v&&v.visible!==!1){const W=qe(_,"style.size",od);T=rt(W)?W[0]||0:W,R=qe(v,"space",Hy);const V=ct.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},u),_.style));Object.keys(_.state||{}).forEach(L=>{const G=_.state[L].fill||_.state[L].stroke;u.fill&&ut(_.state[L].fill)&&G&&(_.state[L].fill=G),u.stroke&&ut(_.state[L].stroke)&&G&&(_.state[L].stroke=G)}),this._appendDataToShape(V,ai.itemShape,t,A,_.state),V.addState(e?vt.selected:vt.unSelected),x.add(V)}let M,E=0;if(c){const W=qe(g,"size",od);B=ct.symbol(Object.assign(Object.assign({x:0,y:-W/2-1,strokeBoundsBuffer:0},g),{visible:!0,pickMode:"imprecise",boundsPadding:D})),this._appendDataToShape(B,ai.focus,t,A),E=W}const P=m.formatMethod?m.formatMethod(l,t,i):l,I=Object.assign(Object.assign({x:T/2+R,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(s=y.style)===null||s===void 0?void 0:s.fontSize},y.style),{text:P});M=au(I)?ct.richtext(lu(I)):ct.text(I),this._appendDataToShape(M,ai.itemLabel,t,A,y.state),M.addState(e?vt.selected:vt.unSelected),x.add(M);const k=qe(m,"space",Ly);if(N(h)){const W=qe(C,"space",c?SI:0),V=C.formatMethod?C.formatMethod(h,t,i):h,L=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:w.style.fontSize},w.style),{text:V});let G;if(G=au(L)?ct.richtext(lu(L)):ct.text(L),this._appendDataToShape(G,ai.itemValue,t,A,w.state),G.addState(e?vt.selected:vt.unSelected),this._itemWidthByUser){const K=this._itemWidthByUser-D[1]-D[3]-T-R-k-E-W;this._autoEllipsis(p,K,M,G),C.alignRight?G.setAttributes({textAlign:"right",x:this._itemWidthByUser-T/2-D[1]-D[3]-E-W}):G.setAttribute("x",W+(M.AABBBounds.empty()?0:M.AABBBounds.x2))}else G.setAttribute("x",W+(M.AABBBounds.empty()?0:M.AABBBounds.x2));F=W+(G.AABBBounds.empty()?0:G.AABBBounds.x2),x.add(G)}else this._itemWidthByUser&&M.setAttribute("maxLineWidth",this._itemWidthByUser-D[1]-D[3]-T-R-E),F=k+(M.AABBBounds.empty()?0:M.AABBBounds.x2);B&&(B.setAttribute("x",F),x.add(B));const H=x.AABBBounds,O=H.width();if(f==="right"){const W=H.x2,V=H.x1;x.forEachChildren((L,G)=>{L.type!=="symbol"&&L.attribute.textAlign!=="right"||L===B?L.setAttribute("x",V+W-L.attribute.x-L.AABBBounds.width()):L.type!=="symbol"?L.setAttributes({x:V+W-L.attribute.x,textAlign:"left"}):L.setAttribute("x",V+W-L.attribute.x)})}const z=H.height(),j=N(this.attribute.item.width)?this.attribute.item.width:O+D[1]+D[3],U=this._itemHeightByUser||z+D[0]+D[2];return A.attribute.width=j,A.attribute.height=U,B&&B.setAttribute("visible",!1),x.translateTo(-H.x1+D[3],-H.y1+D[0]),A}_createPager(t,e,i,r){var o,s;const{disableTriggerEvent:a,maxRow:l}=this.attribute;return t?new os(e?Object.assign(Object.assign({direction:"vertical",width:12,range:[0,.5]},i),{height:r,disableTriggerEvent:a}):Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:a,range:[0,.5],height:12},i),{width:r})):new sd(e?Object.assign(Object.assign({layout:l===1?"horizontal":"vertical",total:99},gt({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},i)),{defaultCurrent:(o=this.attribute.pager)===null||o===void 0?void 0:o.defaultCurrent,disableTriggerEvent:a}):Object.assign({layout:"horizontal",total:99,disableTriggerEvent:a,defaultCurrent:(s=this.attribute.pager)===null||s===void 0?void 0:s.defaultCurrent},i))}_updatePositionOfPager(t,e,i,r,o){const{maxHeight:s,pager:a}=this.attribute,{currentPage:l,totalPage:h}=this._itemContext;if(t)this._pagerComponent.setScrollRange([(l-1)/h,l/h]),e?this._pagerComponent.setAttributes({x:i,y:r}):this._pagerComponent.setAttributes({x:0,y:s-this._pagerComponent.AABBBounds.height()});else{const u=a&&a.position||"middle";if(this._pagerComponent.setTotal(h),e){let d;d=u==="start"?r:u==="end"?r+o-this._pagerComponent.AABBBounds.height()/2:r+o/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:i,y:d})}else{let d;d=u==="start"?0:u==="end"?o-this._pagerComponent.AABBBounds.width():(o-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:d,y:s-this._pagerComponent.AABBBounds.height()})}}}_bindEventsOfPager(t,e,i,r){const o=this.attribute.pager||{},{animation:s=!0,animationDuration:a=450,animationEasing:l="quadIn"}=o,h=t?d=>{const{value:c}=d.detail;let g=c[0]*this._itemContext.totalPage;return o.scrollByPosition?g+=1:g=Math.floor(g)+1,g}:d=>d.detail.current,u=d=>{const c=h(d);if(c!==this._itemContext.currentPage){if(this._itemContext.currentPage=c,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const g=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);this._itemContext.totalPage=g,this._pagerComponent.setScrollRange([(c-1)/g,c/g])}s?this._itemsContainer.animate().to(e?{y:-(c-1)*(i+r)}:{x:-(c-1)*(i+r)},a,l):e?this._itemsContainer.setAttribute("y",-(c-1)*(i+r)):this._itemsContainer.setAttribute("x",-(c-1)*(i+r))}};t?(this._pagerComponent.addEventListener("scrollDrag",u),this._pagerComponent.addEventListener("scrollUp",u)):(this._pagerComponent.addEventListener("toPrev",u),this._pagerComponent.addEventListener("toNext",u))}_renderPagerComponent(t){const e=this._title?this._title.AABBBounds.height()+qe(this.attribute,"title.space",8):0,{maxWidth:i,maxHeight:r,maxCol:o=1,maxRow:s=2,item:a={},pager:l={}}=this.attribute,{spaceCol:h=d0,spaceRow:u=c0}=a,d=this._itemsContainer,{space:c=ky,defaultCurrent:g=1}=l,f=FI(l,["space","defaultCurrent"]),p=l.type==="scrollbar";let v,m=0,C=0,b=0,_=0,y=1;if(t){if(m=(s-1)*u+this._itemHeight*s,v=this._createPager(p,t,f,m),this._pagerComponent=v,this._innerView.add(v),C=i-v.AABBBounds.width()-c,C<=0)return this._innerView.removeChild(v),!1;d.getChildren().forEach((D,A)=>{const{width:x,height:B}=D.attribute;C<b+x&&(b=0,_+=B+u,y+=1),A>0&&D.setAttributes({x:b,y:_}),b+=h+x}),this._itemContext.startX=b,this._itemContext.startY=_,this._itemContext.pages=y;const S=Math.ceil(y/s);this._itemContext.totalPage=S,this._updatePositionOfPager(p,t,C,e,m)}else{if(m=this._itemMaxWidth*o+(o-1)*h,v=this._createPager(p,t,f,m),this._pagerComponent=v,this._innerView.add(v),C=r-v.AABBBounds.height()-c-e,C<=0)return this._innerView.removeChild(v),!1;d.getChildren().forEach((D,A)=>{const{height:x}=D.attribute;C<_+x&&(_=0,b+=this._itemMaxWidth+h,y+=1),A>0&&D.setAttributes({x:b,y:_}),_+=u+x});const S=Math.ceil(y/o);this._itemContext.totalPage=S,this._updatePositionOfPager(p,t,C,e,m)}g>1&&(t?d.setAttribute("y",-(g-1)*(m+u)):d.setAttribute("x",-(g-1)*(m+h)));const w=ct.group({x:0,y:e,width:t?C:m,height:t?m:C,clip:!0,pickable:!1});return w.add(d),this._innerView.add(w),this._bindEventsOfPager(p,t,m,t?u:h),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(vt.selected)?this._setLegendItemState(t,vt.selectedHover,e):this._setLegendItemState(t,vt.unSelectedHover,e);const i=t.getChildren()[0].find(r=>r.name===ai.focus,!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(fn.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(vt.unSelectedHover)||t.hasState(vt.selectedHover))&&(i=!0),t.removeState(vt.unSelectedHover),t.removeState(vt.selectedHover),t.getChildren()[0].getChildren().forEach(o=>{i||!o.hasState(vt.unSelectedHover)&&!o.hasState(vt.selectedHover)||(i=!0),o.removeState(vt.unSelectedHover),o.removeState(vt.selectedHover)});const r=t.getChildren()[0].find(o=>o.name===ai.focus,!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(fn.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(fn.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let r=!1;t.hasState(e)||(r=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach(o=>{o.name!==ai.focus&&(r||o.hasState(e)||(r=!0),o.addState(e,!0))}),r&&this._dispatchLegendEvent(fn.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let r=!1;e.forEach(o=>{!r&&t.hasState(o)&&(r=!0),t.removeState(o)}),t.getChildren()[0].getChildren().forEach(o=>{o.name!==ai.focus&&e.forEach(s=>{!r&&o.hasState(s)&&(r=!0),o.removeState(s)})}),r&&this._dispatchLegendEvent(fn.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return(t=this._itemsContainer)===null||t===void 0||t.getChildren().forEach(i=>{i.hasState(vt.selected)&&e.push(i.data)}),e}_appendDataToShape(t,e,i,r,o={}){t.name=e,t.data=i,t.delegate=r,t.states=gt({},TI,o)}_dispatchLegendEvent(t,e,i){const r=this._getSelectedLegends();r.sort((s,a)=>s.index-a.index);const o=r.map(s=>s.label);this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(vt.selected),currentSelectedItems:r,currentSelected:o,event:i})}_handleStyle(t,e,i,r,o){const s={};return t.style&&(ge(t.style)?s.style=t.style(e,i,r,o):s.style=t.style),t.state&&(s.state={},Object.keys(t.state).forEach(a=>{t.state[a]&&(ge(t.state[a])?s.state[a]=t.state[a](e,i,r,o):s.state[a]=t.state[a])})),s}}ad.defaultAttributes={layout:"horizontal",title:{align:"start",space:Ua,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:d0,spaceRow:c0,shape:{space:Hy,style:{size:od,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:Ly,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:od,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:ky,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var MI=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const RI={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};function EI(n,t){const e=gt({},RI,n),{title:i={},item:r={},pager:o={},background:s={},type:a,id:l,visible:h,orient:u,position:d,data:c,filter:g,regionId:f,regionIndex:p,seriesIndex:v,seriesId:m,padding:C}=e,b=MI(e,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(b.title=Vb(i)),Bt(r.focusIconStyle)||Pe(r.focusIconStyle),Fn(r.shape),Fn(r.label),Fn(r.value),Fn(r.background),Af(r.maxWidth)&&(r.maxWidth=Number(r.maxWidth.substring(0,r.maxWidth.length-1))*t.width/100),Af(r.width)&&(r.width=Number(r.width.substring(0,r.width.length-1))*t.width/100),Af(r.height)&&(r.height=Number(r.height.substring(0,r.height.length-1))*t.width/100),b.item=r,Bt(o.textStyle)||Pe(o.textStyle),Fn(o.handler),b.pager=o,s.visible&&!Bt(s.style)&&(gt(b,s.style),N(s.padding)&&(b.padding=s.padding)),b}class PI{constructor(t,e){var i,r,o,s;this.table=e,this.option=Ot(t),this.orient=(i=t.orient)!==null&&i!==void 0?i:"left",this.visible=(r=t.visible)===null||r===void 0||r,this.position=(o=t.position)!==null&&o!==void 0?o:"middle",this.selectedData=(s=t.defaultSelected)!==null&&s!==void 0?s:[],this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new ad(gt({},t,{defaultSelected:this.selectedData}));e.name="legend",this.legendComponent=e,this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||o<=0)return;const s=this.table.tableNoFrameWidth,a=this.table.tableNoFrameHeight,l=$t((i=(e=t.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);let h=0,u=0;this.orient==="left"?(h=l[3],u=0,r+=l[1]+l[3]):this.orient==="top"?(h=0,u=l[0],o+=l[0]+l[2]):this.orient==="right"?(h=s-r-l[1],u=0,r+=l[1]+l[3]):this.orient==="bottom"&&(h=0,u=a-o-l[2],o+=l[0]+l[2]);const d=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,f=0;d==="horizontal"?g=c==="middle"?(s-r)/2:c==="end"?s-r-l[1]:l[3]:f=c==="middle"?(a-o)/2:c==="end"?a-o-l[2]:l[0],this.legendComponent.setAttributes({dx:g,dy:f,x:h,y:u}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(t){const e=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical";return Object.assign({layout:e,items:this.getLegendItems(),maxWidth:t.width,maxHeight:t.height},EI(this.option,t))}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(fn.legendItemClick,t=>{const e=qe(t,"detail.currentSelected");this.table.fireListeners(Q.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})}),this.legendComponent.addEventListener(fn.legendItemHover,t=>{const e=qe(t,"detail");this.table.fireListeners(Q.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})}),this.legendComponent.addEventListener(fn.legendItemUnHover,t=>{const e=qe(t,"detail");this.table.fireListeners(Q.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})}),this.legendComponent.addEventListener("legendItemAttributeUpdate",t=>{this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}var _e;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(_e||(_e={}));const zy={};Object.values(_e).forEach(n=>{zy[n]=!0});function u5(n){switch(n){case _e.Linear:case _e.Log:case _e.Pow:case _e.Sqrt:case _e.Symlog:case _e.Time:return!0;default:return!1}}function d5(n){return!!zy[n]}function c5(n){switch(n){case _e.Ordinal:case _e.Point:case _e.Band:return!0;default:return!1}}function g5(n){switch(n){case _e.Quantile:case _e.Quantize:case _e.Threshold:return!0;default:return!1}}function f5(n){switch(n){case _e.Linear:case _e.Log:case _e.Pow:case _e.Sqrt:case _e.Symlog:case _e.Time:case _e.Band:case _e.Point:return!0;default:return!1}}var Xi=n=>n!=null;function HI(n,t,e){Xi(t)||(t=n,n=0),Xi(e)||(e=1);let i=-1;const r=0|Math.max(0,Math.ceil((t-n)/e)),o=new Array(r);for(;++i<r;)o[i]=n+i*e;return o}const us=n=>{let t=null,e=null;return(...i)=>(t&&i.every((r,o)=>r===t[o])||(t=i,e=n(...i)),e)};var Wy=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,Rn=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Wy(n,"Number")};function LI(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}var Bi=n=>n==null;function kI(n,t,e=0,i){for(Bi(i)&&(i=n.length);e<i;){const r=e+i>>>1;LI(n[r],t)>0?i=r:e=r+1}return e}function Ka(n){return n}const b5=n=>t=>t<0?-Math.pow(-t,n):Math.pow(t,n),_5=n=>n<0?-Math.sqrt(-n):Math.sqrt(n),y5=n=>n<0?-n*n:n*n,w5=n=>Math.log(n),D5=n=>Math.exp(n),S5=n=>-Math.log(-n),A5=n=>-Math.exp(-n),II=n=>isFinite(n)?Math.pow(10,n):n<0?0:n,x5=n=>n===10?II:n===Math.E?Math.exp:t=>Math.pow(n,t),B5=n=>n===Math.E?Math.log:n===10?Math.log10:n===2?Math.log2:(n=Math.log(n),t=>Math.log(t)/n),F5=n=>t=>Math.sign(t)*Math.log1p(Math.abs(t/n)),T5=n=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*n;function v0(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function Ny(n,t,e){const i=n[0],r=n[1],o=t[0],s=t[1];let a,l;return r<i?(a=v0(r,i),l=e(s,o)):(a=v0(i,r),l=e(o,s)),h=>l(a(h))}function jy(n,t,e){let i;return i=n===1?n+2*e:n-t+2*e,n?i>0?i:1:0}function M5(n,t,e,i){return e===1&&(e=0),jy(n,e,i)*(t/(1-e))}function R5(n,t,e,i,r){const o=jy(n,e,i);let s=t/Math.max(1,o||1);r&&(s=Math.floor(s));let a=s*(1-e);return r&&(a=Math.round(a)),a}function OI(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function zI(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),o=new Array(i);let s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=v0(n[s],n[s+1]),o[s]=e(t[s],t[s+1]);return function(a){const l=kI(n,a,1,i)-1;return o[l](r[l](a))}}const E5=(n,t)=>{const e=n.slice();let i=0,r=e.length-1,o=e[i],s=e[r];return s<o&&([i,r]=[r,i],[o,s]=[s,o]),e[i]=t.floor(o),e[r]=t.ceil(s),e},m0=(n,t=!1)=>{const e=Math.floor(Math.log10(n)),i=n/Math.pow(10,e);let r;return r=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,r*Math.pow(10,e)},WI=(n,t)=>{let e,i;return t[0]<t[1]?(e=t[0],i=t[1]):(e=t[1],i=t[0]),Math.min(Math.max(n,e),i)},NI=Math.sqrt(50),jI=Math.sqrt(10),VI=Math.sqrt(2),ld=[1,2,5,10],Vy=(n,t,e)=>{let i=1,r=n;const o=Math.floor((t-1)/2),s=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&s<1?i=Gy(s).step:(e||s>1)&&(r=Math.floor(n)-o*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),HI(0,t).map(a=>r+a*i)):n>0?hd(0,-(t-1)/i,i):hd((t-1)/i,0,i)},GI=us((n,t,e,i)=>{let r,o,s,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(o=n,n=t,t=o),a=C0(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),u=Math.round(t/a);for(h*a<n&&++h,u*a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)*a}else if(a<0&&(i!=null&&i.noDecimals)){a=1;const h=Math.ceil(n),u=Math.floor(t);if(!(h<=u))return[];for(s=new Array(o=u-h+1);++l<o;)s[l]=h+l}else{a=-a;let h=Math.round(n*a),u=Math.round(t*a);for(h/a<n&&++h,u/a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)/a}return r&&s.reverse(),s}),hd=(n,t,e)=>{let i,r,o=-1;if(e>0){let s=Math.floor(n/e),a=Math.ceil(t/e);for((s+1)*e<n&&++s,(a-1)*e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)*e}else{e=-e;let s=Math.floor(n*e),a=Math.ceil(t*e);for((s+1)/e<n&&++s,(a-1)/e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)/e}return r},UI=(n,t,e)=>{let i;const r=n[0],o=n[n.length-1],s=t-n.length;if(o<=0){const h=[];for(i=s;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=s;i++)n.push(o+i*e);return n}let a=[];const l=[];for(i=1;i<=s;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(o+Math.ceil(i/2)*e);return a.concat(n).concat(l)},ud=us((n,t,e,i)=>{let r,o,s;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return Vy(n,e,i==null?void 0:i.noDecimals);(r=t<n)&&(s=n,n=t,t=s);const a=C0(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:u,gap:d}=a,c=d===10?2*qi(10,u):1*qi(10,u);for(;h<=5&&(o=hd(n,t,l),o.length>e+1)&&e>2;)l+=c,h+=1;e>2&&o.length<e-1&&(o=UI(o,e,l))}else i!=null&&i.noDecimals&&l<0&&(l=1),o=hd(n,t,l);return r&&o.reverse(),o}),Gy=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/qi(10,t);let i=ld[0];return e>=NI?i=ld[3]:e>=jI?i=ld[2]:e>=VI&&(i=ld[1]),t>=0?{step:i*qi(10,t),gap:i,power:t}:{step:-qi(10,-t)/i,gap:i,power:t}};function C0(n,t,e){const i=(t-n)/Math.max(0,e);return Gy(i)}function Uy(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=KI(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let o=0;o<e;o++)r[o]=n+o*i;return r}function KI(n,t,e){return(t-n)/Math.max(1,e-1)}function Ky(n,t,e){let i,r,o=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const s=Math.floor((t-n)/e+1),a=new Array(s);for(;++o<s;)a[o]=n+o*e;return r&&a.reverse(),a}function b0(n,t=10){let e,i,r=0,o=n.length-1,s=n[r],a=n[o],l=10;for(a<s&&(i=s,s=a,a=i,i=r,r=o,o=i);l-- >0;){if(i=C0(s,a,t).step,i===e)return n[r]=s,n[o]=a,n;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function YI(n,t){const e=Rn(t.forceMin),i=Rn(t.forceMax);let r=null;const o=[];let s=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?o[0]=t.forceMin:Rn(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(o[0]=t.min),i?o[1]=t.forceMax:Rn(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(o[1]=t.max),Rn(o[0])&&Rn(o[1])?(s=n.slice(),s[0]=o[0],s[s.length-1]=o[1]):r=Rn(o[0])||Rn(o[1])?Rn(o[0])?"max":"min":"all",{niceType:r,niceDomain:s,niceMinMax:o,domainValidator:a}}const _0=(n,t,e)=>Math.abs(t-n)<1?+e.toFixed(1):Math.round(+e),P5=us((n,t,e,i,r,o,s)=>{let a=n,l=t;const h=l<a;h&&([a,l]=[l,a]);let u,d,c=r(a),g=r(l),f=[];if(!(i%1)&&g-c<e){if(c=Math.floor(c),g=Math.ceil(g),a>0){for(;c<=g;++c)for(u=1;u<i;++u)if(d=c<0?u/o(-c):u*o(c),!(d<a)){if(d>l)break;f.push(d)}}else for(;c<=g;++c)for(u=i-1;u>=1;--u)if(d=c>0?u/o(-c):u*o(c),!(d<a)){if(d>l)break;f.push(d)}2*f.length<e&&(f=ud(a,l,e))}else f=ud(c,g,Math.min(g-c,e)).map(o);return f=f.filter(p=>p!==0),s!=null&&s.noDecimals&&(f=Array.from(new Set(f.map(p=>Math.floor(p))))),h?f.reverse():f}),H5=us((n,t,e,i,r,o)=>{const s=[],a={},l=r(n),h=r(t);let u=[];if(Number.isInteger(i))u=ud(l,h,e);else{const d=(h-l)/(e-1);for(let c=0;c<e;c++)u.push(l+c*d)}return u.forEach(d=>{const c=o(d),g=Number.isInteger(i)?_0(n,t,c):_0(n,t,m0(c)),f=_0(n,t,WI(g,[n,t]));!a[f]&&!isNaN(f)&&u.length>1&&(a[f]=1,s.push(f))}),s}),L5=us((n,t,e,i,r)=>Uy(i(n),i(t),e).map(o=>m0(r(o)))),k5=us((n,t,e,i,r)=>Ky(i(n),i(t),e).map(o=>m0(r(o))));var Yy=function(n,t,e){return n<t?t:n>e?e:n};class $I{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:Xi(this._rangeFactorStart)&&Xi(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=OI(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(r=>r>=0&&r<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):Xi(this._rangeFactorStart)&&Xi(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return Bi(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!Bi(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return Bi(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!Bi(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),s=o[0],a=o[o.length-1],l=Math.min(s,a),h=Math.max(s,a),u=Yy((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),d=Bi(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*d;const g=e/d;this._fishEyeTransform=f=>{const p=Math.abs(f-u);if(p>=d)return f;if(p<=1e-6)return u;const v=c*(1-Math.exp(-p*g))/p*.75+.25;return u+(f-u)*v}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}}var $y=n=>Array.isArray?Array.isArray(n):Wy(n,"Array");function Xy(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),o=e-i/2;let s=0,a=0,l=0;return 0<=n&&n<60?(s=i,a=r,l=0):60<=n&&n<120?(s=r,a=i,l=0):120<=n&&n<180?(s=0,a=i,l=r):180<=n&&n<240?(s=0,a=r,l=i):240<=n&&n<300?(s=r,a=0,l=i):300<=n&&n<360&&(s=i,a=0,l=r),s=Math.round(255*(s+o)),a=Math.round(255*(a+o)),l=Math.round(255*(l+o)),{r:s,g:a,b:l}}function qy(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),o=r-i;let s=0,a=0,l=0;return s=o===0?0:r===n?(t-e)/o%6:r===t?(e-n)/o+2:(n-t)/o+4,s=Math.round(60*s),s<0&&(s+=360),l=(r+i)/2,a=o===0?0:o/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l}}const Zy=/^#([0-9a-f]{3,8})$/,Jy={transparent:4294967040},y0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function dd(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function w0(n){return Rn(n)?new bi(n>>16,n>>8&255,255&n,1):$y(n)?new bi(n[0],n[1],n[2]):new bi(255,255,255)}function XI(n){return Rn(n)?new bi(n>>>24,n>>>16&255,n>>>8&255,255&n):$y(n)?new bi(n[0],n[1],n[2],n[3]):new bi(255,255,255,1)}function D0(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function S0(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}class Kn{static Brighter(t,e=1){return e===1?t:new Kn(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new Kn(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof Kn?t:new Kn(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(Xi(Jy[t]))return XI(Jy[t]);if(Xi(y0[t]))return w0(y0[t]);const e=`${t}`.trim().toLowerCase(),i=Zy.exec(e);if(i){const r=parseInt(i[1],16),o=i[1].length;return o===3?new bi((r>>8&15)+((r>>8&15)<<4),(r>>4&15)+((r>>4&15)<<4),(15&r)+((15&r)<<4),1):o===6?w0(r):o===8?new bi(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):void 0}if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new bi(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),o=Xy(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new bi(o.r,o.g,o.b,parseFloat(r[3]))}}constructor(t){const e=Kn.parseColorString(t);e?this.color=e:(console.warn(`Warn: \u4F20\u5165${t}\u65E0\u6CD5\u89E3\u6790\u4E3AColor`),this.color=new bi(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=qy(this.color.r,this.color.g,this.color.b),s=Xy(Bi(t)?o.h:Yy(t,0,360),Bi(e)?o.s:e>=0&&e<=1?100*e:e,Bi(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new bi(s.r,s.g,s.b,r),this}setRGB(t,e,i){return!Bi(t)&&(this.color.r=t),!Bi(e)&&(this.color.g=e),!Bi(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=Zy.exec(e),r=parseInt(i[1],16),o=i[1].length;return o===3?new bi((r>>8&15)+((r>>8&15)<<4),(r>>4&15)+((r>>4&15)<<4),(15&r)+((15&r)<<4),1):o===6?w0(r):o===8?new bi(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):this}setColorName(t){const e=y0[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new Kn(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=D0(t.color.r),this.color.g=D0(t.color.g),this.color.b=D0(t.color.b),this}copyLinearToSRGB(t){return this.color.r=S0(t.color.r),this.color.g=S0(t.color.g),this.color.b=S0(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class bi{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),Xi(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${dd(this.r)+dd(this.g)+dd(this.b)+(this.opacity===1?"":dd(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=qy(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}}function qI(n,t){const e=n.r,i=t.r,r=n.g,o=t.g,s=n.b,a=t.b,l=n.opacity,h=t.opacity;return u=>{const d=Math.round(e*(1-u)+i*u),c=Math.round(r*(1-u)+o*u),g=Math.round(s*(1-u)+a*u);return new bi(d,c,g,l*(1-u)+h*u)}}function Ya(n,t){return e=>n*(1-e)+t*e}function ZI(n,t){return function(e){return Math.round(n*(1-e)+t*e)}}function JI(n,t){const e=n.valueOf(),i=t.valueOf(),r=new Date;return o=>(r.setTime(e*(1-o)+i*o),r)}const A0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,x0=new RegExp(A0.source,"g");function QI(n){return function(){return n}}function tO(n){return function(t){return n(t)+""}}function z5(n,t){let e,i,r,o=A0.lastIndex=x0.lastIndex=0,s=-1;const a=[],l=[];for(n+="",t+="";(e=A0.exec(n))&&(i=x0.exec(t));)(r=i.index)>o&&(r=t.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(e=e[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Ya(e,i)})),o=x0.lastIndex;return o<t.length&&(r=t.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?tO(l[0].x):QI(t):(t=l.length,function(h){for(let u,d=0;d<t;++d)a[(u=l[d]).i]=u.x(h);return a.join("")})}const{interpolateRgb:B0}=mn;function eO(n,t){const e=typeof t;let i;if(Bi(t)||e==="boolean")return()=>t;if(e==="number")return Ya(n,t);if(e==="string"){if(i=Kn.parseColorString(t)){const r=B0(Kn.parseColorString(n),i);return o=>r(o).formatRgb()}return Ya(Number(n),Number(t))}return t instanceof bi?B0(n,t):t instanceof Kn?B0(n.color,t.color):t instanceof Date?JI(n,t):Ya(Number(n),Number(t))}function iO(n){return Number(n)}function nO(n,t){let e;return n>t&&(e=n,n=t,t=e),i=>Math.max(n,Math.min(t,i))}class rO extends $I{constructor(t=Ka,e=Ka){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Ka,this._piecewise=Ny,this._interpolate=eO}calculateVisibleDomain(t){var e;return Xi(this._rangeFactorStart)&&Xi(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),Ya)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,iO);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=ZI,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,o=this._range.length;let s=Math.min(r,o);if(r&&r<o&&this._forceAlign){const a=o-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let u=1;u<=a;u++)i[r-2+u]=l-h*(a-u);s=o}return this._autoClamp&&(this._clamp=nO(i[0],i[s-1])),this._piecewise=s>2?zI:Ny,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Ka),this.rescale(i)):this._clamp!==Ka}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e!=null?e:[]).map((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return Bi(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return Bi(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}class F0 extends rO{constructor(){super(...arguments),this.type=_e.Linear}clone(){return new F0().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return GI(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(Xi(this._rangeFactorStart)&&Xi(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,o=this._domain,s=r[0],a=r[r.length-1];let l=ud(o[0],o[o.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==s||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==s?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const u=Math.min(h[0],h[h.length-1]),d=Math.max(h[0],h[h.length-1]);l=l.filter(c=>c>=u&&c<=d)}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Uy(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Ky(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const o=this._domain;let s=[];if(e){const a=YI(o,e);if(s=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=b0(o.slice(),t);this._niceType==="min"?a[a.length-1]=(i=s[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=s[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=b0(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=b0(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}var li;(function(n){n.innerView="innerView",n.railContainer="sliderRailContainer",n.rail="sliderRail",n.startText="sliderStartText",n.endText="sliderEndText",n.startHandler="sliderStartHandler",n.startHandlerText="startHandlerText",n.endHandler="sliderEndHandler",n.endHandlerText="sliderEndHandlerText",n.track="sliderTrack",n.trackContainer="sliderTrackContainer"})(li||(li={}));function T0(n){return rt(n)?n:[n,n]}function cd(n){return n?"ew-resize":"ns-resize"}f0();class $a extends Nn{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},$a.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=i=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(i),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=i=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const{min:r,max:o}=this.attribute,s=Xn(this._isHorizontal?(i.viewX-this._rail.globalAABBBounds.x1)/this._rail.globalAABBBounds.width():(i.viewY-this._rail.globalAABBBounds.y1)/this._rail.globalAABBBounds.height(),0,1);s!==this._tooltipState.pos&&(this._tooltipState.pos=s,this._tooltipState.value=r+(o-r)*s,this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:i}=this.attribute;i&&i.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=i=>{i.stopPropagation(),this._isChanging=!0,this._currentHandler=i.target,this._prePos=this._isHorizontal?i.clientX:i.clientY,Ie.env==="browser"?(Ie.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),Ie.addEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onHandlerPointerUp),this.stage.addEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onHandlerPointerMove=i=>{var r,o;i.stopPropagation(),this._isChanging=!0;const{railWidth:s,railHeight:a,min:l,max:h}=this.attribute;if(h===l)return;let u,d,c,g=0;this._isHorizontal?(u=i.clientX,g=u-this._prePos,d=(o=this._currentHandler)===null||o===void 0?void 0:o.attribute.x,c=s):(u=i.clientY,g=u-this._prePos,d=(r=this._currentHandler)===null||r===void 0?void 0:r.attribute.y,c=a);const f=Xn(d+g,0,c),p=f/c*(h-l)+l;this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,f,p):this._updateHandler(this._currentHandler,f,p),this._updateTrack(),this._prePos=u,this._dispatchChangeEvent()},this._onHandlerPointerUp=i=>{i.preventDefault(),this._isChanging=!1,this._currentHandler=null,Ie.env==="browser"?(Ie.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),Ie.removeEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onHandlerPointerUp),this.stage.removeEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onTrackPointerdown=i=>{i.stopPropagation(),this._isChanging=!0,this._prePos=this._isHorizontal?i.clientX:i.clientY,Ie.env==="browser"?(Ie.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),Ie.addEventListener("pointerup",this._onTrackPointerUp)):(this.stage.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onTrackPointerUp),this.stage.addEventListener("pointerupoutside",this._onTrackPointerUp))},this._onTrackPointerMove=i=>{i.stopPropagation(),this._isChanging=!0;const{railWidth:r,railHeight:o,min:s,max:a}=this.attribute;if(a===s)return;const{startHandler:l,endHandler:h}=this._getHandlers();let u,d,c;this._isHorizontal?(u=i.clientX,d=this._track.attribute.width,c=r):(u=i.clientY,d=this._track.attribute.height,c=o);const g=u-this._prePos;if(l){const f=this._isHorizontal?l.attribute.x:l.attribute.y,p=Xn(f+g,0,c-d),v=p/c*(a-s)+s;this._updateHandler(l,p,v)}if(h){const f=this._isHorizontal?h.attribute.x:h.attribute.y,p=Xn(f+g,d,c),v=p/c*(a-s)+s,m=l==null?void 0:l.attribute;this._updateHandler(h,p,v),this._track.setAttributes(this._isHorizontal?{x:Math.min(m.x,h.attribute.x),width:Math.abs(m.x-h.attribute.x)}:{y:Math.min(m.y,h.attribute.y),height:Math.abs(m.y-h.attribute.y)})}this._prePos=u,this._dispatchChangeEvent()},this._onTrackPointerUp=i=>{i.preventDefault(),this._isChanging=!1,Ie.env==="browser"?(Ie.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),Ie.removeEventListener("pointerup",this._onTrackPointerUp)):(this.stage.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onTrackPointerUp),this.stage.removeEventListener("pointerupoutside",this._onTrackPointerUp))},this._onRailPointerDown=i=>{i.stopPropagation(),this._isChanging=!0;const{railWidth:r,railHeight:o,min:s,max:a}=this.attribute;if(a===s)return;const l=this._startHandler,h=this._endHandler;let u,d,c,g;this._isHorizontal?(u=i.viewX-this._rail.globalAABBBounds.x1,d=l==null?void 0:l.attribute.x,c=h==null?void 0:h.attribute.x,g=r):(u=i.viewY-this._rail.globalAABBBounds.y1,d=l==null?void 0:l.attribute.y,c=h==null?void 0:h.attribute.y,g=o);const f=u/g*(a-s)+s;if(N(c)){const p=Math.abs(u-d)>Math.abs(u-c)?h:l;this._updateHandler(p,u,f)}else this._updateHandler(l,u,f);this._updateTrack(),this._dispatchChangeEvent()}}setValue(t){const{layout:e,railWidth:i,railHeight:r,min:o,max:s}=this.attribute;if(s===o)return;const[a,l]=xc(t),{startHandler:h,endHandler:u}=this._getHandlers(),d=e==="vertical"?r:i,c=(a-o)/(s-o)*d;if(h&&this._updateHandler(h,c,a),u){const g=(l-o)/(s-o)*d;this._updateHandler(u,g,l)}this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:o,startText:s,endText:a,min:l,max:h,showHandler:u=!0,showTooltip:d}=this.attribute;let{value:c}=this.attribute;ut(c)&&(c=[l,h]),this._currentValue={startValue:T0(c)[0],endValue:T0(c)[1]};const g=i==="horizontal";this._isHorizontal=g;const f=ct.group({x:0,y:0});f.name=li.innerView,this.add(f),this._innerView=f;let p,v=0;if(s&&s.visible){p=ct.text(Object.assign({x:g?0:r/2,y:g?o/2:0,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:s.text,lineHeight:(t=s.style)===null||t===void 0?void 0:t.fontSize},s.style)),p.name=li.startText,f.add(p);const _=N(s.space)?s.space:0;v+=(g?p.AABBBounds.width():p.AABBBounds.height())+_}const m=ct.group({x:g?v:0,y:g?0:v});f.add(m);const C=ct.group({x:0,y:0});let b;if(C.name=li.railContainer,this._railContainer=C,m.add(C),this._mainContainer=m,this._renderRail(C),v+=g?r:o,a&&a.visible){const _=N(a.space)?a.space:0;b=ct.text(Object.assign({x:g?v+_:r/2,y:g?o/2:v+_,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:a.text,lineHeight:(e=a.style)===null||e===void 0?void 0:e.fontSize},a.style)),b.name=li.endText,f.add(b)}this._renderTrack(C),u&&(this._renderHandlers(m),this._bindEvents()),d&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:r,slidable:o}=this.attribute;let s="default";o!==!1&&(s="pointer");const a=ct.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:s},r));return a.name=li.rail,t.add(a),this._rail=a,a}_renderHandlers(t){const{range:e,min:i,max:r,handlerSize:o=14,handlerStyle:s,handlerText:a,railHeight:l,railWidth:h,slidable:u}=this.attribute;let{value:d}=this.attribute;ut(d)&&(d=[i,r]);const c=a&&a.visible,g=this._isHorizontal,f=g?h:l,[p,v]=T0(d),m=r===i?e?0:f:(p-i)/(r-i)*f,C=this._renderHandler(Object.assign({x:g?m:h/2,y:g?l/2:m,size:o,strokeBoundsBuffer:0,cursor:u===!1?"default":cd(g)},s));if(C.name=li.startHandler,this._startHandler=C,t.add(C),this._currentValue.startPos=m,c){const b=this._renderHandlerText(p,e?"start":"end");b.name=li.startHandlerText,t.add(b),this._startHandlerText=b}if(e){const b=r===i?f:(v-i)/(r-i)*f,_=this._renderHandler(Object.assign({x:g?b:h/2,y:g?l/2:b,size:o,strokeBoundsBuffer:0,cursor:u===!1?"default":cd(g)},s));if(_.name=li.endHandler,this._endHandler=_,t.add(_),this._currentValue.endPos=b,c){const y=this._renderHandlerText(v,"end");y.name=li.endHandlerText,t.add(y),this._endHandlerText=y}}}_renderTrack(t){const{range:e,min:i,max:r,railHeight:o,railWidth:s,trackStyle:a,railStyle:l,slidable:h,value:u}=this.attribute;let d,c;if(ut(u))e?(d=i,c=r):d=c=i;else if(e){const y=oo(u,i,r);d=y[0],c=y[1]}else d=i,c=Xn(u,i,r);const g=this._isHorizontal,f=g?s:o;e||(d=i);const p=ct.group({x:0,y:0,width:s,height:o,cornerRadius:l==null?void 0:l.cornerRadius,clip:!0,pickable:!1});p.name=li.trackContainer;const v=ye(e)&&e.draggableTrack===!0;let m;m=h===!1?"default":e===!1||v===!1?"pointer":cd(g);const C=r===i?f:(c-d)/(r-i)*f,b=r===i?0:(d-i)/(r-i)*f,_=ct.rect(Object.assign({x:g?b:0,y:g?0:b,width:g?C:s,height:g?o:C,cursor:m},a));_.name=li.track,this._track=_,p.add(_),t.add(p)}_renderHandler(t){return ct.symbol(t)}_renderHandlerText(t,e){var i,r,o;const{align:s,min:a,max:l,handlerSize:h=14,handlerText:u={},railHeight:d,railWidth:c,slidable:g}=this.attribute,f=this._isHorizontal,p=f?c:d,v=l===a?e==="start"?0:p:(t-a)/(l-a)*p,m=(i=u.space)!==null&&i!==void 0?i:4,C={text:u.formatter?u.formatter(t):t.toFixed((r=u.precision)!==null&&r!==void 0?r:0),lineHeight:(o=u.style)===null||o===void 0?void 0:o.lineHeight,cursor:g===!1?"default":cd(f)};return f?s==="top"?(C.textBaseline="bottom",C.textAlign="center",C.x=v,C.y=(d-h)/2-m):(C.textBaseline="top",C.textAlign="center",C.x=v,C.y=(d+h)/2+m):s==="left"?(C.textBaseline="middle",C.textAlign="end",C.x=(c-h)/2-m,C.y=v):(C.textBaseline="middle",C.textAlign="start",C.x=(c+h)/2+m,C.y=v),ct.text(Object.assign(Object.assign({},C),u.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:r,align:o}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const s=this._isHorizontal?0:r/2,a=this._isHorizontal?i/2:0;if(e&&e.shape){const c=ct.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:s,y:a,symbolType:"circle"},e.shapeStyle));this._tooltipShape=c,this._mainContainer.add(c)}const l=e&&e.text||{},h=(t=l.space)!==null&&t!==void 0?t:6,u={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(u.x=s,u.y=o==="top"?a-i/2-h:a+i/2+h,u.textAlign="center",u.textBaseline=o==="top"?"bottom":"top"):(u.y=a,u.x=o==="left"?s-r/2-h:a+r/2+h,u.textAlign=o==="left"?"end":"start",u.textBaseline="middle");const d=ct.text(Object.assign(Object.assign({},u),l.style));this._mainContainer.add(d),this._tooltipText=d,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const i=this._isHorizontal?this._tooltipState.pos*this.attribute.railWidth:this._tooltipState.pos*this.attribute.railHeight,r=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[r]:i});const{align:o}=this.attribute;if(this._tooltipText){const s=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[r]:i,text:s.formatter?s.formatter(this._tooltipState.value):this._isHorizontal||o!=="left"?`\u2248 ${this._tooltipState.value.toFixed((e=s.precision)!==null&&e!==void 0?e:0)}`:`${this._tooltipState.value.toFixed((t=s.precision)!==null&&t!==void 0?t:0)} \u2248`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),ye(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_updateTrack(){const t=this._startHandler,e=this._endHandler;if(this._isHorizontal){const i=t==null?void 0:t.attribute.x;if(e){const r=e==null?void 0:e.attribute.x;this._track.setAttributes({x:Math.min(i,r),width:Math.abs(i-r)})}else this._track.setAttributes({width:i})}else{const i=t==null?void 0:t.attribute.y;if(e){const r=e==null?void 0:e.attribute.y;this._track.setAttributes({y:Math.min(i,r),height:Math.abs(i-r)})}else this._track.setAttributes({height:i})}}_updateHandler(t,e,i){var r;const o=this._isHorizontal;t.setAttribute(o?"x":"y",e);const s=t.name===li.startHandler?this._startHandlerText:this._endHandlerText;if(s){const{handlerText:a={}}=this.attribute;s.setAttributes({text:a.formatter?a.formatter(i):i.toFixed((r=a.precision)!==null&&r!==void 0?r:0),[o?"x":"y"]:e})}t.name===li.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var r;const o=this._isHorizontal,{handlerText:s={}}=this.attribute;t.setAttributes({[o?"x":"y"]:e,text:s.formatter?s.formatter(i):i.toFixed((r=s.precision)!==null&&r!==void 0?r:0)});const a=t.name===li.startHandlerText?this._startHandler:this._endHandler;a&&a.setAttributes({[o?"x":"y"]:e}),t.name===li.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){let t,e=this._startHandler,i=this._endHandler;return this._isHorizontal?i&&i.attribute.x<(e==null?void 0:e.attribute.x)&&(t=e,e=i,i=t):i&&i.attribute.y<(e==null?void 0:e.attribute.y)&&(t=e,e=i,i=t),{startHandler:e,endHandler:i}}}$a.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}},xI();class gd extends g0{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},gd.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=i=>{const r=this._slider.tooltipShape;if(r&&i.detail&&!ut(i.detail.value)){const o=this._colorScale.scale(i.detail.value);r.setAttribute("fill",o)}this.dispatchEvent(i)},this._onSliderChange=i=>{this._updateColor(),this.dispatchEvent(i)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:r,min:o,max:s,value:a,railWidth:l,railHeight:h,showHandler:u=!0,handlerSize:d,handlerStyle:c,railStyle:g,trackStyle:f,startText:p,endText:v,handlerText:m,showTooltip:C,tooltip:b,disableTriggerEvent:_}=this.attribute,y=[],w=(s-o)/(t.length-1);for(let D=0;D<t.length;D++)y.push(o+w*D);this._colorScale=new F0().domain(y,!0).range(t),this._color=this._getTrackColor();const S=new $a({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:r,min:o,max:s,value:a,railWidth:l,railHeight:h,showHandler:u,handlerSize:d,handlerStyle:c,railStyle:g,trackStyle:Object.assign({fill:this._color},f),startText:p,endText:v,handlerText:m,showTooltip:C,tooltip:b,disableTriggerEvent:_});this._innerView.add(S),this._slider=S,S.translateTo(0-S.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+qe(this.attribute,"title.space",Ua):0)-S.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e}=this.attribute;if(Bt(t))return;const i=t.length;if(i===1)return t[0];const r=[];for(let s=0;s<i;s++){const a=s/(i-1);r.push({offset:a,color:t[s]})}const o=e==="horizontal";return{gradient:"linear",stops:r,x0:0,y0:0,x1:o?1:0,y1:o?0:1}}_updateColor(){const{layout:t="horizontal",colors:e,railWidth:i,railHeight:r}=this.attribute,{startHandler:o,endHandler:s,track:a}=this._slider,{startValue:l,endValue:h,startPos:u,endPos:d}=this._slider.currentValue,c=this._colorScale.scale(l),g=this._colorScale.scale(h);o==null||o.setAttribute("fill",c),s==null||s.setAttribute("fill",g);const f=t==="horizontal"?i:r;if(Math.abs(u-d)!==f&&e&&e.length>1){const p=this._color.stops,v=Math.min(u,d),m=Math.max(u,d),C=v/f,b=m/f,_=b-C,y=p.filter(B=>B.offset>C&&B.offset<b),w=Math.min(l,h),S=Math.max(l,h),D=this._colorScale.scale(w),A=this._colorScale.scale(S),x=[{offset:0,color:D}];y.forEach(B=>{x.push({offset:(B.offset-C)/_,color:B.color})}),x.push({offset:1,color:A}),a.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:x}))}}}gd.defaultAttributes={layout:"horizontal",title:{align:"start",space:Ua,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function oO(n="bottom"){let t=0;return n==="top"?`
    M${t},-6L${t-3.5},-2.5
    v5
    h7
    v-5
    Z
`:n==="left"?(t=1,`
    M${t-6},0L${t-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):n==="right"?(t=-1,`
    M${t+6},0L${t+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${t},6L${t-3.5},2.5
    v-5
    h7
    v5
    Z
`}BI();class fd extends g0{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},fd.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=i=>{this.dispatchEvent(i)},this._onSliderToolipChange=i=>{this.dispatchEvent(i)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:r,max:o,value:s,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:u,handlerStyle:d,railStyle:c,trackStyle:g,startText:f,endText:p,handlerText:v,showTooltip:m,tooltip:C,sizeBackground:b,disableTriggerEvent:_}=this.attribute,y=ct.group({x:0,y:0});this._innerView.add(y);const w=new $a({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:r,max:o,value:s,railWidth:a,railHeight:l,showHandler:h,handlerSize:u,handlerStyle:Object.assign({symbolType:oO(i)},d),railStyle:c,trackStyle:g,startText:f,endText:p,handlerText:v,showTooltip:m,tooltip:C,disableTriggerEvent:_});y.add(w);let S,D=0;e==="horizontal"?i==="top"?(S=`M0,0L${a},0L${a},12Z`,D=l):(S=`M0,12L${a},12L${a},0Z`,w.setAttribute("y",12)):i==="left"?S=`M${a},0L${a},0L${a+12},${l}L${a},${l}Z`:(S=`M0,${l}L12,${l}L12,0Z`,w.setAttribute("x",12));const A=ct.path(Object.assign(Object.assign({x:0,y:D,path:S},b),{zIndex:0}));y.add(A);const x=this._title?this._title.AABBBounds.height()+qe(this.attribute,"title.space",Ua):0;y.translate(0-y.AABBBounds.x1,x-y.AABBBounds.y1),this._slider=w}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}fd.defaultAttributes={layout:"horizontal",title:{align:"start",space:Ua,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};var sO=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const pd={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},aO={horizontal:Object.assign(Object.assign({},pd),{rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}}),vertical:Object.assign(Object.assign({},pd),{rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}})},lO={horizontal:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}}},pd),vertical:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}}},pd)};function hO(n,t){const e=gt({},(n.type==="color"?aO:lO)[n.orient==="bottom"||n.orient==="top"?"horizontal":"vertical"],n),{title:i={},handler:r={},rail:o={},track:s={},startText:a,endText:l,handlerText:h,sizeBackground:u,background:d={},type:c,id:g,visible:f,orient:p,position:v,data:m,defaultSelected:C,field:b,filter:_,regionId:y,regionIndex:w,seriesIndex:S,seriesId:D,padding:A}=e,x=sO(e,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(x.title=Vb(i)),x.showHandler=r.visible!==!1,Bt(r.style)||(x.handlerStyle=Pe(r.style)),N(o.width)&&(x.railWidth=o.width),N(o.height)&&(x.railHeight=o.height),Bt(o.style)||(x.railStyle=Pe(o.style)),Bt(s.style)||(x.trackStyle=Pe(s.style)),x.startText=Fn(a),x.endText=Fn(l),x.handlerText=Fn(h),Bt(u)||(x.sizeBackground=Pe(u)),d.visible&&!Bt(d.style)&&(gt(x,d.style),N(d.padding)&&(x.padding=d.padding)),x}class uO{constructor(t,e){var i,r,o,s;this.table=e,this.option=Ot(t),this.orient=(i=t.orient)!==null&&i!==void 0?i:"left",this.visible=(r=t.visible)===null||r===void 0||r,this.position=(o=t.position)!==null&&o!==void 0?o:"middle",this.selectedData=(s=t.defaultSelected)!==null&&s!==void 0?s:[],this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e=this.option.type==="color"?new gd(gt({},t,{slidable:!0})):new fd(gt({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||o<=0)return;const s=this.table.tableNoFrameWidth,a=this.table.tableNoFrameHeight,l=$t((i=(e=t.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);let h=0,u=0;this.orient==="left"?(h=l[3],u=0,r+=l[1]+l[3]):this.orient==="top"?(h=0,u=l[0],o+=l[0]+l[2]):this.orient==="right"?(h=s-r-l[1],u=0,r+=l[1]+l[3]):this.orient==="bottom"&&(h=0,u=a-o-l[2],o+=l[0]+l[2]);const d=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,f=0;d==="horizontal"?g=c==="middle"?(s-r)/2:c==="end"?s-r-l[1]:l[3]:f=c==="middle"?(a-o)/2:c==="end"?a-o-l[2]:l[0],this.legendComponent.setAttributes({dx:g,dy:f,x:h,y:u}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(t){const e=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",i=e==="horizontal"?"bottom":this.orient;return Object.assign(Object.assign({},hO(this.option,t)),{layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,[this.option.type==="color"?"colors":"sizeRange"]:this.option.type==="color"?this.option.colors:this.option.sizeRange})}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",t=>{const e=qe(t,"detail.value");this.table.fireListeners(Q.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()})}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function Qy(n,t){return n.type==="color"||n.type==="size"?new uO(n,t):new PI(n,t)}class tw{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new(Ds()),i=t!=null&&t.name?t.name:e_("dataset"),this.name=i,this._logger=(e=t==null?void 0:t.logger)!==null&&e!==void 0?e:te.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&((i=this._logger)===null||i===void 0||i.error(`Error: dataView ${t} \u4E4B\u524D\u5DF2\u5B58\u5728\uFF0C\u8BF7\u91CD\u65B0\u547D\u540D`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} \u4E4B\u524D\u5DF2\u6CE8\u518C\uFF0C\u6267\u884C\u8986\u76D6\u903B\u8F91`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} \u4E4B\u524D\u5DF2\u6CE8\u518C\uFF0C\u6267\u884C\u8986\u76D6\u903B\u8F91`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{t.some(o=>o.isRunning)||i()}),t.forEach(o=>{o.target.addListener(e,r)}),this._callMap.set(i,r)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const r=this._callMap.get(i);r&&t.forEach(o=>{o.target.removeListener(e,r)}),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.parseNewData(e.data,e.options)})}multipleDataViewUpdateInRawData(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.updateRawData(e.data,e.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}class ew{constructor(t){this.isUpdate=!1,this._keys=[],this._sorted=!1,this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);i!==-1&&this._keys.splice(i,1),this.totalSum-=e;const r=this.table.getRowHeight(t);this.updateDifference(t,r-e)}}put(t,e){if(this.data.has(t)){const i=this.data.get(t);this.data.set(t,e);const r=e-i;this.totalSum+=r,this.updateDifference(t,r)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort((e,i)=>e<i?-1:e>i?1:0),this._sorted=!0)}updateDifference(t,e){var i;const r=(i=this.difference.get(t))!==null&&i!==void 0?i:0;this.difference.set(t,r+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,r]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,r+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,r]of this.difference)i<=t&&(e+=r);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){var e;let i=0;for(let r=t;r>=0;r--){if(this.cumulativeSum.has(r)){i+=this.cumulativeSum.get(r);break}i+=(e=this.data.get(r))!==null&&e!==void 0?e:this.table.getRowHeight(r)}return this.cumulativeSum.set(t,i),i}update(){this.isUpdate||(this.isUpdate=!0,setTimeout(()=>{this.dealDiffenence(),this.isUpdate=!1},0))}dealDiffenence(){for(const[t,e]of this.cumulativeSum)for(const[i,r]of this.difference)if(t>=i){const o=this.cumulativeSum.get(t);this.cumulativeSum.set(t,o+r)}this.difference.clear()}insert(t,e){const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),N(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:r}=this;if(t>e){const s=[];for(let a=vd(r,t+i-1);a>=0;a--){const l=r[a];if(l>=t)s.push(this.get(l));else if(e<=l&&l<t)this.put(l+i,this.get(l));else if(l<e)break}for(let a=0;a<i;a++)this.put(e+a,s[i-1-a])}const{length:o}=r;if(t<e){const s=[];for(let a=vd(r,t);a<o;a++){const l=r[a];if(l>=t&&l<t+i)s.push(this.get(l));else if(t+i<=l&&l<=e)this.put(l-i,this.get(l));else if(l>e)break}for(let a=0;a<i;a++)this.put(e+a,s[a])}}exchangeOrder(t,e,i,r,o){const{_keys:s}=this;if(this._sorted||(s.sort((a,l)=>a<l?-1:a>l?1:0),this._sorted=!0),t>i){const a=[],l=[];for(let h=vd(s,i);h<t+e;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(o+e+h,a[h])}else{const a=[],l=[];for(let h=vd(s,t);h<i+r;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(t+h,a[h])}}}function vd(n,t){let e=0,i=n.length-1;for(;e<=i;){const r=Math.floor((e+i)/2);if(n[r]===t)return r;n[r]>t?i=r-1:e=r+1}return i<0?0:i}class dO{constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleId(t,e);if(i)return this.getCustomCellStyleOption(i).style}getCustomCellStyleId(t,e){let i;return this.customCellStyleArrangement.forEach(r=>{r.cellPosition.range?r.cellPosition.range.start.col<=t&&r.cellPosition.range.end.col>=t&&r.cellPosition.range.start.row<=e&&r.cellPosition.range.end.row>=e&&(i=r.customStyleId):r.cellPosition.col===t&&r.cellPosition.row===e&&(i=r.customStyleId)}),i}getCustomCellStyleOption(t){return this.customCellStyle.find(e=>e.id===t)}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex(r=>r.id===t);i===-1?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach(r=>{const o=r.cellPosition;if(r.customStyleId===t)if(o.range)for(let s=o.range.start.col;s<=o.range.end.col;s++)for(let a=o.range.start.row;a<=o.range.end.row;a++)this.table.scenegraph.updateCellContent(s,a);else this.table.scenegraph.updateCellContent(o.col,o.row)}),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e){const i=this.customCellStyleArrangement.findIndex(r=>r.cellPosition.range&&t.range?r.cellPosition.range.start.col===t.range.start.col&&r.cellPosition.range.start.row===t.range.start.row&&r.cellPosition.range.end.col===t.range.end.col&&r.cellPosition.range.end.row===t.range.end.row:r.cellPosition.col===t.col&&r.cellPosition.row===t.row);if(i===-1?this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e}):this.customCellStyleArrangement[i].customStyleId=e,t.range)for(let r=t.range.start.col;r<=t.range.end.col;r++)for(let o=t.range.start.row;o<=t.range.end.row;o++)this.table.scenegraph.updateCellContent(r,o);else this.table.scenegraph.updateCellContent(t.col,t.row);this.table.scenegraph.updateNextFrame()}}function Xa(n,t){n=n.clone();for(const e in t){const i=t[e];i&&(n[`_${e}`]=i)}return n}const{toBoxArray:iw}=TR,{isTouchEvent:cO}=FR,gO=/^\$(\d+)\$(\d+)$/;hR();const fO={};class M0 extends Zh{static get EVENT_TYPE(){return Q}constructor(t,e={}){var i,r,o,s,a,l,h,u,d;if(super(),this.showFrozenIcon=!0,this.version="0.21.3",this.id=`VTable${Date.now()}`,this.isReleased=!1,this._chartEventMap={},this.throttleInvalidate=fR(this.render.bind(this),200),!t&&e.mode!=="node")throw new Error("vtable's container is undefined");const{frozenColCount:c=0,defaultRowHeight:g=40,defaultHeaderRowHeight:f,defaultColWidth:p=80,defaultHeaderColWidth:v,widthMode:m="standard",heightMode:C="standard",autoFillWidth:b=!1,autoFillHeight:_=!1,keyboardOptions:y,eventOptions:w,columnResizeMode:S,dragHeaderMode:D,showFrozenIcon:A,allowFrozenColCount:x,padding:B,hover:F,menu:T,select:R,customRender:M,pixelRatio:E=hs,renderChartAsync:P,renderChartAsyncBatchCount:I,mode:k,modeParams:H,canvasWidth:O,canvasHeight:z,overscrollBehavior:j,limitMinWidth:U}=e;this.container=t,this.options=e,this.options.container=t,this._widthMode=m,this._heightMode=C,this._autoFillWidth=b,this._autoFillHeight=_,this.customRender=M,this.padding={top:0,right:0,left:0,bottom:0},B&&(typeof B=="number"?(this.padding.top=B,this.padding.left=B,this.padding.bottom=B,this.padding.right=B):(B.top&&(this.padding.top=B.top),B.bottom&&(this.padding.bottom=B.bottom),B.left&&(this.padding.left=B.left),B.right&&(this.padding.right=B.right))),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=O,this.canvasHeight=z;const W=this.internalProps={};A!==void 0&&(this.showFrozenIcon=A),typeof x=="number"&&x<=0&&(this.showFrozenIcon=!1),Pt.mode!=="node"&&(W.element=L3(this.padding),W.focusControl=new wI(this,W.element),W.canvas=document.createElement("canvas"),W.element.appendChild(W.canvas),W.context=W.canvas.getContext("2d")),W.handler=new ou,lt(this.options.resizeTime)&&(W.handler.resizeTime=this.options.resizeTime),W.pixelRatio=E,W.frozenColCount=c,W.defaultRowHeight=g,W.defaultHeaderRowHeight=f!=null?f:g,W.defaultColWidth=p,W.defaultHeaderColWidth=v!=null?v:p,W.keyboardOptions=y,W.eventOptions=w,W.columnResizeMode=S,W.dragHeaderMode=D,W.renderChartAsync=P,D1(I),W.overscrollBehavior=j!=null?j:"auto",W._rowHeightsMap=new ew(this),W._rowRangeHeightsMap=new Map,W._colRangeWidthsMap=new Map,W._widthResizedColMap=new Set,this.colWidthsMap=new Wo,this.colContentWidthsMap=new Wo,this.colWidthsLimit={},W.calcWidthContext={_:W,get full(){var V;return Pt.mode==="node"?O/(E!=null?E:1):this._.canvas.width/((V=this._.context.pixelRatio)!==null&&V!==void 0?V:window.devicePixelRatio)}},W.cellTextOverflows={},W.focusedTable=!1,W.theme=zn.of((i=e.theme)!==null&&i!==void 0?i:zn.DEFAULT),W.theme.isPivot=this.isPivotTable(),t?(t.innerHTML="",t.appendChild(W.element),this._updateSize()):this._updateSize(),this.options=e,W.theme=zn.of((r=e.theme)!==null&&r!==void 0?r:zn.DEFAULT),W.theme.isPivot=this.isPivotTable(),W.bodyHelper=new eI(this),W.headerHelper=new dI(this),W.autoWrapText=e.autoWrapText,W.allowFrozenColCount=(o=e.allowFrozenColCount)!==null&&o!==void 0?o:0,W.limitMaxAutoWidth=(s=e.limitMaxAutoWidth)!==null&&s!==void 0?s:450,W.limitMinWidth=U!=null?typeof U=="number"?U:U?10:0:10,this._vDataSet=new tw,this.scenegraph=new ak(this),this.stateManager=new Mk(this),this.eventManager=new Jk(this),e.legends&&(W.legends=Qy(e.legends,this),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})),W.tooltip=Object.assign({renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0},e.tooltip),W.tooltip.renderMode==="html"&&(W.tooltipHandler=new My(this,W.tooltip.confine)),W.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray((a=e.menu)===null||a===void 0?void 0:a.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((l=e.menu)===null||l===void 0?void 0:l.dropDownMenuHighlight),Array.isArray((h=e.menu)===null||h===void 0?void 0:h.defaultHeaderMenuItems)&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),W.menu.renderMode==="html"&&(W.menuHandler=new Py(this)),this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,W.stick={changedCells:new Map},W.customMergeCell=e.customMergeCell,this.customCellStylePlugin=new dO(this,(u=e.customCellStyle)!==null&&u!==void 0?u:[],(d=e.customCellStyleArrangement)!==null&&d!==void 0?d:[])}getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}resize(){this._updateSize(),this.internalProps.legends&&this.internalProps.legends.resize(),this.internalProps.title&&this.internalProps.title.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){var t;return(t=this.internalProps.colCount)!==null&&t!==void 0?t:0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){var t,e,i;return(i=(e=(t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.frozenColCount)!==null&&e!==void 0?e:this.internalProps.frozenColCount)!==null&&i!==void 0?i:0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t,this.tableNoFrameWidth-this.getColsWidth(0,t-1)<=120&&(this.internalProps.frozenColCount=0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t,this.tableNoFrameWidth-this.getColsWidth(0,t-1)<=120&&(this.internalProps.frozenColCount=0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){var t,e,i;return(i=(e=(t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.frozenRowCount)!==null&&e!==void 0?e:this.internalProps.frozenRowCount)!==null&&i!==void 0?i:0}set frozenRowCount(t){this.internalProps.frozenRowCount=t}get rightFrozenColCount(){var t,e,i;return(i=(e=(t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.rightFrozenColCount)!==null&&e!==void 0?e:this.internalProps.rightFrozenColCount)!==null&&i!==void 0?i:0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){var t,e,i;return(i=(e=(t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.bottomFrozenRowCount)!==null&&e!==void 0?e:this.internalProps.bottomFrozenRowCount)!==null&&i!==void 0?i:0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return this.internalProps.defaultRowHeight}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){var t;return(t=this.internalProps.keyboardOptions)!==null&&t!==void 0?t:null}set keyboardOptions(t){this.internalProps.keyboardOptions=t!=null?t:void 0}get eventOptions(){var t;return(t=this.internalProps.eventOptions)!==null&&t!==void 0?t:null}set eventOptions(t){this.internalProps.eventOptions=t!=null?t:void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}_colWidthDefineToPxWidth(t){return t==="auto"?0:ya(this,t)}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=ya(this,e.min),i.minDef=e.min),e.max&&(i.max=ya(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(z3(i,e),0)}setPixelRatio(t){this.internalProps.pixelRatio=t,this.scenegraph.setPixelRatio(t)}_updateSize(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T;const{padding:R}=this;let M=0,E=0;if(Pt.mode==="browser"){const k=this.getElement(),H=(e=(t=k.parentElement)===null||t===void 0?void 0:t.offsetWidth)!==null&&e!==void 0?e:0,O=(r=(i=k.parentElement)===null||i===void 0?void 0:i.offsetHeight)!==null&&r!==void 0?r:0;k.style.width=H&&H-R.left-R.right+"px"||"0px",k.style.height=O&&O-R.top-R.bottom+"px"||"0px";const{canvas:z}=this.internalProps;M=(s=(o=z.parentElement)===null||o===void 0?void 0:o.offsetWidth)!==null&&s!==void 0?s:0,E=(l=(a=z.parentElement)===null||a===void 0?void 0:a.offsetHeight)!==null&&l!==void 0?l:0,!((h=this==null?void 0:this.scenegraph)===null||h===void 0)&&h.stage?this.scenegraph.stage.resize(M,E):(z.style.width="",z.style.height="",z.width=M,z.height=E,z.style.width=`${M}px`,z.style.height=`${E}px`)}else Pt.mode==="node"&&(M=this.canvasWidth-1,E=this.canvasHeight-1);const P=Math.floor(M-ob(this.getTheme().scrollStyle)),I=Math.floor(E-ob(this.getTheme().scrollStyle));if(!((u=this.internalProps.theme)===null||u===void 0)&&u.frameStyle){const k=iw((c=(d=this.internalProps.theme.frameStyle)===null||d===void 0?void 0:d.borderLineWidth)!==null&&c!==void 0?c:[null]),H=iw((f=(g=this.internalProps.theme.frameStyle)===null||g===void 0?void 0:g.shadowBlur)!==null&&f!==void 0?f:[0]);!((p=this.theme.frameStyle)===null||p===void 0)&&p.innerBorder?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=P-((v=H[1])!==null&&v!==void 0?v:0),this.tableNoFrameHeight=I-((m=H[2])!==null&&m!==void 0?m:0)):(this.tableX=((C=k[3])!==null&&C!==void 0?C:0)+((b=H[3])!==null&&b!==void 0?b:0),this.tableY=((_=k[0])!==null&&_!==void 0?_:0)+((y=H[0])!==null&&y!==void 0?y:0),this.tableNoFrameWidth=P-(((w=k[1])!==null&&w!==void 0?w:0)+((S=H[1])!==null&&S!==void 0?S:0))-(((D=k[3])!==null&&D!==void 0?D:0)+((A=H[3])!==null&&A!==void 0?A:0)),this.tableNoFrameHeight=I-(((x=k[0])!==null&&x!==void 0?x:0)+((B=H[0])!==null&&B!==void 0?B:0))-(((F=k[2])!==null&&F!==void 0?F:0)+((T=H[2])!==null&&T!==void 0?T:0)))}}get rowHierarchyType(){return"grid"}getColsWidth(t,e){var i;if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,((i=this.colCount)!==null&&i!==void 0?i:1/0)-1);const r=this._colRangeWidthsMap.get(`$${t}$${e}`);if(r!=null)return r;const o=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(o!=null){const a=o+this.getColWidth(e);return t>=0&&e>=0&&!Number.isNaN(a)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(a)),Math.round(a)}let s=0;for(let a=t;a<=e;a++)s+=this.getColWidth(a);return t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(s)),Math.round(s)}getRowHeight(t){if(N(this.rowHeightsMap.get(t)))return this.rowHeightsMap.get(t);const e=this.getDefaultRowHeight(t);return lt(e)?e:this.defaultRowHeight}getDefaultRowHeight(t){var e,i;return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?(e=this.defaultHeaderRowHeight[t])!==null&&e!==void 0?e:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(this.rowHeaderLevelCount,t)?Array.isArray(this.defaultHeaderRowHeight)?(i=this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0])!==null&&i!==void 0?i:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){this.rowHeightsMap.put(t,Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}getRowsHeight(t,e){var i;if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,((i=this.rowCount)!==null&&i!==void 0?i:1/0)-1);let r=0;if(this.heightMode==="standard"&&!this.autoFillHeight&&this.internalProps.layoutMap&&e>=this.columnHeaderLevelCount&&!this.bottomFrozenRowCount&&!this.hasAutoImageColumn()){for(let o=t;o<this.columnHeaderLevelCount;o++)r+=this.getRowHeight(o);r+=this.defaultRowHeight*(e-Math.max(this.columnHeaderLevelCount,t)+1)}else r=this.rowHeightsMap.getSumInRange(t,e);return Math.round(r)}getColWidthDefined(t){var e,i,r;const{layoutMap:o}=this.internalProps;if(this.widthMode==="autoWidth")return"auto";const{width:s}=(e=o==null?void 0:o.getColumnWidthDefined(t))!==null&&e!==void 0?e:{};return typeof s=="number"&&s<=0?0:s||(this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?(i=this.defaultHeaderColWidth[t])!==null&&i!==void 0?i:this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?(r=this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount])!==null&&r!==void 0?r:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}getColWidth(t){var e,i;const r=(e=this.colWidthsMap.get(t))!==null&&e!==void 0?e:t<this.rowHeaderLevelCount?Array.isArray(this.defaultHeaderColWidth)?(i=this.defaultHeaderColWidth[t])!==null&&i!==void 0?i:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth;return this.widthMode==="adaptive"&&typeof r=="number"||this.transpose&&typeof r=="number"?this._colWidthDefineToPxWidth(r):this._adjustColWidth(t,this._colWidthDefineToPxWidth(r))}_setColWidth(t,e,i,r){this.colWidthsMap.put(t,typeof e=="number"?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),r||this.stateManager.checkFrozen()}_clearColRangeWidthsMap(t){if(typeof t!="number")this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const r=gO.exec(i);if(r){const o=Number(r[1]),s=Number(r[2]);t>=o&&t<=s&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){return this.internalProps.rowCount<=0?0:this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){return this.internalProps.colCount<=0?0:this.getColsWidth(0,this.internalProps.colCount-1)}getMaxColWidth(t){var e;const i=this.colWidthsLimit[t];let r=(e=i&&i.max)!==null&&e!==void 0?e:1/0;return typeof r=="string"&&(r=ya(this,r)),r}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){var e;const i=this.colWidthsLimit[t];let r=(e=i&&i.min)!==null&&e!==void 0?e:0;return typeof r=="string"&&(r=ya(this,r)),r}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){var i,r;const o=this.isFrozenCell(t,e);let s;const a=this.getColWidth(t);let l;s=o&&o.col&&this.isRightFrozenColumn(t,e)?this.tableNoFrameWidth-((i=this.getColsWidth(t,this.colCount-1))!==null&&i!==void 0?i:0):this.getColsWidth(0,t-1)||0;const h=this.getRowHeight(e);return l=o&&o.row&&this.isBottomFrozenRow(t,e)?this.tableNoFrameHeight-((r=this.getRowsHeight(e,this.rowCount-1))!==null&&r!==void 0?r:0):this.getRowsHeight(0,e-1),new On(Math.round(s),Math.round(l),Math.round(a),Math.round(h))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),r=this.getColsWidth(0,i.start.col-1)||0,o=this.getColsWidth(i.start.col,i.end.col),s=this.getRowsHeight(0,i.start.row-1)||0,a=this.getRowsHeight(i.start.row,i.end.row);return new On(Math.round(r),Math.round(s),Math.round(o),Math.round(a))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let r=!0,o=!0;i!=null&&i.col&&(i!=null&&i.row)?(r=!1,o=!1):i!=null&&i.col?r=!1:i!=null&&i.row&&(o=!1);const s=this.getCellRect(t,e);return this._toRelativeRect(s,r,o)}getCellRangeRelativeRect(t){if(t.start){const s=this.isFrozenCell(t.start.col,t.start.row);let a=!0,l=!0;return s!=null&&s.col&&(s!=null&&s.row)?(a=!1,l=!1):s!=null&&s.col?a=!1:s!=null&&s.row&&(l=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),a,l)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let r=!0,o=!0;return i!=null&&i.col&&(i!=null&&i.row)?(r=!1,o=!1):i!=null&&i.col?r=!1:i!=null&&i.row&&(o=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),r,o)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,r=Math.min(t.right,this.tableNoFrameWidth),o=t.copy();o.left=i,o.right=r;const s=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,a=Math.min(t.bottom,this.tableNoFrameHeight);return o.top=s,o.bottom=a,o}getCellsRect(t,e,i,r){var o,s,a,l,h,u;let d=this.getColsWidth(0,t-1)||0,c=this.getColsWidth(t,i);const g=this.scrollLeft;this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?c=this.tableNoFrameWidth-((o=this.getColsWidth(t+1,this.colCount-1))!==null&&o!==void 0?o:0)-d:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?c=Math.max(c-g,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(d=Math.min(d-g,this.tableNoFrameWidth-this.getRightFrozenColsWidth()),c=this.tableNoFrameWidth-((s=this.getColsWidth(t+1,this.colCount-1))!==null&&s!==void 0?s:0)-d):this.isRightFrozenColumn(t)&&(d=this.tableNoFrameWidth-((a=this.getColsWidth(t,this.colCount-1))!==null&&a!==void 0?a:0));let f=this.getRowsHeight(0,e-1),p=this.getRowsHeight(e,r);const v=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(r)?p=this.tableNoFrameHeight-((l=this.getRowsHeight(e+1,this.rowCount-1))!==null&&l!==void 0?l:0)-f:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(r)?p=Math.max(p-v,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(r)?(f=Math.min(f-v,this.tableNoFrameHeight-this.getBottomFrozenRowsHeight()),p=this.tableNoFrameHeight-((h=this.getRowsHeight(e+1,this.rowCount-1))!==null&&h!==void 0?h:0)-f):this.isBottomFrozenRow(e)&&(f=this.tableNoFrameHeight-((u=this.getRowsHeight(e,this.rowCount-1))!==null&&u!==void 0?u:0)),new On(Math.round(d),Math.round(f),Math.round(c),Math.round(p))}getCellsRectWidth(t,e,i,r){const o=this.isFrozenCell(t,e),s=this.isFrozenCell(i,r);let a=this.getColsWidth(t,i);if(o&&o.col){const l=this.scrollLeft;s&&s.col||(a-=l,a=Math.max(a,this.getColsWidth(t,this.frozenColCount-1)))}return a}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e)||this.isBottomFrozenRow(e),r=this.isFrozenColumn(t)||this.isRightFrozenColumn(t);return i||r?{row:i,col:r}:null}getRowAt(t){const e=I3(this,t);if(e)return e;let i=this.getTargetRowAt(t);return i||(i={top:-1,row:-1,bottom:-1,height:-1}),i}getColAt(t){const e=O3(this,t);if(e)return e;let i=this.getTargetColAt(t);return i||(i={left:-1,col:-1,right:-1,width:1}),i}getCellAt(t,e){const i=this.getRowAt(e),{row:r,top:o,bottom:s,height:a}=i,l=this.getColAt(t),{col:h,left:u,right:d,width:c}=l;return{row:r,col:h,rect:{left:u,right:d,top:o,bottom:s,width:c,height:a}}}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const r=this.getCellRect(t,e),o=W3(this);if(o.contains(r))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+r.width>this.canvas.width||(r.left<o.left?this.scrollLeft-=o.left-r.left:o.right<r.right&&(this.scrollLeft-=o.right-r.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+r.height>this.canvas.height||(r.top<o.top?this.scrollTop-=o.top-r.top:o.bottom<r.bottom&&(this.scrollTop-=o.bottom-r.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise((t,e)=>{setTimeout(()=>{t()},0)})}_toRelativeRect(t,e=!0,i=!0){const r=t.copy(),o=this.getVisibleRect();return r.offsetLeft(this.tableX-(e?o.left:0)),r.offsetTop(this.tableY-(i?o.top:0)),r}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,r=this.tableNoFrameHeight;return new On(e,t,i,r)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,r=this.getTargetRowAt(i);if(!r)return 0;const o=Math.max(r.top>=i?r.row:r.row+1,t);let s=this.getRowsHeight(0,o-1),a=0;const{rowCount:l}=this;for(let h=o;h<l;h++){const u=s+this.getRowHeight(h);if(e.bottom<u)break;a++,s=u}return a}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),r=this.getFrozenColsWidth(),o=this.getBottomFrozenRowsHeight(),s=this.getRightFrozenColsWidth(),{row:a}=this.getRowAt(t+i+1),{col:l}=this.getColAt(e+r+1),h=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-o).row:this.rowCount-1,u=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-s).col:this.colCount-1;return u<0||h<0?null:{rowStart:a,colStart:l,rowEnd:h,colEnd:u}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:r}=this.getRowAt(t+e+1),o=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return o<0?null:{rowStart:r,rowEnd:o}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:r}=this.getColAt(t+e+1),o=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return o<0?null:{colStart:r,colEnd:o}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,r=this.getTargetColAt(i);if(!r)return 0;const o=Math.max(r.left>=i?r.col:r.col+1,t);let s=this.getColsWidth(0,o-1),a=0;const{colCount:l}=this;for(let h=o;h<l;h++){const u=s+this.getColWidth(h);if(e.right<u)break;a++,s=u}return a}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||typeof t.release!="function")throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){var t,e,i,r,o,s,a,l,h,u,d;const c=this.internalProps;(e=(t=c.tooltipHandler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),(r=(i=c.menuHandler)===null||i===void 0?void 0:i.release)===null||r===void 0||r.call(i),Y_.clearAll(),(o=super.release)===null||o===void 0||o.call(this),(a=(s=c.handler)===null||s===void 0?void 0:s.release)===null||a===void 0||a.call(s),(h=(l=c.focusControl)===null||l===void 0?void 0:l.release)===null||h===void 0||h.call(l),(u=c.legends)===null||u===void 0||u.release(),(d=c.title)===null||d===void 0||d.release(),c.layoutMap.release(),c.releaseList&&(c.releaseList.forEach(f=>{var p;return(p=f==null?void 0:f.release)===null||p===void 0?void 0:p.call(f)}),c.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release();const{parentElement:g}=c.element;g&&g.removeChild(c.element),this.isReleased=!0}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t){var e,i,r,o,s;this.options=t;const{frozenColCount:a=0,defaultRowHeight:l=40,defaultHeaderRowHeight:h,defaultColWidth:u=80,defaultHeaderColWidth:d=80,keyboardOptions:c,eventOptions:g,columnResizeMode:f,dragHeaderMode:p,showFrozenIcon:v,allowFrozenColCount:m,padding:C,hover:b,menu:_,select:y,pixelRatio:w,widthMode:S,heightMode:D,autoFillWidth:A,autoFillHeight:x,customRender:B,renderChartAsync:F,renderChartAsyncBatchCount:T,overscrollBehavior:R,limitMinWidth:M}=t;w&&w!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=w),C&&(typeof C=="number"?(this.padding.top=C,this.padding.left=C,this.padding.bottom=C,this.padding.right=C):(C.top&&(this.padding.top=C.top),C.bottom&&(this.padding.bottom=C.bottom),C.left&&(this.padding.left=C.left),C.right&&(this.padding.right=C.right))),this.showFrozenIcon=typeof v!="boolean"||v,typeof m=="number"&&m<=0&&(this.showFrozenIcon=!1),this.widthMode=S!=null?S:"standard",this.heightMode=D!=null?D:"standard",this.autoFillWidth=A!=null&&A,this.autoFillHeight=x!=null&&x,this.customRender=B;const E=this.internalProps;Pt.mode!=="node"&&k3(E.element,this.padding),E.frozenColCount=a,E.defaultRowHeight=l,E.defaultHeaderRowHeight=h!=null?h:l,E.defaultColWidth=u,E.defaultHeaderColWidth=d!=null?d:u,E.keyboardOptions=c,E.eventOptions=g,E.columnResizeMode=f,E.dragHeaderMode=p,E.renderChartAsync=F,D1(T),E.overscrollBehavior=R!=null?R:"auto",E.cellTextOverflows={},E._rowHeightsMap=new ew(this),E._rowRangeHeightsMap=new Map,E._colRangeWidthsMap=new Map,E._widthResizedColMap=new Set,this.colWidthsMap=new Wo,this.colContentWidthsMap=new Wo,this.colWidthsLimit={},E.stick.changedCells.clear(),E.theme=zn.of((e=t.theme)!==null&&e!==void 0?e:zn.DEFAULT),E.theme.isPivot=this.isPivotTable(),this.scenegraph.updateStageBackground(),E.autoWrapText=t.autoWrapText,E.allowFrozenColCount=(i=t.allowFrozenColCount)!==null&&i!==void 0?i:0,E.limitMaxAutoWidth=(r=t.limitMaxAutoWidth)!==null&&r!==void 0?r:450,E.limitMinWidth=M!=null?typeof M=="number"?M:M?10:0:10,this._vDataSet=new tw,(o=E.legends)===null||o===void 0||o.release(),(s=E.title)===null||s===void 0||s.release(),E.layoutMap.release(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends&&(E.legends=Qy(t.legends,this),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})),E.tooltip=Object.assign({renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0},t.tooltip),E.tooltip.renderMode!=="html"||E.tooltipHandler||(E.tooltipHandler=new My(this,E.tooltip.confine)),E.menu=Object.assign({renderMode:"html"},t.menu),E.menu.renderMode!=="html"||E.menuHandler||(E.menuHandler=new Py(this)),this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache()}renderWithRecreateCells(){const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){return this.bottomFrozenRowCount>0?this.getRowsHeight(this.rowCount-this.bottomFrozenRowCount,this.rowCount-1):0}getRightFrozenColsWidth(){return this.rightFrozenColCount>0?this.getColsWidth(this.colCount-this.rightFrozenColCount,this.colCount-1):0}getDrawRange(){const t=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),e=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new On(this.tableX,this.tableY,t,e)}_getMouseAbstractPoint(t,e=!0){let i;if(!t)return{inTable:!1,x:void 0,y:void 0};i=cO(t)?t.changedTouches[0]:t;const r=i.clientX||i.pageX+window.scrollX,o=i.clientY||i.pageY+window.scrollY,s=this.internalProps.canvas.getBoundingClientRect();let a=!0;s.right<=r&&(a=!1),s.bottom<=o&&(a=!1);const l=s.width,h=l/(this.canvas.offsetWidth||l),u=s.height,d=u/(this.canvas.offsetHeight||u);return{x:(r-s.left)/h+(e?this.scrollLeft:0),y:(o-s.top)/d+(e?this.scrollTop:0),inTable:a}}getTheme(){return this.internalProps.theme}getTargetColAt(t){if(t===0)return{left:0,col:0,right:0,width:0};const e=(o,s)=>{let a=s-this.getColWidth(o);const{colCount:l}=this.internalProps;for(let h=o;h<l;h++){const u=this.getColWidth(h),d=a+u;if(Math.round(a)<=Math.round(t)&&Math.round(t)<Math.round(d))return{left:a,col:h,right:d,width:u};a=d}return null},i=this.computeTargetColByX(t),r=this.getColsWidth(0,i);return t>=r?e(i,r):((o,s)=>{let a=s;for(let l=o;l>=0;l--){const h=this.getColWidth(l),u=a-h;if(Math.round(u)<=Math.round(t)&&Math.round(t)<Math.round(a))return{left:u,col:l,right:a,width:h};a=u}return null})(i,r)}getTargetRowAt(t){if(t===0)return{top:0,row:0,bottom:0,height:0};const e=(o,s)=>{let a=s-this.getRowHeight(o);const{rowCount:l}=this.internalProps;for(let h=o;h<l;h++){const u=this.getRowHeight(h),d=a+u;if(Math.round(a)<=Math.round(t)&&Math.round(t)<Math.round(d))return{top:a,row:h,bottom:d,height:u};a=d}return null},i=this.computeTargetRowByY(t),r=this.getRowsHeight(0,i);return t>=r?e(i,r):((o,s)=>{let a=s;for(let l=o;l>=0;l--){const h=this.getRowHeight(l),u=a-h;if(Math.round(u)<=Math.round(t)&&Math.round(t)<Math.round(a))return{top:u,row:l,bottom:a,height:h};a=u}return null})(i,r)}computeTargetRowByY(t){let e=this.internalProps.defaultRowHeight;return this._rowRangeHeightsMap.get("$0$"+(this.rowCount-1))&&(e=this._rowRangeHeightsMap.get("$0$"+(this.rowCount-1))/this.rowCount),Math.min(Math.ceil(t/e),this.rowCount-1)}computeTargetColByX(t){if(this._colRangeWidthsMap.get("$0$"+(this.colCount-1))){let e=0,i=this.colCount-1;for(;i-e>1;){const r=Math.floor((e+i)/2);if(t<this._colRangeWidthsMap.get(`$0$${r}`))i=r;else{if(!(t>this._colRangeWidthsMap.get(`$0$${r}`)))return r;e=r}}return i}return Math.min(Math.ceil(t/this.internalProps.defaultColWidth),this.colCount-1)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e){this.stateManager.updateSelectPos(t,e),this.stateManager.endSelectCells()}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach((r,o)=>{r.start.col===r.end.col&&r.start.row===r.end.row?this.stateManager.updateSelectPos(r.start.col,r.start.row,!1,o>=1):(this.stateManager.updateSelectPos(r.start.col,r.start.row,!1,o>=1),this.stateManager.updateInteractionState(St.grabing),this.stateManager.updateSelectPos(r.end.col,r.end.row,!1,o>=1)),this.stateManager.endSelectCells(!1),this.stateManager.updateInteractionState(St.default)}),this.setScrollTop(i),this.setScrollLeft(e)}get recordsCount(){var t;return(t=this.records)===null||t===void 0?void 0:t.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),xf(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=zn.of(t!=null?t:zn.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=zn.of(t!=null?t:zn.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return i==null?void 0:i.define}getBodyColumnType(t,e){const i=this.internalProps.layoutMap.getBody(t,e).cellType;return Ct("cellType",{cellType:i},t,e,this)}getCellType(t,e){let i;return i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,Ct("cellType",{cellType:i},t,e,this)}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return i==null?void 0:i.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const r=this.getHeaderDefine(t,e);if(!r||!r.field&&!r.columns)break;i.push(r),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){var i;if(!this.internalProps.layoutMap.isHeader(t,e))return(i=this.internalProps.dataSource)===null||i===void 0?void 0:i.get(this.getRecordShowIndexByCell(t,e))}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find(r=>r&&r.field===t.field);if(i)return e.getHeaderCellAdressById(i.id)}getCellRange(t,e){var i;if(this.internalProps.customMergeCell){const r=this.internalProps.customMergeCell(t,e,this);if(r&&r.range&&r.text)return r.range}return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(i.text||i.customLayout||this.customRender)){if(i.style){const r=this.internalProps.bodyHelper.getStyleClass("text"),o=i.style,s=zg(o,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},r,this.options.autoWrapText,this.theme);i.style=s}return i}}}isCellRangeEqual(t,e,i,r){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,r)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){var i;const r=this._getHeaderLayoutMap(t,e),o=r==null?void 0:r.define,s=(i=o==null?void 0:o.description)!==null&&i!==void 0?i:r==null?void 0:r.description;return typeof s=="function"?s({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)}):s}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isColumnHeader(t,e)}isRowHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRowHeader(t,e)}isCornerHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isCornerHeader(t,e)}isFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenColumn(t,e)}isLeftFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRightFrozenColumn(t,e)}isFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenRow(t,e)}isTopFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenRow(t,e)}isBottomFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:i==null?void 0:i.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){var r;if(t==null||this.internalProps.layoutMap.isHeader(e,i))return!1;const o=this.getRecordShowIndexByCell(e,i);return(r=this.internalProps.dataSource)===null||r===void 0?void 0:r.hasField(o,t)}_getCellStyle(t,e){var i,r,o,s,a,l,h,u,d;const c=this.customCellStylePlugin.getCustomCellStyle(t,e),{layoutMap:g}=this.internalProps;if(g.isHeader(t,e)){let y;if(!this.isPivotTable()||this.isBottomFrozenRow(e)||this.isRightFrozenColumn(t))y=`${t}-${e}`;else{const x=this.getHeaderDefine(t,e);y=x!=null&&x.dimensionKey?`dim-${x.dimensionKey}`:x!=null&&x.indicatorKey?`ind-${x.indicatorKey}`:`${t}-${e}`}let w=this.headerStyleCache.get(y);if(w)return c?Xa(w,c):w;const S=g.getHeader(t,e);let D;if(this.isPivotChart()&&dH(t,e,g)&&g.isAxisCell(t,e)?D=(r=(i=g.getBody(t,this.rowHeaderLevelCount).style)===null||i===void 0?void 0:i.padding)!==null&&r!==void 0?r:this.theme.bodyStyle.padding:this.isPivotChart()&&cH(t,e,g)&&g.isAxisCell(t,e)&&(D=(s=(o=g.getBody(this.columnHeaderLevelCount,e).style)===null||o===void 0?void 0:o.padding)!==null&&s!==void 0?s:this.theme.bodyStyle.padding),(!S||S.isEmpty)&&(g.isLeftBottomCorner(t,e)||g.isRightBottomCorner(t,e)||g.isCornerHeader(t,e)||g.isRightTopCorner(t,e)))return fO;const A=this.internalProps.headerHelper.getStyleClass((S==null?void 0:S.headerType)||"text");if(g.isBottomFrozenRow(t,e)&&this.theme.bottomFrozenStyle)w=tu(D?{padding:D}:{},this.theme.bottomFrozenStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},A,this.options.autoWrapText,this.theme);else if(g.isRightFrozenColumn(t,e)&&this.theme.rightFrozenStyle)w=tu(D?{padding:D}:{},this.theme.rightFrozenStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},A,this.options.autoWrapText,this.theme);else{const x=(S==null?void 0:S.style)||{};D&&(x.padding=D),w=tu(x,g.isColumnHeader(t,e)||g.isBottomFrozenRow(t,e)?this.theme.headerStyle:g.isRowHeader(t,e)||g.isRightFrozenColumn(t,e)?this.theme.rowHeaderStyle:this.theme.cornerHeaderStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},A,this.options.autoWrapText,this.theme)}return this.headerStyleCache.set(y,w),c?Xa(w,c):w}let f,p;!((l=(a=this.internalProps)===null||a===void 0?void 0:a.dataConfig)===null||l===void 0)&&l.mappingRules&&!this.isHeader(t,e)&&((d=(u=(h=this.internalProps)===null||h===void 0?void 0:h.dataConfig)===null||u===void 0?void 0:u.mappingRules)===null||d===void 0||d.forEach((y,w)=>{y.bgColor&&this.internalProps.layoutMap.getIndicatorKey(t,e)===y.bgColor.indicatorKey&&(f=y.bgColor.mapping)}));const v=this.getCellType(t,e);let m;if(p=this.isListTable()&&!this.transpose||this.isPivotTable()&&this.internalProps.layoutMap.indicatorsAsCol?t+v:e+v,m=g.isBottomFrozenRow(e)?this.bodyBottomStyleCache.get(p):this.bodyStyleCache.get(p),m)return c?Xa(m,c):m;const C=g.getBody(t,e),b=this.internalProps.bodyHelper.getStyleClass(this.getCellType(t,e)),_=C==null?void 0:C.style;return m=zg(_,g.isBottomFrozenRow(e)&&this.theme.bottomFrozenStyle?this.theme.bottomFrozenStyle:g.isRightFrozenColumn(t)&&this.theme.rightFrozenStyle?this.theme.rightFrozenStyle:this.theme.bodyStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},b,this.options.autoWrapText,this.theme),f&&(m=Xa(m,{bgColor:f})),ge(_)||(g.isBottomFrozenRow(e)?this.bodyBottomStyleCache.set(p,m):this.bodyStyleCache.set(p,m)),c?Xa(m,c):m}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0)||this.isCellRangeEqual(t,e,t+1,e)||this.internalProps.columnResizeMode==="none")return!1;if(this.internalProps.columnResizeMode==="header"){if(!this.isHeader(t,e))return!1}else if(this.internalProps.columnResizeMode==="body"&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canDragHeaderPosition(t,e){if(this.isHeader(t,e)&&this.stateManager.isSelected(t,e)){if(this.internalProps.frozenColDragHeaderMode==="disabled"&&(this.isFrozenColumn(t)||this.isRightFrozenColumn(t)))return!1;const i=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(i.end.row!==this.rowCount-1)return!1}else if(!this.isRowHeader(t,e)||i.end.col!==this.colCount-1)return!1;const r=this.getHeaderDefine(t,e);if(!r)return!1;if(r.dragHeader===void 0){if(this.internalProps.dragHeaderMode==="all")return!0;if(this.internalProps.dragHeaderMode==="column"){if(this.isColumnHeader(t,e))return!0}else if(this.internalProps.dragHeaderMode==="row"&&this.isRowHeader(t,e))return!0;return!1}return r.dragHeader}return!1}getCellIcons(t,e){let i;if(this.isHeader(t,e))i=this.internalProps.headerHelper.getIcons(t,e);else{const r=this.getCellValue(t,e),o=this.getCellOriginValue(t,e),s=this.internalProps.context;i=this.internalProps.bodyHelper.getIcons(t,e,r,o,s)}return i}showDropDownMenu(t,e,i){let r="dropdown-menu";i&&(r=Array.isArray(i.content)?"dropdown-menu":"container"),this.internalProps.menu.renderMode==="html"&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,r,i))}showTooltip(t,e,i){this.internalProps.tooltip.renderMode==="html"&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),r=io(i,this,t,e,Ct).theme,{autoWrapText:o,lineClamp:s,textOverflow:a}=i;return{textAlign:r.text.textAlign,textBaseline:r.text.textBaseline,bgColor:Li(r.group.fill)?Ct("bgColor",i,t,e,this):r.group.fill,color:Li(r.text.fill)?Ct("color",i,t,e,this):r.text.fill,fontFamily:r.text.fontFamily,fontSize:r.text.fontSize,fontWeight:r.text.fontWeight,fontVariant:r.text.fontVariant,fontStyle:r.text.fontStyle,lineHeight:r.text.lineHeight,autoWrapText:o!=null&&o,lineClamp:s!=null?s:"auto",textOverflow:a,borderColor:Li(r.group.stroke)?Ct("borderColor",i,t,e,this):r.group.stroke,borderLineWidth:r.group.lineWidth,borderLineDash:r.group.lineDash,underline:!!r.text.underline,underlineDash:r.text.underlineDash,underlineOffset:r.text.underlineOffset,lineThrough:!!r.text.lineThrough,padding:r._vtable.padding,underlineWidth:r.text.underline,lineThroughLineWidth:r.text.lineThrough,_strokeArrayWidth:r.group.strokeArrayWidth,_strokeArrayColor:r.group.strokeArrayColor,_linkColor:Ct("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,r=this.columnHeaderLevelCount,o=this.colCount-1,s=this.rowCount-1;return Array(Math.min(e!=null?e:2e3,s-r+1,this.rowCount)).fill(0).map((a,l)=>Array(Math.min(t!=null?t:2e3,o-i+1,this.colCount)).fill(0).map((h,u)=>this.getCellInfo(u+i,l+r)))}getAllCells(t,e){const o=this.colCount-1,s=this.rowCount-1;return Array(Math.min(e!=null?e:2e3,s-0+1,this.rowCount)).fill(0).map((a,l)=>Array(Math.min(t!=null?t:2e3,o-0+1,this.colCount)).fill(0).map((h,u)=>this.getCellInfo(u+0,l+0)))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=0,i=this.colCount-1,r=this.columnHeaderLevelCount-1;return Array(r-e+1).fill(0).map((o,s)=>Array(i-t+1).fill(0).map((a,l)=>this.getCellInfo(l+t,s+e)))}getAllRowHeaderCells(){const e=this.columnHeaderLevelCount,i=this.rowHeaderLevelCount-1,r=this.rowCount-1;return Array(r-e+1).fill(0).map((o,s)=>Array(i-0+1).fill(0).map((a,l)=>this.getCellInfo(l+0,s+e)))}scrollToCell(t){const e=this.getDrawRange();if(N(t.col)&&t.col>=this.frozenColCount){const i=this.getFrozenColsWidth(),r=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(r-i,this.getAllColsWidth()-e.width)}if(N(t.row)&&t.row>=this.frozenRowCount){const i=this.getFrozenRowsHeight(),r=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(r-i,this.getAllRowsHeight()-e.height)}this.render()}getCopyValue(){var t,e;if(((e=(t=this.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||e===void 0?void 0:e.length)>0){const i=this.stateManager.select.ranges;let r=Math.min(i[0].start.col,i[0].end.col),o=Math.max(i[0].start.col,i[0].end.col),s=Math.min(i[0].start.row,i[0].end.row),a=Math.max(i[0].start.row,i[0].end.row);i.forEach(g=>{r=Math.min(r,g.start.col,g.end.col),o=Math.max(o,g.start.col,g.end.col),s=Math.min(s,g.start.row,g.end.row),a=Math.max(a,g.start.row,g.end.row)});const l=g=>{let f=!1;return i.forEach(p=>{const v=Math.min(p.start.row,p.end.row),m=Math.max(p.start.row,p.end.row);v<=g&&m>=g&&(f=!0)}),f},h=g=>{let f=!1;return i.forEach(p=>{const v=Math.min(p.start.col,p.end.col),m=Math.max(p.start.col,p.end.col);v<=g&&m>=g&&(f=!0)}),f},u=(g,f)=>{let p;return i.forEach(v=>{const m=Math.min(v.start.row,v.end.row),C=Math.max(v.start.row,v.end.row),b=Math.min(v.start.col,v.end.col),_=Math.max(v.start.col,v.end.col);b<=g&&_>=g&&m<=f&&C>=f&&(p=v)}),p},d=(g,f,p)=>{const v=this.getCellRange(g,f);let m=v.start.col,C=v.start.row;if(p){const b=Math.min(p.start.col,p.end.col),_=Math.min(p.start.row,p.end.row);m=Math.max(b,v.start.col),C=Math.max(_,v.start.row)}return m!==g||C!==f?"":this.getCellValue(g,f)};let c="";for(let g=s;g<=a;g++)if(l(g)){for(let f=r;f<=o;f++)if(h(f)){const p=u(f,g);if(p){const v=d(f,g,p);if(!(typeof Promise!="undefined"&&v instanceof Promise)){const m=N(v)?`${v}`:"";/^\[object .*\]$/.exec(m)||(c+=m)}(f<p.end.col||f<o)&&(c+="	")}else c+="	"}g<a&&(c+=`\r
`)}return c}return""}getSelectedCellInfos(){var t;if(!(!((t=this.stateManager.select)===null||t===void 0)&&t.ranges))return null;const e=this.stateManager.select.ranges;if(!e.length)return[];let i=Math.min(e[0].start.col,e[0].end.col),r=Math.max(e[0].start.col,e[0].end.col),o=Math.min(e[0].start.row,e[0].end.row),s=Math.max(e[0].start.row,e[0].end.row);e.forEach(d=>{i=Math.min(i,d.start.col,d.end.col),r=Math.max(r,d.start.col,d.end.col),o=Math.min(o,d.start.row,d.end.row),s=Math.max(s,d.start.row,d.end.row)});const a=d=>{let c=!1;return e.forEach(g=>{const f=Math.min(g.start.row,g.end.row),p=Math.max(g.start.row,g.end.row);f<=d&&p>=d&&(c=!0)}),c},l=d=>{let c=!1;return e.forEach(g=>{const f=Math.min(g.start.col,g.end.col),p=Math.max(g.start.col,g.end.col);f<=d&&p>=d&&(c=!0)}),c},h=(d,c)=>{let g;return e.forEach(f=>{const p=Math.min(f.start.row,f.end.row),v=Math.max(f.start.row,f.end.row),m=Math.min(f.start.col,f.end.col),C=Math.max(f.start.col,f.end.col);m<=d&&C>=d&&p<=c&&v>=c&&(g=f)}),g},u=[];for(let d=o;d<=s;d++)if(a(d)){const c=[];for(let g=i;g<=r;g++)if(l(g)&&h(g,d)){const f=this.getCellInfo(g,d);c.push(f)}u.push(c)}return u}measureText(t,e){return R1.measureText(t,e)}getCustomRender(t,e){let i;if(this.getCellLocation(t,e)!=="body"){const r=this.getHeaderDefine(t,e);i=r==null?void 0:r.headerCustomRender}else{const r=this.getBodyColumnDefine(t,e);i=(r==null?void 0:r.customRender)||this.customRender}return i}getCustomLayout(t,e){let i;if(this.getCellLocation(t,e)!=="body"){const r=this.getHeaderDefine(t,e);i=r==null?void 0:r.headerCustomLayout}else{const r=this.getBodyColumnDefine(t,e);i=r==null?void 0:r.customLayout}return i}hasAutoImageColumn(){return this.internalProps.layoutMap.columnObjects.find(t=>!(t.cellType!=="image"&&typeof t.cellType!="function"||!t.define.imageAutoSizing))}_getActiveChartInstance(){var t,e,i,r,o,s;const a=this.scenegraph.getCell((e=(t=this.stateManager.hover)===null||t===void 0?void 0:t.cellPos)===null||e===void 0?void 0:e.col,(r=(i=this.stateManager.hover)===null||i===void 0?void 0:i.cellPos)===null||r===void 0?void 0:r.row);return((s=(o=a==null?void 0:a.getChildren())===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.type)==="chart"?a.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){const i=this.getDrawRange(),r=this.getCellRelativeRect(t,e);return t<this.frozenColCount&&e<this.frozenRowCount||r.top>=i.top&&r.bottom<=i.bottom&&r.left>=i.left&&r.right<=i.right}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:r}=i;return r}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e){var i,r,o,s;const a=this.cellIsInVisualView(t,e),{scrollTop:l,scrollLeft:h}=this;a||this.scrollToCell({col:t,row:e});const u=this.getCellRelativeRect(t,e);((r=(i=this.stateManager.select)===null||i===void 0?void 0:i.ranges)===null||r===void 0?void 0:r.length)>0&&CL(this.scenegraph);const{col:d,row:c}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1);const g=this.scenegraph.stage.toCanvas(!1,new me().set(u.left+this.tableX+1,u.top+this.tableY+1,u.right+this.tableX,u.bottom+this.tableY));return a||(this.setScrollTop(l),this.setScrollLeft(h)),((s=(o=this.stateManager.select)===null||o===void 0?void 0:o.ranges)===null||s===void 0?void 0:s.length)>0&&bL(this.scenegraph),this.stateManager.updateHoverPos(d,c),g.toDataURL()}exportCellRangeImg(t){const{scrollTop:e,scrollLeft:i}=this,r=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),s=Math.max(t.start.col,t.end.col),a=Math.max(t.start.row,t.end.row),l=this.cellIsInVisualView(r,o),h=this.cellIsInVisualView(s,a);l&&h||this.scrollToCell({col:r,row:o});const u=this.getCellRangeRelativeRect({start:{col:r,row:o},end:{col:s,row:a}}),d=this.scenegraph.stage.toCanvas(!1,new me().set(u.left+this.tableX+1,u.top+this.tableY+1,u.right+this.tableX,u.bottom+this.tableY)).toDataURL();return l&&h||(this.setScrollTop(e),this.setScrollLeft(i)),d}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(t="image/png"){if(this.options.mode!=="node")return;this.render();const e=this.scenegraph.stage;if(e){const i=this.tableX+this.getAllColsWidth(),r=this.tableY+this.getAllRowsHeight();return i>=this.canvasWidth&&r>=this.canvasHeight?(e.render(),e.window.getImageBuffer(t)):this.scenegraph.stage.toCanvas(!1,new me().set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,r))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),typeof e=="function"?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter(i=>i.callback!==e):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach(i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)})}registerCustomCellStyle(t,e){this.customCellStylePlugin.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e){this.customCellStylePlugin.arrangeCustomCellStyle(t,e)}}const nw={};function rw(n){if(nw[n])return nw[n]}function md(n,t,e){const i=n[t];return n[t]=e,i}function W5(n,t){return t!=null?md(themePlugins,n,t):themePlugins[n]}function N5(n,t){return t!=null?md(iconPlugins,n,t):iconPlugins[n]}function j5(n,t){return t!=null?md(chartTypePlugins,n,t):chartTypePlugins[n]}function V5(n,t){return t!=null?md(editors,n,t):editors[n]}function R0(n){for(const t in n)delete n[t]}function G5(){R0(themePlugins),R0(iconPlugins),R0(chartTypePlugins)}function pO(n,t,e){const i=(n+="").split(".");let r=i[0];const o=i.length>1?e+i[1]:"";return r=vO(r,t),r+o}function vO(n,t){return n.replace(/\d+/,function(e){return e.replace(/(\d)(?=(\d{3})+$)/g,function(i){return`${i}${t}`})})}function U5(n){return n=Object.assign({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},n),function(t){if(isNaN(t)||!isFinite(t))return"";const e=pO((n.scaler*t).toFixed(n.digitsAfterDecimal),n.thousandsSep,n.decimalSep);return`${n.prefix}${e}${n.suffix}`}}function K5(n,t,e,i,r){e==null&&(e=!1),i==null&&(i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),r==null&&(r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);const o=e?"UTC":"",s=function(a){return`0${a}`.substring(0,2)};return function(a){const l=new Date(Date.parse(a[n]));return t.replace(/%(.)/g,function(h,u){switch(u){case"y":return l[`get${o}FullYear`]();case"m":return s(l[`get${o}Month`]()+1);case"n":return i[l[`get${o}Month`]()];case"d":return s(l[`get${o}Date`]());case"w":return r[l[`get${o}Day`]()];case"x":return l[`get${o}Day`]();case"H":return s(l[`get${o}Hours`]());case"M":return s(l[`get${o}Minutes`]());case"S":return s(l[`get${o}Seconds`]());default:return`%${u}`}})}}const ow="NO_AXISID_FRO_VTABLE";function mO(n,t,e){var i,r;const o=e.getCellHeaderPaths(n,t);let s;if(e.indicatorsAsCol){const l=(i=o.colHeaderPaths.find(h=>h.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;s=e.columnObjects.find(h=>h.indicatorKey===l)}else{const l=(r=o.rowHeaderPaths.find(h=>h.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;s=e.columnObjects.find(h=>h.indicatorKey===l)}const a=s==null?void 0:s.chartSpec;return typeof a=="function"?a({col:n,row:t,dataValue:e._table.getCellOriginValue(n,t)||"",value:e._table.getCellValue(n,t)||"",rect:e._table.getCellRangeRelativeRect(e._table.getCellRange(n,t)),table:e._table}):a}function CO(n,t,e){var i,r;const o=e.getCellHeaderPaths(n,t);let s;if(e.indicatorsAsCol){const a=(i=o.colHeaderPaths.find(l=>l.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;s=e.columnObjects.find(l=>l.indicatorKey===a)}else{const a=(r=o.rowHeaderPaths.find(l=>l.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;s=e.columnObjects.find(l=>l.indicatorKey===a)}return typeof(s==null?void 0:s.chartSpec)!="function"}function Cd(n){let t=!1;for(let e=0;e<n.indicatorsDefine.length;e++){const i=n.indicatorsDefine[e];if(i.chartSpec&&i.chartSpec.type!=="pie"&&i.chartSpec.type!=="funnel"&&i.chartSpec.type!=="rose"){t=!0;break}}return t}function bO(n,t,e){let i=!0;const r=e.getRawChartSpec(n,t);return r&&r.type!=="pie"&&r.type!=="funnel"&&r.type!=="rose"||(i=!1),i}function ds(n,t,e,i){let r=!1;if(i.indicatorsAsCol&&e==="row"||!i.indicatorsAsCol&&e==="col")for(let o=0;o<i.indicatorsDefine.length;o++){const s=i.indicatorsDefine[o];if(s.chartSpec&&s.chartSpec.type!=="pie"&&s.chartSpec.type!=="funnel"&&s.chartSpec.type!=="rose"){r=!0;break}}else{const o=i.getRawChartSpec(n,t);o?o.type!=="pie"&&o.type!=="funnel"&&o.type!=="rose"&&(r=!0):r=!1}return r}function _O(n,t,e){let i=e.getRawChartSpec(n,t);return i?(e._table.isPivotChart()&&(i=Ot(i),i.sortDataByAxis=!0,rt(i.series)&&i.series.forEach(r=>{r.sortDataByAxis=!0}),i.axes=e.getChartAxes(n,t),i.padding=0,i.dataZoom=[]),i):null}function yO(n,t,e){var i;const r=[];if(e.indicatorsAsCol){const o=e.getIndicatorKeyInChartSpec(n,t),s=e.getColKeysPath(n,t);o.forEach((g,f)=>{const{range:p,isZeroAlign:v,axisOption:m}=bd(n,t,f,f===0?"bottom":"top",o,s,e);if(v){const C=bd(n,t,o.length-1-f,f===0?"top":"bottom",o,s,e);if(C){const{range:b}=C,_=es(p,b);_&&(p.min=_.range1[0],p.max=_.range1[1])}}lt(m==null?void 0:m.min)&&(p.min=m.min),lt(m==null?void 0:m.max)&&(p.max=m.max),r.push(gt({range:p},m,{type:(m==null?void 0:m.type)||"linear",orient:f===0?"bottom":"top",label:{visible:!1},title:{visible:!1},domainLine:{visible:!1},seriesIndex:f,sync:{axisId:ow}}))});let a=e.getDimensionKeyInChartSpec(e.rowHeaderLevelCount,t);rt(a)&&(a=a[0]);const l=e.dataset.cacheCollectedValues[a]||e.dataset.collectedValues[a]||[],h=e.getRowKeysPath(n,t),u=l[h!=null?h:""],{axisOption:d,isPercent:c}=is(n,t,"left",e);r.push(gt({domain:Array.from(u!=null?u:[])},d,{type:"band",orient:"left",label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}else{const o=e.getIndicatorKeyInChartSpec(n,t),s=e.getRowKeysPath(n,t);o.forEach((g,f)=>{const{range:p,isZeroAlign:v,axisOption:m}=bd(n,t,f,f===0?"left":"right",o,s,e);if(v){const C=bd(n,t,o.length-1-f,f===0?"right":"left",o,s,e);if(C){const{range:b}=C,_=es(p,b);_&&(p.min=_.range1[0],p.max=_.range1[1])}}lt(m==null?void 0:m.min)&&(p.min=m.min),lt(m==null?void 0:m.max)&&(p.max=m.max),r.push(gt({range:p},m,{type:(m==null?void 0:m.type)||"linear",orient:f===0?"left":"right",label:{visible:!1},title:{visible:!1},domainLine:{visible:!1},seriesIndex:f,sync:{axisId:ow}}))});let a=e.getDimensionKeyInChartSpec(n,e.columnHeaderLevelCount);rt(a)&&(a=a[0]);const l=e.dataset.cacheCollectedValues[a]||e.dataset.collectedValues[a]||[],h=e.getColKeysPath(n,t),u=(i=l==null?void 0:l[h!=null?h:""])!==null&&i!==void 0?i:[],{axisOption:d,isPercent:c}=is(n,t,"bottom",e);r.push(gt({domain:Array.from(u)},d,{type:"band",orient:"bottom",visible:!0,label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}return r}function sw(n,t,e){var i;const r=e.getRawChartSpec(n,t);if(r!=null&&r.series){const o={};return!((i=r.data)===null||i===void 0)&&i.id&&(o[r.data.id]=void 0),r==null||r.series.forEach(s=>{var a,l,h,u,d,c,g,f,p,v,m;if(!(!((a=s.data)===null||a===void 0)&&a.fromDataId))if(!((l=s.data)===null||l===void 0)&&l.transforms)o[(m=(p=(f=s.data)===null||f===void 0?void 0:f.id)!==null&&p!==void 0?p:(v=r.data)===null||v===void 0?void 0:v.id)!==null&&m!==void 0?m:"data"]=void 0;else{const C=s.direction==="horizontal"?s.xField:s.yField;o[(c=(u=(h=s.data)===null||h===void 0?void 0:h.id)!==null&&u!==void 0?u:(d=r.data)===null||d===void 0?void 0:d.id)!==null&&c!==void 0?c:"data"]=!((g=s.data)===null||g===void 0)&&g.id?C:void 0}}),o}return r.data.id}function bd(n,t,e,i,r,o,s){const{axisOption:a,isPercent:l,isZeroAlign:h,seriesIndice:u}=is(n,t,i,s),d=If(s.dataset.collectedValues,r,h,o,u!=null?u:e);if(l&&(d.min=d.min<0?-1:0,d.max=d.max>0?1:0),(a!=null&&a.zero||d.min===d.max)&&(d.min=Math.min(d.min,0),d.max=Math.max(d.max,0)),a==null?void 0:a.nice){const{range:c}=o1(d.min,d.max,a,h,s._table.getColWidth(n));d.min=c[0],d.max=c[1]}return lt(a==null?void 0:a.min)&&(d.min=a.min),lt(a==null?void 0:a.max)&&(d.max=a.max),{range:d,isZeroAlign:h,axisOption:a}}function aw(n){let t=!1;for(let e=0;e<n.columnObjects.length;e++)if(n.columnObjects[e].chartSpec){t=!0;break}return t}function wO(n){const t=n.columnObjects;for(let e=0;e<t.length;e++){const i=t[e];if(i!=null&&i.aggregation)return!0}return!1}function DO(n){const t=n.columnObjects;let e=0;for(let i=0;i<t.length;i++){const r=t[i];r!=null&&r.aggregation&&(Array.isArray(r==null?void 0:r.aggregation)?e=Math.max(e,r.aggregation.filter(o=>o.showOnTop===!0).length):r.aggregation.showOnTop===!0&&(e=Math.max(e,1)))}return e}function SO(n){const t=n.columnObjects;let e=0;for(let i=0;i<t.length;i++){const r=t[i];r!=null&&r.aggregation&&(Array.isArray(r==null?void 0:r.aggregation)?e=Math.max(e,r.aggregation.filter(o=>o.showOnTop===!1).length):r.aggregation.showOnTop===!1&&(e=Math.max(e,1)))}return e}class cs{constructor(t,e,i="grid",r=void 0){this.sizeIncludeParent=!1,this.tree={id:0,dimensionKey:"",value:"",children:[],level:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0},this.totalLevel=0,this.dimensionKeys=new Wo,this.cache=new Map,this.sizeIncludeParent=r!=null,this.rowExpandLevel=r,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t,e=!1){this.cache.clear(),this.dimensionKeys=new Wo,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree),this.totalLevel=this.dimensionKeys.count()}setTreeNode(t,e,i){var r,o;t.startIndex=e,t.startInTotal=((r=i.startInTotal)!==null&&r!==void 0?r:0)+t.startIndex,((o=t.dimensionKey)!==null&&o!==void 0?o:t.indicatorKey)&&(!this.dimensionKeys.contain(t.indicatorKey?qg:t.dimensionKey)&&this.dimensionKeys.put(t.level,t.indicatorKey?qg:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let s=t.dimensionKey&&this.sizeIncludeParent?1:0;const a=t.children||t.columns;return this.hierarchyType==="grid"?(a==null?void 0:a.length)>=1?a.forEach(l=>{var h;l.level=((h=t.level)!==null&&h!==void 0?h:0)+1,s+=this.setTreeNode(l,s,t)}):s=1:t.hierarchyState===Ft.expand&&(a==null?void 0:a.length)>=1?a.forEach(l=>{var h;l.level=((h=t.level)!==null&&h!==void 0?h:0)+1,s+=this.setTreeNode(l,s,t)}):t.hierarchyState===Ft.collapse&&(a==null?void 0:a.length)>=1?a.forEach(l=>{var h;l.level=((h=t.level)!==null&&h!==void 0?h:0)+1,this.setTreeNode(l,s,t)}):!t.hierarchyState&&t.level+1<this.rowExpandLevel&&(a==null?void 0:a.length)>=1?(t.hierarchyState=Ft.expand,a.forEach(l=>{var h;l.level=((h=t.level)!==null&&h!==void 0?h:0)+1,s+=this.setTreeNode(l,s,t)})):(a==null?void 0:a.length)>=1?(t.hierarchyState=Ft.collapse,a.forEach(l=>{var h;l.level=((h=t.level)!==null&&h!==void 0?h:0)+1,this.setTreeNode(l,s,t)})):(t.hierarchyState=Ft.none,s=1),t.size=s,s}getTreePath(t,e=30){const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}getTreePathByCellIds(t){const e=[];let i=this.tree.children;for(let r=0;r<t.length;r++){const o=t[r],s=this.findNodeById(i,o);if(!s)break;e.push(s),i=s.children}return e}findNodeById(t,e){return t.find(i=>i.id===e)}searchPath(t,e,i,r){if(!e||t<e.startIndex||t>=e.startIndex+e.size||(i.push(e),!e.children||e.children.length===0||e.level>=r))return;const o=t-e.startIndex;if(this.cache.has(e.level+1)){const l=this.cache.get(e.level+1);if(o>=l.startIndex&&o<l.startIndex+l.size)return void this.searchPath(o,l,i,r)}let s=0,a=e.children.length-1;for(;s<=a;){const l=Math.floor((s+a)/2),h=e.children[l];if(o>=h.startIndex&&o<h.startIndex+h.size){this.cache.set(h.level,h);const u=[];this.cache.forEach((d,c)=>{c>h.level&&u.push(c)}),u.forEach(d=>{this.cache.delete(d)}),this.searchPath(o,h,i,r);break}o<h.startIndex?a=l-1:s=l+1}}movePosition(t,e,i){let r,o,s;const a=(u,d)=>{if(o!==void 0&&s!==void 0)return;u.level===t&&(u.startInTotal===e&&(o=d),u.startInTotal<=i&&i<=u.startInTotal+u.size-1&&(s=d));const c=u.children||u.columns;if(c&&u.level<t){r=u;for(let g=0;g<c.length;g++)(e>=c[g].startInTotal&&e<=c[g].startInTotal+c[g].size||i>=c[g].startInTotal&&i<=c[g].startInTotal+c[g].size)&&a(c[g],g)}};a(this.tree,0);const l=r.children||r.columns,h=l.splice(o,1);h.unshift(s,0),Array.prototype.splice.apply(l,h)}getCopiedTree(){const t=Ot(this.tree.children);return lw(t),t}}function E0(n,t){t==null||t.forEach(e=>{const i={dimensionKey:e.dimensionKey,indicatorKey:e.indicatorKey,value:e.value,hierarchyState:e.hierarchyState,children:void 0};n.push(i),e.children&&(i.children=[],E0(i.children,e.children))})}function _d(n,t){let e=0;return n==null||n.forEach(i=>{t?e++:i.children&&i.children.length!==0||e++,i.children&&(e+=_d(i.children,t))}),e}function AO(n,t,e,i,r,o){var s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T;const R=n.id,M=(a=(s=o.rowsDefine)===null||s===void 0?void 0:s.find(I=>typeof I!="string"&&I.dimensionKey===n.dimensionKey))!==null&&a!==void 0?a:(l=o.columnsDefine)===null||l===void 0?void 0:l.find(I=>typeof I!="string"&&I.dimensionKey===n.dimensionKey),E=(h=o.indicatorsDefine)===null||h===void 0?void 0:h.find(I=>typeof I!="string"&&(n.indicatorKey?I.indicatorKey===n.indicatorKey:I.title===n.value)),P={id:R,title:(u=n.value)!==null&&u!==void 0?u:E==null?void 0:E.title,field:n.dimensionKey,style:typeof((d=E!=null?E:M)===null||d===void 0?void 0:d.headerStyle)=="function"?(c=E!=null?E:M)===null||c===void 0?void 0:c.headerStyle:Object.assign({},(g=E!=null?E:M)===null||g===void 0?void 0:g.headerStyle),headerType:(p=(f=E==null?void 0:E.headerType)!==null&&f!==void 0?f:M==null?void 0:M.headerType)!==null&&p!==void 0?p:"text",headerIcon:(v=E==null?void 0:E.headerIcon)!==null&&v!==void 0?v:M==null?void 0:M.headerIcon,define:Object.assign({},n,E!=null?E:M),fieldFormat:(m=E==null?void 0:E.headerFormat)!==null&&m!==void 0?m:M==null?void 0:M.headerFormat,dropDownMenu:(C=E==null?void 0:E.dropDownMenu)!==null&&C!==void 0?C:M==null?void 0:M.dropDownMenu,pivotInfo:{value:n.value,dimensionKey:n.dimensionKey,isPivotCorner:!1},width:M==null?void 0:M.width,minWidth:M==null?void 0:M.minWidth,maxWidth:M==null?void 0:M.maxWidth,showSort:(b=E==null?void 0:E.showSort)!==null&&b!==void 0?b:M==null?void 0:M.showSort,description:M==null?void 0:M.description};E?(E.customRender&&(n.customRender=E.customRender),N((_=o._indicators)===null||_===void 0?void 0:_.find(I=>I.indicatorKey===E.indicatorKey))||(y=o._indicators)===null||y===void 0||y.push({id:++o.sharedVar.seqId,indicatorKey:E.indicatorKey,field:E.indicatorKey,fieldFormat:E==null?void 0:E.format,cellType:(S=(w=E==null?void 0:E.cellType)!==null&&w!==void 0?w:E==null?void 0:E.columnType)!==null&&S!==void 0?S:"text",chartModule:"chartModule"in E?E.chartModule:null,chartSpec:"chartSpec"in E?E.chartSpec:null,sparklineSpec:"sparklineSpec"in E?E.sparklineSpec:null,style:E==null?void 0:E.style,icon:E==null?void 0:E.icon,define:Object.assign({},n,E,{dragHeader:M==null?void 0:M.dragHeader}),width:E==null?void 0:E.width,minWidth:E==null?void 0:E.minWidth,maxWidth:E==null?void 0:E.maxWidth,disableColumnResize:E==null?void 0:E.disableColumnResize})):n.indicatorKey&&(N((D=o._indicators)===null||D===void 0?void 0:D.find(I=>I.indicatorKey===n.indicatorKey))||(A=o._indicators)===null||A===void 0||A.push({id:++o.sharedVar.seqId,indicatorKey:n.indicatorKey,field:n.indicatorKey,cellType:"text",define:Object.assign({},n)})),e[R]=P,o._headerObjects[R]=P,t[r][o.colIndex]=R;for(let I=r-1;I>=0;I--)t[I][o.colIndex]=i[I];if(n.levelSpan>1)for(let I=1;I<n.levelSpan;I++)t[r+I]||(t[r+I]=[]),t[r+I][o.colIndex]=R;if(((x=n.children)===null||x===void 0?void 0:x.length)>=1)o._addHeaders(t,r+((B=n.levelSpan)!==null&&B!==void 0?B:1),(F=n.children)!==null&&F!==void 0?F:[],[...i,...Array((T=n.levelSpan)!==null&&T!==void 0?T:1).fill(R)]).forEach(I=>e.push(I));else{for(let I=r+1;I<t.length;I++)t[I][o.colIndex]=R;o.colIndex++}}function xO(n,t,e,i,r,o,s,a,l){var h,u,d,c;const g=n.id,f=a.find(v=>typeof v!="string"&&v.dimensionKey===n.dimensionKey),p={id:g,title:n.value,field:n.dimensionKey,style:n.level+1===o||typeof(f==null?void 0:f.headerStyle)=="function"?f==null?void 0:f.headerStyle:Object.assign({},f==null?void 0:f.headerStyle,{textAlign:"left"}),headerType:(h=f==null?void 0:f.headerType)!==null&&h!==void 0?h:"text",headerIcon:f==null?void 0:f.headerIcon,define:Object.assign(n,{linkJump:f==null?void 0:f.linkJump,linkDetect:f==null?void 0:f.linkDetect,templateLink:f==null?void 0:f.templateLink,keepAspectRatio:(u=f==null?void 0:f.keepAspectRatio)!==null&&u!==void 0&&u,imageAutoSizing:f==null?void 0:f.imageAutoSizing,headerCustomRender:f==null?void 0:f.headerCustomRender,headerCustomLayout:f==null?void 0:f.headerCustomLayout,dragHeader:f==null?void 0:f.dragHeader,disableHeaderHover:!!(f!=null&&f.disableHeaderHover),disableHeaderSelect:!!(f!=null&&f.disableHeaderSelect)}),fieldFormat:f==null?void 0:f.headerFormat,dropDownMenu:f==null?void 0:f.dropDownMenu,pivotInfo:{value:n.value,dimensionKey:n.dimensionKey,isPivotCorner:!1},hierarchyLevel:n.level,dimensionTotalLevel:o,hierarchyState:n.level+1===o?void 0:n.hierarchyState,width:f==null?void 0:f.width,minWidth:f==null?void 0:f.minWidth,maxWidth:f==null?void 0:f.maxWidth,parentCellId:i[i.length-1]};e[g]=p,l._headerObjects[g]=p,t[r][l.colIndex]=g;for(let v=r-1;v>=0;v--)t[v][l.colIndex]=i[v];if(n.hierarchyState===Ft.expand&&((d=n.children)===null||d===void 0?void 0:d.length)>=1)s&&l.colIndex++,l._addHeadersForTreeMode(t,r,(c=n.children)!==null&&c!==void 0?c:[],[...i,g],o,s&&n.hierarchyState===Ft.expand,a).forEach(v=>e.push(v));else{s&&l.colIndex++;for(let v=r+1;v<t.length;v++)t[v][l.colIndex]=g}}function lw(n){for(let t=0;t<n.length;t++){const e=n[t];delete e.level,delete e.startIndex,delete e.id,delete e.levelSpan,delete e.size,delete e.startInTotal;const i=e.children||e.columns;i&&lw(i)}}class BO{constructor(t,e,i,r){this.seqId=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._headerCellIds=[],this.hierarchyIndent=r!=null?r:20,this.columnTree=new cs(e,{seqId:0}),this._headerObjects=this._addHeaders(0,e,[]),this._headerObjectMap=this._headerObjects.reduce((o,s)=>(o[s.id]=s,o),{}),this._hasAggregation=wO(this),this._hasAggregationOnBottomCount=SO(this),this._hasAggregationOnTopCount=DO(this)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isHeader(t,e){return!!(this.transpose&&t>=0&&t<this.headerLevelCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount){if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0}if(this.hasAggregationOnTopCount){if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount){if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount){if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0}return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregators(t,e){return this.getBody(t,e).aggregator}getAggregatorOnTop(t,e){const i=this.getBody(t,e),r=i.aggregator,o=i.aggregation;if(Array.isArray(o)){const s=o.reduce((a,l,h)=>(l.showOnTop&&a.push(h),a),[]).map(a=>r[a]);return this.transpose?s[t-this.rowHeaderLevelCount]:s[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?o!=null&&o.showOnTop?r:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:o!=null&&o.showOnTop?r:null}getAggregatorOnBottom(t,e){const i=this.getBody(t,e),r=i.aggregator,o=i.aggregation;if(Array.isArray(o)){const s=o.reduce((a,l,h)=>(l.showOnTop===!1&&a.push(h),a),[]).map(a=>r[a]);return this.transpose?s[t-(this.colCount-this.hasAggregationOnBottomCount)]:s[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?(o==null?void 0:o.showOnTop)===!1?r:null:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0?null:(o==null?void 0:o.showOnTop)===!1?r:null}getCellAddressHasAggregator(t,e){const i=[];if(this.transpose){const r=this.hasAggregationOnTopCount;for(let s=0;s<r;s++)i.push({col:this.headerLevelCount+s,row:e});const o=this.hasAggregationOnBottomCount;for(let s=0;s<o;s++)i.push({col:this.rowCount-o+s,row:e})}else{const r=this.hasAggregationOnTopCount;for(let s=0;s<r;s++)i.push({col:t,row:this.headerLevelCount+s});const o=this.hasAggregationOnBottomCount;for(let s=0;s<o;s++)i.push({col:t,row:this.rowCount-o+s})}return i}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=0&&t<=this.headerLevelCount-1)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1}isFrozenColumn(t,e){if(N(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(N(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(N(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(N(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftBottomCorner(t,e){return t>=0&&t<this.rowHeaderLevelCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.columnHeaderLevelCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var t,e,i,r;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:((t=this.colCount)!==null&&t!==void 0?t:0)-1,row:((e=this.rowCount)!==null&&e!==void 0?e:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:((i=this.colCount)!==null&&i!==void 0?i:0)-1,row:((r=this.rowCount)!==null&&r!==void 0?r:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount:this._columns.length}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get columnWidths(){return this._columns}getColumnWidthDefined(t){var e;if(this.transpose){let i,r,o=0;if(t>=this.rowHeaderLevelCount){let s;return this.columnObjects.forEach((a,l)=>{typeof a.width=="number"?o=Math.max(a.width,o):a.width==="auto"&&(s=!0),typeof a.minWidth=="number"&&(r=Math.max(a.minWidth,r)),typeof a.maxWidth=="number"&&(i=Math.max(a.maxWidth,i))}),o=o>0?o:s?"auto":void 0,{width:o,minWidth:r,maxWidth:i}}if(this.isRowHeader(t,0)){const s=Array.isArray(this._table.defaultHeaderColWidth)?(e=this._table.defaultHeaderColWidth[t])!==null&&e!==void 0?e:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return s==="auto"?{width:"auto"}:{width:s}}}return this._columns[t]}getCellId(t,e){var i,r,o,s;return this.transpose?this.headerLevelCount<=t?(i=this._columns[e])===null||i===void 0?void 0:i.id:(r=this._headerCellIds[t])===null||r===void 0?void 0:r[e]:this.headerLevelCount<=e?(o=this._columns[t])===null||o===void 0?void 0:o.id:(s=this._headerCellIds[e])===null||s===void 0?void 0:s[t]}getHeader(t,e){const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){var i;const r=this.getCellId(t,e);return((i=this._headerObjectMap[r])===null||i===void 0?void 0:i.field)||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t]&&this._columns[t].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return this.transpose?{col:e,row:r}:{col:r,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find(i=>i&&i.field===t);return this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.transpose?this._columns[e]:this._columns[t]}getBodyLayoutRangeById(t){var e,i;if(this.transpose){for(let r=0;r<((e=this.rowCount)!==null&&e!==void 0?e:0);r++)if(t===this._columns[r].id)return{start:{col:0,row:r},end:{col:0,row:r}}}else for(let r=0;r<((i=this.colCount)!==null&&i!==void 0?i:0);r++)if(t===this._columns[r].id)return{start:{col:r,row:0},end:{col:r,row:0}};throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){var i,r,o;if(t===-1||e===-1)return{start:{col:t,row:e},end:{col:t,row:e}};if(this._cellRangeMap.has(`$${t}$${e}`))return this._cellRangeMap.get(`$${t}$${e}`);let s={start:{col:t,row:e},end:{col:t,row:e}};if(this.transpose)s=this.getCellRangeTranspose(t,e);else if(this.headerLevelCount<=e){if(this.headerLevelCount<=e&&(!((r=(i=this.columnObjects[t])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const a=this._table.getCellValue(t,e);for(let l=e-1;l>=this.headerLevelCount;l--){const h=this._table.getCellValue(t,l);if(typeof this.columnObjects[t].define.mergeCell=="boolean"){if(a!==h)break}else if(!this.columnObjects[t].define.mergeCell(a,h))break;s.start.row=l}for(let l=e+1;l<this.rowCount;l++){const h=this._table.getCellValue(t,l);if(typeof this.columnObjects[t].define.mergeCell=="boolean"){if(a!==h)break}else if(!this.columnObjects[t].define.mergeCell(a,h))break;s.end.row=l}}}else{const a=this.getCellId(t,e);for(let l=t-1;l>=0&&a===this.getCellId(l,e);l--)s.start.col=l;for(let l=t+1;l<((o=this.colCount)!==null&&o!==void 0?o:0)&&a===this.getCellId(l,e);l++)s.end.col=l;for(let l=e-1;l>=0&&a===this.getCellId(t,l);l--)s.start.row=l;for(let l=e+1;l<this.headerLevelCount&&a===this.getCellId(t,l);l++)s.end.row=l}return this._cellRangeMap.set(`$${t}$${e}`,s),s}getCellRangeTranspose(t,e){var i,r,o,s;const a={start:{col:t,row:e},end:{col:t,row:e}};if(this.headerLevelCount<=t||t===-1&&e===-1){if(this.headerLevelCount<=t&&(!((r=(i=this.columnObjects[e])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const h=this._table.getCellValue(t,e);for(let u=t-1;u>=this.headerLevelCount;u--){const d=this._table.getCellValue(u,e);if(typeof this.columnObjects[e].define.mergeCell=="boolean"){if(h!==d)break}else if(!this.columnObjects[e].define.mergeCell(h,d))break;a.start.col=u}for(let u=t+1;u<((o=this.colCount)!==null&&o!==void 0?o:0);u++){const d=this._table.getCellValue(u,e);if(typeof this.columnObjects[e].define.mergeCell=="boolean"){if(h!==d)break}else if(!this.columnObjects[e].define.mergeCell(h,d))break;a.end.col=u}}return a}const l=this.getCellId(t,e);for(let h=e-1;h>=0&&l===this.getCellId(t,h);h--)a.start.row=h;for(let h=e+1;h<((s=this.rowCount)!==null&&s!==void 0?s:0)&&l===this.getCellId(t,h);h++)a.end.row=h;for(let h=t-1;h>=0&&l===this.getCellId(h,e);h--)a.start.col=h;for(let h=t+1;h<this.headerLevelCount&&l===this.getCellId(h,e);h++)a.end.col=h;return a}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),s=this.getCellRange(i,r);return o.start.col===s.start.col&&o.end.col===s.end.col&&o.start.row===s.start.row&&o.end.row===s.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_addHeaders(t,e,i,r){const o=[],s=this._newRow(t,r);return e.forEach(a=>{var l,h,u,d;const c=this._columns.length,g=this.seqId++,f={id:g,title:(l=a.title)!==null&&l!==void 0?l:a.caption,headerIcon:a.headerIcon,field:a.field,style:a.headerStyle,headerType:(h=a.headerType)!==null&&h!==void 0?h:"text",dropDownMenu:a.dropDownMenu,define:a,columnWidthComputeMode:a.columnWidthComputeMode};o[g]=f;for(let p=t-1;p>=0;p--)this._headerCellIds[p]&&(this._headerCellIds[p][c]=i[p]);if(r?this._headerCellIds[t-1]&&(s[c]=this._headerCellIds[t-1][c]):s[c]=g,a.columns)this._addHeaders(t+1,a.columns,[...i,g],a.hideColumnsSubHeader||r).forEach(p=>o.push(p));else{const p=a;this._columns.push({id:this.seqId++,field:p.field,fieldFormat:p.fieldFormat,width:p.width,minWidth:p.minWidth,maxWidth:p.maxWidth,icon:p.icon,cellType:(d=(u=p.cellType)!==null&&u!==void 0?u:p.columnType)!==null&&d!==void 0?d:"text",chartModule:"chartModule"in p?p.chartModule:null,chartSpec:"chartSpec"in p?p.chartSpec:null,sparklineSpec:"sparklineSpec"in p?p.sparklineSpec:qR,style:p.style,define:p,columnWidthComputeMode:p.columnWidthComputeMode,disableColumnResize:p==null?void 0:p.disableColumnResize,aggregation:this._getAggregationForColumn(p,c)});for(let v=t+1;v<this._headerCellIds.length;v++)this._headerCellIds[v][c]=g}}),o}_getAggregationForColumn(t,e){let i;return t.aggregation?i=t.aggregation:this._table.options.aggregation&&(i=typeof this._table.options.aggregation=="function"?this._table.options.aggregation({col:e,field:t.field}):this._table.options.aggregation),i?Array.isArray(i)?i.map(r=>(N(r.showOnTop)||(r.showOnTop=!1),r)):Object.assign({showOnTop:!1},i):null}_newRow(t,e=!1){if(this._headerCellIds[t]){const o=this._headerCellIds[t-1];if(o.length>this._headerCellIds[t].length)for(let s=this._headerCellIds[t].length;s<o.length;s++)this._headerCellIds[t][s]=o[s];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const r=this._headerCellIds[t-1];for(let o=0;o<r.length;o++)i[o]=r[o];return i}getCellHeaderPaths(t,e){let i=[],r=[];return this.transpose?r=[{field:this._columns[e].field}]:i=[{field:this._columns[t].field}],{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(e!==0)return this.isColumnHeader(t,e)?this.getCellId(t,e-1):this.isRowHeader(t,e)?this.getCellId(t-1,e):void 0}canMoveHeaderPosition(t,e){if(t.col<0||t.row<0||e.col<0||e.row<0||this._table.internalProps.frozenColDragHeaderMode==="disabled"&&(this._table.isFrozenColumn(e.col)||this._table.isRightFrozenColumn(e.col)))return!1;const i=this.getCellRange(t.col,t.row);return this.isColumnHeader(t.col,t.row)?this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row):this.isRowHeader(t.col,t.row)?this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row):!1}moveHeaderPosition(t,e){if(this.canMoveHeaderPosition(t,e)){const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const r=i.end.col-i.start.col+1;let o;const s=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?s.end.col-r+1:s.start.col,o===i.start.col)return null;for(let l=0;l<this._headerCellIds.length;l++){const h=this._headerCellIds[l].splice(i.start.col,r);h.unshift(o,0),Array.prototype.splice.apply(this._headerCellIds[l],h)}const a=this._columns.splice(i.start.col,r);return a.unshift(o,0),Array.prototype.splice.apply(this._columns,a),this.columnTree.movePosition(i.start.row,i.start.col,o),this.columnTree.reset(this.columnTree.tree.children,!0),this._cellRangeMap=new Map,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:s.end.col-s.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)){const r=i.end.row-i.start.row+1;let o;const s=this.getCellRange(i.start.col,e.row);if(o=e.row>=t.row?s.end.row-r+1:s.start.row,o===i.start.row)return null;for(let l=0;l<this._headerCellIds.length;l++){const h=this._headerCellIds[l].splice(i.start.row,r);h.unshift(o,0),Array.prototype.splice.apply(this._headerCellIds[l],h)}const a=this._columns.splice(i.start.row,r);return a.unshift(o,0),Array.prototype.splice.apply(this._columns,a),this.columnTree.movePosition(i.start.col,i.start.row,o),this.columnTree.reset(this.columnTree.tree.children,!0),this._cellRangeMap=new Map,{sourceIndex:i.start.row,targetIndex:o,sourceSize:r,targetSize:s.end.row-s.start.row+1,moveType:"row"}}}return null}toggleHierarchyState(t){return{addCellPositions:t.add.map(e=>({col:0,row:this._table.frozenRowCount+e})),removeCellPositions:t.remove.map(e=>({col:0,row:this._table.frozenRowCount+e}))}}setChartInstance(t,e,i){const r=this.transpose?this._columns[e]:this._columns[t];typeof r.chartSpec!="function"&&(r.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t]).chartInstance}checkHasChart(){return aw(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e);return typeof(i==null?void 0:i.chartSpec)!="function"}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),r=i==null?void 0:i.chartSpec;return typeof r=="function"?r({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table}):r}getChartDataId(t,e){return sw(t,e,this)}release(){const t=this._table._getActiveChartInstance();t==null||t.release(),this.columnObjects.forEach(e=>{var i;(i=e.chartInstance)===null||i===void 0||i.release()})}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const r=this._table.internalProps.layoutMap.getHeader(t,e);r.title=i,r.define.title=i}getColumnByField(t){var e;return(e=this.columnObjects)===null||e===void 0?void 0:e.reduce((i,r,o)=>(r.field===t&&i.push({col:o,columnDefine:r}),i),[])}}function FO(){Dn(),Yh(),Ih()}FO();class yd extends Nn{constructor(t,e){super(e!=null&&e.skipDefault?t:gt({},yd.defaultAttributes,t)),this.name="title"}render(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k,H,O,z,j,U,W,V;const{textType:L,text:G,subtextType:K,textStyle:Y={},subtext:nt,subtextStyle:q={},width:ot,height:at,minWidth:et,maxWidth:ft,minHeight:tt,maxHeight:dt,align:J,verticalAlign:it,padding:_t=0}=this.attribute,Xt=Wn(_t),ae=this.createOrUpdateChild("title-container",{x:Xt[3],y:Xt[0],zIndex:1},"group");if(this.attribute.visible!==!1&&Y.visible!==!1)if(L==="rich"||N(Y.character)){const ce=Object.assign({x:(t=Y.x)!==null&&t!==void 0?t:0,y:(e=Y.y)!==null&&e!==void 0?e:0,width:(r=(i=Y.width)!==null&&i!==void 0?i:ot)!==null&&r!==void 0?r:0,height:(s=(o=Y.height)!==null&&o!==void 0?o:at)!==null&&s!==void 0?s:0,ellipsis:(a=Y.ellipsis)===null||a===void 0||a,wordBreak:(l=Y.wordBreak)!==null&&l!==void 0?l:"break-word",maxHeight:Y.maxHeight,maxWidth:Y.maxWidth,textConfig:(h=Y.character)!==null&&h!==void 0?h:G},Y);this._mainTitle=ae.createOrUpdateChild("mainTitle",ce,"richtext")}else if(L==="html"){const ce=Object.assign({html:Object.assign(Object.assign({dom:G},Hb),Y),x:(u=Y.x)!==null&&u!==void 0?u:0,y:(d=Y.y)!==null&&d!==void 0?d:0,width:(g=(c=Y.width)!==null&&c!==void 0?c:ot)!==null&&g!==void 0?g:0,height:(p=(f=Y.height)!==null&&f!==void 0?f:at)!==null&&p!==void 0?p:0,ellipsis:(v=Y.ellipsis)===null||v===void 0||v,wordBreak:(m=Y.wordBreak)!==null&&m!==void 0?m:"break-word",maxHeight:Y.maxHeight,maxWidth:Y.maxWidth,textConfig:[]},Y);this._mainTitle=ae.createOrUpdateChild("mainTitle",ce,"richtext")}else N(G)&&(this._mainTitle=ae.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:rt(G)?G:[G]},Y),{maxLineWidth:(C=Y.maxLineWidth)!==null&&C!==void 0?C:ot,heightLimit:Y.heightLimit,lineClamp:Y.lineClamp,ellipsis:(b=Y.ellipsis)===null||b===void 0||b,x:0,y:0}),"wrapText"));const Vt=this._mainTitle?this._mainTitle.AABBBounds.height():0,pn=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&q.visible!==!1)if(K==="rich"||N(q.character)){const ce=Object.assign({x:(_=q.x)!==null&&_!==void 0?_:0,y:(y=q.y)!==null&&y!==void 0?y:0,width:(S=(w=q.width)!==null&&w!==void 0?w:ot)!==null&&S!==void 0?S:0,height:(A=(D=q.height)!==null&&D!==void 0?D:at)!==null&&A!==void 0?A:0,ellipsis:(x=q.ellipsis)===null||x===void 0||x,wordBreak:(B=q.wordBreak)!==null&&B!==void 0?B:"break-word",maxHeight:q.maxHeight,maxWidth:q.maxWidth,textConfig:(F=q.character)!==null&&F!==void 0?F:nt},q);this._subTitle=ae.createOrUpdateChild("subTitle",ce,"richtext")}else if(K==="html"){const ce=Object.assign({html:Object.assign(Object.assign({dom:nt},Hb),q),x:(T=q.x)!==null&&T!==void 0?T:0,y:(R=q.y)!==null&&R!==void 0?R:0,width:(E=(M=q.width)!==null&&M!==void 0?M:ot)!==null&&E!==void 0?E:0,height:(I=(P=q.height)!==null&&P!==void 0?P:at)!==null&&I!==void 0?I:0,ellipsis:(k=q.ellipsis)===null||k===void 0||k,wordBreak:(H=q.wordBreak)!==null&&H!==void 0?H:"break-word",maxHeight:q.maxHeight,maxWidth:q.maxWidth,textConfig:[]},q);this._subTitle=ae.createOrUpdateChild("subTitle",ce,"richtext")}else N(nt)&&(this._subTitle=ae.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:rt(nt)?nt:[nt]},q),{maxLineWidth:(O=q.maxLineWidth)!==null&&O!==void 0?O:ot,heightLimit:q.heightLimit,lineClamp:q.lineClamp,ellipsis:(z=q.ellipsis)===null||z===void 0||z,x:0,y:Vt}),"wrapText"));const k0=this._subTitle?this._subTitle.AABBBounds.height():0,qa=this._subTitle?this._subTitle.AABBBounds.width():0;let Hr=Math.max(pn,qa),pr=Vt+((j=q.height)!==null&&j!==void 0?j:k0);if(N(ot)&&(Hr=ot,this._mainTitle&&this._mainTitle.setAttribute("maxLineWidth",ot),this._subTitle&&this._subTitle.setAttribute("maxLineWidth",ot)),N(at)&&(pr=at),N(et)&&Hr<et&&(Hr=et),N(ft)&&(this._mainTitle&&this._mainTitle.setAttribute("maxLineWidth",ft),this._subTitle&&this._subTitle.setAttribute("maxLineWidth",ft),this._mainTitle&&this._mainTitle.setAttribute("maxWidth",ft),this._subTitle&&this._subTitle.setAttribute("maxWidth",ft),Hr>ft&&(Hr=ft)),N(tt)&&pr<tt&&(pr=tt),N(dt)&&(this._mainTitle&&this._mainTitle.setAttribute("maxHeight",dt),this._subTitle&&this._subTitle.setAttribute("maxHeight",dt-Vt),pr>dt&&(pr=dt)),ae.attribute.width=Hr,ae.attribute.height=pr,ae.attribute.boundsPadding=Xt,this._mainTitle){if(N(J)||N(Y.align)){const ce=Y.align?Y.align:J,He=(U=Y.width)!==null&&U!==void 0?U:pn;ce==="left"?(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left")):ce==="center"?(this._mainTitle.setAttribute("x",He/2),this._mainTitle.setAttribute("textAlign","center")):ce==="right"&&(this._mainTitle.setAttribute("x",He),this._mainTitle.setAttribute("textAlign","right"))}if(N(it)||N(Y.verticalAlign)){const ce=Y.verticalAlign?Y.verticalAlign:it,He=Y.height?Y.height:pr;ce==="top"?(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top")):ce==="middle"?(this._mainTitle.setAttribute("y",He/2),this._mainTitle.setAttribute("textBaseline","middle")):ce==="bottom"&&(this._mainTitle.setAttribute("y",He),this._mainTitle.setAttribute("textBaseline","bottom"))}}if(this._subTitle){if(N(J)||N(q.align)){const ce=q.align?q.align:J,He=(W=q.width)!==null&&W!==void 0?W:qa;ce==="left"?(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left")):ce==="center"?(this._subTitle.setAttribute("x",He/2),this._subTitle.setAttribute("textAlign","center")):ce==="right"&&(this._subTitle.setAttribute("x",He),this._subTitle.setAttribute("textAlign","right"))}if(N(it)||N(Y.verticalAlign)){const ce=q.verticalAlign?q.verticalAlign:it,He=Vt,fs=(V=q.height)!==null&&V!==void 0?V:0;ce==="top"?(this._subTitle.setAttribute("y",He),this._subTitle.setAttribute("textBaseline","top")):ce==="middle"?(this._subTitle.setAttribute("y",He+fs/2),this._subTitle.setAttribute("textBaseline","middle")):ce==="bottom"&&(this._subTitle.setAttribute("y",He+fs),this._subTitle.setAttribute("textBaseline","bottom"))}}}}yd.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};class gs{constructor(t,e){this.isReleased=!1,this.table=e,this._titleOption=t,t.visible!==!1&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)cr(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new yd(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){var t,e,i,r,o;if(!this._titleComponent)return;const s=$t((t=this._titleOption.padding)!==null&&t!==void 0?t:10),a=(e=this._titleOption.width)!==null&&e!==void 0?e:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-s[1]-s[3],l=(i=this._titleOption.height)!==null&&i!==void 0?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-s[0]-s[2];this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((o=this._titleOption.y)!==null&&o!==void 0?o:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?a:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?l:this._titleOption.height,textStyle:Object.assign({width:a},this._titleOption.textStyle),subtextStyle:Object.assign({width:a},this._titleOption.subtextStyle)}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){var e,i,r,o;const s=isFinite((e=this._titleComponent)===null||e===void 0?void 0:e.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,a=isFinite((i=this._titleComponent)===null||i===void 0?void 0:i.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;this._titleOption.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(s),this.table.tableX+=Math.ceil(s)):this._titleOption.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(a),this.table.tableY+=Math.ceil(a)):this._titleOption.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(s):this._titleOption.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(a)),this._cacheAttrs=t,this._titleOption.orient!=="right"&&this._titleOption.orient!=="bottom"||this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:((o=this._titleOption.y)!==null&&o!==void 0?o:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){var t,e,i,r,o,s,a,l,h;const u=this._titleOption.text||this._titleOption.subtext?10:0,d=$t((t=this._titleOption.padding)!==null&&t!==void 0?t:u),c=(e=this._titleOption.width)!==null&&e!==void 0?e:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-d[1]-d[3],g=(i=this._titleOption.height)!==null&&i!==void 0?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-d[0]-d[2];return{text:(r=this._titleOption.text)!==null&&r!==void 0?r:"",subtext:(o=this._titleOption.subtext)!==null&&o!==void 0?o:"",x:((s=this._titleOption.x)!==null&&s!==void 0?s:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((a=this._titleOption.y)!==null&&a!==void 0?a:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?c:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?g:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:(l=this._titleOption.align)!==null&&l!==void 0?l:"left",verticalAlign:(h=this._titleOption.verticalAlign)!==null&&h!==void 0?h:"top",textStyle:Object.assign({width:c},this._titleOption.textStyle),subtextStyle:Object.assign({width:c},this._titleOption.subtextStyle)}}}class hw{constructor(t){this.table=t,this.bindEvent()}bindEvent(){const t=this.table.internalProps.handler;this.table.on(Q.DBLCLICK_CELL,e=>{var i;if(!this.table.options.editCellTrigger||this.table.options.editCellTrigger==="doubleclick"){const{col:r,row:o}=e,s=Je(e.federatedEvent),a=this.table.scenegraph.getResizeColAt(s.abstractPos.x,s.abstractPos.y,(i=s.eventArgs)===null||i===void 0?void 0:i.targetCell);if(this.table._canResizeColumn(a.col,a.row)&&a.col>=0)return;this.startEditCell(r,o)}}),this.table.on(Q.CLICK_CELL,e=>{if(this.table.options.editCellTrigger==="click"){const{col:i,row:r}=e;this.startEditCell(i,r)}}),t.on(this.table.getElement(),"wheel",e=>{this.completeEdit()})}startEditCell(t,e){var i,r,o,s,a;if(this.table.isPivotTable()&&this.table.isHeader(t,e))return;const l=this.table.getEditor(t,e);if(l){if(this.table.getCustomRender(t,e)||this.table.getCustomLayout(t,e))return;if(!this.table.isHeader(t,e)){const c=this.table.getCellRange(t,e);if(c.start.col!==c.end.col||c.start.row!==c.end.row)return}if(!((r=(i=this.table.internalProps.layoutMap)===null||i===void 0?void 0:i.isAggregation)===null||r===void 0)&&r.call(i,t,e))return;this.editingEditor=l,this.editCell={col:t,row:e};const h=this.table.getCellOriginValue(t,e),u=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),d={rect:{left:u.left,top:u.top,width:u.width,height:u.height}};l.beginEditing,(o=l.beginEditing)===null||o===void 0||o.call(l,this.table.getElement(),d,h),l.bindSuccessCallback,(s=l.bindSuccessCallback)===null||s===void 0||s.call(l,()=>{this.completeEdit()}),(a=l.onStart)===null||a===void 0||a.call(l,{value:h,endEdit:()=>{this.completeEdit()},referencePosition:d,container:this.table.getElement(),col:t,row:e})}}completeEdit(t){var e,i,r,o,s,a;if(!this.editingEditor)return;const l=t==null?void 0:t.target,{editingEditor:h}=this;if(l){if(h.targetIsOnEditor){if(h.targetIsOnEditor(l))return}else if(!h.isEditorElement||h.isEditorElement(l))return}this.editingEditor.getValue;const u=(i=(e=this.editingEditor).getValue)===null||i===void 0?void 0:i.call(e);this.table.changeCellValue(this.editCell.col,this.editCell.row,u),this.editingEditor.exit,(o=(r=this.editingEditor).exit)===null||o===void 0||o.call(r),(a=(s=this.editingEditor).onEnd)===null||a===void 0||a.call(s),this.editingEditor=null}cancelEdit(){var t,e,i,r;this.editingEditor&&((e=(t=this.editingEditor).exit)===null||e===void 0||e.call(t),(r=(i=this.editingEditor).onEnd)===null||r===void 0||r.call(i),this.editingEditor=null)}}class uw extends M0{constructor(t,e){var i,r,o;Pt.mode==="node"?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e),this.showHeader=!0;const s=this.internalProps;s.frozenColDragHeaderMode=e.frozenColDragHeaderMode,this.pagination=e.pagination,s.sortState=e.sortState,s.dataConfig={},s.columns=e.columns?Ot(e.columns):e.header?Ot(e.header):[],(i=e.columns)===null||i===void 0||i.forEach((a,l)=>{a.editor&&(s.columns[l].editor=a.editor)}),this.showHeader=(r=e.showHeader)===null||r===void 0||r,this.transpose=(o=e.transpose)!==null&&o!==void 0&&o,Pt.mode!=="node"&&(this.editorManager=new hw(this)),this.refreshHeader(),e.dataSource?xf(this,e.dataSource):e.records?this.setRecords(e.records,{sortState:s.sortState}):this.setRecords([]),e.title&&(s.title=new gs(e.title,this),this.scenegraph.resize()),setTimeout(()=>{this.fireListeners(Q.INITIALIZED,null)},0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var t;return(t=this.dataSource)===null||t===void 0?void 0:t.source}get recordsCount(){return this.dataSource.source.length}updateColumns(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=Ot(t),t.forEach((i,r)=>{i.editor&&(this.internalProps.columns[r].editor=i.editor)}),this.options.columns=t,this.refreshHeader(),this.scenegraph.clearCells(),this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.renderAsync(),this.eventManager.updateEventBinder()}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,this.options.header=t,this.refreshHeader(),this.renderAsync()}get transpose(){var t;return(t=this.internalProps.transpose)!==null&&t!==void 0&&t}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.options.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e){if(t===-1||e===-1)return null;const i=this.getCustomMergeValue(t,e);if(i)return i;const r=this;if(r.internalProps.layoutMap.isHeader(t,e)){const{title:a}=r.internalProps.layoutMap.getHeader(t,e);return typeof a=="function"?a():a}if(r.internalProps.layoutMap.isAggregation(t,e)){if(r.internalProps.layoutMap.isTopAggregation(t,e)){const a=r.internalProps.layoutMap.getAggregatorOnTop(t,e);return a!=null&&a.formatValue?a.formatValue(t,e,this):""}if(r.internalProps.layoutMap.isBottomAggregation(t,e)){const a=r.internalProps.layoutMap.getAggregatorOnBottom(t,e);return a!=null&&a.formatValue?a.formatValue(t,e,this):""}}const{field:o,fieldFormat:s}=r.internalProps.layoutMap.getBody(t,e);return r.getFieldData(s||o,t,e)}getCellOriginValue(t,e){if(t===-1||e===-1)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getHeader(t,e);return typeof o=="function"?o():o}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const o=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return o==null?void 0:o.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const o=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return o==null?void 0:o.value()}}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(r,t,e)}getCellRawValue(t,e){if(t===-1||e===-1)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getHeader(t,e);return typeof o=="function"?o():o}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(r,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,r=i.getRecordShowIndexByCell(t,e);return this.dataSource.currentPagerIndexedData[r]}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find(r=>r.field===t),i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.get(r)}getCellRawRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.getRaw(r)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const r=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)return!1}return i}updateOption(t){var e,i;const r=this.internalProps;return super.updateOption(t),r.frozenColDragHeaderMode=t.frozenColDragHeaderMode,this.pagination=t.pagination,r.dataConfig={},this.showHeader=(e=t.showHeader)===null||e===void 0||e,r.columns=t.columns?Ot(t.columns):t.header?Ot(t.header):[],t.columns.forEach((o,s)=>{o.editor&&(r.columns[s].editor=o.editor)}),this.transpose=(i=t.transpose)!==null&&i!==void 0&&i,this.refreshHeader(),r.releaseList&&(r.releaseList.forEach(o=>{var s;return(s=o==null?void 0:o.release)===null||s===void 0?void 0:s.call(o)}),r.releaseList=null),t.dataSource?xf(this,t.dataSource):t.records?this.setRecords(t.records,{restoreHierarchyState:t.restoreHierarchyState,sortState:t.sortState}):(this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title&&(r.title=new gs(t.title,this),this.scenegraph.resize()),new Promise(o=>{setTimeout(o,0)})}updatePagination(t){this.pagination&&(typeof t.currentPage=="number"&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var t,e,i;const r=this,o=r.internalProps,s=r.transpose,a=r.showHeader,l=o.layoutMap=new BO(this,(t=o.columns)!==null&&t!==void 0?t:[],a,r.options.hierarchyIndent);if(l.transpose=s,!s)for(let h=0;h<l.columnWidths.length;h++){const{width:u,minWidth:d,maxWidth:c}=(i=(e=l.columnWidths)===null||e===void 0?void 0:e[h])!==null&&i!==void 0?i:{};u&&(typeof u=="string"&&u!=="auto"||typeof u=="number"&&u>0)&&r._setColWidth(h,u),d&&(typeof d=="number"&&d>0||typeof d=="string")&&r.setMinColWidth(h,d),c&&(typeof c=="number"&&c>0||typeof c=="string")&&r.setMaxColWidth(h,c)}this.refreshRowColCount()}refreshRowColCount(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f;const p=this,{layoutMap:v}=p.internalProps;v&&(v.recordsCount=((e=(t=p.internalProps.dataSource)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0)+v.hasAggregationOnTopCount+v.hasAggregationOnBottomCount,p.transpose?(p.rowCount=(i=v.rowCount)!==null&&i!==void 0?i:0,p.colCount=v.recordsCount*v.bodyRowSpanCount+v.headerLevelCount,p.frozenRowCount=0,this.internalProps.frozenColCount=(r=v.headerLevelCount)!==null&&r!==void 0?r:0,p.bottomFrozenRowCount!==((o=this.options.bottomFrozenRowCount)!==null&&o!==void 0?o:0)&&(p.bottomFrozenRowCount=(s=this.options.bottomFrozenRowCount)!==null&&s!==void 0?s:0),p.rightFrozenColCount!==((a=this.options.rightFrozenColCount)!==null&&a!==void 0?a:0)&&(p.rightFrozenColCount=(l=this.options.rightFrozenColCount)!==null&&l!==void 0?l:0)):(p.colCount=(h=v.colCount)!==null&&h!==void 0?h:0,p.rowCount=v.recordsCount*v.bodyRowSpanCount+v.headerLevelCount,this.internalProps.frozenColCount=(u=this.options.frozenColCount)!==null&&u!==void 0?u:0,p.frozenRowCount=v.headerLevelCount,p.bottomFrozenRowCount!==((d=this.options.bottomFrozenRowCount)!==null&&d!==void 0?d:0)&&(p.bottomFrozenRowCount=(c=this.options.bottomFrozenRowCount)!==null&&c!==void 0?c:0),p.rightFrozenColCount!==((g=this.options.rightFrozenColCount)!==null&&g!==void 0?g:0)&&(p.rightFrozenColCount=(f=this.options.rightFrozenColCount)!==null&&f!==void 0?f:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}getFieldData(t,e,i){if(t===null||this.internalProps.layoutMap.isHeader(e,i))return null;const r=this.getRecordShowIndexByCell(e,i);return this.internalProps.dataSource.getField(r,t,e,i,this)}getRawFieldData(t,e,i){if(t===null||this.internalProps.layoutMap.isHeader(e,i))return null;const r=this.getRecordShowIndexByCell(e,i);return this.internalProps.dataSource.getRawField(r,t,e,i,this)}_moveHeaderPosition(t,e){var i,r;const o=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(o){if(o.moveType==="column"){if(this.colWidthsMap.adjustOrder(o.sourceIndex,o.targetIndex,o.sourceSize),!this.transpose){this.colWidthsLimit={};for(let l=0;l<this.internalProps.layoutMap.columnWidths.length;l++){const{minWidth:h,maxWidth:u}=(r=(i=this.internalProps.layoutMap.columnWidths)===null||i===void 0?void 0:i[l])!==null&&r!==void 0?r:{};h&&(typeof h=="number"&&h>0||typeof h=="string")&&this.setMinColWidth(l,h),u&&(typeof u=="number"&&u>0||typeof u=="string")&&this.setMaxColWidth(l,u)}}const s=Math.min(o.sourceIndex,o.targetIndex),a=Math.max(o.sourceIndex,o.targetIndex);for(let l=s;l<=a;l++)this._clearColRangeWidthsMap(l)}else{const s=Math.min(o.sourceIndex,o.targetIndex),a=Math.max(o.sourceIndex,o.targetIndex);for(let l=s;l<=a;l++)this._clearRowRangeHeightsMap(l)}return o}return null}getCellAddress(t,e){let i;for(let o=0;o<this.internalProps.records.length;o++){const s=this.internalProps.records[o];if(typeof t=="function")t(s)&&(i=o);else{let a=!0;for(const l in t)if(s[l]!==t[l]){a=!1;break}a&&(i=o)}if(N(i))break}const r=this.getCellRangeByField(e,i);if(r)return{row:r.start.row,col:r.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,r=i.columnObjects.find(o=>o.field===t);if(r){const o=i.getBodyLayoutRangeById(r.id);let s;return N(e)&&(s=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:o.start.row,col:N(s)?s+o.start.col:void 0},end:{row:o.end.row,col:N(s)?s+o.end.col:void 0}}:{start:{col:o.start.col,row:N(s)?s+o.start.row:void 0},end:{col:o.end.col,row:N(s)?s+o.end.row:void 0}}}return null}getHierarchyState(t,e){if(!this.getBodyColumnDefine(t,e).tree)return Ft.none;const i=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(i)}toggleHierarchyState(t,e){const i=this.getHierarchyState(t,e);if(i===Ft.expand)this._refreshHierarchyState(t,e),this.fireListeners(Q.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Ft.collapse});else if(i===Ft.collapse){const r=this.getCellOriginRecord(t,e);Array.isArray(r.children)&&this._refreshHierarchyState(t,e),this.fireListeners(Q.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Ft.expand,originData:r})}}_refreshHierarchyState(t,e){let i=!1,r=!1;const o=this.internalProps.layoutMap.checkHasChart();o&&(this.autoFillWidth&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(r=this.getAllRowsHeight()<=this.tableNoFrameHeight));const s=this.getRecordShowIndexByCell(t,e),a=this.dataSource.toggleHierarchyState(s),l=this.internalProps.layoutMap.toggleHierarchyState(a);this.refreshRowColCount(),this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.scenegraph.updateHierarchyIcon(t,e),this.scenegraph.updateRow(l.removeCellPositions,l.addCellPositions),o&&(this.autoFillWidth&&!i&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!r&&(r=this.getAllRowsHeight()<=this.tableNoFrameHeight),(this.widthMode==="adaptive"||i||this.heightMode==="adaptive"||r)&&this.scenegraph.updateChartSize(0))}_hasHierarchyTreeHeader(){var t,e;return(e=(t=this.options.columns)!==null&&t!==void 0?t:this.options.header)===null||e===void 0?void 0:e.some((i,r)=>i.tree)}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if((i&&i===o.fieldKey||!i&&o.field===e)&&o.sort&&typeof o.sort=="function")return o.sort;if(o.columns){const s=this._getSortFuncFromHeaderOption(o.columns,e,i);if(s)return s}}}updateSortState(t,e=!0){var i;if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let s=0;s<this.internalProps.sortState.length;s++)this.internalProps.sortState[s].order="normal";else this.internalProps.sortState.order="normal";let r,o;if(Array.isArray(this.internalProps.sortState)?{order:r,field:o}=(i=this.internalProps.sortState)===null||i===void 0?void 0:i[0]:{order:r,field:o}=this.internalProps.sortState,o&&e){const s=this._getSortFuncFromHeaderOption(this.internalProps.columns,o),a=this.internalProps.layoutMap.headerObjects.find(l=>l&&l.field===o);a.define.sort!==!1&&(this.dataSource.sort(a.field,r,s),this.internalProps.layoutMap.clearCellRangeMap(),this.scenegraph.sortCell())}this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.internalProps.dataConfig.filterRules=t,this.sortState?(this.dataSource.updateFilterRulesForSorted(t),wa(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.scenegraph.createSceneGraph()}getCheckboxState(t){return this.stateManager.checkedState.length<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),N(t)?this.stateManager.checkedState.map(e=>e[t]):this.stateManager.checkedState}getCellCheckboxState(t,e){const i=this.getBodyColumnDefine(t,e),r=i==null?void 0:i.field,o=this.getCellType(t,e);if(N(r)&&o==="checkbox"){const s=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e));return this.stateManager.checkedState[s][r]}}setRecords(t,e){var i,r,o,s,a,l,h,u;let d;Array.isArray(e)||e!=null&&e.order?d=e:e?d=e.sortState:e===null&&(d=null),typeof window!="undefined"&&window.performance.now();const c={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.scenegraph.clearCells(),d!==void 0&&(this.internalProps.sortState=d,this.stateManager.setSortState(this.sortState));const g=(i=this.dataSource)===null||i===void 0?void 0:i._currentPagerIndexedData,f=(r=this.dataSource)===null||r===void 0?void 0:r.currentIndexedData,p=(o=this.dataSource)===null||o===void 0?void 0:o.treeDataHierarchyState,v=(a=(s=this.records)===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0;if(t){if(K_(this,t),this.sortState){let m,C;if(Array.isArray(this.sortState)?this.sortState.length!==0&&({order:m,field:C}=(l=this.sortState)===null||l===void 0?void 0:l[0]):{order:m,field:C}=this.sortState,m&&C&&m!=="normal"){const b=this._getSortFuncFromHeaderOption(void 0,C),_=this.internalProps.layoutMap.headerObjects.find(y=>y&&y.field===C);_.define.sort!==!1&&this.dataSource.sort(_.field,m,b!=null?b:Ug)}}e!=null&&e.restoreHierarchyState&&v===((h=this.records)===null||h===void 0?void 0:h.length)&&(this.dataSource._currentPagerIndexedData=g,this.dataSource.currentIndexedData=f,this.dataSource.treeDataHierarchyState=p),this.refreshRowColCount()}else K_(this,t),e!=null&&e.restoreHierarchyState&&v===((u=this.records)===null||u===void 0?void 0:u.length)&&(this.dataSource._currentPagerIndexedData=g,this.dataSource.currentIndexedData=f,this.dataSource.treeDataHierarchyState=p);this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(c.col,c.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.render()}setRecordChildren(t,e,i){const r=this.getCellOriginRecord(e,i);r.children=t;const o=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(r,o),this._refreshHierarchyState(e,i)}startEditCell(t,e){var i;if(N(t)&&N(e))this.selectCell(t,e),this.editorManager.startEditCell(t,e);else if(!((i=this.stateManager.select)===null||i===void 0)&&i.cellPos){const{col:r,row:o}=this.stateManager.select.cellPos;N(r)&&N(o)&&this.editorManager.startEditCell(r,o)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){var i,r;const o=this.getBodyColumnDefine(t,e);let s=this.isHeader(t,e)?(i=o==null?void 0:o.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=o==null?void 0:o.editor)!==null&&r!==void 0?r:this.options.editor;return typeof s=="function"&&(s=s({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),typeof s=="string"?rw(s):s}isHasEditorDefine(t,e){var i,r;const o=this.getBodyColumnDefine(t,e);let s=this.isHeader(t,e)?(i=o==null?void 0:o.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=o==null?void 0:o.editor)!==null&&r!==void 0?r:this.options.editor;return typeof s=="function"&&(s=s({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),N(s)}changeCellValue(t,e,i){const r=this.getRecordShowIndexByCell(t,e),{field:o}=this.internalProps.layoutMap.getBody(t,e),s=this.getCellRawValue(t,e);this.isHeader(t,e)?this.internalProps.layoutMap.updateColumnTitle(t,e,i):this.dataSource.changeFieldValue(i,r,o,t,e,this);const a=this.internalProps.layoutMap.getAggregators(t,e);if(a){if(Array.isArray(a))for(let u=0;u<(a==null?void 0:a.length);u++)a[u].recalculate();else a.recalculate();const h=this.internalProps.layoutMap.getCellAddressHasAggregator(t,e);for(let u=0;u<h.length;u++){const d=this.getCellRange(h[u].col,h[u].row);for(let c=d.start.col;c<=d.end.col;c++)for(let g=d.start.row;g<=d.end.row;g++)this.scenegraph.updateCellContent(c,g)}}const l=this.getCellRange(t,e);for(let h=l.start.col;h<=l.end.col;h++)for(let u=l.start.row;u<=l.end.row;u++)this.scenegraph.updateCellContent(h,u);if(this.widthMode==="adaptive"||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)this.internalProps._widthResizedColMap.size===0&&this.scenegraph.recalculateColWidths();else if(!this.internalProps._widthResizedColMap.has(t)){const h=this.getColWidth(t),u=Er(t,0,this.rowCount-1,this,!1);u!==h&&this.scenegraph.updateColWidth(t,u-h)}if(this.heightMode==="adaptive"||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if(this.heightMode==="autoHeight"){const h=this.getRowHeight(e),u=Ui(e,0,this.colCount-1,this);this.scenegraph.updateRowHeight(e,u-h)}this.fireListeners(Q.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:s,changedValue:this.getCellOriginValue(t,e)}),this.scenegraph.updateNextFrame()}changeCellValues(t,e,i,r=!1){let o=t,s=e;for(let h=0;h<i.length&&!(e+h>this.rowCount-1);h++){s=e+h;const u=i[h];let d=t;for(let c=0;c<u.length&&!(t+c>this.colCount-1);c++)if(d=t+c,r&&this.isHasEditorDefine(t+c,e+h)||r===!1){const g=u[c],f=this.getRecordShowIndexByCell(t+c,e+h),{field:p}=this.internalProps.layoutMap.getBody(t+c,e+h),v=this.getCellRawValue(t+c,e+h);this.isHeader(t+c,e+h)?this.internalProps.layoutMap.updateColumnTitle(t+c,e+h,g):this.dataSource.changeFieldValue(g,f,p,t+c,e+h,this),this.fireListeners(Q.CHANGE_CELL_VALUE,{col:t+c,row:e+h,rawValue:v,changedValue:this.getCellOriginValue(t+c,e+h)})}o=Math.max(o,d)}const a=this.getCellRange(t,e),l=this.getCellRange(o,s);for(let h=a.start.col;h<=l.end.col;h++)for(let u=a.start.row;u<=l.end.row;u++)this.scenegraph.updateCellContent(h,u);if(this.widthMode==="adaptive"||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)this.internalProps._widthResizedColMap.size===0&&this.scenegraph.recalculateColWidths();else for(let h=t;h<=l.end.col;h++)if(!this.internalProps._widthResizedColMap.has(h)){const u=this.getColWidth(h),d=Er(h,0,this.rowCount-1,this,!1);d!==u&&this.scenegraph.updateColWidth(h,d-u)}if(this.heightMode==="adaptive"||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if(this.heightMode==="autoHeight"){const h=[],u=[];for(let d=e;d<=l.end.row;d++)if(this.rowHeightsMap.get(d)){const c=this.getRowHeight(d),g=Ui(d,0,this.colCount-1,this);h.push(d),u.push(g-c)}this.scenegraph.updateRowsHeight(h,u)}this.scenegraph.updateNextFrame()}addRecord(t,e){if(this.sortState)this.dataSource.addRecordForSorted(t),wa(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{(e===void 0||e>this.dataSource.sourceLength)&&(e=this.dataSource.sourceLength);const i=this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount;this.dataSource.addRecord(t,e);const r=this.rowCount;if(this.refreshRowColCount(),this.scenegraph.proxy.totalActualBodyRowCount===0)return this.scenegraph.clearCells(),void this.scenegraph.createSceneGraph();const o=this.transpose?this.colCount:this.rowCount;if(this.pagination){const{perPageCount:s,currentPage:a}=this.pagination,l=s*(a||0)+s;if(e<l)if(e<l-s)this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const h=e-(l-s)+i;if(r-i===this.pagination.perPageCount){const u=[];for(let d=h;d<o;d++)this.transpose?u.push({col:d,row:0}):u.push({col:0,row:d});this.transpose?this.scenegraph.updateCol([],[],u):this.scenegraph.updateRow([],[],u)}else{const u=[];for(let d=h;d<Math.min(o,h+1);d++)this.transpose?u.push({col:d,row:0}):u.push({col:0,row:d});this.transpose?this.scenegraph.updateCol([],u,[]):this.scenegraph.updateRow([],u,[])}}}else{const s=[];for(let a=e+i;a<e+i+1;a++)this.transpose?s.push({col:a,row:0}):s.push({col:0,row:a});this.transpose?this.scenegraph.updateCol([],s,[]):this.scenegraph.updateRow([],s,[])}}}addRecords(t,e){if(this.sortState)this.dataSource.addRecordsForSorted(t),wa(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{e===void 0||e>this.dataSource.sourceLength?e=this.dataSource.sourceLength:e<0&&(e=0);const i=this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount;this.dataSource.addRecords(t,e);const r=this.transpose?this.colCount:this.rowCount;if(this.refreshRowColCount(),this.scenegraph.proxy.totalActualBodyRowCount===0)return this.scenegraph.clearCells(),void this.scenegraph.createSceneGraph();const o=this.transpose?this.colCount:this.rowCount;if(this.pagination){const{perPageCount:s,currentPage:a}=this.pagination,l=s*(a||0)+s;if(e<l)if(e<l-s)this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const h=e-(l-s)+i;if(r-i===this.pagination.perPageCount){const u=[];for(let d=h;d<o;d++)this.transpose?u.push({col:d,row:0}):u.push({col:0,row:d});this.transpose?this.scenegraph.updateCol([],[],u):this.scenegraph.updateRow([],[],u)}else{const u=[];for(let d=h;d<Math.min(o,h+(Array.isArray(t)?t.length:1));d++)this.transpose?u.push({col:d,row:0}):u.push({col:0,row:d});this.transpose?this.scenegraph.updateCol([],u,[]):this.scenegraph.updateRow([],u,[])}}}else{const s=[];for(let a=e+i;a<e+i+(Array.isArray(t)?t.length:1);a++)this.transpose?s.push({col:a,row:0}):s.push({col:0,row:a});this.transpose?this.scenegraph.updateCol([],s,[]):this.scenegraph.updateRow([],s,[])}}}deleteRecords(t){if((t==null?void 0:t.length)>0)if(this.sortState)this.dataSource.deleteRecordsForSorted(t),wa(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const e=this.dataSource.deleteRecords(t);if(e.length===0)return;const i=this.transpose?this.colCount:this.rowCount;this.refreshRowColCount();const r=this.transpose?this.colCount:this.rowCount,o=e.sort((a,l)=>a-l),s=o[0];if(this.pagination){const{perPageCount:a,currentPage:l}=this.pagination,h=a*(l||0)+a;if(s<h)if(s<h-a)this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const u=[],d=[];for(let c=s-(h-a)+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);c<r;c++)this.transpose?u.push({col:c,row:0}):u.push({col:0,row:c});if(r<i)for(let c=r;c<i;c++)this.transpose?d.push({col:c,row:0}):d.push({col:0,row:c});this.transpose?this.scenegraph.updateCol(d,[],u):this.scenegraph.updateRow(d,[],u)}}else{const a=[];for(let l=0;l<o.length;l++){const h=o[l]+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);this.transpose?a.push({col:h,row:0}):a.push({col:0,row:h})}this.transpose?this.scenegraph.updateCol(a,[],[]):this.scenegraph.updateRow(a,[],[])}}}updateRecords(t,e){if((e==null?void 0:e.length)>0)if(this.sortState)this.dataSource.updateRecordsForSorted(t,e),wa(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const i=this.dataSource.updateRecords(t,e);if(i.length===0)return;const r=i.sort((o,s)=>o-s);if(this.pagination){const{perPageCount:o,currentPage:s}=this.pagination,a=o*(s||0)+o,l=[];for(let h=0;h<r.length;h++){const u=r[h];if(u<a&&u>=a-o){const d=u-(a-o)+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);l.push(d)}}if(l.length>=1){const h=[];for(let u=0;u<l.length;u++){const d=l[u];this.transpose?h.push({col:d,row:0}):h.push({col:0,row:d})}this.transpose?this.scenegraph.updateCol([],[],h):this.scenegraph.updateRow([],[],h)}}else{const o=[];for(let s=0;s<r.length;s++){const a=r[s]+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);this.transpose?o.push({col:a,row:0}):o.push({col:0,row:a})}this.transpose?this.scenegraph.updateCol([],[],o):this.scenegraph.updateRow([],[],o)}}}_hasCustomRenderOrLayout(){var t,e,i,r;const{headerObjects:o}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let s=0;s<o.length;s++){const a=o[s];if(!((t=a==null?void 0:a.define)===null||t===void 0)&&t.customLayout||!((e=a==null?void 0:a.define)===null||e===void 0)&&e.headerCustomLayout||!((i=a==null?void 0:a.define)===null||i===void 0)&&i.customRender||!((r=a==null?void 0:a.define)===null||r===void 0)&&r.headerCustomRender)return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let r=0;r<e.length;r++){const o=e[r].columnDefine.aggregator;if(delete e[r].columnDefine,o){const s={col:e[r].col,aggregateValue:null};if(s.aggregateValue=[],Array.isArray(o))for(let a=0;a<o.length;a++)s.aggregateValue.push({aggregationType:o[a].type,value:o[a].value()});else s.aggregateValue.push({aggregationType:o.type,value:o.value()});i.push(s)}}return i}}const dw={startInTotal:0,level:0};class Pr{constructor(t,e){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b;if(this.colIndex=0,this._showHeader=!0,this.columnHeaderObjs=[],this.rowHeaderObjs=[],this._cornerHeaderCellIds=[],this._columnHeaderCellIds=[],this._rowHeaderCellIds=[],this._rowHeaderCellIds_FULL=[],this._columnWidths=[],this.columnPaths=[],this._headerObjects=[],this._headerObjectMap={},this._indicators=[],this.indicatorsAsCol=!0,this.hideIndicatorName=!1,this._showRowHeader=!0,this._showColumnHeader=!0,this._indicatorShowType="column",this.rowDimensionKeys=[],this.colDimensionKeys=[],this.indicatorKeys=[],this.indicatorDimensionKey=qg,this._rowHeaderExtensionTree={},this._extensionRowDimensionKeys=[],this.fullRowDimensionKeys=[],this.sharedVar={seqId:0},this._table=t,t.options.rowHierarchyType==="tree"&&(this.extensionRows=t.options.extensionRows),this.dataset=e,this._largeCellRangeCache=[],this._CellHeaderPathMap=new Map,this.rowTree=t.internalProps.rowTree,this.columnTree=t.internalProps.columnTree,this.rowsDefine=(i=t.internalProps.rows)!==null&&i!==void 0?i:[],this.columnsDefine=(r=t.internalProps.columns)!==null&&r!==void 0?r:[],this.indicatorsDefine=(o=t.internalProps.indicators)!==null&&o!==void 0?o:[],this.indicatorTitle=t.options.indicatorTitle,this.indicatorsAsCol=(s=t.options.indicatorsAsCol)===null||s===void 0||s,this.hideIndicatorName=(a=t.options.hideIndicatorName)!==null&&a!==void 0&&a,this.showRowHeader=(l=t.options.showRowHeader)===null||l===void 0||l,this.showColumnHeader=(h=t.options.showColumnHeader)===null||h===void 0||h,this.rowHeaderTitle=t.options.rowHeaderTitle,this.columnHeaderTitle=t.options.columnHeaderTitle,this.rowHierarchyType=(u=t.options.rowHierarchyType)!==null&&u!==void 0?u:"grid",this.rowExpandLevel=(d=t.options.rowExpandLevel)!==null&&d!==void 0?d:1,this.rowHierarchyIndent=(c=t.options.rowHierarchyIndent)!==null&&c!==void 0?c:20,this.cornerSetting=(g=t.options.corner)!==null&&g!==void 0?g:{titleOnDimension:"column"},e&&(this.rowTree=e.rowHeaderTree,this.columnTree=e.colHeaderTree,this.indicatorsAsCol&&this._table.isPivotChart()&&Cd(this))){const _=y=>{y.forEach(w=>{var S;!((S=w.children)===null||S===void 0)&&S.length?_(w.children):w.children=[{dimensionKey:"axis",value:""}]})};!((f=this.rowTree)===null||f===void 0)&&f.length?_(this.rowTree):this.rowTree=[{dimensionKey:"axis",value:""}]}if((p=this.indicatorsDefine)===null||p===void 0||p.forEach(_=>{typeof _=="string"?this.indicatorKeys.push(_):this.indicatorKeys.push(_.indicatorKey)}),this.columnDimensionTree=new cs((v=this.columnTree)!==null&&v!==void 0?v:[],this.sharedVar),this.rowDimensionTree=new cs((m=this.rowTree)!==null&&m!==void 0?m:[],this.sharedVar,this.rowHierarchyType,this.rowHierarchyType==="tree"?this.rowExpandLevel:void 0),this.colDimensionKeys=this.columnDimensionTree.dimensionKeys.valueArr(),this.rowDimensionKeys=this.rowDimensionTree.dimensionKeys.valueArr(),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),this.resetRowHeaderLevelCount(),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this._table.isPivotChart()&&(this.hasTwoIndicatorAxes=this._indicators.some(_=>!!(_.chartSpec&&_.chartSpec.series&&_.chartSpec.series.length>1))),this.resetColumnHeaderLevelCount(),this._rowHeaderCellIds_FULL=Ng(this._rowHeaderCellIds_FULL),t.options.rowHierarchyType==="tree"&&((C=this.extensionRows)===null||C===void 0?void 0:C.length)>=1&&(this.generateExtensionRowTree(),this.extensionRows.forEach(_=>{const y=[];_.rows.forEach(w=>{typeof w=="string"?y.push(w):y.push(w.dimensionKey)}),this._extensionRowDimensionKeys.push(y),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(y)})),this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length),this.cornerSetting.titleOnDimension==="column")this.cornerHeaderObjs=this._addCornerHeaders(this.columnHeaderTitle?[""].concat(this.colDimensionKeys):this.colDimensionKeys,this.columnsDefine);else if(this.cornerSetting.titleOnDimension==="row")if(this.rowHierarchyType==="tree"&&((b=this.extensionRows)===null||b===void 0?void 0:b.length)>=1){const _=[];_.push(this.rowDimensionKeys[0]),this._extensionRowDimensionKeys.forEach(w=>{_.push(w[0])});const y=this.extensionRows.reduce((w,S)=>w.concat(S.rows),[]);this.cornerHeaderObjs=this._addCornerHeaders(this.rowHeaderTitle?[""].concat(_):_,this.rowsDefine.concat(y))}else this.cornerHeaderObjs=this._addCornerHeaders(this.rowHeaderTitle?[""].concat(this.rowDimensionKeys):this.rowDimensionKeys,this.rowsDefine);else this.cornerHeaderObjs=this._addCornerHeaders(null,void 0);this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce((_,y)=>(_[y.id]=y,_),{}),this.indicatorsAsCol&&!this.hideIndicatorName?this._indicatorShowType="column":this.indicatorsAsCol||this.hideIndicatorName?this._indicatorShowType="none":this._indicatorShowType="row",this.setPagination(t.options.pagination),this._table.isPivotChart()&&(this._chartItemSpanSize=0,this._chartItemBandSize=0,this._indicators.find(_=>{var y,w,S,D,A,x,B,F;!((y=_==null?void 0:_.style)===null||y===void 0)&&y.padding&&(this._chartPadding=_.style.padding),!((w=_.chartSpec)===null||w===void 0)&&w.barWidth&&typeof _.chartSpec.barWidth=="number"&&(this._chartItemSpanSize=(S=_.chartSpec)===null||S===void 0?void 0:S.barWidth);const T=(A=(D=_.chartSpec)===null||D===void 0?void 0:D.axes)===null||A===void 0?void 0:A.find(R=>R.type==="band");return T!=null&&T.bandSize&&(this._chartItemBandSize=T==null?void 0:T.bandSize,this._chartPaddingInner=(x=rt(T.paddingInner)?T.paddingInner[0]:T.paddingInner)!==null&&x!==void 0?x:0,this._chartPaddingOuter=(B=rt(T.paddingOuter)?T.paddingOuter[0]:T.paddingOuter)!==null&&B!==void 0?B:0),this._chartItemSpanSize>0||((F=_.chartSpec.series)===null||F===void 0||F.find(R=>(R.barWidth&&typeof R.barWidth=="number"&&(this._chartItemSpanSize=R.barWidth),this._chartItemSpanSize>0)),!1)})),this.setColumnWidths()}_generateColHeaderIds(){var t,e;if(((t=this.columnDimensionTree.tree.children)===null||t===void 0?void 0:t.length)>=1&&(this.columnHeaderObjs=this._addHeaders(this._columnHeaderCellIds,0,this.columnDimensionTree.tree.children,[])),this.columnHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const i=++this.sharedVar.seqId,r=Array(this.colCount-this.rowHeaderLevelCount).fill(i);this._columnHeaderCellIds.unshift(r);const o={id:i,title:typeof this.columnHeaderTitle.title=="string"?this.columnHeaderTitle.title:this.columnsDefine.reduce((s,a)=>typeof a=="string"?s:s+(s?`/${a.title}`:`${a.title}`),""),field:void 0,headerType:(e=this.columnHeaderTitle.headerType)!==null&&e!==void 0?e:"text",style:this.columnHeaderTitle.headerStyle,define:{id:i,disableHeaderHover:!!this.columnHeaderTitle.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle.disableHeaderSelect}};this.columnHeaderObjs.push(o),this._headerObjects[i]=o}}_generateRowHeaderIds(){var t,e,i,r;if(((t=this.rowDimensionTree.tree.children)===null||t===void 0?void 0:t.length)>=1&&(this.rowHeaderObjs=this.rowHierarchyType==="tree"?this._addHeadersForTreeMode(this._rowHeaderCellIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine):this._addHeaders(this._rowHeaderCellIds_FULL,0,this.rowDimensionTree.tree.children,[])),this.rowHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const o=++this.sharedVar.seqId,s=Array((i=(e=this._rowHeaderCellIds_FULL[0])===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:this.rowDimensionTree.tree.size).fill(o);this._rowHeaderCellIds_FULL.unshift(s);const a={id:o,title:typeof this.rowHeaderTitle.title=="string"?this.rowHeaderTitle.title:this.rowsDefine.reduce((l,h)=>typeof h=="string"?l:l+(l?`/${h.title}`:`${h.title}`),""),field:void 0,headerType:(r=this.rowHeaderTitle.headerType)!==null&&r!==void 0?r:"text",style:this.rowHeaderTitle.headerStyle,define:{id:o,disableHeaderHover:!!this.columnHeaderTitle.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle.disableHeaderSelect}};this.rowHeaderObjs.push(a),this._headerObjects[o]=a}}_addHeaders(t,e,i,r){const o=this,s=[];t[e]||function(a){const l=t[a]=[];if(o.colIndex===0)return l;const h=t[a-1];for(let u=0;u<(h==null?void 0:h.length);u++)l[u]=h[u]}(e);for(let a=0;a<i.length;a++){const l=i[a];AO(l,t,s,r,e,this)}return s}_addHeadersForTreeMode(t,e,i,r,o,s,a){const l=this,h=[];t[e]||function(u){const d=t[u]=[];if(l.colIndex===0)return d;const c=t[u-1];for(let g=0;g<(c==null?void 0:c.length);g++)d[g]=c[g]}(e);for(let u=0;u<i.length;u++){const d=i[u];xO(d,t,h,r,e,o,s,a,this)}return h}_addCornerHeaders(t,e){var i;const r=[];if(t)t.forEach((o,s)=>{var a,l;const h=++this.sharedVar.seqId,u=e.find(c=>typeof c!="string"&&c.dimensionKey===o),d={id:h,title:o===this.indicatorDimensionKey?this.indicatorTitle:u?u.title:o==="axis"?"":o,field:"\u7EF4\u5EA6\u540D\u79F0",style:this.cornerSetting.headerStyle,headerType:(a=this.cornerSetting.headerType)!==null&&a!==void 0?a:"text",define:{dimensionKey:"\u7EF4\u5EA6\u540D\u79F0",id:h,value:o,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:u==null?void 0:u.cornerDropDownMenu,pivotInfo:{value:(l=u==null?void 0:u.title)!==null&&l!==void 0?l:"",dimensionKey:o,isPivotCorner:!0},description:u==null?void 0:u.cornerDescription};if(r[h]=d,this._headerObjects[h]=d,this.cornerSetting.titleOnDimension==="column"){this._cornerHeaderCellIds[s]||(this._cornerHeaderCellIds[s]=[]);for(let c=0;c<this.rowHeaderLevelCount;c++)this._cornerHeaderCellIds[s][c]=h}else if(this.cornerSetting.titleOnDimension==="row")for(let c=0;c<this.columnHeaderLevelCount;c++)this._cornerHeaderCellIds[c]||(this._cornerHeaderCellIds[c]=[]),this._cornerHeaderCellIds[c][s]=h});else{const o=++this.sharedVar.seqId,s={id:o,title:"",field:"\u7EF4\u5EA6\u540D\u79F0",style:this.cornerSetting.headerStyle,headerType:(i=this.cornerSetting.headerType)!==null&&i!==void 0?i:"text",define:{dimensionKey:"\u7EF4\u5EA6\u540D\u79F0",id:o,value:"",disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect}};r[o]=s,this._headerObjects[o]=s;for(let a=0;a<this.columnHeaderLevelCount;a++)for(let l=0;l<this.rowHeaderLevelCount;l++)this._cornerHeaderCellIds[a]||(this._cornerHeaderCellIds[a]=[]),this._cornerHeaderCellIds[a][l]=o}return r}generateExtensionRowTree(){this.extensionRows.forEach((t,e)=>{const i=this._rowHeaderCellIds_FULL;this._rowHeaderCellIds_FULL=[],i.forEach((r,o)=>{const s=r[r.length-1];let a,l;if(this.colIndex=0,typeof t.rowTree=="function"){const u=this.findFullCellIds(r);a=t.rowTree(u.map(d=>({dimensionKey:this._headerObjects[d].field,value:this._headerObjects[d].title})))}else a=Ot(t.rowTree);this._rowHeaderExtensionTree[s]?(this._rowHeaderExtensionTree[s].reset(this._rowHeaderExtensionTree[s].tree.children,!0),l=this._rowHeaderExtensionTree[s]):(l=new cs(a!=null?a:[],this.sharedVar,this.rowHierarchyType,void 0),this._rowHeaderExtensionTree[s]=l);const h=[];this._addHeadersForTreeMode(h,0,l.tree.children,[],l.totalLevel,!0,t.rows);for(let u=0;u<h[0].length;u++)this._rowHeaderCellIds_FULL.push(r.concat(h[0][u]))})})}setColumnWidths(){var t,e,i;const r=new Array(this.colCount).fill(void 0);if(this.showHeader&&this.showRowHeader)if(this.rowHeaderTitle&&(r[0]={}),this.rowHierarchyType==="tree"){const o=this.rowDimensionKeys[0];if(o){const s=(t=this.rowsDefine)===null||t===void 0?void 0:t.find(a=>typeof a!="string"&&a.dimensionKey===o);s&&(r[0+(this.rowHeaderTitle?1:0)]={width:s.width,minWidth:s.minWidth,maxWidth:s.maxWidth})}(e=this._extensionRowDimensionKeys)===null||e===void 0||e.forEach((s,a)=>{var l;const h=s[0];if(h){const u=(l=this.extensionRows[a].rows)===null||l===void 0?void 0:l.find(d=>typeof d!="string"&&d.dimensionKey===h);u&&(r[a+1+(this.rowHeaderTitle?1:0)]={width:u.width,minWidth:u.minWidth,maxWidth:u.maxWidth})}})}else this.rowDimensionKeys.forEach((o,s)=>{var a;const l=(a=this.rowsDefine)===null||a===void 0?void 0:a.find(h=>typeof h!="string"&&h.dimensionKey===o);l&&(r[s+(this.rowHeaderTitle?1:0)]={width:l.width,minWidth:l.minWidth,maxWidth:l.maxWidth})});if(this.indicatorsAsCol)for(let o=this.rowHeaderLevelCount;o<this.colCount;o++){const s=this.getBody(o,this.columnHeaderLevelCount);r[o]={width:s==null?void 0:s.width,minWidth:s==null?void 0:s.minWidth,maxWidth:s==null?void 0:s.maxWidth}}else{let o,s,a,l=0;(i=this._indicators)===null||i===void 0||i.forEach((h,u)=>{typeof h.width=="number"?l=Math.max(h.width,l):h.width==="auto"&&(a=!0),typeof h.minWidth=="number"&&(s=Math.max(h.minWidth,s)),typeof h.maxWidth=="number"&&(o=Math.max(h.maxWidth,o))}),l=l>0?l:a?"auto":void 0,r.fill({width:l,minWidth:s,maxWidth:o},this.rowHeaderLevelCount,this.colCount-this.rightFrozenColCount)}this._columnWidths=r}get columnWidths(){return this._columnWidths}getColumnWidthDefined(t){return this._columnWidths[t]}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}get showColumnHeader(){return this._showColumnHeader}set showColumnHeader(t){this._showColumnHeader=t}get showRowHeader(){return this._showRowHeader}set showRowHeader(t){this._showRowHeader=t}get columnHeaderTitle(){return this._columnHeaderTitle}set columnHeaderTitle(t){this._columnHeaderTitle=t}get rowHeaderTitle(){return this._rowHeaderTitle}set rowHeaderTitle(t){this._rowHeaderTitle=t}getHeaderFieldKey(t,e){}getCellLocation(t,e){return this.isCornerHeader(t,e)?"cornerHeader":this.isColumnHeader(t,e)?"columnHeader":this.isRowHeader(t,e)?"rowHeader":"body"}isHeader(t,e){return t>=0&&t<this.rowHeaderLevelCount||e>=0&&e<this.columnHeaderLevelCount||t>=this.colCount-this.rightHeaderColCount||e>=this.rowCount-this.bottomHeaderRowCount}isCornerHeader(t,e){return t>=0&&t<this.rowHeaderLevelCount&&e>=0&&e<this.columnHeaderLevelCount}isColumnHeader(t,e){return t>=this.rowHeaderLevelCount&&e>=0&&e<this.columnHeaderLevelCount}isRowHeader(t,e){return t>=0&&t<this.rowHeaderLevelCount&&e>=this.columnHeaderLevelCount}isFrozen(t,e){return this.isFrozenColumn(t)||this.isRightFrozenColumn(t)||this.isBottomFrozenRow(e)||this.isFrozenRow(e)}isFrozenColumn(t,e){if(N(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(N(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(N(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(N(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftBottomCorner(t,e){return t>=0&&t<this.rowHeaderLevelCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.columnHeaderLevelCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}getColumnHeaderRange(){return{start:{col:this.rowHeaderLevelCount,row:0},end:{col:this.colCount-1,row:this.columnHeaderLevelCount-1}}}getRowHeaderRange(){return{start:{col:0,row:this.columnHeaderLevelCount},end:{col:this.rowHeaderLevelCount-1,row:this.rowCount-1}}}getCornerHeaderRange(){return{start:{col:0,row:0},end:{col:this.rowHeaderLevelCount-1,row:this.columnHeaderLevelCount-1}}}getBodyRange(){return{start:{col:this.rowHeaderLevelCount,row:this.columnHeaderLevelCount},end:{col:this.colCount-1,row:this.rowCount-1}}}resetCellIds(){}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get headerLevelCount(){return this.columnHeaderLevelCount}resetColumnHeaderLevelCount(){var t,e;if(this.showHeader&&this.showColumnHeader){if(this._table.isPivotChart()&&this.indicatorsAsCol&&!(!((e=(t=this.dataset)===null||t===void 0?void 0:t.colKeys)===null||e===void 0)&&e.length)&&!this.hasTwoIndicatorAxes)return void(this.columnHeaderLevelCount=0);let i=this.indicatorsAsCol&&this.hideIndicatorName&&this.colDimensionKeys[this.colDimensionKeys.length-1]===this.indicatorDimensionKey?this.columnDimensionTree.totalLevel-1:this.columnDimensionTree.totalLevel;return this.columnHeaderTitle&&(i+=1),this._table.isPivotChart()&&this.indicatorsAsCol&&!this.hasTwoIndicatorAxes&&Cd(this)&&(i-=1),void(this.columnHeaderLevelCount=i)}this.columnHeaderLevelCount=0}resetRowHeaderLevelCount(){var t,e;if(this.showHeader&&this.showRowHeader){if(this.rowHierarchyType==="tree"){const o=(e=(t=this.extensionRows)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0;return this.rowHeaderTitle?void(this.rowHeaderLevelCount=2+o):void(this.rowHeaderLevelCount=1+o)}const i=this.rowDimensionKeys.length;let r=i;return this.indicatorsAsCol||this.hideIndicatorName&&this.rowDimensionKeys[this.rowDimensionKeys.length-1]===this.indicatorDimensionKey&&(r=i-1),this.rowHeaderTitle&&(r+=1),void(this.rowHeaderLevelCount=r)}this.rowHeaderLevelCount=this.indicatorsAsCol||this.hideIndicatorName?0:1}get columnHeaderLevelCount(){return this._columnHeaderLevelCount}set columnHeaderLevelCount(t){this._columnHeaderLevelCount=t}get rowHeaderLevelCount(){return this._rowHeaderLevelCount}set rowHeaderLevelCount(t){this._rowHeaderLevelCount=t}get colCount(){return this.columnDimensionTree.tree.size+this.rowHeaderLevelCount+this.rightHeaderColCount}get rowCount(){var t,e,i,r;return((!Array.isArray(this._table.records)||this._table.records.length>0)&&((t=this._indicators)===null||t===void 0?void 0:t.length)>0&&!(!((e=this._rowHeaderCellIds)===null||e===void 0)&&e.length)?1:(r=(i=this._rowHeaderCellIds)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0)+this.columnHeaderLevelCount+this.bottomHeaderRowCount}get bodyRowSpanCount(){return this.rowDimensionTree.tree.size}get bottomFrozenRowCount(){if(!this._table.isPivotChart())return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0;if(this.indicatorKeys.length>=1&&Cd(this)){const t=this._table.pivotChartAxes.find(e=>e.orient==="bottom");return(t==null?void 0:t.visible)===!1?0:(this.indicatorsAsCol,1)}return 0}get rightFrozenColCount(){if(!this._table.isPivotChart())return this._table.internalProps.rightFrozenColCount?this.colCount-this.rowHeaderLevelCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:this.colCount-this.rowHeaderLevelCount:0;const t=this._table.pivotChartAxes.find(e=>e.orient==="right");return(t==null?void 0:t.visible)===!1||this.indicatorsAsCol?0:this.hasTwoIndicatorAxes?1:0}get bodyRowCount(){return this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount}get headerObjects(){return this._headerObjects}get columnObjects(){return this._indicators}getCellId(t,e){var i,r;if(e>=0&&t>=0){if(this.isCornerHeader(t,e))return this._cornerHeaderCellIds[e][t];if(this.isColumnHeader(t,e))return this._columnHeaderCellIds[e][t-this.rowHeaderLevelCount];if(this.isRowHeader(t,e))return(i=this._rowHeaderCellIds[e-this.columnHeaderLevelCount])===null||i===void 0?void 0:i[t];if(this.isRightFrozenColumn(t,e))return this._rowHeaderCellIds[e-this.columnHeaderLevelCount][this.rowHeaderLevelCount-1];if(this.isBottomFrozenRow(t,e))return(r=this._columnHeaderCellIds[this.columnHeaderLevelCount-1])===null||r===void 0?void 0:r[t-this.rowHeaderLevelCount]}}getHeader(t,e){var i;const r=this.getCellId(t,e);return(i=this._headerObjectMap[r])!==null&&i!==void 0?i:{id:void 0,field:"",headerType:"text",define:void 0}}getHeaderField(t,e){var i,r;const o=this.getCellId(t,e);return((i=this._headerObjectMap[o])===null||i===void 0?void 0:i.field)||((r=this.getBody(t,e))===null||r===void 0?void 0:r.field)}getHeaderCellAdressById(t){for(let e=0;e<this._columnHeaderCellIds.length;e++){const i=this._columnHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r+this._table.frozenColCount,row:e}}for(let e=0;e<this._rowHeaderCellIds.length;e++){const i=this._rowHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r,row:e+this._table.frozenRowCount}}for(let e=0;e<this._cornerHeaderCellIds.length;e++){const i=this._cornerHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find(i=>i&&i.field===t);return this.getHeaderCellAdressById(e.id)}getBody(t,e){var i,r,o,s,a,l,h,u,d,c;const g=this.getCellHeaderPaths(t,e);if(this.indicatorsAsCol){const p=(r=(i=g.colHeaderPaths)===null||i===void 0?void 0:i.find(v=>v.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;return(a=(s=(o=this._indicators)===null||o===void 0?void 0:o.find(v=>v.indicatorKey===p))!==null&&s!==void 0?s:this._indicators[0])!==null&&a!==void 0?a:{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0}}const f=(h=(l=g.rowHeaderPaths)===null||l===void 0?void 0:l.find(p=>p.indicatorKey))===null||h===void 0?void 0:h.indicatorKey;return(c=(d=(u=this._indicators)===null||u===void 0?void 0:u.find(p=>p.indicatorKey===f))!==null&&d!==void 0?d:this._indicators[0])!==null&&c!==void 0?c:{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0}}getCellRange(t,e){var i,r;const o={start:{col:t,row:e},end:{col:t,row:e}};if(!this.isHeader(t,e)||t===-1||e===-1||this.isRightFrozenColumn(t,e)||this.isBottomFrozenRow(t,e))return o;if(this._table.isPivotChart()){if(this.isLeftBottomCorner(t,e))return{start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.frozenColCount-1,row:this.rowCount-1}};if(this.isRightTopCorner(t,e))return{start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}};if(this.isRightBottomCorner(t,e))return{start:{col:this.colCount-this.rightFrozenColCount,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}}}for(let s=0;s<this._largeCellRangeCache.length;s++){const a=this._largeCellRangeCache[s];if(t>=a.start.col&&t<=a.end.col&&e>=a.start.row&&e<=a.end.row)return a}if(this.isHeader(t,e)&&t!==-1&&e!==-1){const s=this.getCellId(t,e);for(let a=t-1;a>=0&&s===this.getCellId(a,e);a--)o.start.col=a;for(let a=t+1;a<((i=this.colCount)!==null&&i!==void 0?i:0)&&s===this.getCellId(a,e);a++)o.end.col=a;for(let a=e-1;a>=0&&s===this.getCellId(t,a);a--)o.start.row=a;for(let a=e+1;a<((r=this.rowCount)!==null&&r!==void 0?r:0)&&s===this.getCellId(t,a);a++)o.end.row=a}return(o.end.col-o.start.col>100||o.end.row-o.start.row>100)&&this._largeCellRangeCache.push(o),o}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),s=this.getCellRange(i,r);return o.start.col===s.start.col&&o.end.col===s.end.col&&o.start.row===s.start.row&&o.end.row===s.end.row}getBodyIndexByRow(t){return t<this.columnHeaderLevelCount||t>=this.rowCount-this.bottomHeaderRowCount?-1:t-this.columnHeaderLevelCount}get bottomHeaderRowCount(){return this._table.isPivotChart()?this.bottomFrozenRowCount:0}get rightHeaderColCount(){return this._table.isPivotChart()?this.rightFrozenColCount:0}getBodyIndexByCol(t){return t<this.rowHeaderLevelCount||t>=this.colCount-this.rightHeaderColCount?-1:t-this.rowHeaderLevelCount}getRecordStartRowByRecordIndex(t){return this.columnHeaderLevelCount+t}getRecordShowIndexByCell(t,e){}getCellHeaderPathsWidthTreeNode(t,e){if(t===this._lastCellCol&&e===this._lastCellRow)return this._lastCellHeaderPath;let i=-1;for(let h=0;h<this._largeCellRangeCache.length;h++){const u=this._largeCellRangeCache[h];if(t>=u.start.col&&t<=u.end.col&&e>=u.start.row&&e<=u.end.row){i=h;break}}const r=this.getBodyIndexByCol(t),o=this.getBodyIndexByRow(e)+this.currentPageStartIndex;let s=[],a=[];if(e>=0&&r>=0&&(s=this.columnDimensionTree.getTreePath(r,this.showHeader&&this.showColumnHeader?e-(this.columnHeaderTitle?1:0):this.columnDimensionTree.totalLevel)),t>=0&&o>=0)if(this.rowHierarchyType==="tree"){const h=this._rowHeaderCellIds[o];let u=this.rowDimensionTree,d=0;for(;u;){const c=[];let g=h[d];for(c.push(g);;){const p=this._headerObjectMap[g];if(!(p!=null&&p.parentCellId))break;c.unshift(p.parentCellId),g=p.parentCellId}const f=u.getTreePathByCellIds(c);a=a.concat(f),u=this._rowHeaderExtensionTree[h[d]],d++}}else a=this.rowDimensionTree.getTreePath(o,this.showHeader&&this.showRowHeader?t-(this.rowHeaderTitle?1:0):this.rowDimensionTree.totalLevel);const l={colHeaderPaths:s,rowHeaderPaths:a,cellLocation:this.getCellLocation(t,e)};return this._lastCellHeaderPath=l,this._lastCellCol=t,this._lastCellRow=e,l}getCellHeaderPaths(t,e){var i,r;const o=this.getCellHeaderPathsWidthTreeNode(t,e),s={colHeaderPaths:[],rowHeaderPaths:[],cellLocation:o.cellLocation};return(i=o.colHeaderPaths)===null||i===void 0||i.forEach(a=>{var l,h,u;const d={};d.dimensionKey=a.dimensionKey,d.indicatorKey=a.indicatorKey,d.value=(u=(l=a.value)!==null&&l!==void 0?l:(h=this.getIndicatorInfoByIndicatorKey(a.indicatorKey))===null||h===void 0?void 0:h.title)!==null&&u!==void 0?u:"",s.colHeaderPaths.push(d)}),(r=o.rowHeaderPaths)===null||r===void 0||r.forEach(a=>{var l,h,u;if(a.dimensionKey!=="axis"){const d={};d.dimensionKey=a.dimensionKey,d.indicatorKey=a.indicatorKey,d.value=(u=(l=a.value)!==null&&l!==void 0?l:(h=this.getIndicatorInfoByIndicatorKey(a.indicatorKey))===null||h===void 0?void 0:h.title)!==null&&u!==void 0?u:"",s.rowHeaderPaths.push(d)}}),s}getIndicatorInfoByIndicatorKey(t){var e;return(e=this.indicatorsDefine)===null||e===void 0?void 0:e.find(i=>typeof i!="string"&&!!t&&i.indicatorKey===t)}findFullCellIds(t){const e=[];for(let i=0;i<t.length;i++){let r=t[i];for(e.push(r);;){const o=this._headerObjectMap[r];if(!(o!=null&&o.parentCellId))break;e.unshift(o.parentCellId),r=o.parentCellId}}return e}getHeaderDimension(t,e){var i,r,o;if(this.isHeader(t,e)){const s=this.getHeader(t,e);return(r=(i=this.rowsDefine)===null||i===void 0?void 0:i.find(a=>typeof a!="string"&&a.dimensionKey===s.field))!==null&&r!==void 0?r:(o=this.columnsDefine)===null||o===void 0?void 0:o.find(a=>typeof a!="string"&&a.dimensionKey===s.field)}}isColumnIndicatorHeader(t,e){return this._indicatorShowType==="column"&&e===this.columnHeaderLevelCount-1&&t>=this.rowHeaderLevelCount}isRowIndicatorHeader(t,e){return this._indicatorShowType==="row"&&t===this.rowHeaderLevelCount-1&&e>=this.columnHeaderLevelCount}isIndicatorHeader(t,e){return this.isColumnIndicatorHeader(t,e)||this.isRowIndicatorHeader(t,e)}toggleHierarchyState(t,e){var i,r;const o=this._rowHeaderCellIds_FULL.slice(0),s=o.map((h,u)=>({col:t,row:u+this.columnHeaderLevelCount})),a=this.getHeader(t,e);if(a.define.hierarchyState=a.define.hierarchyState===Ft.collapse?Ft.expand:Ft.collapse,this.rowDimensionTree.reset(this.rowDimensionTree.tree.children,!0),this._rowHeaderCellIds_FULL=[],this.rowHeaderObjs=this._addHeadersForTreeMode(this._rowHeaderCellIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine),this.rowHeaderTitle){const h=++this.sharedVar.seqId,u=Array(this.rowCount-this.columnHeaderLevelCount).fill(h);this._rowHeaderCellIds_FULL.unshift(u);const d={id:h,title:typeof this.rowHeaderTitle.title=="string"?this.rowHeaderTitle.title:this.rowsDefine.reduce((c,g)=>typeof g=="string"?c:c+(c?`/${g.title}`:`${g.title}`),""),field:void 0,headerType:(i=this.rowHeaderTitle.headerType)!==null&&i!==void 0?i:"text",style:this.rowHeaderTitle.headerStyle,define:{field:"",headerType:"text",cellType:"text",disableHeaderHover:!!this.columnHeaderTitle.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle.disableHeaderSelect}};this.rowHeaderObjs.push(d),this._headerObjects[h]=d}this._rowHeaderCellIds_FULL=Ng(this._rowHeaderCellIds_FULL),this.rowHierarchyType==="tree"&&((r=this.extensionRows)===null||r===void 0?void 0:r.length)>=1&&this.generateExtensionRowTree(),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce((h,u)=>(h[u.id]=u,h),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0;const l=i3(t,e,o.map(h=>h[t]),this._rowHeaderCellIds_FULL.map(h=>h[t]),s,this);return this._rowHeaderCellIds=this._rowHeaderCellIds_FULL.slice(),l}isHeaderForColWidth(t,e){return this.isHeader(t,e)}getHeaderForColWidth(t,e){return this.getHeader(t,e)}getPivotCellAdress(t){var e;if(!Array.isArray(t))return;let i,r,o=this.rowTree,s=this.columnTree;for(let h=0;h<t.length;h++){const u=t[h];if((u.isPivotCorner||!u.value)&&h===t.length-1){if(((e=this==null?void 0:this.cornerSetting)===null||e===void 0?void 0:e.titleOnDimension)==="row"){let g=0;return this.rowHierarchyType==="grid"&&(g=this.rowDimensionKeys.indexOf(u.dimensionKey)),g===-1?void 0:{col:this.rowHeaderTitle?g+1:g,row:0}}const c=this.colDimensionKeys.indexOf(u.dimensionKey);return c===-1?void 0:{col:0,row:this.columnHeaderTitle?c+1:c}}let d=!1;for(let c=0;c<s.length;c++){const g=s[c];if((N(u.dimensionKey)&&g.dimensionKey===u.dimensionKey||N(u.indicatorKey)&&g.indicatorKey===u.indicatorKey)&&g.value===u.value){s=g.children,r=g,d=!0;break}}if(!d)for(let c=0;c<o.length;c++){const g=o[c];if((N(u.dimensionKey)&&g.dimensionKey===u.dimensionKey||N(u.indicatorKey)&&g.indicatorKey===u.indicatorKey)&&g.value===u.value){o=g.children,i=g;break}}}let a=0,l=0;if(i){l=this.columnHeaderLevelCount;const{startInTotal:h,level:u}=i;return l+=h,a=this.rowHierarchyType==="grid"?this.rowHeaderTitle?u+1:u:0,{col:a,row:l}}if(r){a=this.rowHeaderLevelCount;const{startInTotal:h,level:u}=r;return a+=h,l=this.columnHeaderTitle?u+1:u,{col:a,row:l}}}getPivotDimensionInfo(t,e){var i;const{colHeaderPaths:r,rowHeaderPaths:o}=this.getCellHeaderPaths(t,e),s=[];return r.length?r.forEach((a,l)=>{s.push({dimensionKey:a.dimensionKey,value:a.value,isPivotCorner:!1,indicatorKey:a.indicatorKey})}):o.length?o.forEach((a,l)=>{s.push({dimensionKey:a.dimensionKey,value:a.value,isPivotCorner:!1,indicatorKey:a.indicatorKey})}):this.isCornerHeader(t,e)&&(((i=this==null?void 0:this.cornerSetting)===null||i===void 0?void 0:i.titleOnDimension)==="row"?s.push({dimensionKey:this.rowDimensionKeys[this.rowHeaderTitle?t-1:t],isPivotCorner:!0}):s.push({dimensionKey:this.colDimensionKeys[this.columnHeaderTitle?e-1:e],isPivotCorner:!0})),s}getIndicatorKey(t,e){var i;return(i=this.getBody(t,e))===null||i===void 0?void 0:i.indicatorKey}getParentCellId(t,e){if(e!==0)return this.isColumnHeader(t,e)?this.getCellId(t,e-1):this.isRowHeader(t,e)?this.getCellId(t-1,e):void 0}getRowHeaderCellAddressByCellId(t){let e,i;if(this._rowHeaderCellIds.find((r,o)=>!!r.find((s,a)=>s===t&&(e=a,!0))&&(i=o,!0)),N(e)&&N(i))return{col:e,row:i+this.columnHeaderLevelCount}}canMoveHeaderPosition(t,e){if(t.col<0||t.row<0||e.col<0||e.row<0)return!1;const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row))return this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row);if(this.isRowHeader(t.col,t.row)){if(this.rowHierarchyType!=="tree")return this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row);{const r=Ot(this.getCellHeaderPathsWidthTreeNode(t.col,t.row).rowHeaderPaths),o=Ot(this.getCellHeaderPathsWidthTreeNode(e.col,e.row).rowHeaderPaths);if(r.pop(),o.pop(),r.length<=o.length){if(r.length===o.length)return!r.find((s,a)=>s.dimensionKey!==o[a].dimensionKey||s.value!==o[a].value);if(r.length>0){for(let s=0;s<r.length;s++)if(r[s].startInTotal!==o[s].startInTotal)return!1}return!0}}}return!1}moveHeaderPosition(t,e){if(this.canMoveHeaderPosition(t,e)&&!this.isCellRangeEqual(t.col,t.row,e.col,e.row)){const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const r=i.end.col-i.start.col+1;let o;const s=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?s.end.col-r+1:s.start.col,o===i.start.col)return null;for(let l=0;l<this._columnHeaderCellIds.length;l++){const h=this._columnHeaderCellIds[l].splice(i.start.col-this.rowHeaderLevelCount,r);h.unshift(o-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this._columnHeaderCellIds[l],h)}const a=this._columnWidths.splice(i.start.col,r);return a.unshift(o,0),Array.prototype.splice.apply(this._columnWidths,a),this.columnDimensionTree.movePosition(this.getCellHeaderPathsWidthTreeNode(t.col,t.row).colHeaderPaths.length-1,i.start.col-this.rowHeaderLevelCount,s.start.col-this.rowHeaderLevelCount),this.columnDimensionTree.reset(this.columnDimensionTree.tree.children,!0),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:s.end.col-s.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)){let r;const o=this.getCellHeaderPathsWidthTreeNode(t.col,t.row).rowHeaderPaths,s=this.getCellHeaderPathsWidthTreeNode(e.col,e.row).rowHeaderPaths,a=o[o.length-1],l=s[o.length-1],h=a.size;if(r=e.row>=t.row?l.startInTotal+l.size-h:l.startInTotal,r===i.start.row-this.columnHeaderLevelCount)return null;const u=this._rowHeaderCellIds.splice(i.start.row-this.columnHeaderLevelCount,h);u.unshift(r-this.currentPageStartIndex,0),Array.prototype.splice.apply(this._rowHeaderCellIds,u);const d=this._rowHeaderCellIds_FULL.splice(i.start.row-this.columnHeaderLevelCount+this.currentPageStartIndex,h);return d.unshift(r,0),Array.prototype.splice.apply(this._rowHeaderCellIds_FULL,d),this.rowDimensionTree.movePosition(o.length-1,i.start.row-this.columnHeaderLevelCount,r+(e.row>t.row?a.size-1:0)),this.rowDimensionTree.reset(this.rowDimensionTree.tree.children,!0),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.row,targetIndex:r+this.columnHeaderLevelCount,sourceSize:h,targetSize:l.size,moveType:"row"}}}return null}getCellAdressByHeaderPath(t){var e,i;let r,o,s=!1;if(Array.isArray(t)){if(t.length>this.rowDimensionKeys.length+this.colDimensionKeys.length)return;r=t.filter(v=>this.colDimensionKeys.indexOf(v.dimensionKey)>=0||this.colDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&v.indicatorKey),o=t.filter(v=>this.rowDimensionKeys.indexOf(v.dimensionKey)>=0||this.rowDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&v.indicatorKey)}else r=t.colHeaderPaths,o=t.rowHeaderPaths,(t==null?void 0:t.cellLocation)==="body"&&this._table.isPivotTable()&&(s=!0);if(!Array.isArray(r)&&!Array.isArray(o))return;r==null||r.sort((v,m)=>{var C,b;return this.colDimensionKeys.indexOf((C=v.dimensionKey)!==null&&C!==void 0?C:this.indicatorDimensionKey)-this.colDimensionKeys.indexOf((b=m.dimensionKey)!==null&&b!==void 0?b:this.indicatorDimensionKey)}),o==null||o.sort((v,m)=>{var C,b;return this.fullRowDimensionKeys.indexOf((C=v.dimensionKey)!==null&&C!==void 0?C:this.indicatorDimensionKey)-this.fullRowDimensionKeys.indexOf((b=m.dimensionKey)!==null&&b!==void 0?b:this.indicatorDimensionKey)});let a,l,h,u,d=!1;(r==null?void 0:r.length)>=1&&(o==null?void 0:o.length)>=1&&(d=!0);let c,g,f=this.rowTree,p=this.columnTree;if(r)for(let v=0;v<r.length;v++){const m=r[v];for(let C=0;C<p.length;C++){const b=p[C];if(!N(m.indicatorKey)&&b.dimensionKey===m.dimensionKey&&b.value===m.value||N(m.indicatorKey)&&b.indicatorKey===m.indicatorKey){p=b.children,d&&!p?g=b:d||(g=b);break}}}if((o==null?void 0:o.length)>=1)if(this.rowHierarchyType==="tree"){const v=o[o.length-1],m=this.headerObjects.filter(b=>((b==null?void 0:b.field)===v.dimensionKey||(b==null?void 0:b.field)===v.indicatorKey)&&(b==null?void 0:b.title)===v.value).map(b=>b.id),C=this._rowHeaderCellIds.filter(b=>m.indexOf(b[b.length-1])>=0).find(b=>{const _=this.findFullCellIds(b);return _.length===o.length&&_.every(y=>{const w=this._headerObjectMap[y];return o.find(S=>S.dimensionKey===w.field&&S.value===w.title)})});l=this._rowHeaderCellIds.indexOf(C)+this.columnHeaderLevelCount}else for(let v=0;v<o.length;v++){const m=o[v];for(let C=0;C<f.length;C++){const b=f[C];if(!N(m.indicatorKey)&&b.dimensionKey===m.dimensionKey&&b.value===m.value||N(m.indicatorKey)&&b.indicatorKey===m.indicatorKey&&(!m.value||b.value===m.value)){f=b.children,(!d||f&&!f.some(_=>_.dimensionKey==="axis"))&&d||(c=b);break}}}if(s||!d||(c||N(l))&&g){if(c||s){l=this.columnHeaderLevelCount;const{startInTotal:v,level:m}=(e=c)!==null&&e!==void 0?e:dw;l+=v!=null?v:0,h=this.rowHierarchyType==="grid"?this.rowHeaderTitle?m+1:m:0}if(g||s){a=this.rowHeaderLevelCount;const{startInTotal:v,level:m}=(i=g)!==null&&i!==void 0?i:dw;a+=v!=null?v:0,u=this.columnHeaderTitle?m+1:m}return N(a)||N(l)?{col:a!=null?a:h,row:l!=null?l:u}:void 0}}setChartInstance(t,e,i){var r,o,s,a;const l=this.getCellHeaderPaths(t,e);let h;if(this.indicatorsAsCol){const u=(r=l.colHeaderPaths.find(d=>d.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;h=(o=this._indicators)===null||o===void 0?void 0:o.find(d=>d.indicatorKey===u)}else{const u=(s=l.rowHeaderPaths.find(d=>d.indicatorKey))===null||s===void 0?void 0:s.indicatorKey;h=(a=this._indicators)===null||a===void 0?void 0:a.find(d=>d.indicatorKey===u)}typeof(h==null?void 0:h.chartSpec)!="function"&&h&&(h.chartInstance=i)}getChartInstance(t,e){var i,r,o,s;const a=this.getCellHeaderPaths(t,e);let l;if(this.indicatorsAsCol){const h=(i=a.colHeaderPaths.find(u=>u.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;l=(r=this._indicators)===null||r===void 0?void 0:r.find(u=>u.indicatorKey===h)}else{const h=(o=a.rowHeaderPaths.find(u=>u.indicatorKey))===null||o===void 0?void 0:o.indicatorKey;l=(s=this._indicators)===null||s===void 0?void 0:s.find(u=>u.indicatorKey===h)}return l==null?void 0:l.chartInstance}checkHasChart(){return aw(this)}getDimension(t,e){var i,r;return e==="column"?(i=this.columnsDefine)===null||i===void 0?void 0:i.find(o=>typeof o!="string"&&o.dimensionKey===t):e==="row"?(r=this.rowsDefine)===null||r===void 0?void 0:r.find(o=>typeof o!="string"&&o.dimensionKey===t):void 0}getAxisConfigInPivotChart(t,e){if((this.isFrozenColumn(t,e)||this.isRightFrozenColumn(t,e))&&ds(t,e,"row",this)||(this.isFrozenRow(t,e)||this.isBottomFrozenRow(t,e))&&ds(t,e,"col",this))return kf(t,e,this)}isEmpty(t,e){return!!this._table.isPivotChart()&&(!!this.isLeftBottomCorner(t,e)||!!this.isRightBottomCorner(t,e)||!!this.isRightTopCorner(t,e))}isAxisCell(t,e){return this._table.isPivotChart()?!!(this.indicatorKeys.length>=1&&Cd(this)&&(this.isBottomFrozenRow(t,e)&&ds(t,e,"col",this)||this.isRightFrozenColumn(t,e)&&ds(t,e,"row",this)||this.isRowHeader(t,e)&&t===this.rowHeaderLevelCount-1&&ds(t,e,"row",this)||this.hasTwoIndicatorAxes&&this.indicatorsAsCol&&e===this.columnHeaderLevelCount-1&&ds(t,e,"col",this))):!1}getChartAxes(t,e){if(bO(t,e,this)||this.isAxisCell(t,e))return yO(t,e,this)}getRawChartSpec(t,e){return mO(t,e,this)}getChartSpec(t,e){return _O(t,e,this)}isShareChartSpec(t,e){return CO(t,e,this)}getChartDataId(t,e){return sw(t,e,this)}setPagination(t){var e,i,r,o,s;if(this.clearCellRangeMap(),this.pagination=t,this.rowHierarchyType==="grid"&&N((e=this.pagination)===null||e===void 0?void 0:e.perPageCount)&&N((i=this.pagination)===null||i===void 0?void 0:i.currentPage)){this.indicatorsAsCol===!1&&(this.pagination.perPageCount=Math.ceil(this.pagination.perPageCount/this.indicatorKeys.length)*this.indicatorKeys.length);const{perPageCount:a,currentPage:l}=this.pagination;this.currentPageStartIndex=a*(l||0),this.currentPageEndIndex=this.currentPageStartIndex+a,this._rowHeaderCellIds=(r=this._rowHeaderCellIds_FULL)===null||r===void 0?void 0:r.slice(this.currentPageStartIndex,this.currentPageEndIndex)}else this.currentPageStartIndex=0,this.currentPageEndIndex=this._rowHeaderCellIds_FULL.length,this._rowHeaderCellIds=(o=this._rowHeaderCellIds_FULL)===null||o===void 0?void 0:o.slice(this.currentPageStartIndex,this.currentPageEndIndex);this.pagination&&(this.pagination.totalCount=(s=this._rowHeaderCellIds_FULL)===null||s===void 0?void 0:s.length)}release(){var t;const e=this._table._getActiveChartInstance();e==null||e.release(),(t=this._indicators)===null||t===void 0||t.forEach(i=>{var r;(r=i.chartInstance)===null||r===void 0||r.release()})}getHeadNode(t){if(!Array.isArray(t))return;let e,i,r=this.rowTree,o=this.columnTree;for(let s=0;s<t.length;s++){const a=t[s];if((a.isPivotCorner||!a.value)&&s===t.length-1)return;let l=!1;for(let h=0;h<o.length;h++){const u=o[h];if((N(a.dimensionKey)&&u.dimensionKey===a.dimensionKey||N(a.indicatorKey)&&u.indicatorKey===a.indicatorKey)&&u.value===a.value){o=u.children,i=u,l=!0;break}}if(!l)for(let h=0;h<r.length;h++){const u=r[h];if((N(a.dimensionKey)&&u.dimensionKey===a.dimensionKey||N(a.indicatorKey)&&u.indicatorKey===a.indicatorKey)&&u.value===a.value){r=u.children,e=u;break}}}return e||i||void 0}clearCellRangeMap(){this._largeCellRangeCache.length=0,this._CellHeaderPathMap=new Map}getDimensionKeyInChartSpec(t,e){var i,r,o,s,a,l;let h;if(this.indicatorsAsCol===!1)for(let u=0;u<this.indicatorsDefine.length;u++){const d=this.indicatorsDefine[u].chartSpec;if(d&&(h=(i=d.xField)!==null&&i!==void 0?i:(o=(r=d==null?void 0:d.series)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.xField,h))return h}else for(let u=0;u<this.indicatorsDefine.length;u++){const d=this.indicatorsDefine[u].chartSpec;if(d&&(h=(s=d.yField)!==null&&s!==void 0?s:(l=(a=d==null?void 0:d.series)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.yField,h))return h}return null}_generateChartState(){return{vtable_selected:{filter:t=>{var e;return this._table._selectedDataItemsInChart.length>=1?!!this._table._selectedDataItemsInChart.find(i=>{for(const r in i)if(i[r]!==t[r])return!1;return!0}):!((e=this._table._selectedDimensionInChart)===null||e===void 0)&&e.length?!!this._table._selectedDimensionInChart.every(i=>t[i.key]===i.value):!1}},vtable_selected_reverse:{filter:t=>{var e;return this._table._selectedDataItemsInChart.length>=1?!this._table._selectedDataItemsInChart.find(i=>{for(const r in i)if(i[r]!==t[r])return!1;return!0}):!((e=this._table._selectedDimensionInChart)===null||e===void 0)&&e.length?!this._table._selectedDimensionInChart.every(i=>t[i.key]===i.value):!1}}}}updateDataStateToChartInstance(t){t||(t=this._table._getActiveChartInstance());const e=this._generateChartState();this._indicators.forEach(i=>{i.chartInstance.updateState(e)}),t==null||t.updateState(e)}updateDataStateToActiveChartInstance(t){t||(t=this._table._getActiveChartInstance());const e=this._generateChartState();t==null||t.updateState(e)}getIndicatorKeyInChartSpec(t,e){const i=this.getRawChartSpec(t,e),r=[];if(i){if(i.series||i.xField||i.yField)return this.indicatorsAsCol===!1?i.series?i.series.forEach(o=>{const s=o.yField;r.push(s)}):r.push(i.yField):i.series?i.series.forEach(o=>{const s=o.xField;r.push(s)}):r.push(i.xField),r;if(i.valueField&&r.push(i.valueField),r.length>=1)return r}return null}getOptimunHeightForChart(t){var e,i,r,o,s;const a=this.getCellHeaderPaths(this.rowHeaderLevelCount,t).rowHeaderPaths;let l,h;for(const d in this.dataset.collectValuesBy)if(this.dataset.collectValuesBy[d].type==="yField"&&!this.dataset.collectValuesBy[d].range){l=(e=this.dataset.collectedValues[d])===null||e===void 0?void 0:e[a.map(c=>c.value).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)h=cw((i=l==null?void 0:l.length)!==null&&i!==void 0?i:0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const d=this._chartItemSpanSize||25;h=((r=l==null?void 0:l.length)!==null&&r!==void 0?r:0)*(d+d/3)}const u=$t((s=(o=this._chartPadding)!==null&&o!==void 0?o:this._table.theme.bodyStyle.padding)!==null&&s!==void 0?s:0);return h+u[0]+u[2]}getOptimunWidthForChart(t){var e,i,r,o,s;const a=this.getCellHeaderPaths(t,this.columnHeaderLevelCount).colHeaderPaths;let l,h;for(const d in this.dataset.collectValuesBy)if(this.dataset.collectValuesBy[d].type==="xField"&&!this.dataset.collectValuesBy[d].range){l=(e=this.dataset.collectedValues[d])===null||e===void 0?void 0:e[a.map(c=>c.value).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)h=cw((i=l==null?void 0:l.length)!==null&&i!==void 0?i:0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const d=this._chartItemSpanSize||25;h=((r=l==null?void 0:l.length)!==null&&r!==void 0?r:0)*(d+d/3)}const u=$t((s=(o=this._chartPadding)!==null&&o!==void 0?o:this._table.theme.bodyStyle.padding)!==null&&s!==void 0?s:0);return h+u[1]+u[3]}get leftAxesCount(){if(!this._table.isPivotChart())return 0;const t=this._table.pivotChartAxes.find(e=>e.orient==="left");return(t==null?void 0:t.visible)===!1?0:(this.indicatorsAsCol,1)}get topAxesCount(){if(!this._table.isPivotChart())return 0;const t=this._table.pivotChartAxes.find(e=>e.orient==="top");return(t==null?void 0:t.visible)===!1?0:this.indicatorsAsCol&&this.hasTwoIndicatorAxes?1:0}get rightAxesCount(){return this.rightFrozenColCount}get bottomAxesCount(){return this.bottomFrozenRowCount}getColKeysPath(t,e){const i=this.getCellHeaderPaths(t,e),r=[];return i.colHeaderPaths.length&&i.colHeaderPaths.forEach(o=>{o.dimensionKey&&r.push(o.value)}),r==null?void 0:r.join(this.dataset.stringJoinChar)}getRowKeysPath(t,e){const i=this.getCellHeaderPaths(t,e),r=[];return i.rowHeaderPaths.length&&i.rowHeaderPaths.forEach(o=>{o.dimensionKey&&r.push(o.value)}),r==null?void 0:r.join(this.dataset.stringJoinChar)}getIndicatorInfo(t,e=""){var i;return(i=this.indicatorsDefine)===null||i===void 0?void 0:i.find(r=>typeof r!="string"&&(t?r.indicatorKey===t:!!e&&r.title===e))}getLayoutColumnTree(){const t=[],e=this.columnDimensionTree.tree.children;return E0(t,e),t}getLayoutRowTree(){const t=[],e=this.rowDimensionTree.tree.children;return E0(t,e),t}getLayoutColumnTreeCount(){const t=this.columnDimensionTree.tree.children;return _d(t,this.rowHierarchyType==="tree")}getLayoutRowTreeCount(){var t;const e=this.rowDimensionTree.tree.children;let i=_d(e,this.rowHierarchyType==="tree");return(t=this.extensionRows)===null||t===void 0||t.forEach(r=>{if(typeof r.rowTree!="function"){const o=_d(r.rowTree,!0);i*=o}}),i}resetHeaderTree(){var t,e;this._rowHeaderCellIds_FULL=[],this._columnHeaderCellIds=[];const i=this.dataset;this.rowTree=i.rowHeaderTree,this.columnTree=i.colHeaderTree,this.columnDimensionTree=new cs((t=this.columnTree)!==null&&t!==void 0?t:[],this.sharedVar),this.rowDimensionTree=new cs((e=this.rowTree)!==null&&e!==void 0?e:[],this.sharedVar,this.rowHierarchyType,this.rowHierarchyType==="tree"?this.rowExpandLevel:void 0),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this.resetColumnHeaderLevelCount(),this._rowHeaderCellIds_FULL=Ng(this._rowHeaderCellIds_FULL),this._headerObjectMap=this._headerObjects.reduce((r,o)=>(r[o.id]=o,r),{}),this.setPagination(this.pagination)}}function cw(n,t,e,i){e===1&&(e=0);const r=TO(n,e,i),o=t/(1-e);return Math.ceil(r*o)}function TO(n,t,e){let i;return i=n===1?n+2*e:n-t+2*e,n?i>0?i:1:0}class P0{constructor(t,e){this.tree={},this.changedTree={},this.colFlatKeys={},this.rowFlatKeys={},this.stringJoinChar=String.fromCharCode(0),this.rowsIsTotal=[],this.colsIsTotal=[],this.dataConfig=t,e&&(this.records=e,typeof window!="undefined"&&window.performance.now(),this.setRecords(e),typeof window!="undefined"&&window.performance.now()),delete this.rowFlatKeys,delete this.colFlatKeys}setRecords(t){this.processRecords()}processRecords(){for(let t=0,e=this.records.length;t<e;t++){const i=this.records[t];this.processRecord(i)}}processRecord(t){var e;const i=[],r=[];for(let o=0,s=this.dataConfig.rows.length;o<s;o++){const a=this.dataConfig.rows[o];t[a]!==void 0&&a!==this.dataConfig.indicatorDimensionKey&&r.push(t[a])}for(let o=0,s=this.dataConfig.columns.length;o<s;o++){const a=this.dataConfig.columns[o];t[a]!==void 0&&a!==this.dataConfig.indicatorDimensionKey&&i.push(t[a])}(e=this.dataConfig.indicators)===null||e===void 0||e.forEach(o=>{const s=t[o];s!==void 0&&(this.dataConfig.indicatorsAsCol?i.push(o):r.push(o));const a=r.join(this.stringJoinChar),l=i.join(this.stringJoinChar);r.length!==0&&(this.rowFlatKeys[a]||(this.rowFlatKeys[a]=1)),i.length!==0&&(this.colFlatKeys[l]||(this.colFlatKeys[l]=1)),i.length===0&&r.length===0||(this.tree[a]||(this.tree[a]={}),s!==void 0&&(this.tree[a][l]={value:s,record:t},this.dataConfig.indicatorsAsCol?i.pop():r.pop()))})}getTreeNode(t=[],e=[],i,r=!0){var o,s,a,l,h,u,d;let c,g;if(typeof t=="string")c=t;else{let f=!1;t.map((p,v)=>{p===i&&(t.splice(v,1),f=!0)}),f&&t.push(i),c=t.join(this.stringJoinChar)}if(typeof e=="string")g=e;else{let f=!1;e.map((p,v)=>{p===i&&(e.splice(v,1),f=!0)}),f&&e.push(i),g=e.join(this.stringJoinChar)}return r&&N((o=this.changedTree[c])===null||o===void 0?void 0:o[g])?{value:this.changedTree[c][g],record:(l=(a=(s=this.tree)===null||s===void 0?void 0:s[c])===null||a===void 0?void 0:a[g])===null||l===void 0?void 0:l.record}:(d=(u=(h=this.tree)===null||h===void 0?void 0:h[c])===null||u===void 0?void 0:u[g])!==null&&d!==void 0?d:void 0}changeTreeNodeValue(t=[],e=[],i,r){let o,s;if(typeof t=="string")o=t;else{let a=!1;t.map((l,h)=>{l===i&&(t.splice(h,1),a=!0)}),a&&t.push(i),o=t.join(this.stringJoinChar)}if(typeof e=="string")s=e;else{let a=!1;e.map((l,h)=>{l===i&&(e.splice(h,1),a=!0)}),a&&e.push(i),s=e.join(this.stringJoinChar)}this.changedTree[o]||(this.changedTree[o]={}),this.changedTree[o][s]=r}}class wd{constructor(t,e,i,r,o,s,a,l,h,u,d){var c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k,H,O,z,j,U,W;if(this.tree={},this.changedTree={},this.colFlatKeys={},this.rowFlatKeys={},this.colKeys=[],this.rowKeys=[],this.rowOrder="key_a_to_z",this.colOrder="key_a_to_z",this.sorted=!1,this.indicatorStatistics=[],this.aggregators={},this.stringJoinChar=String.fromCharCode(0),this.rowsIsTotal=[],this.colsIsTotal=[],this.collectedValues={},this.cacheCollectedValues={},this.totalRecordsTree={},this.registerAggregators(),this.dataConfig=t,this.rowHierarchyType=l!=null?l:"grid",this.sortRules=(c=this.dataConfig)===null||c===void 0?void 0:c.sortRules,this.aggregationRules=(g=this.dataConfig)===null||g===void 0?void 0:g.aggregationRules,this.derivedFieldRules=(f=this.dataConfig)===null||f===void 0?void 0:f.derivedFieldRules,this.mappingRules=(p=this.dataConfig)===null||p===void 0?void 0:p.mappingRules,this.totals=(v=this.dataConfig)===null||v===void 0?void 0:v.totals,this.rows=e,this.columns=i,this.indicatorKeys=r,this.indicatorsAsCol=s,this.indicators=o,this.customColTree=h,this.customRowTree=u,this.colGrandTotalLabel=(b=(C=(m=this.totals)===null||m===void 0?void 0:m.column)===null||C===void 0?void 0:C.grandTotalLabel)!==null&&b!==void 0?b:"\u603B\u8BA1",this.colSubTotalLabel=(w=(y=(_=this.totals)===null||_===void 0?void 0:_.column)===null||y===void 0?void 0:y.subTotalLabel)!==null&&w!==void 0?w:"\u5C0F\u8BA1",this.rowGrandTotalLabel=(A=(D=(S=this.totals)===null||S===void 0?void 0:S.row)===null||D===void 0?void 0:D.grandTotalLabel)!==null&&A!==void 0?A:"\u603B\u8BA1",this.rowSubTotalLabel=(F=(B=(x=this.totals)===null||x===void 0?void 0:x.row)===null||B===void 0?void 0:B.subTotalLabel)!==null&&F!==void 0?F:"\u5C0F\u8BA1",this.collectValuesBy=(T=this.dataConfig)===null||T===void 0?void 0:T.collectValuesBy,this.needSplitPositiveAndNegative=d!=null&&d,this.rowsIsTotal=new Array((M=(R=this.rows)===null||R===void 0?void 0:R.length)!==null&&M!==void 0?M:0).fill(!1),this.colsIsTotal=new Array((P=(E=this.columns)===null||E===void 0?void 0:E.length)!==null&&P!==void 0?P:0).fill(!1),((I=this.totals)===null||I===void 0?void 0:I.row)&&this.totals.row.showSubTotals!==!1)for(let V=0,L=(O=(H=(k=this.totals)===null||k===void 0?void 0:k.row)===null||H===void 0?void 0:H.subTotalsDimensions)===null||O===void 0?void 0:O.length;V<L;V++){const G=this.totals.row.subTotalsDimensions[V],K=this.rows.indexOf(G);this.rowsIsTotal[K]=!0}if(!((z=this.totals)===null||z===void 0)&&z.column&&this.totals.column.showSubTotals!==!1)for(let V=0,L=(W=(U=(j=this.totals)===null||j===void 0?void 0:j.column)===null||U===void 0?void 0:U.subTotalsDimensions)===null||W===void 0?void 0:W.length;V<L;V++){const G=this.totals.column.subTotalsDimensions[V],K=this.columns.indexOf(G);this.colsIsTotal[K]=!0}this.setRecords(a)}setRecords(t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_;this.records=t,this.collectedValues={},this.cacheCollectedValues={},this.totalRecordsTree={},this.tree={},this.colFlatKeys={},this.rowFlatKeys={},this.colKeys=[],this.rowKeys=[],t&&(this.records=t,typeof window!="undefined"&&window.performance.now(),this.processRecords(),this.processCollectedValuesWithSumBy(),this.generateCollectedValuesSortRule(),this.processCollectedValuesWithSortBy(),typeof window!="undefined"&&window.performance.now(),typeof window!="undefined"&&window.performance.now(),this.totalStatistics(),typeof window!="undefined"&&window.performance.now(),typeof window!="undefined"&&window.performance.now(),this.sortKeys(),typeof window!="undefined"&&window.performance.now(),typeof window!="undefined"&&window.performance.now(),this.customRowTree?(this.indicatorsAsCol||(this.customRowTree=this._adjustCustomTree(this.customRowTree)),this.rowHeaderTree=this.customRowTree):this.rowHierarchyType==="tree"?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,((i=(e=this.totals)===null||e===void 0?void 0:e.row)===null||i===void 0?void 0:i.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,((o=(r=this.totals)===null||r===void 0?void 0:r.row)===null||o===void 0?void 0:o.showGrandTotals)||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel,this.rowSubTotalLabel,(l=(a=(s=this.totals)===null||s===void 0?void 0:s.row)===null||a===void 0?void 0:a.showGrandTotalsOnTop)!==null&&l!==void 0&&l,(d=(u=(h=this.totals)===null||h===void 0?void 0:h.row)===null||u===void 0?void 0:u.showSubTotalsOnTop)!==null&&d!==void 0&&d),this.customColTree?(this.indicatorsAsCol&&(this.customColTree=this._adjustCustomTree(this.customColTree)),this.colHeaderTree=this.customColTree):this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns,this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,((g=(c=this.totals)===null||c===void 0?void 0:c.column)===null||g===void 0?void 0:g.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0,this.colGrandTotalLabel,this.colSubTotalLabel,(v=(p=(f=this.totals)===null||f===void 0?void 0:f.column)===null||p===void 0?void 0:p.showGrandTotalsOnLeft)!==null&&v!==void 0&&v,(b=(C=(m=this.totals)===null||m===void 0?void 0:m.column)===null||C===void 0?void 0:C.showSubTotalsOnLeft)!==null&&b!==void 0&&b),typeof window!="undefined"&&window.performance.now(),!((_=this.dataConfig)===null||_===void 0)&&_.isPivotChart&&this.cacheDeminsionCollectedValues())}registerAggregator(t,e){this.aggregators[t]=e}registerAggregators(){this.registerAggregator(Et.RECORD,T_),this.registerAggregator(Et.SUM,R_),this.registerAggregator(Et.COUNT,E_),this.registerAggregator(Et.MAX,H_),this.registerAggregator(Et.MIN,L_),this.registerAggregator(Et.AVG,P_),this.registerAggregator(Et.NONE,M_)}processCollectedValuesWithSumBy(){var t;for(const e in this.collectedValues)if(!((t=this.collectValuesBy[e])===null||t===void 0)&&t.sumBy)for(const i in this.collectedValues[e]){const r=Object.values(this.collectedValues[e][i]).reduce((l,h)=>h.value()>l?h.value():l,Number.MIN_SAFE_INTEGER),o=Object.values(this.collectedValues[e][i]).reduce((l,h)=>h.value()<l?h.value():l,Number.MAX_SAFE_INTEGER);let s,a;this.needSplitPositiveAndNegative&&(s=Object.values(this.collectedValues[e][i]).reduce((l,h)=>h.positiveValue()>l?h.positiveValue():l,Number.MIN_SAFE_INTEGER),a=Object.values(this.collectedValues[e][i]).reduce((l,h)=>h.negativeValue()<l?h.negativeValue():l,Number.MAX_SAFE_INTEGER)),this.collectedValues[e][i]={},this.collectedValues[e][i].max=r,this.collectedValues[e][i].min=o,this.needSplitPositiveAndNegative&&(this.collectedValues[e][i].positiveMax=s,this.collectedValues[e][i].negativeMin=a)}}processCollectedValuesWithSortBy(){var t;for(const e in this.collectedValues)if(!((t=this.collectValuesBy[e])===null||t===void 0)&&t.sortBy)for(const i in this.collectedValues[e])this.collectedValues[e][i]=this.collectedValues[e][i].sort((r,o)=>{var s,a;return((s=this.collectValuesBy[e])===null||s===void 0?void 0:s.sortBy.indexOf(r))-((a=this.collectValuesBy[e])===null||a===void 0?void 0:a.sortBy.indexOf(o))})}generateCollectedValuesSortRule(){for(const t in this.collectedValues)if(this.collectValuesBy[t]&&!this.collectValuesBy[t].sortBy){let e=[];for(const i in this.collectedValues[t])Array.isArray(this.collectedValues[t][i])&&(e.push(...this.collectedValues[t][i]),e=Array.from(new Set(e)));e.length>0&&(this.collectValuesBy[t].sortBy=e)}}processRecords(){var t,e;let i=!1;if(((e=(t=this.dataConfig)===null||t===void 0?void 0:t.filterRules)===null||e===void 0?void 0:e.length)>=1&&(i=!0),Array.isArray(this.records))for(let r=0,o=this.records.length;r<o;r++){const s=this.records[r];i&&!this.filterRecord(s)||this.processRecord(s)}else for(const r in this.records)for(let o=0,s=this.records[r].length;o<s;o++){const a=this.records[r][o];i&&!this.filterRecord(a)||this.processRecord(a,r)}this.rowFlatKeys={},this.colFlatKeys={}}filterRecord(t){var e,i;let r=!0;for(let o=0;o<this.dataConfig.filterRules.length;o++){const s=(e=this.dataConfig)===null||e===void 0?void 0:e.filterRules[o];if(s.filterKey){const a=t[s.filterKey];if(s.filteredValues.indexOf(a)===-1){r=!1;break}}else if(!(!((i=s.filterFunc)===null||i===void 0)&&i.call(s,t))){r=!1;break}}return r}processRecord(t,e){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k,H,O,z,j,U,W,V,L,G,K,Y,nt,q,ot;(i=this.derivedFieldRules)===null||i===void 0||i.forEach((J,it)=>{t[J.fieldName]=J.derivedFunc(t)});for(const J in this.collectValuesBy)if(t[J]){this.collectedValues[J]||(this.collectedValues[J]={});const it=this.collectValuesBy[J].by.map(_t=>t[_t]).join(this.stringJoinChar);if(this.collectedValues[J][it]||(this.collectValuesBy[J].sumBy?this.collectedValues[J][it]={}:this.collectValuesBy[J].range?this.collectedValues[J][it]={min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER}:this.collectedValues[J][it]=[]),this.collectValuesBy[J].sumBy){const _t=this.collectValuesBy[J].sumBy.map(Xt=>t[Xt]).join(this.stringJoinChar);this.collectedValues[J][it][_t]||(this.collectedValues[J][it][_t]=new this.aggregators[Et.SUM](J,void 0,void 0,this.needSplitPositiveAndNegative)),this.collectedValues[J][it][_t].push(t)}else if(this.collectValuesBy[J].range){const _t=this.collectedValues[J][it],Xt=Math.max(t[J],_t.max),ae=Math.min(t[J],_t.min);isNaN(Xt)||(_t.max=Xt,_t.min=ae)}else{const _t=this.collectedValues[J][it];_t.indexOf(t[J])===-1&&_t.push(t[J])}}const at=[],et=[];let ft=!1;for(let J=0,it=this.rows.length;J<it;J++){const _t=this.rows[J];if(_t in t)et.push(t[_t]);else{if(!((s=(o=(r=this.dataConfig)===null||r===void 0?void 0:r.totals)===null||o===void 0?void 0:o.row)===null||s===void 0)&&s.showGrandTotals&&J===0&&!this.rows.find(Xt=>Xt in t)){et.push(this.rowGrandTotalLabel),ft=!0;break}if(((h=(l=(a=this.dataConfig)===null||a===void 0?void 0:a.totals)===null||l===void 0?void 0:l.row)===null||h===void 0?void 0:h.subTotalsDimensions.indexOf(this.rows[J-1]))>=0){this.rowHierarchyType==="grid"&&et.push(this.rowSubTotalLabel),ft=!0;break}}}for(let J=0,it=this.columns.length;J<it;J++){const _t=this.columns[J];if(_t in t)at.push(t[_t]);else{if(!((c=(d=(u=this.dataConfig)===null||u===void 0?void 0:u.totals)===null||d===void 0?void 0:d.column)===null||c===void 0)&&c.showGrandTotals&&J===0&&!this.columns.find(Xt=>Xt in t)){at.push(this.colGrandTotalLabel),ft=!0;break}if(((p=(f=(g=this.dataConfig)===null||g===void 0?void 0:g.totals)===null||f===void 0?void 0:f.column)===null||p===void 0?void 0:p.subTotalsDimensions.indexOf(this.columns[J-1]))>=0){at.push(this.colSubTotalLabel),ft=!0;break}}}const tt=et.join(this.stringJoinChar),dt=at.join(this.stringJoinChar);if(ft){this.totalRecordsTree[tt]||(this.totalRecordsTree[tt]={}),this.totalRecordsTree[tt][dt]||(this.totalRecordsTree[tt][dt]=[]);for(let J=0;J<this.indicatorKeys.length;J++){const it=this.getAggregatorRule(this.indicatorKeys[J]);!((m=(v=this.totalRecordsTree[tt])===null||v===void 0?void 0:v[dt])===null||m===void 0)&&m[J]||(this.totalRecordsTree[tt][dt][J]=new this.aggregators[(C=it==null?void 0:it.aggregationType)!==null&&C!==void 0?C:Et.SUM]((b=it==null?void 0:it.field)!==null&&b!==void 0?b:this.indicatorKeys[J],(_=it==null?void 0:it.formatFun)!==null&&_!==void 0?_:(w=(y=this.indicators)===null||y===void 0?void 0:y.find(_t=>typeof _t!="string"&&_t.indicatorKey===this.indicatorKeys[J]))===null||w===void 0?void 0:w.format)),this.indicatorKeys[J]in t&&((D=(S=this.totalRecordsTree[tt])===null||S===void 0?void 0:S[dt])===null||D===void 0||D[J].push(t))}}else{et.length!==0&&(this.rowFlatKeys[tt]||(this.rowKeys.push(et),this.rowFlatKeys[tt]=1)),at.length!==0&&(this.colFlatKeys[dt]||(this.colKeys.push(at),this.colFlatKeys[dt]=1)),this.tree[tt]||(this.tree[tt]={}),!((A=this.tree[tt])===null||A===void 0)&&A[dt]||(this.tree[tt][dt]=[]);for(let J=0;J<this.indicatorKeys.length;J++){const it=this.getAggregatorRule(this.indicatorKeys[J]);!((B=(x=this.tree[tt])===null||x===void 0?void 0:x[dt])===null||B===void 0)&&B[J]||(this.tree[tt][dt][J]=new this.aggregators[(F=it==null?void 0:it.aggregationType)!==null&&F!==void 0?F:Et.SUM]((T=it==null?void 0:it.field)!==null&&T!==void 0?T:this.indicatorKeys[J],(R=it==null?void 0:it.formatFun)!==null&&R!==void 0?R:(E=(M=this.indicators)===null||M===void 0?void 0:M.find(_t=>typeof _t!="string"&&_t.indicatorKey===this.indicatorKeys[J]))===null||E===void 0?void 0:E.format)),e?this.indicatorKeys[J]===e&&((I=(P=this.tree[tt])===null||P===void 0?void 0:P[dt])===null||I===void 0||I[J].push(t)):it!=null&&it.field?typeof(it==null?void 0:it.field)=="string"?(it==null?void 0:it.field)in t&&((H=(k=this.tree[tt])===null||k===void 0?void 0:k[dt])===null||H===void 0||H[J].push(t)):it!=null&&it.field.find(_t=>_t in t)&&((z=(O=this.tree[tt])===null||O===void 0?void 0:O[dt])===null||z===void 0||z[J].push(t)):this.indicatorKeys[J]in t&&((U=(j=this.tree[tt])===null||j===void 0?void 0:j[dt])===null||U===void 0||U[J].push(t))}if(this.mappingRules)for(let J=0;J<this.indicatorKeys.length;J++){if(!this.indicatorStatistics[J]){const it=this.getAggregatorRule(this.indicatorKeys[J]);this.indicatorStatistics[J]={max:new this.aggregators[Et.MAX](this.indicatorKeys[J]),min:new this.aggregators[Et.MIN](this.indicatorKeys[J]),total:new this.aggregators[(W=it==null?void 0:it.aggregationType)!==null&&W!==void 0?W:Et.SUM]((V=it==null?void 0:it.field)!==null&&V!==void 0?V:this.indicatorKeys[J],(L=it==null?void 0:it.formatFun)!==null&&L!==void 0?L:(K=(G=this.indicators)===null||G===void 0?void 0:G.find(_t=>typeof _t!="string"&&_t.indicatorKey===this.indicatorKeys[J]))===null||K===void 0?void 0:K.format)}}this.indicatorStatistics[J].max.push((nt=(Y=this.tree[tt])===null||Y===void 0?void 0:Y[dt])===null||nt===void 0?void 0:nt[J].value()),this.indicatorStatistics[J].min.push((ot=(q=this.tree[tt])===null||q===void 0?void 0:q[dt])===null||ot===void 0?void 0:ot[J].value()),this.indicatorStatistics[J].total.push(t)}}}updateSortRules(t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b;this.sorted=!1,this.sortRules=t,this.sortKeys(),this.customRowTree||(this.rowHierarchyType==="tree"?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,((i=(e=this.totals)===null||e===void 0?void 0:e.row)===null||i===void 0?void 0:i.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,((o=(r=this.totals)===null||r===void 0?void 0:r.row)===null||o===void 0?void 0:o.showGrandTotals)||this.indicatorsAsCol&&this.rows.length===0,this.rowGrandTotalLabel,this.rowSubTotalLabel,(l=(a=(s=this.totals)===null||s===void 0?void 0:s.row)===null||a===void 0?void 0:a.showGrandTotalsOnTop)!==null&&l!==void 0&&l,(d=(u=(h=this.totals)===null||h===void 0?void 0:h.row)===null||u===void 0?void 0:u.showSubTotalsOnTop)!==null&&d!==void 0&&d)),this.customColTree||(this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns,this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,((g=(c=this.totals)===null||c===void 0?void 0:c.column)===null||g===void 0?void 0:g.showGrandTotals)||!this.indicatorsAsCol&&this.columns.length===0,this.colGrandTotalLabel,this.colSubTotalLabel,(v=(p=(f=this.totals)===null||f===void 0?void 0:f.column)===null||p===void 0?void 0:p.showGrandTotalsOnLeft)!==null&&v!==void 0&&v,(b=(C=(m=this.totals)===null||m===void 0?void 0:m.column)===null||C===void 0?void 0:C.showSubTotalsOnLeft)!==null&&b!==void 0&&b))}updateFilterRules(t,e=!1){var i;if(this.filterRules=t,e)this.tree={};else for(const r in this.tree)for(const o in this.tree[r])for(let s=0;s<this.tree[r][o].length;s++)this.tree[r][o][s].reset();this.collectedValues={},this.processRecords(),this.processCollectedValuesWithSumBy(),this.processCollectedValuesWithSortBy(),!((i=this.dataConfig)===null||i===void 0)&&i.isPivotChart&&this.cacheDeminsionCollectedValues()}getAggregatorRule(t){var e;return(e=this.aggregationRules)===null||e===void 0?void 0:e.find((i,r)=>t===i.indicatorKey)}getAggregator(t=[],e=[],i,r=!0){var o,s,a,l;const h=this.indicatorKeys.indexOf(i);let u,d;u=typeof t=="string"?t:t.join(this.stringJoinChar),d=typeof e=="string"?e:e.join(this.stringJoinChar);const c=(s=(o=this.tree[u])===null||o===void 0?void 0:o[d])===null||s===void 0?void 0:s[h];if(r&&N((l=(a=this.changedTree[u])===null||a===void 0?void 0:a[d])===null||l===void 0?void 0:l[h])){const g=this.changedTree[u][d][h];return c?{value:()=>g,formatValue:c.formatValue,formatFun:c.formatFun,records:c.records,className:"",recalculate(){},push(){},clearCacheValue(){},reset(){}}:{value:()=>g,className:"",push(){},recalculate(){},formatValue:()=>g,clearCacheValue(){},reset(){}}}return c||{className:"",push(){},recalculate(){},value:()=>null,formatValue:()=>"",clearCacheValue(){},reset(){}}}sortKeys(){const t=this;if(!this.sorted){this.sorted=!0;const e=function(i,r){return t.getAggregator(i,r,"").value()};switch(this.rowOrder){case"value_a_to_z":this.rowKeys.sort(function(i,r){return Fr(e(i,[]),e(r,[]))});break;case"value_z_to_a":this.rowKeys.sort(function(i,r){return-Fr(e(i,[]),e(r,[]))});break;default:this.rowKeys.sort(this.arrSort(this.rows,!0))}switch(this.colOrder){case"value_a_to_z":this.colKeys.sort(function(r,o){return Fr(e([],r),e([],o))});break;case"value_z_to_a":this.colKeys.sort(function(r,o){return-Fr(e([],r),e([],o))});break;default:const i=this.arrSort(this.columns,!1);this.colKeys.sort(i)}}}arrSort(t,e){let i;const r=this,o=function(s){const a=[];for(let l=0,h=t.length;l<h;l++){i=t[l];let u=!1;if(r.sortRules)for(let d=0,c=r.sortRules.length;d<c;d++)r.sortRules[d].sortField===i&&(u=!0,a.push({field:i,fieldIndex:l,sortRule:r.sortRules[d],func:r.getSort(r.sortRules[d],e)}))}return a}.call(this);return function(s,a){var l,h,u;let d,c;for(let g=0;g<o.length;g++){if(c=o[g],(l=c.sortRule)===null||l===void 0?void 0:l.sortByIndicator){let f=s,p=a;c.fieldIndex<t.length-1&&(f=s.slice(0,c.fieldIndex+1),f.push(e?r.rowSubTotalLabel:r.colSubTotalLabel),p=a.slice(0,c.fieldIndex+1),p.push(e?r.rowSubTotalLabel:r.colSubTotalLabel)),d=c.func(f,p)}else d=(h=c.func)===null||h===void 0?void 0:h.call(c,s[c.fieldIndex],a[c.fieldIndex]);if(d!==0)return d*(((u=c.sortRule)===null||u===void 0?void 0:u.sortType)===Ig.DESC?-1:1)}return 0}}getSort(t,e){const i=this;return t.sortByIndicator?(r,o)=>{const s=function(a,l){return a.length<i.rows.length&&a[a.length-1]!==i.rowSubTotalLabel&&a[a.length-1]!==i.rowGrandTotalLabel&&a.push(i.rowSubTotalLabel),l.length<i.columns.length&&l[l.length-1]!==i.colSubTotalLabel&&l[l.length-1]!==i.colGrandTotalLabel&&l.push(i.colSubTotalLabel),i.getAggregator(a,l,t.sortByIndicator).value()};return e?Fr(s(r,t.query),s(o,t.query)):Fr(s(t.query,r),s(t.query,o))}:t.sortBy?a3(t.sortBy):t.sortType?s3:t.sortFunc?t.sortFunc:Fr}totalStatistics(){var t,e,i,r,o,s,a,l,h,u;const d=this;if(((i=(e=(t=d==null?void 0:d.totals)===null||t===void 0?void 0:t.column)===null||e===void 0?void 0:e.subTotalsDimensions)===null||i===void 0?void 0:i.length)>=1||((s=(o=(r=d==null?void 0:d.totals)===null||r===void 0?void 0:r.row)===null||o===void 0?void 0:o.subTotalsDimensions)===null||s===void 0?void 0:s.length)>=1||!((l=(a=d==null?void 0:d.totals)===null||a===void 0?void 0:a.column)===null||l===void 0)&&l.showGrandTotals||!((u=(h=d==null?void 0:d.totals)===null||h===void 0?void 0:h.row)===null||u===void 0)&&u.showGrandTotals){const c=[],g=(f,p)=>{var v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k,H,O,z,j,U,W,V,L,G,K,Y;if(!((m=(v=this.totalRecordsTree)===null||v===void 0?void 0:v[f])===null||m===void 0)&&m[p])return void(this.tree[f][p]=(b=(C=this.totalRecordsTree)===null||C===void 0?void 0:C[f])===null||b===void 0?void 0:b[p]);const nt=p.split(this.stringJoinChar);for(let q=0,ot=(w=(y=(_=d.totals)===null||_===void 0?void 0:_.column)===null||y===void 0?void 0:y.subTotalsDimensions)===null||w===void 0?void 0:w.length;q<ot;q++){const at=d.totals.column.subTotalsDimensions[q],et=d.columns.indexOf(at);if(et>=0){const ft=nt.slice(0,et+1);ft.push(d.colSubTotalLabel);const tt=ft.join(this.stringJoinChar);if(!((D=(S=this.totalRecordsTree)===null||S===void 0?void 0:S[f])===null||D===void 0)&&D[tt])return void(this.tree[f][tt]=(x=(A=this.totalRecordsTree)===null||A===void 0?void 0:A[f])===null||x===void 0?void 0:x[tt]);this.tree[f][tt]||(this.tree[f][tt]=[]);for(let dt=0;dt<this.indicatorKeys.length;dt++){if(!this.tree[f][tt][dt]){const J=this.getAggregatorRule(this.indicatorKeys[dt]);this.tree[f][tt][dt]=new this.aggregators[(B=J==null?void 0:J.aggregationType)!==null&&B!==void 0?B:Et.SUM]((F=J==null?void 0:J.field)!==null&&F!==void 0?F:this.indicatorKeys[dt],(T=J==null?void 0:J.formatFun)!==null&&T!==void 0?T:(M=(R=this.indicators)===null||R===void 0?void 0:R.find(it=>typeof it!="string"&&it.indicatorKey===this.indicatorKeys[dt]))===null||M===void 0?void 0:M.format)}this.tree[f][tt][dt].push((P=(E=d.tree[f])===null||E===void 0?void 0:E[p])===null||P===void 0?void 0:P[dt])}}}if(!((k=(I=d.totals)===null||I===void 0?void 0:I.column)===null||k===void 0)&&k.showGrandTotals||this.rows.length===0){const q=d.colGrandTotalLabel;if(!((O=(H=this.totalRecordsTree)===null||H===void 0?void 0:H[f])===null||O===void 0)&&O[q])return void(this.tree[f][q]=(j=(z=this.totalRecordsTree)===null||z===void 0?void 0:z[f])===null||j===void 0?void 0:j[q]);this.tree[f][q]||(this.tree[f][q]=[]);for(let ot=0;ot<this.indicatorKeys.length;ot++){if(!this.tree[f][q][ot]){const at=this.getAggregatorRule(this.indicatorKeys[ot]);this.tree[f][q][ot]=new this.aggregators[(U=at==null?void 0:at.aggregationType)!==null&&U!==void 0?U:Et.SUM]((W=at==null?void 0:at.field)!==null&&W!==void 0?W:this.indicatorKeys[ot],(V=at==null?void 0:at.formatFun)!==null&&V!==void 0?V:(G=(L=this.indicators)===null||L===void 0?void 0:L.find(et=>typeof et!="string"&&et.indicatorKey===this.indicatorKeys[ot]))===null||G===void 0?void 0:G.format)}this.tree[f][q][ot].push((Y=(K=d.tree[f])===null||K===void 0?void 0:K[p])===null||Y===void 0?void 0:Y[ot])}}};Object.keys(d.tree).forEach(f=>{const p=f.split(this.stringJoinChar);Object.keys(d.tree[f]).forEach(v=>{var m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k;for(let H=0,O=(b=(C=(m=d.totals)===null||m===void 0?void 0:m.row)===null||C===void 0?void 0:C.subTotalsDimensions)===null||b===void 0?void 0:b.length;H<O;H++){const z=d.totals.row.subTotalsDimensions[H],j=d.rows.indexOf(z);if(j>=0&&j<d.rows.length-1){const U=p.slice(0,j+1);this.rowHierarchyType==="grid"&&U.push(d.rowSubTotalLabel);const W=U.join(this.stringJoinChar);this.tree[W]||(this.tree[W]={},c.push(W)),this.tree[W][v]||(this.tree[W][v]=[]);for(let V=0;V<this.indicatorKeys.length;V++){if(!this.tree[W][v][V]){const L=this.getAggregatorRule(this.indicatorKeys[V]);this.tree[W][v][V]=new this.aggregators[(_=L==null?void 0:L.aggregationType)!==null&&_!==void 0?_:Et.SUM]((y=L==null?void 0:L.field)!==null&&y!==void 0?y:this.indicatorKeys[V],(w=L==null?void 0:L.formatFun)!==null&&w!==void 0?w:(D=(S=this.indicators)===null||S===void 0?void 0:S.find(G=>typeof G!="string"&&G.indicatorKey===this.indicatorKeys[V]))===null||D===void 0?void 0:D.format)}this.tree[W][v][V].push((x=(A=d.tree[f])===null||A===void 0?void 0:A[v])===null||x===void 0?void 0:x[V])}}}if(!((F=(B=d.totals)===null||B===void 0?void 0:B.row)===null||F===void 0)&&F.showGrandTotals||this.columns.length===0){const H=d.rowGrandTotalLabel;this.tree[H]||(this.tree[H]={},c.push(H)),this.tree[H][v]||(this.tree[H][v]=[]);for(let O=0;O<this.indicatorKeys.length;O++){if(!this.tree[H][v][O]){const z=this.getAggregatorRule(this.indicatorKeys[O]);this.tree[H][v][O]=new this.aggregators[(T=z==null?void 0:z.aggregationType)!==null&&T!==void 0?T:Et.SUM]((R=z==null?void 0:z.field)!==null&&R!==void 0?R:this.indicatorKeys[O],(M=z==null?void 0:z.formatFun)!==null&&M!==void 0?M:(P=(E=this.indicators)===null||E===void 0?void 0:E.find(j=>typeof j!="string"&&j.indicatorKey===this.indicatorKeys[O]))===null||P===void 0?void 0:P.format)}this.tree[H][v][O].push((k=(I=d.tree[f])===null||I===void 0?void 0:I[v])===null||k===void 0?void 0:k[O])}}g(f,v)})}),c.forEach(f=>{Object.keys(d.tree[f]).forEach(p=>{g(f,p)})})}}ArrToTree1(t,e,i,r,o){const s=[],a=this.stringJoinChar,l=new Map;function h(u){const d=[];let c;u.forEach((g,f)=>{d.push(g);const p=d.join(a);let v=l.get(p);v||(v={value:g,dimensionKey:e[f],children:f===u.length-1&&(i==null?void 0:i.length)>=1?i==null?void 0:i.map(m=>typeof m=="string"?{indicatorKey:m,value:m}:{indicatorKey:m.indicatorKey,value:m.title}):[]},l.set(p,v),c?c.children.push(v):s.push(v)),c=v})}return t.forEach(u=>h(u)),r&&h([o]),s}ArrToTree(t,e,i,r,o,s,a,l,h){var u;let d=[];const c=this.stringJoinChar,g=new Map;if(t!=null&&t.length?t.forEach(f=>function(p){const v=[];let m;p.forEach((C,b)=>{v.push(C);const _=v.join(c);let y=g.get(_);if(!y){if(y={value:C,dimensionKey:e[b],children:b===p.length-1&&(i==null?void 0:i.length)>=1?i==null?void 0:i.map(w=>typeof w=="string"?{indicatorKey:w,value:w}:{indicatorKey:w.indicatorKey,value:w.title}):[]},r[b]){let w=y.children;const S={value:a,dimensionKey:e[b+1],levelSpan:r.length-b-1,children:(i==null?void 0:i.length)>=1?i==null?void 0:i.map(D=>typeof D=="string"?{indicatorKey:D,value:D}:{indicatorKey:D.indicatorKey,value:D.title}):[]};w.push(S),w=S.children}g.set(_,y),m?r[b-1]&&!h?m.children.splice(m.children.length-1,0,y):m.children.push(y):d.push(y)}m=y})}(f)):i&&(d=i==null?void 0:i.map(f=>{var p;return{indicatorKey:f.indicatorKey,value:(p=f.title)!==null&&p!==void 0?p:f.indicatorKey}})),o&&(t==null?void 0:t.length)){const f={value:s,dimensionKey:e[0],levelSpan:r.length,children:(u=i==null?void 0:i.map(p=>typeof p=="string"?{indicatorKey:p,value:p}:{indicatorKey:p.indicatorKey,value:p.title}))!==null&&u!==void 0?u:[]};l?d.unshift(f):d.push(f)}return d}TreeToArr(t){const e=[];function i(r,o){var s;o.push(r.id),r.children.length>0?(s=r.children)===null||s===void 0||s.forEach(a=>i(a,[...o])):e.push(o)}return t.forEach(r=>i(r,[])),e}cacheDeminsionCollectedValues(){for(const t in this.collectValuesBy)this.collectValuesBy[t].type!=="xField"&&this.collectValuesBy[t].type!=="yField"||(this.dataConfig.dimensionSortArray?this.cacheCollectedValues[t]=MO(this.collectedValues[t],this.dataConfig.dimensionSortArray):this.cacheCollectedValues[t]=this.collectedValues[t])}_adjustCustomTree(t){var e;const i=(r,o)=>{r.forEach(s=>{var a,l;s.indicatorKey||o||!((a=s.children)===null||a===void 0)&&a.length?s.children&&i(s.children,o||!!s.indicatorKey):s.children=(l=this.indicators)===null||l===void 0?void 0:l.map(h=>{var u;return{indicatorKey:h.indicatorKey,value:(u=h.title)!==null&&u!==void 0?u:h.indicatorKey}})})};return t!=null&&t.length?i(t,!1):t=(e=this.indicators)===null||e===void 0?void 0:e.map(r=>{var o;return{indicatorKey:r.indicatorKey,value:(o=r.title)!==null&&o!==void 0?o:r.indicatorKey}}),t}changeTreeNodeValue(t=[],e=[],i,r){var o;const s=this.indicatorKeys.indexOf(i);let a,l;a=typeof t=="string"?t:t.join(this.stringJoinChar),l=typeof e=="string"?e:e.join(this.stringJoinChar),!((o=this.changedTree[a])===null||o===void 0)&&o[l]?this.changedTree[a][l][s]=r:this.changedTree[a]?(this.changedTree[a][l]=[],this.changedTree[a][l][s]=r):(this.changedTree[a]={},this.changedTree[a][l]=[],this.changedTree[a][l][s]=r)}}function MO(n,t){return n.sort((e,i)=>{const r=t.indexOf(e),o=t.indexOf(i);return r<o?-1:r>o?1:0})}class gw extends M0{constructor(t,e){var i,r,o,s,a,l,h,u,d,c,g,f;Pt.mode==="node"?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e),e.layout&&Object.assign(e,e.layout),this.internalProps.columns=Ot(e.columns),this.internalProps.rows=Ot(e.rows),this.internalProps.indicators=Ot(e.indicators),(i=e.indicators)===null||i===void 0||i.forEach((v,m)=>{typeof v=="object"&&(v!=null&&v.editor)&&(this.internalProps.indicators[m].editor=v.editor)}),this.internalProps.columnTree=!e.indicatorsAsCol||!((r=e.columns)===null||r===void 0)&&r.length||e.columnTree?Ot(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||!((o=e.rows)===null||o===void 0)&&o.length||e.rowTree?Ot(e.rowTree):[],this.internalProps.records=e.records,this.pagination=e.pagination,this.internalProps.columnResizeType=(s=e.columnResizeType)!==null&&s!==void 0?s:"column",this.internalProps.dataConfig=Ot(e.dataConfig),e.rowTree||e.columnTree?this.internalProps.enableDataAnalysis=!1:this.internalProps.enableDataAnalysis=!0;const p=this.internalProps.records;if(this.internalProps.enableDataAnalysis&&(e.rows||e.columns)){const v=(l=(a=e.rows)===null||a===void 0?void 0:a.reduce((b,_)=>(typeof _=="string"?b.push(_):b.push(_.dimensionKey),b),[]))!==null&&l!==void 0?l:[],m=(u=(h=e.columns)===null||h===void 0?void 0:h.reduce((b,_)=>(typeof _=="string"?b.push(_):b.push(_.dimensionKey),b),[]))!==null&&u!==void 0?u:[],C=(c=(d=e.indicators)===null||d===void 0?void 0:d.reduce((b,_)=>(typeof _=="string"?b.push(_):b.push(_.indicatorKey),b),[]))!==null&&c!==void 0?c:[];this.dataset=new wd(this.internalProps.dataConfig,v,m,C,this.internalProps.indicators,(g=e.indicatorsAsCol)===null||g===void 0||g,e.records,e.rowHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree),this.internalProps.layoutMap=new Pr(this,this.dataset)}else{if(!Array.isArray(this.internalProps.columnTree)&&!Array.isArray(this.internalProps.rowTree))return;this.internalProps.layoutMap=new Pr(this,null),((f=p==null?void 0:p[0])===null||f===void 0?void 0:f.constructor)!==Array&&(this.flatDataToObjects=new P0({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey},p))}this.pivotSortState=[],e.pivotSortState&&this.updatePivotSortState(e.pivotSortState),Pt.mode!=="node"&&(this.editorManager=new hw(this)),this.refreshHeader(),this.stateManager.initCheckedState(p),this.scenegraph.createSceneGraph(),e.title&&(this.internalProps.title=new gs(e.title,this),this.scenegraph.resize()),setTimeout(()=>{this.fireListeners(Q.INITIALIZED,null)},0)}static get EVENT_TYPE(){return za}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!1}get recordsCount(){var t;return(t=this.records)===null||t===void 0?void 0:t.length}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.internalProps.layoutMap.indicatorsAsCol){const r=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)return!1}return i}updateOption(t){var e,i,r,o,s,a,l,h,u,d,c;const g=this.internalProps;if(super.updateOption(t),this.internalProps.columns=Ot(t.columns),this.internalProps.rows=Ot(t.rows),this.internalProps.indicators=!((e=t.indicators)===null||e===void 0)&&e.length?Ot(t.indicators):[],(i=t.indicators)===null||i===void 0||i.forEach((p,v)=>{typeof p=="object"&&(p!=null&&p.editor)&&(this.internalProps.indicators[v].editor=p.editor)}),this.internalProps.columnTree=!t.indicatorsAsCol||!((r=t.columns)===null||r===void 0)&&r.length||t.columnTree?Ot(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||!((o=t.rows)===null||o===void 0)&&o.length||t.rowTree?Ot(t.rowTree):[],t.records&&(this.internalProps.records=t.records),this.stateManager.initCheckedState(this.internalProps.records),this.pagination=t.pagination,g.columnResizeType=(s=t.columnResizeType)!==null&&s!==void 0?s:"column",g.dataConfig=Ot(t.dataConfig),t.rowTree||t.columnTree?g.enableDataAnalysis=!1:g.enableDataAnalysis=!0,(t==null?void 0:t.rowHierarchyType)==="tree"&&this.internalProps.layoutMap.rowHierarchyType==="tree"&&this.internalProps.layoutMap.rowExpandLevel===(t==null?void 0:t.rowExpandLevel)){const p=this.internalProps.layoutMap.rowDimensionTree.tree.children;(a=this.internalProps.rowTree)===null||a===void 0||a.forEach((v,m)=>{const C=p.find(b=>b.dimensionKey===v.dimensionKey&&b.value===v.value);C&&this.syncHierarchyState(C,v)})}const f=this.internalProps.records;if(this.internalProps.enableDataAnalysis&&(t.rows||t.columns)){const p=(l=t.rows)===null||l===void 0?void 0:l.reduce((C,b)=>(typeof b=="string"?C.push(b):C.push(b.dimensionKey),C),[]),v=(h=t.columns)===null||h===void 0?void 0:h.reduce((C,b)=>(typeof b=="string"?C.push(b):C.push(b.dimensionKey),C),[]),m=(u=t.indicators)===null||u===void 0?void 0:u.reduce((C,b)=>(typeof b=="string"?C.push(b):C.push(b.indicatorKey),C),[]);this.dataset=new wd(g.dataConfig,p,v,m,this.internalProps.indicators,(d=t.indicatorsAsCol)===null||d===void 0||d,t.records,t.rowHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree),g.layoutMap=new Pr(this,this.dataset)}else{if(!Array.isArray(this.internalProps.columnTree)&&!Array.isArray(this.internalProps.rowTree))return this;g.layoutMap=new Pr(this,null),((c=f==null?void 0:f[0])===null||c===void 0?void 0:c.constructor)!==Array&&(this.flatDataToObjects=new P0({rows:g.layoutMap.fullRowDimensionKeys,columns:g.layoutMap.colDimensionKeys,indicators:g.layoutMap.indicatorKeys,indicatorsAsCol:g.layoutMap.indicatorsAsCol,indicatorDimensionKey:g.layoutMap.indicatorDimensionKey},f))}return this.pivotSortState=[],t.pivotSortState&&this.updatePivotSortState(t.pivotSortState),this.refreshHeader(),g.releaseList&&(g.releaseList.forEach(p=>{var v;return(v=p==null?void 0:p.release)===null||v===void 0?void 0:v.call(p)}),g.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),t.title&&(this.internalProps.title=new gs(t.title,this),this.scenegraph.resize()),new Promise(p=>{setTimeout(p,0)})}updatePagination(t){t?(this.pagination||(this.pagination={currentPage:0,perPageCount:0}),typeof t.currentPage=="number"&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(this.pagination),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()):this.pagination&&(this.pagination=void 0,this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(void 0),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render())}refreshHeader(){var t,e;const i=this.internalProps;for(let r=0;r<i.layoutMap.columnWidths.length;r++){const{width:o,minWidth:s,maxWidth:a}=(e=(t=i.layoutMap.columnWidths)===null||t===void 0?void 0:t[r])!==null&&e!==void 0?e:{};o&&(typeof o=="string"&&o!=="auto"||typeof o=="number"&&o>0)&&this._setColWidth(r,o),s&&(typeof s=="number"&&s>0||typeof s=="string")&&this.setMinColWidth(r,s),a&&(typeof a=="number"&&a>0||typeof a=="string")&&this.setMaxColWidth(r,a)}this.refreshRowColCount()}refreshRowColCount(){var t,e,i,r,o,s,a;const l=this,{layoutMap:h}=l.internalProps;h&&(l.colCount=(t=h.colCount)!==null&&t!==void 0?t:0,l.rowCount=(e=h.rowCount)!==null&&e!==void 0?e:0,l.internalProps.frozenColCount=(i=h.rowHeaderLevelCount)!==null&&i!==void 0?i:0,l.frozenRowCount=h.headerLevelCount,l.bottomFrozenRowCount!==((r=this.options.bottomFrozenRowCount)!==null&&r!==void 0?r:0)&&(l.bottomFrozenRowCount=(o=this.options.bottomFrozenRowCount)!==null&&o!==void 0?o:0),l.rightFrozenColCount!==((s=this.options.rightFrozenColCount)!==null&&s!==void 0?s:0)&&(l.rightFrozenColCount=(a=this.options.rightFrozenColCount)!==null&&a!==void 0?a:0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}_getSortFuncFromHeaderOption(t,e,i){}get rowHierarchyType(){return this.internalProps.layoutMap.rowHierarchyType}syncHierarchyState(t,e){var i,r;t.value===e.value&&t.dimensionKey===e.dimensionKey&&(e.hierarchyState=(i=e.hierarchyState)!==null&&i!==void 0?i:e!=null&&e.children?t.hierarchyState:void 0,(r=e==null?void 0:e.children)===null||r===void 0||r.forEach((o,s)=>{var a;if(!((a=t==null?void 0:t.children)===null||a===void 0)&&a[s]&&o){const l=t.children.find(h=>h.dimensionKey===o.dimensionKey&&h.value===o.value);l&&this.syncHierarchyState(l,o)}}))}getRecordShowIndexByCell(t,e){}getTableIndexByRecordIndex(t){}getTableIndexByField(t){}getCellAddrByFieldRecord(t,e){}getBodyIndexByRow(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByRow(t)}getBodyIndexByCol(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByCol(t)}getFieldData(t,e,i){var r;if(this.internalProps.layoutMap.isHeader(e,i))return;if(this.dataset){const a=this.internalProps.layoutMap.getCellHeaderPaths(e,i);if(a){const l=a.colHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),h=a.rowHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),u=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?h:h.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?l.slice(0,-1):l,this.internalProps.layoutMap.getIndicatorKey(e,i));if(u.records&&u.records.length>=1)return u.records[0][t]}}else if(this.flatDataToObjects){const a=this.internalProps.layoutMap.getCellHeaderPaths(e,i),l=a.colHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),h=a.rowHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),u=this.flatDataToObjects.getTreeNode(h,l,this.internalProps.layoutMap.getBody(e,i).indicatorKey,!1);if(u!=null&&u.record)return u==null?void 0:u.record[t]}const o=this.getBodyIndexByRow(i),s=this.getBodyIndexByCol(e);return(r=this.records[o])===null||r===void 0?void 0:r[s]}getCellValue(t,e){var i,r;const o=this.getCustomMergeValue(t,e);if(o)return o;if(this.internalProps.layoutMap.isHeader(t,e)){const{title:u,fieldFormat:d}=this.internalProps.layoutMap.getHeader(t,e);return typeof d=="function"?d(u,t,e,this):u}if(this.dataset){const u=this.internalProps.layoutMap.getCellHeaderPaths(t,e),d=u.colHeaderPaths.map(f=>{var p;return(p=f.indicatorKey)!==null&&p!==void 0?p:f.value}),c=u.rowHeaderPaths.map(f=>{var p;return(p=f.indicatorKey)!==null&&p!==void 0?p:f.value}),g=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?c:c.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?d.slice(0,-1):d,this.internalProps.layoutMap.getIndicatorKey(t,e));return g.formatValue?g.formatValue(t,e,this):""}if(this.flatDataToObjects){const u=this.internalProps.layoutMap.getCellHeaderPaths(t,e),d=u.colHeaderPaths.map(p=>{var v;return(v=p.indicatorKey)!==null&&v!==void 0?v:p.value}),c=u.rowHeaderPaths.map(p=>{var v;return(v=p.indicatorKey)!==null&&v!==void 0?v:p.value}),g=this.flatDataToObjects.getTreeNode(c,d,this.internalProps.layoutMap.getBody(t,e).indicatorKey),{fieldFormat:f}=this.internalProps.layoutMap.getBody(t,e);return typeof f=="function"?f(g==null?void 0:g.value,t,e,this):(i=g==null?void 0:g.value)!==null&&i!==void 0?i:""}const{fieldFormat:s}=this.internalProps.layoutMap.getBody(t,e),a=this.getBodyIndexByRow(e),l=this.getBodyIndexByCol(t),h=(r=this.records[a])===null||r===void 0?void 0:r[l];return typeof s=="function"?s(h,t,e,this):h}getCellOriginValue(t,e){var i;const r=this;if(r.internalProps.layoutMap.isHeader(t,e)){const{title:a}=r.internalProps.layoutMap.getHeader(t,e);return typeof a=="function"?a():a}if(this.dataset){const a=this.internalProps.layoutMap.getCellHeaderPaths(t,e),l=a.colHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),h=a.rowHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),u=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?h:h.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?l.slice(0,-1):l,this.internalProps.layoutMap.getIndicatorKey(t,e));return u.value?u.value():void 0}if(this.flatDataToObjects){const a=this.internalProps.layoutMap.getCellHeaderPaths(t,e),l=a.colHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),h=a.rowHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),u=this.flatDataToObjects.getTreeNode(h,l,this.internalProps.layoutMap.getBody(t,e).indicatorKey);return u==null?void 0:u.value}const o=this.getBodyIndexByRow(e),s=this.getBodyIndexByCol(t);return(i=this.records[o])===null||i===void 0?void 0:i[s]}getCellRawValue(t,e){var i;const r=this;if(r.internalProps.layoutMap.isHeader(t,e)){const{title:a}=r.internalProps.layoutMap.getHeader(t,e);return typeof a=="function"?a():a}if(this.dataset){const a=this.internalProps.layoutMap.getCellHeaderPaths(t,e),l=a.colHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),h=a.rowHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),u=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?h:h.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?l.slice(0,-1):l,this.internalProps.layoutMap.getIndicatorKey(t,e),!1);return u.value?u.value():void 0}if(this.flatDataToObjects){const a=this.internalProps.layoutMap.getCellHeaderPaths(t,e),l=a.colHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),h=a.rowHeaderPaths.map(d=>{var c;return(c=d.indicatorKey)!==null&&c!==void 0?c:d.value}),u=this.flatDataToObjects.getTreeNode(h,l,this.internalProps.layoutMap.getBody(t,e).indicatorKey,!1);return u==null?void 0:u.value}const o=this.getBodyIndexByRow(e),s=this.getBodyIndexByCol(t);return(i=this.records[o])===null||i===void 0?void 0:i[s]}getCellOriginRecord(t,e){var i;if(this.internalProps.layoutMap.isHeader(t,e))return;if(this.dataset){const s=this.internalProps.layoutMap.getCellHeaderPaths(t,e),a=s.colHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value}),l=s.rowHeaderPaths.map(h=>{var u;return(u=h.indicatorKey)!==null&&u!==void 0?u:h.value});return this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?l:l.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?a.slice(0,-1):a,this.internalProps.layoutMap.getIndicatorKey(t,e)).records}if(this.flatDataToObjects){const s=this.internalProps.layoutMap.getCellHeaderPaths(t,e),a=s.colHeaderPaths.map(u=>{var d;return(d=u.indicatorKey)!==null&&d!==void 0?d:u.value}),l=s.rowHeaderPaths.map(u=>{var d;return(d=u.indicatorKey)!==null&&d!==void 0?d:u.value}),h=this.flatDataToObjects.getTreeNode(l,a,this.internalProps.layoutMap.getBody(t,e).indicatorKey,!1);return h==null?void 0:h.record}const r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t);return(i=this.records[r])===null||i===void 0?void 0:i[o]}getCellRawRecord(t,e){return this.getCellOriginRecord(t,e)}updateSortRules(t){this.internalProps.dataConfig.sortRules=t,this.dataset.updateSortRules(t),this.internalProps.layoutMap.resetHeaderTree(),this.scenegraph.clearCells(),this.refreshHeader(),this.scenegraph.createSceneGraph(),this.render()}updatePivotSortState(t){for(let e=0;e<t.length;e++){const{dimensions:i,order:r}=t[e],o=this.internalProps.layoutMap.getPivotCellAdress(i);o&&this.pivotSortState.push({col:o.col,row:o.row,order:r})}}getPivotSortState(t,e){if(!this.pivotSortState)return;const i=this.getCellRange(t,e);for(let r=0;r<this.pivotSortState.length;r++){const{col:o,row:s,order:a}=this.pivotSortState[r];if(Bn(i,o,s))return a}}_moveHeaderPosition(t,e){var i,r,o,s,a,l;const h=this.getCellRange(t.col,t.row),u=this.getCellRange(e.col,e.row),d=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(d){if(d.moveType==="column"){if(((r=(i=this.options.records)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.constructor)===Array)for(let c=0;c<this.internalProps.records.length;c++){const g=this.internalProps.records[c].splice(d.sourceIndex-this.rowHeaderLevelCount,d.sourceSize);g.unshift(d.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[c],g)}this.colWidthsMap.exchangeOrder(h.start.col,h.end.col-h.start.col+1,u.start.col,u.end.col-u.start.col+1,d.targetIndex);for(let c=0;c<this.internalProps.layoutMap.columnWidths.length;c++){const{minWidth:g,maxWidth:f}=(s=(o=this.internalProps.layoutMap.columnWidths)===null||o===void 0?void 0:o[c])!==null&&s!==void 0?s:{};g&&(typeof g=="number"&&g>0||typeof g=="string")&&this.setMinColWidth(c,g),f&&(typeof f=="number"&&f>0||typeof f=="string")&&this.setMaxColWidth(c,f)}}else if(d.moveType==="row"){if(((l=(a=this.options.records)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.constructor)===Array){const c=this.internalProps.records.splice(d.sourceIndex-this.columnHeaderLevelCount,d.sourceSize);c.unshift(d.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,c)}d.targetIndex>d.sourceIndex?this.rowHeightsMap.exchangeOrder(d.sourceIndex,d.sourceSize,d.targetIndex+d.sourceSize-d.targetSize,d.targetSize,d.targetIndex):this.rowHeightsMap.exchangeOrder(d.sourceIndex,d.sourceSize,d.targetIndex,d.targetSize,d.targetIndex)}return d}return null}toggleHierarchyState(t,e){let i=!1,r=!1;const o=this.internalProps.layoutMap.checkHasChart();o&&(this.autoFillWidth&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(r=this.getAllRowsHeight()<=this.tableNoFrameHeight));const s=this.getHierarchyState(t,e);s===Ft.expand?this.fireListeners(za.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Ft.collapse}):s===Ft.collapse&&this.fireListeners(za.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Ft.expand,originData:this.getCellOriginRecord(t,e)});const a=this.internalProps.layoutMap.toggleHierarchyState(t,e);this.refreshRowColCount(),this.clearCellStyleCache(),this.scenegraph.updateHierarchyIcon(t,e),this.scenegraph.updateRow(a.removeCellPositions,a.addCellPositions,a.updateCellPositions),o&&(this.autoFillWidth&&!i&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!r&&(r=this.getAllRowsHeight()<=this.tableNoFrameHeight),(this.widthMode==="adaptive"||i||this.heightMode==="adaptive"||r)&&this.scenegraph.updateChartSize(0))}getHeaderCellAddressByPath(t){return this.internalProps.layoutMap.getPivotCellAdress(t)}getCellAddressByHeaderPaths(t){return this.internalProps.layoutMap.getCellAdressByHeaderPath(t)}getHeaderPathByXY(t){let e;return e=t?this.getCellAt(t.x+this.getFrozenColsWidth()+this.scrollLeft+1,t.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1),this.internalProps.layoutMap.getCellHeaderPaths(e.col,e.row)}getHierarchyState(t,e){var i;return(i=this._getHeaderLayoutMap(t,e))===null||i===void 0?void 0:i.hierarchyState}getLayoutColumnTree(){return this.internalProps.layoutMap.getLayoutColumnTree()}getLayoutColumnTreeCount(){return this.internalProps.layoutMap.getLayoutColumnTreeCount()}getLayoutRowTree(){return this.internalProps.layoutMap.getLayoutRowTree()}getLayoutRowTreeCount(){return this.internalProps.layoutMap.getLayoutRowTreeCount()}getCellHeaderTreeNodes(t,e){return this.internalProps.layoutMap.getCellHeaderPathsWidthTreeNode(t,e)}_hasHierarchyTreeHeader(){return this.internalProps.layoutMap.rowHierarchyType==="tree"}getMenuInfo(t,e,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(t,e);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),isPivotCorner:this.isCornerHeader(t,e),event:void 0}}setRecords(t){var e;const i={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=t;const r=this.options,o=this.internalProps;this.internalProps.enableDataAnalysis&&(r.rows||r.columns)?(this.dataset.setRecords(t),o.layoutMap=new Pr(this,this.dataset),this.pivotSortState=[],r.pivotSortState&&this.updatePivotSortState(r.pivotSortState)):(Array.isArray(this.internalProps.columnTree)||Array.isArray(this.internalProps.rowTree))&&((e=t==null?void 0:t[0])===null||e===void 0?void 0:e.constructor)!==Array&&(this.flatDataToObjects=new P0({rows:o.layoutMap.fullRowDimensionKeys,columns:o.layoutMap.colDimensionKeys,indicators:o.layoutMap.indicatorKeys,indicatorsAsCol:o.layoutMap.indicatorsAsCol,indicatorDimensionKey:o.layoutMap.indicatorDimensionKey},t)),this.refreshHeader(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(i.col,i.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder()}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){var i;const r=this.getBodyColumnDefine(t,e);let o=(i=r==null?void 0:r.editor)!==null&&i!==void 0?i:this.options.editor;return typeof o=="function"&&(o=o({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),typeof o=="string"?rw(o):o}isHasEditorDefine(t,e){var i;const r=this.getBodyColumnDefine(t,e);let o=(i=r==null?void 0:r.editor)!==null&&i!==void 0?i:this.options.editor;return typeof o=="function"&&(o=o({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),N(o)}changeCellValue(t,e,i){let r=i;if(typeof this.getCellRawValue(t,e)=="number"&&Kg(i)&&(r=parseFloat(i)),this._changeCellValueToDataSet(t,e,r),this.scenegraph.updateCellContent(t,e),this.widthMode==="adaptive"||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)this.internalProps._widthResizedColMap.size===0&&this.scenegraph.recalculateColWidths();else if(!this.internalProps._widthResizedColMap.has(t)){const o=this.getColWidth(t),s=Er(t,0,this.rowCount-1,this,!1);s!==o&&this.scenegraph.updateColWidth(t,s-o)}if(this.heightMode==="adaptive"||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if(this.heightMode==="autoHeight"){const o=this.getRowHeight(e),s=Ui(e,0,this.colCount-1,this);this.scenegraph.updateRowHeight(e,s-o)}this.fireListeners(Q.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:this.getCellRawValue(t,e),changedValue:r}),this.scenegraph.updateNextFrame()}changeCellValues(t,e,i,r=!1){let o=t,s=e;for(let h=0;h<i.length&&!(e+h>this.rowCount-1);h++){s=e+h;const u=i[h];let d=t;for(let c=0;c<u.length&&!(t+c>this.colCount-1);c++)if(d=t+c,r&&this.isHasEditorDefine(t+c,e+h)||r===!1){const g=u[c];let f=g;const p=this.getCellRawValue(t+c,e+h);typeof p=="number"&&Kg(g)&&(f=parseFloat(g)),this._changeCellValueToDataSet(t+c,e+h,f),this.fireListeners(Q.CHANGE_CELL_VALUE,{col:t+c,row:e+h,rawValue:p,changedValue:this.getCellOriginValue(t+c,e+h)})}o=Math.max(o,d)}const a=this.getCellRange(t,e),l=this.getCellRange(o,s);for(let h=a.start.col;h<=l.end.col;h++)for(let u=a.start.row;u<=l.end.row;u++)this.scenegraph.updateCellContent(h,u);if(this.widthMode==="adaptive"||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)this.internalProps._widthResizedColMap.size===0&&this.scenegraph.recalculateColWidths();else for(let h=t;h<=l.end.col;h++)if(!this.internalProps._widthResizedColMap.has(h)){const u=this.getColWidth(h),d=Er(h,0,this.rowCount-1,this,!1);d!==u&&this.scenegraph.updateColWidth(h,d-u)}if(this.heightMode==="adaptive"||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if(this.heightMode==="autoHeight"){const h=[],u=[];for(let d=e;d<=l.end.row;d++)if(this.rowHeightsMap.get(d)){const c=this.getRowHeight(d),g=Ui(d,0,this.colCount-1,this);h.push(d),u.push(g-c)}this.scenegraph.updateRowsHeight(h,u)}this.scenegraph.updateNextFrame()}_changeCellValueToDataSet(t,e,i){if(this.dataset){const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths.map(a=>{var l;return(l=a.indicatorKey)!==null&&l!==void 0?l:a.value}),s=r.rowHeaderPaths.map(a=>{var l;return(l=a.indicatorKey)!==null&&l!==void 0?l:a.value});this.dataset.changeTreeNodeValue(this.internalProps.layoutMap.indicatorsAsCol?s:s.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?o.slice(0,-1):o,this.internalProps.layoutMap.getIndicatorKey(t,e),i)}else if(this.flatDataToObjects){const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths.map(a=>{var l;return(l=a.indicatorKey)!==null&&l!==void 0?l:a.value}),s=r.rowHeaderPaths.map(a=>{var l;return(l=a.indicatorKey)!==null&&l!==void 0?l:a.value});this.flatDataToObjects.changeTreeNodeValue(s,o,this.internalProps.layoutMap.getBody(t,e).indicatorKey,i)}else{const r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t);this.records[r][o]=i}}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:t,rowsDefine:e,indicatorsDefine:i}=this.internalProps.layoutMap;for(let r=0;r<t.length;r++){const o=t[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<i.length;r++){const o=i[r];if(typeof o!="string"&&(o.customLayout||o.headerCustomLayout||o.customRender||o.headerCustomRender))return!0}return!1}}class fw extends M0{constructor(t,e){var i,r,o,s,a,l,h,u,d,c;Pt.mode==="node"?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e),this._selectedDataItemsInChart=[],this._selectedDimensionInChart=[],this._chartEventMap={},e.layout&&Object.assign(e,e.layout),this.internalProps.columns=Ot(e.columns),this.internalProps.rows=Ot(e.rows),this.internalProps.indicators=Ot(e.indicators),this.internalProps.columnTree=!e.indicatorsAsCol||!((i=e.columns)===null||i===void 0)&&i.length||e.columnTree?Ot(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||!((r=e.rows)===null||r===void 0)&&r.length||e.rowTree?Ot(e.rowTree):[],this.internalProps.records=e.records,this.setCustomStateNameToSpec(),this.internalProps.columnResizeType=(o=e.columnResizeType)!==null&&o!==void 0?o:"column",this.internalProps.dataConfig={isPivotChart:!0},this._axes=rt(e.axes)?e.axes:[];const g=(a=(s=e.rows)===null||s===void 0?void 0:s.reduce((v,m)=>(typeof m=="string"?v.push(m):v.push(m.dimensionKey),v),[]))!==null&&a!==void 0?a:[],f=(h=(l=e.columns)===null||l===void 0?void 0:l.reduce((v,m)=>(typeof m=="string"?v.push(m):v.push(m.dimensionKey),v),[]))!==null&&h!==void 0?h:[],p=(d=(u=e.indicators)===null||u===void 0?void 0:u.reduce((v,m)=>(typeof m=="string"?v.push(m):v.push(m.indicatorKey),v),[]))!==null&&d!==void 0?d:[];this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(f,g),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new wd(this.internalProps.dataConfig,g,f,p,this.internalProps.indicators,(c=e.indicatorsAsCol)===null||c===void 0||c,e.records,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),this.internalProps.layoutMap=new Pr(this,this.dataset),this.refreshHeader(),this.scenegraph.createSceneGraph(),e.title&&(this.internalProps.title=new gs(e.title,this),this.scenegraph.resize()),setTimeout(()=>{this.fireListeners(Q.INITIALIZED,null)},0)}static get EVENT_TYPE(){return s0}get pivotChartAxes(){return this._axes}get recordsCount(){var t;return(t=this.records)===null||t===void 0?void 0:t.length}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!0}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.internalProps.layoutMap.indicatorsAsCol){const r=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)return!1}return i}updateOption(t){var e,i,r,o,s,a,l,h,u,d,c,g;const f=this.internalProps;super.updateOption(t),this.internalProps.columns=Ot(t.columns),this.internalProps.rows=Ot(t.rows),this.internalProps.indicators=!((e=t.indicators)===null||e===void 0)&&e.length?Ot(t.indicators):[],this.internalProps.columnTree=!t.indicatorsAsCol||!((i=t.columns)===null||i===void 0)&&i.length||t.columnTree?Ot(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||!((r=t.rows)===null||r===void 0)&&r.length||t.rowTree?Ot(t.rowTree):[],t.records&&(this.internalProps.records=t.records),this.setCustomStateNameToSpec(),this._selectedDataItemsInChart=[],f.columnResizeType=(o=t.columnResizeType)!==null&&o!==void 0?o:"column",f.dataConfig={isPivotChart:!0},this._axes=rt(t.axes)?t.axes:[];const p=(a=(s=t.rows)===null||s===void 0?void 0:s.reduce((C,b)=>(typeof b=="string"?C.push(b):C.push(b.dimensionKey),C),[]))!==null&&a!==void 0?a:[],v=(h=(l=t.columns)===null||l===void 0?void 0:l.reduce((C,b)=>(typeof b=="string"?C.push(b):C.push(b.dimensionKey),C),[]))!==null&&h!==void 0?h:[],m=(d=(u=t.indicators)===null||u===void 0?void 0:u.reduce((C,b)=>(typeof b=="string"?C.push(b):C.push(b.indicatorKey),C),[]))!==null&&d!==void 0?d:[];return this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(v,p),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new wd(this.internalProps.dataConfig,p,v,m,this.internalProps.indicators,(c=t.indicatorsAsCol)===null||c===void 0||c,(g=t.records)!==null&&g!==void 0?g:this.internalProps.records,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),f.layoutMap=new Pr(this,this.dataset),this.refreshHeader(),f.releaseList&&(f.releaseList.forEach(C=>{var b;return(b=C==null?void 0:C.release)===null||b===void 0?void 0:b.call(C)}),f.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),t.title&&(this.internalProps.title=new gs(t.title,this),this.scenegraph.resize()),new Promise(C=>{setTimeout(C,0)})}updatePagination(){}refreshHeader(){var t,e;const i=this.internalProps;for(let r=0;r<i.layoutMap.columnWidths.length;r++){const{width:o,minWidth:s,maxWidth:a}=(e=(t=i.layoutMap.columnWidths)===null||t===void 0?void 0:t[r])!==null&&e!==void 0?e:{};o&&(typeof o=="string"&&o!=="auto"||typeof o=="number"&&o>0)&&this._setColWidth(r,o),s&&(typeof s=="number"&&s>0||typeof s=="string")&&this.setMinColWidth(r,s),a&&(typeof a=="number"&&a>0||typeof a=="string")&&this.setMaxColWidth(r,a)}this.refreshRowColCount()}refreshRowColCount(){var t,e,i,r,o,s,a;const l=this,{layoutMap:h}=l.internalProps;h&&(l.colCount=(t=h.colCount)!==null&&t!==void 0?t:0,l.rowCount=(e=h.rowCount)!==null&&e!==void 0?e:0,l.internalProps.frozenColCount=(i=h.rowHeaderLevelCount)!==null&&i!==void 0?i:0,l.frozenRowCount=h.headerLevelCount,l.bottomFrozenRowCount!==((r=h==null?void 0:h.bottomFrozenRowCount)!==null&&r!==void 0?r:0)&&(l.bottomFrozenRowCount=(o=h==null?void 0:h.bottomFrozenRowCount)!==null&&o!==void 0?o:0),l.rightFrozenColCount!==((s=h==null?void 0:h.rightFrozenColCount)!==null&&s!==void 0?s:0)&&(l.rightFrozenColCount=(a=h==null?void 0:h.rightFrozenColCount)!==null&&a!==void 0?a:0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}_getSortFuncFromHeaderOption(t,e,i){}syncHierarchyState(t,e){var i,r;t.value===e.value&&t.dimensionKey===e.dimensionKey&&(e.hierarchyState=(i=e.hierarchyState)!==null&&i!==void 0?i:e!=null&&e.children?t.hierarchyState:void 0,(r=e==null?void 0:e.children)===null||r===void 0||r.forEach((o,s)=>{var a;!((a=t==null?void 0:t.children)===null||a===void 0)&&a[s]&&o&&this.syncHierarchyState(t.children[s],o)}))}getRecordShowIndexByCell(t,e){}getTableIndexByRecordIndex(t){}getTableIndexByField(t){}getCellAddrByFieldRecord(t,e){}getBodyIndexByRow(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByRow(t)}getBodyIndexByCol(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByCol(t)}getCellValue(t,e){var i,r,o;const s=this.getCustomMergeValue(t,e);if(s)return s;if(this.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.layoutMap.isBottomFrozenRow(t,e)||this.internalProps.layoutMap.isRightFrozenColumn(t,e)){const g=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(t,e);let f;return g==null||g.forEach(p=>{const v=this.internalProps.layoutMap.getIndicatorInfo(p);v&&(f=v)}),(r=(i=f==null?void 0:f.title)!==null&&i!==void 0?i:f==null?void 0:f.indicatorKey)!==null&&r!==void 0?r:""}const{title:d,fieldFormat:c}=this.internalProps.layoutMap.getHeader(t,e);return typeof c=="function"?c(d,t,e,this):d}if(this.dataset){const d=this.internalProps.layoutMap.getCellHeaderPaths(t,e),c=d.colHeaderPaths.map(p=>{var v;return(v=p.indicatorKey)!==null&&v!==void 0?v:p.value}),g=d.rowHeaderPaths.map(p=>{var v;return(v=p.indicatorKey)!==null&&v!==void 0?v:p.value}),f=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?g:g.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?c.slice(0,-1):c,this.internalProps.layoutMap.getIndicatorKey(t,e));return f.value?f.value():void 0}const{fieldFormat:a}=this.internalProps.layoutMap.getBody(t,e),l=this.getBodyIndexByRow(e),h=this.getBodyIndexByCol(t),u=(o=this.records[l])===null||o===void 0?void 0:o[h];return typeof a=="function"?a(u,t,e,this):u}getCellOriginValue(t,e){var i,r,o;const s=this;if(s.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.layoutMap.isBottomFrozenRow(t,e)||this.internalProps.layoutMap.isRightFrozenColumn(t,e)){const u=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(t,e);let d;return u==null||u.forEach(c=>{const g=this.internalProps.layoutMap.getIndicatorInfo(c);g&&(d=g)}),(r=(i=d==null?void 0:d.title)!==null&&i!==void 0?i:d==null?void 0:d.indicatorKey)!==null&&r!==void 0?r:""}const{title:h}=s.internalProps.layoutMap.getHeader(t,e);return typeof h=="function"?h():h}if(this.dataset){const h=this.internalProps.layoutMap.getCellHeaderPaths(t,e),u=h.colHeaderPaths.map(g=>{var f;return(f=g.indicatorKey)!==null&&f!==void 0?f:g.value}),d=h.rowHeaderPaths.map(g=>{var f;return(f=g.indicatorKey)!==null&&f!==void 0?f:g.value}),c=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?d:d.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?u.slice(0,-1):u,this.internalProps.layoutMap.getIndicatorKey(t,e));return c.value?c.value():void 0}const a=this.getBodyIndexByRow(e),l=this.getBodyIndexByCol(t);return(o=this.records[a])===null||o===void 0?void 0:o[l]}getCellRawValue(t,e){return this.getCellOriginValue(t,e)}getCellOriginRecord(t,e){if(!this.internalProps.layoutMap.isHeader(t,e)&&this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map(s=>{var a;return(a=s.indicatorKey)!==null&&a!==void 0?a:s.value}),o=i.rowHeaderPaths.map(s=>{var a;return(a=s.indicatorKey)!==null&&a!==void 0?a:s.value});return this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e)).records}}getCellRawRecord(t,e){return this.getCellOriginRecord(t,e)}updateSortRules(t){this.internalProps.dataConfig.sortRules=t,this.dataset.updateSortRules(t),this.internalProps.layoutMap.resetHeaderTree(),this.scenegraph.clearCells(),this.refreshHeader(),this.scenegraph.createSceneGraph(),this.render()}updatePivotSortState(t){for(let e=0;e<t.length;e++){const{dimensions:i,order:r}=t[e],o=this.internalProps.layoutMap.getPivotCellAdress(i);o&&this.pivotSortState.push({col:o.col,row:o.row,order:r})}}getPivotSortState(t,e){if(!this.pivotSortState)return;const i=this.getCellRange(t,e);for(let r=0;r<this.pivotSortState.length;r++){const{col:o,row:s,order:a}=this.pivotSortState[r];if(Bn(i,o,s))return a}}_moveHeaderPosition(t,e){var i,r,o,s,a,l;const h=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(h){if(h.moveType==="column"){if(((r=(i=this.options.records)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.constructor)===Array)for(let u=0;u<this.internalProps.records.length;u++){const d=this.internalProps.records[u].splice(h.sourceIndex-this.rowHeaderLevelCount,h.sourceSize);d.unshift(h.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[u],d)}this.colWidthsMap.adjustOrder(h.sourceIndex,h.targetIndex,h.sourceSize);for(let u=0;u<this.internalProps.layoutMap.columnWidths.length;u++){const{minWidth:d,maxWidth:c}=(s=(o=this.internalProps.layoutMap.columnWidths)===null||o===void 0?void 0:o[u])!==null&&s!==void 0?s:{};d&&(typeof d=="number"&&d>0||typeof d=="string")&&this.setMinColWidth(u,d),c&&(typeof c=="number"&&c>0||typeof c=="string")&&this.setMaxColWidth(u,c)}}else if(h.moveType==="row"){if(((l=(a=this.options.records)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.constructor)===Array){const u=this.internalProps.records.splice(h.sourceIndex-this.columnHeaderLevelCount,h.sourceSize);u.unshift(h.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,u)}this.rowHeightsMap.adjustOrder(h.sourceIndex,h.targetIndex,h.sourceSize)}return h}return null}toggleHierarchyState(t,e){const i=this.getHierarchyState(t,e);i===Ft.expand?this.fireListeners(s0.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Ft.collapse}):i===Ft.collapse&&this.fireListeners(s0.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Ft.expand,originData:this.getCellOriginRecord(t,e)});const r=this.internalProps.layoutMap.toggleHierarchyState(t,e);this.refreshRowColCount(),this.clearCellStyleCache(),this.scenegraph.updateHierarchyIcon(t,e),this.scenegraph.updateRow(r.removeCellPositions,r.addCellPositions)}getHeaderCellAddressByPath(t){return this.internalProps.layoutMap.getPivotCellAdress(t)}getCellAddressByHeaderPaths(t){return this.internalProps.layoutMap.getCellAdressByHeaderPath(t)}getHeaderPathByXY(t){let e;return e=t?this.getCellAt(t.x+this.getFrozenColsWidth()+this.scrollLeft+1,t.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1),this.internalProps.layoutMap.getCellHeaderPaths(e.col,e.row)}getHierarchyState(t,e){var i;return(i=this._getHeaderLayoutMap(t,e))===null||i===void 0?void 0:i.hierarchyState}_hasHierarchyTreeHeader(){return this.internalProps.layoutMap.rowHierarchyType==="tree"}getMenuInfo(t,e,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(t,e);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),isPivotCorner:this.isCornerHeader(t,e),event:void 0}}_generateCollectValuesConfig(t,e){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A,x,B,F,T,R,M,E,P,I,k,H,O;const z=this.internalProps.indicators,j={};for(let U=0,W=z==null?void 0:z.length;U<W;U++)if(typeof z[U]!="string"&&z[U].chartSpec){if(((i=z[U].chartSpec)===null||i===void 0?void 0:i.type)==="pie")continue;if(this.options.indicatorsAsCol===!1){const V=z[U];if(((r=V.chartSpec)===null||r===void 0?void 0:r.stack)!==!1&&(((o=V.chartSpec)===null||o===void 0?void 0:o.type)==="bar"||((s=V.chartSpec)===null||s===void 0?void 0:s.type)==="area")&&(V.chartSpec.stack=!0),j[V.indicatorKey]={by:e,range:!0,sumBy:((a=V.chartSpec)===null||a===void 0?void 0:a.stack)&&t.concat((l=V.chartSpec)===null||l===void 0?void 0:l.xField)},V.chartSpec.series)V.chartSpec.series.forEach(L=>{var G,K,Y,nt,q,ot,at,et,ft,tt,dt,J,it,_t,Xt,ae;const Vt=typeof L.xField=="string"?L.xField:L.xField[0];j[Vt]={by:t,type:L.direction!=="horizontal"?"xField":void 0,range:L.direction==="horizontal",sortBy:L.direction!=="horizontal"?(nt=(Y=(K=(G=L==null?void 0:L.data)===null||G===void 0?void 0:G.fields)===null||K===void 0?void 0:K[Vt])===null||Y===void 0?void 0:Y.domain)!==null&&nt!==void 0?nt:(et=(at=(ot=(q=V.chartSpec)===null||q===void 0?void 0:q.data)===null||ot===void 0?void 0:ot.fields)===null||at===void 0?void 0:at[Vt])===null||et===void 0?void 0:et.domain:void 0};const pn=L.yField;L.stack!==!1&&(L.type==="bar"||L.type==="area")&&(L.stack=!0),j[pn]={by:e,range:L.direction!=="horizontal",sumBy:L.stack&&t.concat(L==null?void 0:L.xField),sortBy:L.direction==="horizontal"?(J=(dt=(tt=(ft=L==null?void 0:L.data)===null||ft===void 0?void 0:ft.fields)===null||tt===void 0?void 0:tt[pn])===null||dt===void 0?void 0:dt.domain)!==null&&J!==void 0?J:(ae=(Xt=(_t=(it=V.chartSpec)===null||it===void 0?void 0:it.data)===null||_t===void 0?void 0:_t.fields)===null||Xt===void 0?void 0:Xt[pn])===null||ae===void 0?void 0:ae.domain:void 0}});else{const L=typeof V.chartSpec.xField=="string"?V.chartSpec.xField:V.chartSpec.xField[0];j[L]={by:t,type:V.chartSpec.direction!=="horizontal"?"xField":void 0,range:V.chartSpec.direction==="horizontal",sortBy:V.chartSpec.direction!=="horizontal"?(c=(d=(u=(h=V.chartSpec)===null||h===void 0?void 0:h.data)===null||u===void 0?void 0:u.fields)===null||d===void 0?void 0:d[L])===null||c===void 0?void 0:c.domain:void 0},((g=V.chartSpec)===null||g===void 0?void 0:g.stack)!==!1&&(((f=V.chartSpec)===null||f===void 0?void 0:f.type)==="bar"||((p=V.chartSpec)===null||p===void 0?void 0:p.type)==="area")&&(V.chartSpec.stack=!0);const G=V.chartSpec.yField;j[G]={by:e,range:z[U].chartSpec.direction!=="horizontal",sumBy:V.chartSpec.stack&&t.concat((v=V.chartSpec)===null||v===void 0?void 0:v.xField),sortBy:V.chartSpec.direction==="horizontal"?(_=(b=(C=(m=V.chartSpec)===null||m===void 0?void 0:m.data)===null||C===void 0?void 0:C.fields)===null||b===void 0?void 0:b[G])===null||_===void 0?void 0:_.domain:void 0}}}else{const V=z[U];if(((y=V.chartSpec)===null||y===void 0?void 0:y.stack)!==!1&&(((w=V.chartSpec)===null||w===void 0?void 0:w.type)==="bar"||((S=V.chartSpec)===null||S===void 0?void 0:S.type)==="area")&&(V.chartSpec.stack=!0),j[V.indicatorKey]={by:t,range:!0,sumBy:((D=V.chartSpec)===null||D===void 0?void 0:D.stack)&&e.concat((A=V.chartSpec)===null||A===void 0?void 0:A.yField)},V.chartSpec.series)V.chartSpec.series.forEach(L=>{var G,K,Y,nt,q,ot,at,et,ft,tt,dt,J,it,_t,Xt,ae;const Vt=typeof L.yField=="string"?L.yField:L.yField[0];j[Vt]={by:e,type:L.direction==="horizontal"?"yField":void 0,range:L.direction!=="horizontal",sortBy:L.direction==="horizontal"?(nt=(Y=(K=(G=L==null?void 0:L.data)===null||G===void 0?void 0:G.fields)===null||K===void 0?void 0:K[Vt])===null||Y===void 0?void 0:Y.domain)!==null&&nt!==void 0?nt:(et=(at=(ot=(q=V.chartSpec)===null||q===void 0?void 0:q.data)===null||ot===void 0?void 0:ot.fields)===null||at===void 0?void 0:at[Vt])===null||et===void 0?void 0:et.domain:void 0};const pn=L.xField;L.stack!==!1&&(L.type==="bar"||L.type==="area")&&(L.stack=!0),j[pn]={by:t,range:L.direction==="horizontal",sumBy:L.stack&&e.concat(L==null?void 0:L.yField),sortBy:L.direction!=="horizontal"?(J=(dt=(tt=(ft=L==null?void 0:L.data)===null||ft===void 0?void 0:ft.fields)===null||tt===void 0?void 0:tt[pn])===null||dt===void 0?void 0:dt.domain)!==null&&J!==void 0?J:(ae=(Xt=(_t=(it=V.chartSpec)===null||it===void 0?void 0:it.data)===null||_t===void 0?void 0:_t.fields)===null||Xt===void 0?void 0:Xt[pn])===null||ae===void 0?void 0:ae.domain:void 0}});else{const L=typeof V.chartSpec.yField=="string"?V.chartSpec.yField:V.chartSpec.yField[0];j[L]={by:e,type:V.chartSpec.direction==="horizontal"?"yField":void 0,range:V.chartSpec.direction!=="horizontal",sortBy:V.chartSpec.direction==="horizontal"?(T=(F=(B=(x=V.chartSpec)===null||x===void 0?void 0:x.data)===null||B===void 0?void 0:B.fields)===null||F===void 0?void 0:F[L])===null||T===void 0?void 0:T.domain:void 0},((R=V.chartSpec)===null||R===void 0?void 0:R.stack)!==!1&&(((M=V.chartSpec)===null||M===void 0?void 0:M.type)==="bar"||((E=V.chartSpec)===null||E===void 0?void 0:E.type)==="area")&&(V.chartSpec.stack=!0);const G=V.chartSpec.xField;j[G]={by:t,range:z[U].chartSpec.direction==="horizontal",sumBy:V.chartSpec.stack&&e.concat((P=V.chartSpec)===null||P===void 0?void 0:P.yField),sortBy:V.chartSpec.direction!=="horizontal"?(O=(H=(k=(I=V.chartSpec)===null||I===void 0?void 0:I.data)===null||k===void 0?void 0:k.fields)===null||H===void 0?void 0:H[G])===null||O===void 0?void 0:O.domain:void 0}}}}return j}_generateAggregationRules(){var t;const e=[];return(t=this.internalProps.indicators)===null||t===void 0||t.forEach(i=>{var r,o;if(typeof i=="string")e.push({indicatorKey:i,field:i,aggregationType:Et.RECORD});else if(!((r=i.chartSpec)===null||r===void 0)&&r.series){const s=[];(o=i.chartSpec)===null||o===void 0||o.series.forEach(a=>{const l=this.options.indicatorsAsCol===!1?a.yField:a.xField;s.indexOf(l)===-1&&s.push(l)}),e.push({indicatorKey:i.indicatorKey,field:s,aggregationType:Et.RECORD})}else{const s=this.options.indicatorsAsCol===!1?i.chartSpec.yField:i.chartSpec.xField;e.push({indicatorKey:i.indicatorKey,field:s!=null?s:i.indicatorKey,aggregationType:Et.RECORD})}}),e}setCustomStateNameToSpec(){var t;const e=i=>{var r,o,s,a,l,h,u,d;!((o=(r=i.bar)===null||r===void 0?void 0:r.state)===null||o===void 0)&&o.selected&&(i.bar.state.vtable_selected=i.bar.state.selected,i.bar.state.vtable_selected_reverse=i.bar.state.selected_reverse,delete i.bar.state.selected,delete i.bar.state.selected_reverse),!((a=(s=i.point)===null||s===void 0?void 0:s.state)===null||a===void 0)&&a.selected&&(i.point.state.vtable_selected=i.point.state.selected,i.point.state.vtable_selected_reverse=i.point.state.selected_reverse,delete i.point.state.selected,delete i.point.state.selected_reverse),!((h=(l=i.line)===null||l===void 0?void 0:l.state)===null||h===void 0)&&h.selected&&(i.line.state.vtable_selected=i.line.state.selected,i.line.state.vtable_selected_reverse=i.line.state.selected_reverse,delete i.line.state.selected,delete i.line.state.selected_reverse),!((d=(u=i.area)===null||u===void 0?void 0:u.state)===null||d===void 0)&&d.selected&&(i.area.state.vtable_selected=i.area.state.selected,i.area.state.vtable_selected_reverse=i.area.state.selected_reverse,delete i.area.state.selected,delete i.area.state.selected_reverse)};(t=this.internalProps.indicators)===null||t===void 0||t.forEach(i=>{if(i.chartSpec){const r=i.chartSpec;r.series?r.series.forEach(o=>{e(o)}):e(r)}})}updateFilterRules(t){this.internalProps.dataConfig.filterRules=t,this.dataset.updateFilterRules(t),td(this.scenegraph),PL(this.scenegraph),this.render()}getLegendSelected(){return this.internalProps.legends.legendComponent._getSelectedLegends().map(t=>t.label)}setLegendSelected(t){this.internalProps.legends.legendComponent.setSelected(t)}getChartDatumPosition(t,e){const{chartInstance:i,bounds:r}=this.getChartInstance(e);if(i){const o=i.convertDatumToPosition(t);return o?{x:Math.round(o.x+r.x1),y:Math.round(o.y+r.y1)}:null}return null}getCellAddressByRecord(t){const e=[],i=[],r={},o=[];this.dataset.dataConfig.aggregationRules.forEach(s=>{if(typeof s.field=="string")r[s.field]=s.indicatorKey,o.push(s.field);else for(let a=0;a<s.field.length;a++)r[s.field[a]]=s.indicatorKey,o.push(s.field[a])});for(const s in t)this.dataset.rows.indexOf(s)>=0&&e.push({dimensionKey:s,value:t[s]}),this.dataset.columns.indexOf(s)>=0&&i.push({dimensionKey:s,value:t[s]}),o.indexOf(s)>=0&&(this.dataset.indicatorsAsCol?i.push({indicatorKey:r[s]}):e.push({indicatorKey:r[s]}));return this.getCellAddressByHeaderPaths({rowHeaderPaths:e,colHeaderPaths:i,cellLocation:"body"})}getChartInstance(t){var e,i,r,o,s;const a=this.getCellAddressByHeaderPaths(t);if(a){const l=this.getCellRelativeRect(a.col,a.row),h=this.scenegraph.getCell(a.col,a.row);let u;const d=(e=h==null?void 0:h.getChildren())===null||e===void 0?void 0:e[0];if(d.attribute.chartInstance){u=d.attribute.chartInstance;const{dataId:c,data:g,axes:f,spec:p}=d.attribute,v=d.getViewBox();if(f==null||f.forEach((m,C)=>{var b,_,y,w;m.type==="linear"?u.updateModelSpecSync({type:"axes",index:C},{min:(_=(b=m.range)===null||b===void 0?void 0:b.min)!==null&&_!==void 0?_:0,max:(w=(y=m.range)===null||y===void 0?void 0:y.max)!==null&&w!==void 0?w:0},!0):m.type==="band"&&u.updateModelSpec({type:"axes",index:C},{domain:m.domain.slice(0)},!0)}),u.updateViewBox({x1:v.x1-d.getRootNode().table.scrollLeft,x2:v.x2-d.getRootNode().table.scrollLeft,y1:v.y1-d.getRootNode().table.scrollTop,y2:v.y2-d.getRootNode().table.scrollTop},!1,!1),typeof c=="string")u.updateDataSync(c,g!=null?g:[]);else{const m=[];for(const C in c){const b=c[C],_=p.series.find(y=>{var w;return((w=y==null?void 0:y.data)===null||w===void 0?void 0:w.id)===C});m.push({id:C,values:b?(i=g==null?void 0:g.filter(y=>y.hasOwnProperty(b)))!==null&&i!==void 0?i:[]:g!=null?g:[],fields:(r=_==null?void 0:_.data)===null||r===void 0?void 0:r.fields}),u.updateFullDataSync||u.updateDataSync(C,b?(o=g==null?void 0:g.filter(y=>y.hasOwnProperty(b)))!==null&&o!==void 0?o:[]:g!=null?g:[])}(s=u.updateFullDataSync)===null||s===void 0||s.call(u,m)}this.renderAsync()}return{chartInstance:u,bounds:l.bounds}}return{}}_getDimensionSortArray(){var t,e;if(!((e=(t=this.options)===null||t===void 0?void 0:t.axes)===null||e===void 0)&&e.length){const i=this.options.indicatorsAsCol?"left":"bottom",r=this.options.axes.find(o=>o.orient===i);if(r&&rt(r.domain))return r.domain}}setRecords(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=t,this.options;const i=this.internalProps;this.dataset.setRecords(t),i.layoutMap=new Pr(this,this.dataset),this.refreshHeader(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder()}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:t,rowsDefine:e,indicatorsDefine:i}=this.internalProps.layoutMap;for(let r=0;r<t.length;r++){const o=t[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&(o.headerCustomLayout||o.headerCustomRender))return!0}for(let r=0;r<i.length;r++){const o=i[r];if(typeof o!="string"&&(o.customLayout||o.headerCustomLayout||o.customRender||o.headerCustomRender))return!0}return!1}}class Y5 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d;const c=isArray(t.boundsPadding),g=[(i=(e=t.marginTop)!==null&&e!==void 0?e:c?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:c?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:c?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:c?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=g,super(t)}}class $5 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p;t.direction&&(t.flexDirection=t.direction),!t.justifyContent||t.justifyContent!=="start"&&t.justifyContent!=="end"||(t.justifyContent="flex-"+t.justifyContent),!t.alignItems||t.alignItems!=="start"&&t.alignItems!=="end"||(t.alignItems="flex-"+t.alignItems),!t.alignContent||t.alignContent!=="start"&&t.alignContent!=="end"||(t.alignContent="flex-"+t.alignContent),t.display="flex",t.flexDirection||(t.flexDirection="row"),t.clip=!0,t.fill=(e=t==null?void 0:t.background)===null||e===void 0?void 0:e.fill,t.stroke=(i=t==null?void 0:t.background)===null||i===void 0?void 0:i.stroke,t.lineWidth=(r=t==null?void 0:t.background)===null||r===void 0?void 0:r.lineWidth,t.cornerRadius=(o=t==null?void 0:t.background)===null||o===void 0?void 0:o.cornerRadius;const v=isArray(t.boundsPadding),m=[(a=(s=t.marginTop)!==null&&s!==void 0?s:v?t.boundsPadding[0]:t.boundsPadding)!==null&&a!==void 0?a:0,(h=(l=t.marginRight)!==null&&l!==void 0?l:v?t.boundsPadding[1]:t.boundsPadding)!==null&&h!==void 0?h:0,(c=(u=t.marginBottom)!==null&&u!==void 0?u:v?(d=t.boundsPadding[2])!==null&&d!==void 0?d:t.boundsPadding[0]:t.boundsPadding)!==null&&c!==void 0?c:0,(p=(g=t.marginLeft)!==null&&g!==void 0?g:v?(f=t.boundsPadding[3])!==null&&f!==void 0?f:t.boundsPadding[1]:t.boundsPadding)!==null&&p!==void 0?p:0];t.boundsPadding=m,super(t)}}class X5 extends null{constructor(t){t.flexWrap="nowrap",super(t)}}class q5 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d,c,g;let f;isString(t.iconName)&&(f=registerIcons.get()[t.iconName],f&&(t.width=(e=t.width)!==null&&e!==void 0?e:f.width,t.height=(i=t.height)!==null&&i!==void 0?i:f.height,t.svg=f.svg,t.cursor=f.cursor)),t.svg&&(t.image=t.svg);const p=isArray(t.boundsPadding),v=[(o=(r=t.marginTop)!==null&&r!==void 0?r:p?t.boundsPadding[0]:t.boundsPadding)!==null&&o!==void 0?o:0,(a=(s=t.marginRight)!==null&&s!==void 0?s:p?t.boundsPadding[1]:t.boundsPadding)!==null&&a!==void 0?a:0,(u=(l=t.marginBottom)!==null&&l!==void 0?l:p?(h=t.boundsPadding[2])!==null&&h!==void 0?h:t.boundsPadding[0]:t.boundsPadding)!==null&&u!==void 0?u:0,(g=(d=t.marginLeft)!==null&&d!==void 0?d:p?(c=t.boundsPadding[3])!==null&&c!==void 0?c:t.boundsPadding[1]:t.boundsPadding)!==null&&g!==void 0?g:0];t.boundsPadding=v,super(t),this.cache=f}}class Z5 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d;t.src&&(t.image=t.src),t.shape==="circle"&&(t.cornerRadius=t.width/2);const c=isArray(t.boundsPadding),g=[(i=(e=t.marginTop)!==null&&e!==void 0?e:c?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:c?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:c?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:c?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=g,super(t)}}class J5 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d;const c=isArray(t.boundsPadding),g=[(i=(e=t.marginTop)!==null&&e!==void 0?e:c?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:c?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:c?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:c?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=g,super(t)}}class Q5 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d,c;t.textBaseline||(t.textBaseline="top");const g=isArray(t.boundsPadding),f=[(i=(e=t.marginTop)!==null&&e!==void 0?e:g?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:g?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:g?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:g?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=f,t.fill=(c=t.fill)!==null&&c!==void 0?c:"#000",super(t)}getSize(t){this.AABBBounds.width()}}function t4(n,t=0){return{percent:n,delta:t}}class e4 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d;const c=isArray(t.boundsPadding),g=[(i=(e=t.marginTop)!==null&&e!==void 0?e:c?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:c?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:c?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:c?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=g,super(t)}}class i4 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d;const c=isArray(t.boundsPadding),g=[(i=(e=t.marginTop)!==null&&e!==void 0?e:c?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:c?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:c?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:c?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=g,super(t)}getSize(t){this.AABBBounds.width()}}class n4 extends null{constructor(t){var e,i,r,o,s,a,l,h,u,d;const c=isArray(t.boundsPadding),g=[(i=(e=t.marginTop)!==null&&e!==void 0?e:c?t.boundsPadding[0]:t.boundsPadding)!==null&&i!==void 0?i:0,(o=(r=t.marginRight)!==null&&r!==void 0?r:c?t.boundsPadding[1]:t.boundsPadding)!==null&&o!==void 0?o:0,(l=(s=t.marginBottom)!==null&&s!==void 0?s:c?(a=t.boundsPadding[2])!==null&&a!==void 0?a:t.boundsPadding[0]:t.boundsPadding)!==null&&l!==void 0?l:0,(d=(h=t.marginLeft)!==null&&h!==void 0?h:c?(u=t.boundsPadding[3])!==null&&u!==void 0?u:t.boundsPadding[1]:t.boundsPadding)!==null&&d!==void 0?d:0];t.boundsPadding=g,super(t)}}function r4(n){var t,e,i,r,o,s,a;const l={isPivotChart:!0},h=(e=(t=n.rows)===null||t===void 0?void 0:t.reduce((c,g)=>(typeof g=="string"?c.push(g):c.push(g.dimensionKey),c),[]))!==null&&e!==void 0?e:[],u=(r=(i=n.columns)===null||i===void 0?void 0:i.reduce((c,g)=>(typeof g=="string"?c.push(g):c.push(g.dimensionKey),c),[]))!==null&&r!==void 0?r:[],d=(s=(o=n.indicators)===null||o===void 0?void 0:o.reduce((c,g)=>(typeof g=="string"?c.push(g):c.push(g.indicatorKey),c),[]))!==null&&s!==void 0?s:[];return l.collectValuesBy=RO(n,u,h),l.aggregationRules=EO(n),new Dataset(l,h,u,d,n.indicators,(a=n.indicatorsAsCol)===null||a===void 0||a,n.records,void 0,n.columnTree,n.rowTree,!0)}function RO(n,t,e){var i,r,o,s,a,l,h,u,d,c,g,f,p,v,m,C,b,_,y,w,S,D,A;const x={};for(let B=0,F=(i=n.indicators)===null||i===void 0?void 0:i.length;B<F;B++)if(typeof n.indicators[B]!="string"&&n.indicators[B].chartSpec)if(n.indicatorsAsCol===!1){const T=n.indicators[B];if(x[T.indicatorKey]={by:e,range:!0,sumBy:((r=T.chartSpec)===null||r===void 0?void 0:r.stack)!==!1&&t.concat((o=T.chartSpec)===null||o===void 0?void 0:o.xField)},T.chartSpec.series)T.chartSpec.series.forEach(R=>{var M,E,P,I,k,H,O,z,j,U,W,V,L,G,K,Y;const nt=typeof R.xField=="string"?R.xField:R.xField[0];x[nt]={by:t,type:R.direction!=="horizontal"?"xField":void 0,range:R.direction==="horizontal",sortBy:R.direction!=="horizontal"?(I=(P=(E=(M=R==null?void 0:R.data)===null||M===void 0?void 0:M.fields)===null||E===void 0?void 0:E[nt])===null||P===void 0?void 0:P.domain)!==null&&I!==void 0?I:(z=(O=(H=(k=T.chartSpec)===null||k===void 0?void 0:k.data)===null||H===void 0?void 0:H.fields)===null||O===void 0?void 0:O[nt])===null||z===void 0?void 0:z.domain:void 0};const q=R.yField;x[q]={by:e,range:R.direction!=="horizontal",sumBy:R.stack!==!1&&t.concat(R==null?void 0:R.xField),sortBy:R.direction==="horizontal"?(V=(W=(U=(j=R==null?void 0:R.data)===null||j===void 0?void 0:j.fields)===null||U===void 0?void 0:U[q])===null||W===void 0?void 0:W.domain)!==null&&V!==void 0?V:(Y=(K=(G=(L=T.chartSpec)===null||L===void 0?void 0:L.data)===null||G===void 0?void 0:G.fields)===null||K===void 0?void 0:K[q])===null||Y===void 0?void 0:Y.domain:void 0}});else{const R=typeof T.chartSpec.xField=="string"?T.chartSpec.xField:T.chartSpec.xField[0];x[R]={by:t,type:T.chartSpec.direction!=="horizontal"?"xField":void 0,range:T.chartSpec.direction==="horizontal",sortBy:T.chartSpec.direction!=="horizontal"?(h=(l=(a=(s=T.chartSpec)===null||s===void 0?void 0:s.data)===null||a===void 0?void 0:a.fields)===null||l===void 0?void 0:l[R])===null||h===void 0?void 0:h.domain:void 0};const M=T.chartSpec.yField;x[M]={by:e,range:n.indicators[B].chartSpec.direction!=="horizontal",sumBy:T.chartSpec.stack!==!1&&t.concat((u=T.chartSpec)===null||u===void 0?void 0:u.xField),sortBy:T.chartSpec.direction==="horizontal"?(f=(g=(c=(d=T.chartSpec)===null||d===void 0?void 0:d.data)===null||c===void 0?void 0:c.fields)===null||g===void 0?void 0:g[M])===null||f===void 0?void 0:f.domain:void 0}}}else{const T=n.indicators[B];if(x[T.indicatorKey]={by:t,range:!0,sumBy:((p=T.chartSpec)===null||p===void 0?void 0:p.stack)!==!1&&e.concat((v=T.chartSpec)===null||v===void 0?void 0:v.yField)},T.chartSpec.series)T.chartSpec.series.forEach(R=>{var M,E,P,I,k,H,O,z,j,U,W,V,L,G,K,Y;const nt=typeof R.yField=="string"?R.yField:R.yField[0];x[nt]={by:e,type:R.direction==="horizontal"?"yField":void 0,range:R.direction!=="horizontal",sortBy:R.direction==="horizontal"?(I=(P=(E=(M=R==null?void 0:R.data)===null||M===void 0?void 0:M.fields)===null||E===void 0?void 0:E[nt])===null||P===void 0?void 0:P.domain)!==null&&I!==void 0?I:(z=(O=(H=(k=T.chartSpec)===null||k===void 0?void 0:k.data)===null||H===void 0?void 0:H.fields)===null||O===void 0?void 0:O[nt])===null||z===void 0?void 0:z.domain:void 0};const q=R.xField;x[q]={by:t,range:R.direction==="horizontal",sumBy:R.stack!==!1&&e.concat(R==null?void 0:R.yField),sortBy:R.direction!=="horizontal"?(V=(W=(U=(j=R==null?void 0:R.data)===null||j===void 0?void 0:j.fields)===null||U===void 0?void 0:U[q])===null||W===void 0?void 0:W.domain)!==null&&V!==void 0?V:(Y=(K=(G=(L=T.chartSpec)===null||L===void 0?void 0:L.data)===null||G===void 0?void 0:G.fields)===null||K===void 0?void 0:K[q])===null||Y===void 0?void 0:Y.domain:void 0}});else{const R=typeof T.chartSpec.yField=="string"?T.chartSpec.yField:T.chartSpec.yField[0];x[R]={by:e,type:T.chartSpec.direction==="horizontal"?"yField":void 0,range:T.chartSpec.direction!=="horizontal",sortBy:T.chartSpec.direction==="horizontal"?(_=(b=(C=(m=T.chartSpec)===null||m===void 0?void 0:m.data)===null||C===void 0?void 0:C.fields)===null||b===void 0?void 0:b[R])===null||_===void 0?void 0:_.domain:void 0};const M=T.chartSpec.xField;x[M]={by:t,range:n.indicators[B].chartSpec.direction==="horizontal",sumBy:T.chartSpec.stack!==!1&&e.concat((y=T.chartSpec)===null||y===void 0?void 0:y.yField),sortBy:T.chartSpec.direction!=="horizontal"?(A=(D=(S=(w=T.chartSpec)===null||w===void 0?void 0:w.data)===null||S===void 0?void 0:S.fields)===null||D===void 0?void 0:D[M])===null||A===void 0?void 0:A.domain:void 0}}}return x}function EO(n){var t;const e=[];return(t=n.indicators)===null||t===void 0||t.forEach(i=>{var r,o;if(typeof i=="string")e.push({indicatorKey:i,field:i,aggregationType:AggregationType.RECORD});else if(!((r=i.chartSpec)===null||r===void 0)&&r.series){const s=[];(o=i.chartSpec)===null||o===void 0||o.series.forEach(a=>{const l=n.indicatorsAsCol===!1?a.yField:a.xField;s.indexOf(l)===-1&&s.push(l)}),e.push({indicatorKey:i.indicatorKey,field:s,aggregationType:AggregationType.RECORD})}else{const s=n.indicatorsAsCol===!1?i.chartSpec.yField:i.chartSpec.xField;e.push({indicatorKey:i.indicatorKey,field:s!=null?s:i.indicatorKey,aggregationType:AggregationType.RECORD})}}),e}function o4(n,t,e){const i=createDataset(n),r=new PivotHeaderLayoutMap({options:n,internalProps:n,isPivotChart:()=>!0,pivotChartAxes:[],_selectedDataItemsInChart:[],_getActiveChartInstance:()=>({updateState:()=>{}})},i);for(let o=0;o<r.colCount;o++)for(let s=0;s<r.rowCount;s++){if(r.isHeader(o,s))continue;const a=r.getCellHeaderPaths(o,s),l=a.colHeaderPaths.map(c=>{var g;return(g=c.indicatorKey)!==null&&g!==void 0?g:c.value}),h=a.rowHeaderPaths.map(c=>{var g;return(g=c.indicatorKey)!==null&&g!==void 0?g:c.value}),u=i.getAggregator(r.indicatorsAsCol?h:h.slice(0,-1),r.indicatorsAsCol?l.slice(0,-1):l,r.getIndicatorKey(o,s)),d=PO(u.value?u.value():void 0,t,o,s,r,e);if(d)return d}}function PO(n,t,e,i,r,o){if(isArray(n)){for(let s=0;s<n.length;s++)if(o?o(n[s],t):HO(n[s],t))return r.getCellHeaderPaths(e,i)}}function HO(n,t){return JSON.stringify(n)===JSON.stringify(t)}function s4(n){return new Tag(n?n.attribute:{})}qC();const a4="0.21.3";function l4(){return icons.get()}function h4(){register.clearAll()}var se=mt(67294),LO=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};function kO(n,t="TableContainer",e){const i=se.forwardRef((r,o)=>{const s=(0,se.useRef)(),[a,l]=(0,se.useState)(!1),{className:h,style:u,width:d}=r,c=LO(r,["className","style","width"]);return(0,se.useLayoutEffect)(()=>{l(!0)},[]),se.createElement("div",{ref:s,className:h,style:Object.assign({position:"relative",height:r.height||"100%",width:r.width||"100%"},u)},a?se.createElement(n,Object.assign({ref:o,container:s.current},e?e(c):c)):se.createElement(se.Fragment,null))});return i.displayName=t||n.name,i}const H0=se.createContext(null);H0.displayName="TableContext";function u4(n){const t=React.forwardRef((e,i)=>React.createElement(H0.Consumer,null,r=>React.createElement(n,Object.assign({ref:i,table:r.table},e))));return t.displayName=n.name,t}var IO=H0,OO=mt(27);let pw=0;const d4=n=>n?`${n}-${pw++}`:""+pw++,L0=n=>typeof n=="string"?n:n?n.displayName||n.name:"",zO=(n,t="__TYPE")=>(n==null?void 0:n.props)&&n.props[t]||typeof(n==null?void 0:n.type)=="string"&&n.type||(n==null?void 0:n.type)&&typeof n.type=="symbol"&&n.type.toString()==="Symbol(react.fragment)"&&"react.fragment"||typeof(n==null?void 0:n.type)=="function"&&n.type||typeof(n==null?void 0:n.type)=="object"&&n.type.$$typeof.toString()==="Symbol(react.forward_ref)"&&"react.forward_ref"||typeof n=="string"&&"string"||typeof n=="function"&&"function"||void 0,Dd=n=>{let t=[];return se.Children.forEach(n,e=>{ut(e)||((0,OO.isFragment)(e)?t=t.concat(Dd(e.props.children)):t.push(e))}),t},WO=(n,t)=>{const e=[];let i=[];return i=isArray(t)?t.map(r=>L0(r)):[L0(t)],Dd(n).forEach(r=>{const o=L0(zO(r));i.indexOf(o)!==-1&&e.push(r)}),e},c4=(n,t)=>{const e=WO(n,t);return e==null?void 0:e[0]},NO=["children","hooks","ref"],Ht=Object.assign(Object.assign(Object.assign({},uw.EVENT_TYPE),gw.EVENT_TYPE),fw.EVENT_TYPE),Sd={onClickCell:Ht.CLICK_CELL,onDblClickCell:Ht.DBLCLICK_CELL,onMouseDownCell:Ht.MOUSEDOWN_CELL,onMouseUpCell:Ht.MOUSEUP_CELL,onSelectedCell:Ht.SELECTED_CELL,onKeyDown:Ht.KEYDOWN,onMouseEnterTable:Ht.MOUSEENTER_TABLE,onMouseLeaveTable:Ht.MOUSELEAVE_TABLE,onMouseMoveCell:Ht.MOUSEMOVE_CELL,onMouseEnterCell:Ht.MOUSEENTER_CELL,onMouseLeaveCell:Ht.MOUSELEAVE_CELL,onContextMenuCell:Ht.CONTEXTMENU_CELL,onResizeColumn:Ht.RESIZE_COLUMN,onResizeColumnEnd:Ht.RESIZE_COLUMN_END,onChangeHeaderPosition:Ht.CHANGE_HEADER_POSITION,onSortClick:Ht.SORT_CLICK,onFreezeClick:Ht.FREEZE_CLICK,onScroll:Ht.SCROLL,onDropdownMenuClick:Ht.DROPDOWN_MENU_CLICK,onMouseOverChartSymbol:Ht.MOUSEOVER_CHART_SYMBOL,onDragSelectEnd:Ht.DRAG_SELECT_END,onDropdownIconClick:Ht.DROPDOWN_ICON_CLICK,onDropdownMenuClear:Ht.DROPDOWN_MENU_CLEAR,onTreeHierarchyStateChange:Ht.TREE_HIERARCHY_STATE_CHANGE,onShowMenu:Ht.SHOW_MENU,onHideMenu:Ht.HIDE_MENU,onIconClick:Ht.ICON_CLICK,onLegendItemClick:Ht.LEGEND_ITEM_CLICK,onLegendItemHover:Ht.LEGEND_ITEM_HOVER,onLegendItemUnHover:Ht.LEGEND_ITEM_UNHOVER,onLegendChange:Ht.LEGEND_CHANGE,onMouseEnterAxis:Ht.MOUSEENTER_AXIS,onMouseLeaveAxis:Ht.MOUSELEAVE_AXIS,onCheckboxStateChange:Ht.CHECKBOX_STATE_CHANGE,onAfterRender:Ht.AFTER_RENDER,onInitialized:Ht.INITIALIZED,onPivotSortClick:Ht.PIVOT_SORT_CLICK,onDrillMenuClick:Ht.DRILLMENU_CLICK,onVChartEventType:Ht.VCHART_EVENT_TYPE},jO=Object.keys(Sd),vw=(n,t=Sd)=>{const e={};return Object.keys(n).forEach(i=>{t[i]&&n[i]&&(e[i]=n[i])}),e},VO=(n,t,e,i=Sd)=>{if(!t&&!e||!n)return!1;const r=e?vw(e,i):null,o=t?vw(t,i):null;return r&&Object.keys(r).forEach(s=>{o&&o[s]&&o[s]===r[s]||n.off(i[s],e[s])}),o&&Object.keys(o).forEach(s=>{r&&r[s]&&r[s]===o[s]||n.on(i[s],o[s])}),!0},mw=[...NO,...jO,"skipFunctionDiff","onError","onReady","option","records","container"],Cw=(n,t)=>`${n&&n.type&&(n.type.displayName||n.type.name)}-${t}`,GO=n=>{const t={};return Dd(n.children).map((e,i)=>{const r=e&&e.type&&e.type.parseOption;if(r&&e.props){const o=r(ut(e.props.componentId)?Object.assign(Object.assign({},e.props),{componentId:Cw(e,i)}):e.props);o.isSingle?t[o.optionName]=o.option:(t[o.optionName]||(t[o.optionName]=[]),t[o.optionName].push(o.option))}}),t},UO=se.forwardRef((n,t)=>{const[e,i]=(0,se.useState)(0),r=(0,se.useRef)({});(0,se.useImperativeHandle)(t,()=>{var m;return(m=r.current)===null||m===void 0?void 0:m.table});const o=!!n.option,s=!!n.records,a=(0,se.useRef)(!1),l=(0,se.useRef)(ef(n,mw)),h=(0,se.useRef)(null),u=(0,se.useRef)(n.records),d=se.useRef(null),c=!!n.skipFunctionDiff,g=(0,se.useCallback)(m=>o&&m.option?s&&m.records?Object.assign(Object.assign({},m.option),{records:m.records}):m.option:Object.assign(Object.assign({records:m.records},l.current),h.current),[o,s]),f=(0,se.useCallback)(m=>{let C;C=m.type==="pivot-table"?new gw(m.container,g(m)):m.type==="pivot-chart"?new fw(m.container,g(m)):new uw(m.container,g(m)),r.current=Object.assign(Object.assign({},r.current),{table:C}),a.current=!1},[g]),p=(0,se.useCallback)(()=>{if(!a.current){if(!r.current||!r.current.table)return;VO(r.current.table,n,d.current,Sd),i(e+1),n.onReady&&n.onReady(r.current.table,e===0)}},[e,i,n]),v=(0,se.useCallback)(()=>{r.current.table&&(r.current.table.render(),p())},[p]);return(0,se.useEffect)(()=>{var m,C;const b=o?null:GO(n);if(!(!((m=r.current)===null||m===void 0)&&m.table))return o||(h.current=b),f(n),v(),void(d.current=n);if(o)return void(cr(d.current.option,n.option,{skipFunction:c})?s&&!cr(d.current.records,n.records,{skipFunction:c})&&(d.current=n,r.current.table.setRecords(n.records,{restoreHierarchyState:n.option.restoreHierarchyState}),p()):(d.current=n,r.current.table.updateOption(g(n)),p()));const _=ef(n,mw);cr(_,l.current,{skipFunction:c})&&cr(b,h.current,{skipFunction:c})?s&&!cr(n.records,u.current,{skipFunction:c})&&(u.current=n.records,r.current.table.setRecords(n.records,{restoreHierarchyState:(C=n.option)===null||C===void 0?void 0:C.restoreHierarchyState}),p()):(l.current=_,h.current=b,r.current.table.updateOption(g(n)),p())},[f,o,s,g,p,v,c,n]),(0,se.useEffect)(()=>()=>{r&&r.current&&r.current.table&&(r.current.table.release(),r.current=null),d.current=null,a.current=!0},[]),se.createElement(IO.Provider,{value:r.current},Dd(n.children).map((m,C)=>{if(typeof m=="string")return;const b=Cw(m,C);return se.createElement(se.Fragment,{key:b},se.cloneElement(m,{updateId:e,componentId:b}))}))}),KO=((n,t,e)=>{const i=kO(UO,n,r=>(r.type=t,e?e(r):t?Object.assign(Object.assign({},r),{type:t}):r));return i.displayName=n,i})("ListTable","list-table")},11829:function(vr,vn){"use strict";var mt;var _i=Symbol.for("react.element"),mn=Symbol.for("react.portal"),Gt=Symbol.for("react.fragment"),ht=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),qt=Symbol.for("react.provider"),bt=Symbol.for("react.context"),Dt=Symbol.for("react.server_context"),yt=Symbol.for("react.forward_ref"),Zt=Symbol.for("react.suspense"),Jt=Symbol.for("react.suspense_list"),wt=Symbol.for("react.memo"),Ae=Symbol.for("react.lazy"),xt=Symbol.for("react.offscreen"),le;le=Symbol.for("react.module.reference");function ve(st){if(typeof st=="object"&&st!==null){var hi=st.$$typeof;switch(hi){case _i:switch(st=st.type,st){case Gt:case re:case ht:case Zt:case Jt:return st;default:switch(st=st&&st.$$typeof,st){case Dt:case bt:case yt:case Ae:case wt:case qt:return st;default:return hi}}case mn:return hi}}}mt=bt,mt=qt,mt=_i,mt=yt,mt=Gt,mt=Ae,mt=wt,mt=mn,mt=re,mt=ht,mt=Zt,mt=Jt,mt=function(){return!1},mt=function(){return!1},mt=function(st){return ve(st)===bt},mt=function(st){return ve(st)===qt},mt=function(st){return typeof st=="object"&&st!==null&&st.$$typeof===_i},mt=function(st){return ve(st)===yt},vn.isFragment=function(st){return ve(st)===Gt},mt=function(st){return ve(st)===Ae},mt=function(st){return ve(st)===wt},mt=function(st){return ve(st)===mn},mt=function(st){return ve(st)===re},mt=function(st){return ve(st)===ht},mt=function(st){return ve(st)===Zt},mt=function(st){return ve(st)===Jt},mt=function(st){return typeof st=="string"||typeof st=="function"||st===Gt||st===re||st===ht||st===Zt||st===Jt||st===xt||typeof st=="object"&&st!==null&&(st.$$typeof===Ae||st.$$typeof===wt||st.$$typeof===qt||st.$$typeof===bt||st.$$typeof===yt||st.$$typeof===le||st.getModuleId!==void 0)},mt=ve},27:function(vr,vn,mt){"use strict";vr.exports=mt(11829)},10407:function(vr){var vn={},mt=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),_i=["style","variant","weight","size","lineHeight","family"],mn=/([\.0-9]+)(.*)/,Gt=function(bt,Dt,yt){var Zt=bt.match(mn);if(Zt){bt=parseFloat(Zt[1]);var Jt=Zt[2].toLowerCase().trim(),wt=Math.round(bt);switch(wt===bt&&(bt=wt),Jt){case"em":return Dt===null?void 0:bt*Dt;case"px":return bt;case"pt":return bt/(72/yt);case"pc":return bt/(6/yt);case"mm":return bt*(yt/25.4);case"cm":return bt*(yt/2.54);case"in":return bt*yt;case"%":return Dt===null?void 0:Dt*(bt/100)}}},ht={size:Gt,lineHeight:Gt},re={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},qt=vr.exports=function(bt,Dt,yt){var Zt=bt+"-"+(Dt||"null")+"@"+yt;if(yt=yt||96,typeof vn[Zt]!="undefined")return vn[Zt];if(Dt&&(Dt=qt(Dt,null,yt)),bt==="inherit")return Dt;var Jt=mt.exec(bt);if(!Jt){vn[Zt]=null;return}Jt.shift();for(var wt={},Ae=0;Ae<Jt.length;Ae++){var xt=_i[Ae],le=Jt[Ae];if(ht[xt]&&le){var ve=Dt&&Dt[xt]||null,st=ht[xt](le,ve,yt);typeof st=="undefined"&&xt==="lineHeight"&&le?le=wt.size*parseFloat(le):le=st}if(!(!le||le==="normal")){if(le==="inherit"){if(!Dt)return;le=Dt[xt]}le.trim&&(le=le.trim()),wt[xt]=le}}Object.keys(wt).length||(wt=null),vn[Zt]=wt;var hi=[];wt.style&&hi.push(wt.style),wt.variant&&hi.push(wt.variant),wt.weight&&wt.weight!=="400"&&wt.weight!=="normal"&&hi.push(wt.weight),hi.push(wt.size+"px"),wt.lineHeight&&(hi[hi.length-1]+="/"+wt.lineHeight+"px");var Fi=wt.family.split(",");return wt.family=Fi.map(function(Z){return Z=Z.trim(),re[Z.toLowerCase()]&&(Z=Z.toLowerCase()),Z}),hi.push(wt.family),Object.defineProperty(wt,"toString",{value:function(){return hi.map(function(Z){return Array.isArray(Z)?Z.map(function(Lr){return Lr.indexOf(" ")>-1?'"'+Lr.replace(/["']/g,"")+'"':Lr}).join(", "):Z}).join(" ")}}),wt};vr.exports.generics=re},26729:function(vr){"use strict";var vn=Object.prototype.hasOwnProperty,mt="~";function _i(){}Object.create&&(_i.prototype=Object.create(null),new _i().__proto__||(mt=!1));function mn(qt,bt,Dt){this.fn=qt,this.context=bt,this.once=Dt||!1}function Gt(qt,bt,Dt,yt,Zt){if(typeof Dt!="function")throw new TypeError("The listener must be a function");var Jt=new mn(Dt,yt||qt,Zt),wt=mt?mt+bt:bt;return qt._events[wt]?qt._events[wt].fn?qt._events[wt]=[qt._events[wt],Jt]:qt._events[wt].push(Jt):(qt._events[wt]=Jt,qt._eventsCount++),qt}function ht(qt,bt){--qt._eventsCount===0?qt._events=new _i:delete qt._events[bt]}function re(){this._events=new _i,this._eventsCount=0}re.prototype.eventNames=function(){var bt=[],Dt,yt;if(this._eventsCount===0)return bt;for(yt in Dt=this._events)vn.call(Dt,yt)&&bt.push(mt?yt.slice(1):yt);return Object.getOwnPropertySymbols?bt.concat(Object.getOwnPropertySymbols(Dt)):bt},re.prototype.listeners=function(bt){var Dt=mt?mt+bt:bt,yt=this._events[Dt];if(!yt)return[];if(yt.fn)return[yt.fn];for(var Zt=0,Jt=yt.length,wt=new Array(Jt);Zt<Jt;Zt++)wt[Zt]=yt[Zt].fn;return wt},re.prototype.listenerCount=function(bt){var Dt=mt?mt+bt:bt,yt=this._events[Dt];return yt?yt.fn?1:yt.length:0},re.prototype.emit=function(bt,Dt,yt,Zt,Jt,wt){var Ae=mt?mt+bt:bt;if(!this._events[Ae])return!1;var xt=this._events[Ae],le=arguments.length,ve,st;if(xt.fn){switch(xt.once&&this.removeListener(bt,xt.fn,void 0,!0),le){case 1:return xt.fn.call(xt.context),!0;case 2:return xt.fn.call(xt.context,Dt),!0;case 3:return xt.fn.call(xt.context,Dt,yt),!0;case 4:return xt.fn.call(xt.context,Dt,yt,Zt),!0;case 5:return xt.fn.call(xt.context,Dt,yt,Zt,Jt),!0;case 6:return xt.fn.call(xt.context,Dt,yt,Zt,Jt,wt),!0}for(st=1,ve=new Array(le-1);st<le;st++)ve[st-1]=arguments[st];xt.fn.apply(xt.context,ve)}else{var hi=xt.length,Fi;for(st=0;st<hi;st++)switch(xt[st].once&&this.removeListener(bt,xt[st].fn,void 0,!0),le){case 1:xt[st].fn.call(xt[st].context);break;case 2:xt[st].fn.call(xt[st].context,Dt);break;case 3:xt[st].fn.call(xt[st].context,Dt,yt);break;case 4:xt[st].fn.call(xt[st].context,Dt,yt,Zt);break;default:if(!ve)for(Fi=1,ve=new Array(le-1);Fi<le;Fi++)ve[Fi-1]=arguments[Fi];xt[st].fn.apply(xt[st].context,ve)}}return!0},re.prototype.on=function(bt,Dt,yt){return Gt(this,bt,Dt,yt,!1)},re.prototype.once=function(bt,Dt,yt){return Gt(this,bt,Dt,yt,!0)},re.prototype.removeListener=function(bt,Dt,yt,Zt){var Jt=mt?mt+bt:bt;if(!this._events[Jt])return this;if(!Dt)return ht(this,Jt),this;var wt=this._events[Jt];if(wt.fn)wt.fn===Dt&&(!Zt||wt.once)&&(!yt||wt.context===yt)&&ht(this,Jt);else{for(var Ae=0,xt=[],le=wt.length;Ae<le;Ae++)(wt[Ae].fn!==Dt||Zt&&!wt[Ae].once||yt&&wt[Ae].context!==yt)&&xt.push(wt[Ae]);xt.length?this._events[Jt]=xt.length===1?xt[0]:xt:ht(this,Jt)}return this},re.prototype.removeAllListeners=function(bt){var Dt;return bt?(Dt=mt?mt+bt:bt,this._events[Dt]&&ht(this,Dt)):(this._events=new _i,this._eventsCount=0),this},re.prototype.off=re.prototype.removeListener,re.prototype.addListener=re.prototype.on,re.prefixed=mt,re.EventEmitter=re,vr.exports=re}}]);
